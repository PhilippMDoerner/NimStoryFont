(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[3689],{"./node_modules/tinymce/tinymce.js":(module,__unused_webpack_exports,__webpack_require__)=>{var _asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/asyncToGenerator.js").default;!function(){"use strict";var typeOf$1=function(x){if(null===x)return"null";if(void 0===x)return"undefined";var t=typeof x;return"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},eq$2=function(f){return{eq:f}},eqString=eq$2((function(x,y){return x===y})),eqArray=function(eqa){return eq$2((function(x,y){if(x.length!==y.length)return!1;for(var len=x.length,i=0;i<len;i++)if(!eqa.eq(x[i],y[i]))return!1;return!0}))},eqSortedArray=function(eqa,compareFn){return function(eqa,f){return eq$2((function(x,y){return eqa.eq(f(x),f(y))}))}(eqArray(eqa),(function(xs){return function(xs,compareFn){return Array.prototype.slice.call(xs).sort(compareFn)}(xs,compareFn)}))},eqRecord=function(eqa){return eq$2((function(x,y){var kx=Object.keys(x),ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky))return!1;for(var len=kx.length,i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q]))return!1}return!0}))},eqAny=eq$2((function(x,y){if(x===y)return!0;var tx=typeOf$1(x);return tx===typeOf$1(y)&&(function(x){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(x)}(tx)?x===y:"array"===tx?eqArray(eqAny).eq(x,y):"object"===tx&&eqRecord(eqAny).eq(x,y))}));const getPrototypeOf$2=Object.getPrototypeOf,hasProto=(v,constructor,predicate)=>{var _a;return!!predicate(v,constructor.prototype)||(null===(_a=v.constructor)||void 0===_a?void 0:_a.name)===constructor.name},isType$1=type=>value=>(x=>{const t=typeof x;return null===x?"null":"object"===t&&Array.isArray(x)?"array":"object"===t&&hasProto(x,String,((o,proto)=>proto.isPrototypeOf(o)))?"string":t})(value)===type,isSimpleType=type=>value=>typeof value===type,eq$1=t=>a=>t===a,is$4=(value,constructor)=>isObject(value)&&hasProto(value,constructor,((o,proto)=>getPrototypeOf$2(o)===proto)),isString=isType$1("string"),isObject=isType$1("object"),isPlainObject=value=>is$4(value,Object),isArray$1=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=a=>null==a,isNonNullable=a=>!isNullable(a),isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),isArrayOf=(value,pred)=>{if(isArray$1(value)){for(let i=0,len=value.length;i<len;++i)if(!pred(value[i]))return!1;return!0}return!1},noop=()=>{},compose=(fa,fb)=>(...args)=>fa(fb.apply(null,args)),compose1=(fbc,fab)=>a=>fbc(fab(a)),constant=value=>()=>value,identity=x=>x,tripleEquals=(a,b)=>a===b;function curry(fn,...initialArgs){return(...restArgs)=>{const all=initialArgs.concat(restArgs);return fn.apply(null,all)}}const not=f=>t=>!f(t),die=msg=>()=>{throw new Error(msg)},apply$1=f=>f(),call=f=>{f()},never=constant(!1),always=constant(!0);class Optional{constructor(tag,value){this.tag=tag,this.value=value}static some(value){return new Optional(!0,value)}static none(){return Optional.singletonNone}fold(onNone,onSome){return this.tag?onSome(this.value):onNone()}isSome(){return this.tag}isNone(){return!this.tag}map(mapper){return this.tag?Optional.some(mapper(this.value)):Optional.none()}bind(binder){return this.tag?binder(this.value):Optional.none()}exists(predicate){return this.tag&&predicate(this.value)}forall(predicate){return!this.tag||predicate(this.value)}filter(predicate){return!this.tag||predicate(this.value)?this:Optional.none()}getOr(replacement){return this.tag?this.value:replacement}or(replacement){return this.tag?this:replacement}getOrThunk(thunk){return this.tag?this.value:thunk()}orThunk(thunk){return this.tag?this:thunk()}getOrDie(message){if(this.tag)return this.value;throw new Error(null!=message?message:"Called getOrDie on None")}static from(value){return isNonNullable(value)?Optional.some(value):Optional.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(worker){this.tag&&worker(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}Optional.singletonNone=new Optional(!1);const nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=(ts,t)=>nativeIndexOf.call(ts,t),contains$2=(xs,x)=>rawIndexOf(xs,x)>-1,exists=(xs,pred)=>{for(let i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return!0}return!1},map$3=(xs,f)=>{const len=xs.length,r=new Array(len);for(let i=0;i<len;i++){const x=xs[i];r[i]=f(x,i)}return r},each$e=(xs,f)=>{for(let i=0,len=xs.length;i<len;i++){f(xs[i],i)}},eachr=(xs,f)=>{for(let i=xs.length-1;i>=0;i--){f(xs[i],i)}},partition$2=(xs,pred)=>{const pass=[],fail=[];for(let i=0,len=xs.length;i<len;i++){const x=xs[i];(pred(x,i)?pass:fail).push(x)}return{pass,fail}},filter$5=(xs,pred)=>{const r=[];for(let i=0,len=xs.length;i<len;i++){const x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=(xs,f,acc)=>(eachr(xs,((x,i)=>{acc=f(acc,x,i)})),acc),foldl=(xs,f,acc)=>(each$e(xs,((x,i)=>{acc=f(acc,x,i)})),acc),findUntil$1=(xs,pred,until)=>{for(let i=0,len=xs.length;i<len;i++){const x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$2=(xs,pred)=>findUntil$1(xs,pred,never),findIndex$2=(xs,pred)=>{for(let i=0,len=xs.length;i<len;i++){if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},flatten=xs=>{const r=[];for(let i=0,len=xs.length;i<len;++i){if(!isArray$1(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$3=(xs,f)=>flatten(map$3(xs,f)),forall=(xs,pred)=>{for(let i=0,len=xs.length;i<len;++i){if(!0!==pred(xs[i],i))return!1}return!0},reverse=xs=>{const r=nativeSlice.call(xs,0);return r.reverse(),r},difference=(a1,a2)=>filter$5(a1,(x=>!contains$2(a2,x))),mapToObject=(xs,f)=>{const r={};for(let i=0,len=xs.length;i<len;i++){const x=xs[i];r[String(x)]=f(x,i)}return r},sort=(xs,comparator)=>{const copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get$b=(xs,i)=>i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none(),head=xs=>get$b(xs,0),last$3=xs=>get$b(xs,xs.length-1),from=isFunction(Array.from)?Array.from:x=>nativeSlice.call(x),findMap=(arr,f)=>{for(let i=0;i<arr.length;i++){const r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty$1=Object.hasOwnProperty,each$d=(obj,f)=>{const props=keys(obj);for(let k=0,len=props.length;k<len;k++){const i=props[k];f(obj[i],i)}},map$2=(obj,f)=>tupleMap(obj,((x,i)=>({k:i,v:f(x,i)}))),tupleMap=(obj,f)=>{const r={};return each$d(obj,((x,i)=>{const tuple=f(x,i);r[tuple.k]=tuple.v})),r},objAcc=r=>(x,i)=>{r[i]=x},internalFilter=(obj,pred,onTrue,onFalse)=>{each$d(obj,((x,i)=>{(pred(x,i)?onTrue:onFalse)(x,i)}))},filter$4=(obj,pred)=>{const t={};return internalFilter(obj,pred,objAcc(t),noop),t},mapToArray=(obj,f)=>{const r=[];return each$d(obj,((value,name)=>{r.push(f(value,name))})),r},values=obj=>mapToArray(obj,identity),get$a=(obj,key)=>has$2(obj,key)?Optional.from(obj[key]):Optional.none(),has$2=(obj,key)=>hasOwnProperty$1.call(obj,key),hasNonNullableKey=(obj,key)=>has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key],stringArray=a=>{const all={};return each$e(a,(key=>{all[key]={}})),keys(all)},isArrayLike=o=>void 0!==o.length,isArray=Array.isArray,each$c=(o,cb,s)=>{if(!o)return!1;if(s=s||o,isArrayLike(o)){for(let n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return!1}else for(const n in o)if(has$2(o,n)&&!1===cb.call(s,o[n],n,o))return!1;return!0},map$1=(array,callback)=>{const out=[];return each$c(array,((item,index)=>{out.push(callback(item,index,array))})),out},filter$3=(a,f)=>{const o=[];return each$c(a,((v,index)=>{f&&!f(v,index,a)||o.push(v)})),o},reduce=(collection,iteratee,accumulator,thisArg)=>{let acc=isUndefined(accumulator)?collection[0]:accumulator;for(let i=0;i<collection.length;i++)acc=iteratee.call(thisArg,acc,collection[i],i);return acc},findIndex$1=(array,predicate,thisArg)=>{for(let i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1},last$2=collection=>collection[collection.length-1],cached=f=>{let r,called=!1;return(...args)=>(called||(called=!0,r=f.apply(null,args)),r)},unknown$2=()=>nu$3(0,0),nu$3=(major,minor)=>({major,minor}),Version={nu:nu$3,detect:(versionRegexes,agent)=>{const cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$2():((regexes,agent)=>{const r=((regexes,s)=>{for(let i=0;i<regexes.length;i++){const x=regexes[i];if(x.test(s))return x}})(regexes,agent);if(!r)return{major:0,minor:0};const group=i=>Number(agent.replace(r,"$"+i));return nu$3(group(1),group(2))})(versionRegexes,cleanedAgent)},unknown:unknown$2},detect$4=(candidates,userAgent)=>{const agent=String(userAgent).toLowerCase();return find$2(candidates,(candidate=>candidate.search(agent)))},checkRange=(str,substr,start)=>""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr,removeLeading=(str,prefix)=>startsWith(str,prefix)?((str,numChars)=>str.substring(numChars))(str,prefix.length):str,contains$1=(str,substr,start=0,end)=>{const idx=str.indexOf(substr,start);return-1!==idx&&(!!isUndefined(end)||idx+substr.length<=end)},startsWith=(str,prefix)=>checkRange(str,prefix,0),endsWith=(str,suffix)=>checkRange(str,suffix,str.length-suffix.length),blank=r=>s=>s.replace(r,""),trim$4=blank(/^\s+|\s+$/g),lTrim=blank(/^\s+/g),rTrim=blank(/\s+$/g),isNotEmpty=s=>s.length>0,isEmpty$3=s=>!isNotEmpty(s),toInt=(value,radix=10)=>{const num=parseInt(value,radix);return isNaN(num)?Optional.none():Optional.some(num)},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=target=>uastring=>contains$1(uastring,target),browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:uastring=>contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:uastring=>contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:uastring=>contains$1(uastring,"msie")||contains$1(uastring,"trident")},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:uastring=>(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:uastring=>contains$1(uastring,"iphone")||contains$1(uastring,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(browsers),oses:constant(oses)},nu$2=info=>{const current=info.current,version=info.version,isBrowser=name=>()=>current===name;return{current,version,isEdge:isBrowser("Edge"),isChromium:isBrowser("Chromium"),isIE:isBrowser("IE"),isOpera:isBrowser("Opera"),isFirefox:isBrowser("Firefox"),isSafari:isBrowser("Safari")}},Browser={unknown:()=>nu$2({current:void 0,version:Version.unknown()}),nu:nu$2,edge:constant("Edge"),chromium:constant("Chromium"),ie:constant("IE"),opera:constant("Opera"),firefox:constant("Firefox"),safari:constant("Safari")},nu$1=info=>{const current=info.current,version=info.version,isOS=name=>()=>current===name;return{current,version,isWindows:isOS("Windows"),isiOS:isOS("iOS"),isAndroid:isOS("Android"),isMacOS:isOS("macOS"),isLinux:isOS("Linux"),isSolaris:isOS("Solaris"),isFreeBSD:isOS("FreeBSD"),isChromeOS:isOS("ChromeOS")}},OperatingSystem={unknown:()=>nu$1({current:void 0,version:Version.unknown()}),nu:nu$1,windows:constant("Windows"),ios:constant("iOS"),android:constant("Android"),linux:constant("Linux"),macos:constant("macOS"),solaris:constant("Solaris"),freebsd:constant("FreeBSD"),chromeos:constant("ChromeOS")},PlatformDetection_detect=(userAgent,userAgentDataOpt,mediaMatch)=>{const browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((userAgentData=>((browsers,userAgentData)=>findMap(userAgentData.brands,(uaBrand=>{const lcBrand=uaBrand.brand.toLowerCase();return find$2(browsers,(browser=>{var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((info=>({current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)})))})))(browsers,userAgentData))).orThunk((()=>((browsers,userAgent)=>detect$4(browsers,userAgent).map((browser=>{const version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version}})))(browsers,userAgent))).fold(Browser.unknown,Browser.nu),os=((oses,userAgent)=>detect$4(oses,userAgent).map((os=>{const version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version}})))(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType=((os,browser,userAgent,mediaMatch)=>{const isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)}})(os,browser,userAgent,mediaMatch);return{browser,os,deviceType}},mediaMatch=query=>window.matchMedia(query).matches;let platform$4=cached((()=>PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)));const detect$2=()=>platform$4(),userAgent=navigator.userAgent,platform$3=detect$2(),browser$3=platform$3.browser,os$1=platform$3.os,deviceType=platform$3.deviceType,windowsPhone=-1!==userAgent.indexOf("Windows Phone"),Env={transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",documentMode:browser$3.isIE()?document.documentMode||7:10,cacheSuffix:null,container:null,canHaveCSP:!browser$3.isIE(),windowsPhone,browser:{current:browser$3.current,version:browser$3.version,isChromium:browser$3.isChromium,isEdge:browser$3.isEdge,isFirefox:browser$3.isFirefox,isIE:browser$3.isIE,isOpera:browser$3.isOpera,isSafari:browser$3.isSafari},os:{current:os$1.current,version:os$1.version,isAndroid:os$1.isAndroid,isChromeOS:os$1.isChromeOS,isFreeBSD:os$1.isFreeBSD,isiOS:os$1.isiOS,isLinux:os$1.isLinux,isMacOS:os$1.isMacOS,isSolaris:os$1.isSolaris,isWindows:os$1.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}},whiteSpaceRegExp$1=/^\s*|\s*$/g,trim$3=str=>isNullable(str)?"":(""+str).replace(whiteSpaceRegExp$1,""),walk$4=function(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),each$c(o,((o,i)=>!1!==f.call(s,o,i,n)&&(walk$4(o,f,n,s),!0))))},Tools={trim:trim$3,isArray,is:(obj,type)=>type?!("array"!==type||!isArray(obj))||typeof obj===type:void 0!==obj,toArray:obj=>{if(isArray(obj))return obj;{const array=[];for(let i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array}},makeMap:(items,delim,map={})=>{const resolvedItems=isString(items)?items.split(delim||","):items||[];let i=resolvedItems.length;for(;i--;)map[resolvedItems[i]]={};return map},each:each$c,map:map$1,grep:filter$3,inArray:(a,v)=>{if(a)for(let i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},hasOwn:has$2,extend:(obj,...exts)=>{for(let i=0;i<exts.length;i++){const ext=exts[i];for(const name in ext)if(has$2(ext,name)){const value=ext[name];void 0!==value&&(obj[name]=value)}}return obj},walk:walk$4,resolve:(n,o=window)=>{const path=n.split(".");for(let i=0,l=path.length;i<l&&(o=o[path[i]]);i++);return o},explode:(s,d)=>isArray$1(s)?s:""===s?[]:map$1(s.split(d||","),trim$3),_addCacheSuffix:url=>{const cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}},is$2=(lhs,rhs,comparator=tripleEquals)=>lhs.exists((left=>comparator(left,rhs))),equals=(lhs,rhs,comparator=tripleEquals)=>lift2(lhs,rhs,comparator).getOr(lhs.isNone()&&rhs.isNone()),lift2=(oa,ob,f)=>oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none(),someIf=(b,a)=>b?Optional.some(a):Optional.none(),Global="undefined"!=typeof window?window:Function("return this;")(),resolve$2=(p,scope)=>((parts,scope)=>{let o=null!=scope?scope:Global;for(let i=0;i<parts.length&&null!=o;++i)o=o[parts[i]];return o})(p.split("."),scope),getOrDie=(name,scope)=>{const actual=((name,scope)=>resolve$2(name,scope))(name,scope);if(null==actual)throw new Error(name+" not available on this browser");return actual},getPrototypeOf$1=Object.getPrototypeOf,isPrototypeOf=x=>{const scope=resolve$2("ownerDocument.defaultView",x);return isObject(x)&&((scope=>getOrDie("HTMLElement",scope))(scope).prototype.isPrototypeOf(x)||/^HTML\w*Element$/.test(getPrototypeOf$1(x).constructor.name))},name=element=>element.dom.nodeName.toLowerCase(),type$1=element=>element.dom.nodeType,isType=t=>element=>type$1(element)===t,isHTMLElement$1=element=>isElement$7(element)&&isPrototypeOf(element.dom),isElement$7=isType(1),isText$b=isType(3),isDocument$2=isType(9),isDocumentFragment$1=isType(11),isTag=tag=>e=>isElement$7(e)&&name(e)===tag,rawSet=(dom,key,value)=>{if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$3=(element,key,value)=>{rawSet(element.dom,key,value)},setAll$1=(element,attrs)=>{const dom=element.dom;each$d(attrs,((v,k)=>{rawSet(dom,k,v)}))},get$9=(element,key)=>{const v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=(element,key)=>Optional.from(get$9(element,key)),has$1=(element,key)=>{const dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)},remove$a=(element,key)=>{element.dom.removeAttribute(key)},clone$4=element=>foldl(element.dom.attributes,((acc,attr)=>(acc[attr.name]=attr.value,acc)),{}),read$4=(element,attr)=>{const value=get$9(element,attr);return void 0===value||""===value?[]:value.split(" ")},supports=element=>void 0!==element.dom.classList,get$8=element=>read$4(element,"class"),add$3=(element,clazz)=>((element,attr,id)=>{const nu=read$4(element,attr).concat([id]);return set$3(element,attr,nu.join(" ")),!0})(element,"class",clazz),remove$8=(element,clazz)=>((element,attr,id)=>{const nu=filter$5(read$4(element,attr),(v=>v!==id));return nu.length>0?set$3(element,attr,nu.join(" ")):remove$a(element,attr),!1})(element,"class",clazz),add$2=(element,clazz)=>{supports(element)?element.dom.classList.add(clazz):add$3(element,clazz)},cleanClass=element=>{0===(supports(element)?element.dom.classList:get$8(element)).length&&remove$a(element,"class")},remove$7=(element,clazz)=>{if(supports(element)){element.dom.classList.remove(clazz)}else remove$8(element,clazz);cleanClass(element)},toggle$1=(element,clazz)=>{const result=supports(element)?element.dom.classList.toggle(clazz):((element,clazz)=>contains$2(get$8(element),clazz)?remove$8(element,clazz):add$3(element,clazz))(element,clazz);return cleanClass(element),result},has=(element,clazz)=>supports(element)&&element.dom.classList.contains(clazz),fromDom$2=node=>{if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},SugarElement={fromHtml:(html,scope)=>{const div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1){const message="HTML does not have a single root node";throw console.error(message,html),new Error(message)}return fromDom$2(div.childNodes[0])},fromTag:(tag,scope)=>{const node=(scope||document).createElement(tag);return fromDom$2(node)},fromText:(text,scope)=>{const node=(scope||document).createTextNode(text);return fromDom$2(node)},fromDom:fromDom$2,fromPoint:(docElm,x,y)=>Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom$2)},toArray=(target,f)=>{const r=[],recurse=e=>(r.push(e),f(e));let cur=f(target);do{cur=cur.bind(recurse)}while(cur.isSome());return r},is$1=(element,selector)=>{const dom=element.dom;if(1!==dom.nodeType)return!1;{const elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")}},bypassSelector=dom=>1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount,eq=(e1,e2)=>e1.dom===e2.dom,contains=(e1,e2)=>{const d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)},owner$1=element=>SugarElement.fromDom(element.dom.ownerDocument),documentOrOwner=dos=>isDocument$2(dos)?dos:owner$1(dos),defaultView=element=>SugarElement.fromDom(documentOrOwner(element).dom.defaultView),parent=element=>Optional.from(element.dom.parentNode).map(SugarElement.fromDom),parentElement=element=>Optional.from(element.dom.parentElement).map(SugarElement.fromDom),parents$1=(element,isRoot)=>{const stop=isFunction(isRoot)?isRoot:never;let dom=element.dom;const ret=[];for(;null!==dom.parentNode&&void 0!==dom.parentNode;){const rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret},prevSibling=element=>Optional.from(element.dom.previousSibling).map(SugarElement.fromDom),nextSibling=element=>Optional.from(element.dom.nextSibling).map(SugarElement.fromDom),prevSiblings=element=>reverse(toArray(element,prevSibling)),nextSiblings=element=>toArray(element,nextSibling),children$1=element=>map$3(element.dom.childNodes,SugarElement.fromDom),child$1=(element,index)=>{const cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},firstChild=element=>child$1(element,0),lastChild=element=>child$1(element,element.dom.childNodes.length-1),childNodesCount=element=>element.dom.childNodes.length,isShadowRoot=dos=>isDocumentFragment$1(dos)&&isNonNullable(dos.dom.host),supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported$1=constant(supported),getRootNode=supported?e=>SugarElement.fromDom(e.dom.getRootNode()):documentOrOwner,getStyleContainer=dos=>isShadowRoot(dos)?dos:(doc=>{const b=doc.dom.head;if(null==b)throw new Error("Head is not available yet");return SugarElement.fromDom(b)})(documentOrOwner(dos)),getShadowHost=e=>SugarElement.fromDom(e.dom.host),getOriginalEventTarget=event=>{if(isSupported$1()&&isNonNullable(event.target)){const el=SugarElement.fromDom(event.target);if(isElement$7(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){const composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)},isOpenShadowHost=element=>isNonNullable(element.dom.shadowRoot),inBody=element=>{const dom=isText$b(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;const doc=dom.ownerDocument;return(e=>{const r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()})(SugarElement.fromDom(dom)).fold((()=>doc.body.contains(dom)),compose1(inBody,getShadowHost))};var ClosestOrAncestor=(is,ancestor,scope,a,isRoot)=>is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot);const ancestor$4=(scope,predicate,isRoot)=>{let element=scope.dom;const stop=isFunction(isRoot)?isRoot:never;for(;element.parentNode;){element=element.parentNode;const el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$4=(scope,predicate,isRoot)=>ClosestOrAncestor(((s,test)=>test(s)),ancestor$4,scope,predicate,isRoot),child=(scope,predicate)=>find$2(scope.dom.childNodes,(node=>predicate(SugarElement.fromDom(node)))).map(SugarElement.fromDom),descendant$2=(scope,predicate)=>{const descend=node=>{for(let i=0;i<node.childNodes.length;i++){const child=SugarElement.fromDom(node.childNodes[i]);if(predicate(child))return Optional.some(child);const res=descend(node.childNodes[i]);if(res.isSome())return res}return Optional.none()};return descend(scope.dom)},ancestor$3=(scope,selector,isRoot)=>ancestor$4(scope,(e=>is$1(e,selector)),isRoot),descendant$1=(scope,selector)=>((selector,scope)=>{const base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)})(selector,scope),closest$3=(scope,selector,isRoot)=>ClosestOrAncestor(((element,selector)=>is$1(element,selector)),ancestor$3,scope,selector,isRoot),isEditable$2=(element,assumeEditable=!1)=>{return inBody(element)?element.dom.isContentEditable:(target=element,closest$3(target,"[contenteditable]")).fold(constant(assumeEditable),(editable=>"true"===getRaw$1(editable)));var target},getRaw$1=element=>element.dom.contentEditable,isSupported=dom=>void 0!==dom.style&&isFunction(dom.style.getPropertyValue),internalSet=(dom,property,value)=>{if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported(dom)&&dom.style.setProperty(property,value)},set$2=(element,property,value)=>{const dom=element.dom;internalSet(dom,property,value)},setAll=(element,css)=>{const dom=element.dom;each$d(css,((v,k)=>{internalSet(dom,k,v)}))},get$7=(element,property)=>{const dom=element.dom,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=(dom,property)=>isSupported(dom)?dom.style.getPropertyValue(property):"",getRaw=(element,property)=>{const dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((r=>r.length>0))},getAllRaw=element=>{const css={},dom=element.dom;if(isSupported(dom))for(let i=0;i<dom.style.length;i++){const ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},remove$6=(element,property)=>{((dom,property)=>{isSupported(dom)&&dom.style.removeProperty(property)})(element.dom,property),is$2(getOpt(element,"style").map(trim$4),"")&&remove$a(element,"style")},before$3=(marker,element)=>{parent(marker).each((v=>{v.dom.insertBefore(element.dom,marker.dom)}))},after$4=(marker,element)=>{nextSibling(marker).fold((()=>{parent(marker).each((v=>{append$1(v,element)}))}),(v=>{before$3(v,element)}))},prepend=(parent,element)=>{firstChild(parent).fold((()=>{append$1(parent,element)}),(v=>{parent.dom.insertBefore(element.dom,v.dom)}))},append$1=(parent,element)=>{parent.dom.appendChild(element.dom)},wrap$2=(element,wrapper)=>{before$3(element,wrapper),append$1(wrapper,element)},append=(parent,elements)=>{each$e(elements,(x=>{append$1(parent,x)}))},empty=element=>{element.dom.textContent="",each$e(children$1(element),(rogue=>{remove$5(rogue)}))},remove$5=element=>{const dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=wrapper=>{const children=children$1(wrapper);var marker,elements;children.length>0&&(marker=wrapper,each$e(elements=children,((x,i)=>{const e=0===i?marker:elements[i-1];after$4(e,x)}))),remove$5(wrapper)},fromDom$1=nodes=>map$3(nodes,SugarElement.fromDom),get$6=element=>element.dom.innerHTML,set$1=(element,content)=>{const docDom=owner$1(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=((html,scope)=>{const div=(scope||document).createElement("div");return div.innerHTML=html,children$1(SugarElement.fromDom(div))})(content,docDom);append(fragment,contentElements),empty(element),append$1(element,fragment)},handle$1=(filter,handler)=>rawEvent=>{filter(rawEvent)&&handler((rawEvent=>{const target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target)),stop=()=>rawEvent.stopPropagation(),prevent=()=>rawEvent.preventDefault(),kill=compose(prevent,stop);return((target,x,y,stop,prevent,kill,raw)=>({target,x,y,stop,prevent,kill,raw}))(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent)})(rawEvent))},bind$2=(element,event,filter,handler)=>((element,event,filter,handler,useCapture)=>{const wrapped=handle$1(filter,handler);return element.dom.addEventListener(event,wrapped,useCapture),{unbind:curry(unbind,element,event,wrapped,useCapture)}})(element,event,filter,handler,!1),unbind=(element,event,handler,useCapture)=>{element.dom.removeEventListener(event,handler,useCapture)},r=(left,top)=>({left,top,translate:(x,y)=>r(left+x,top+y)}),SugarPosition=r,firstDefinedOrZero=(a,b)=>void 0!==a?a:void 0!==b?b:0,viewport=element=>{const dom=element.dom,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?(dom=>{const box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)})(dom):SugarPosition(0,0)},get$5=_DOC=>{const doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=(x,y,_DOC)=>{const win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},intoView=(element,alignToTop)=>{detect$2().browser.isSafari()&&isFunction(element.dom.scrollIntoViewIfNeeded)?element.dom.scrollIntoViewIfNeeded(!1):element.dom.scrollIntoView(alignToTop)},bounds=(x,y,width,height)=>({x,y,width,height,right:x+width,bottom:y+height}),getBounds=_win=>{const win=void 0===_win?window:_win,doc=win.document,scroll=get$5(SugarElement.fromDom(doc));return(_win=>{const win=void 0===_win?window:_win;return detect$2().browser.isFirefox()?Optional.none():Optional.from(win.visualViewport)})(win).fold((()=>{const html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height)}),(visualViewport=>bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)))},descendants$1=(scope,predicate)=>{let result=[];return each$e(children$1(scope),(x=>{predicate(x)&&(result=result.concat([x])),result=result.concat(descendants$1(x,predicate))})),result},descendants=(scope,selector)=>((selector,scope)=>{const base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$3(base.querySelectorAll(selector),SugarElement.fromDom)})(selector,scope),ancestor$2=(scope,selector,isRoot)=>ancestor$3(scope,selector,isRoot).isSome();class DomTreeWalker{constructor(startNode,rootNode){this.node=startNode,this.rootNode=rootNode,this.current=this.current.bind(this),this.next=this.next.bind(this),this.prev=this.prev.bind(this),this.prev2=this.prev2.bind(this)}current(){return this.node}next(shallow){return this.node=this.findSibling(this.node,"firstChild","nextSibling",shallow),this.node}prev(shallow){return this.node=this.findSibling(this.node,"lastChild","previousSibling",shallow),this.node}prev2(shallow){return this.node=this.findPreviousNode(this.node,shallow),this.node}findSibling(node,startName,siblingName,shallow){if(node){if(!shallow&&node[startName])return node[startName];if(node!==this.rootNode){let sibling=node[siblingName];if(sibling)return sibling;for(let parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode)if(sibling=parent[siblingName],sibling)return sibling}}}findPreviousNode(node,shallow){if(node){const sibling=node.previousSibling;if(this.rootNode&&sibling===this.rootNode)return;if(sibling){if(!shallow)for(let child=sibling.lastChild;child;child=child.lastChild)if(!child.lastChild)return child;return sibling}const parent=node.parentNode;if(parent&&parent!==this.rootNode)return parent}}}const isNodeType=type=>node=>!!node&&node.nodeType===type,isRestrictedNode=node=>!!node&&!Object.getPrototypeOf(node),isElement$6=isNodeType(1),isHTMLElement=node=>isElement$6(node)&&isHTMLElement$1(SugarElement.fromDom(node)),matchNodeName=name=>{const lowerCasedName=name.toLowerCase();return node=>isNonNullable(node)&&node.nodeName.toLowerCase()===lowerCasedName},matchNodeNames=names=>{const lowerCasedNames=names.map((s=>s.toLowerCase()));return node=>{if(node&&node.nodeName){const nodeName=node.nodeName.toLowerCase();return contains$2(lowerCasedNames,nodeName)}return!1}},matchStyleValues=(name,values)=>{const items=values.toLowerCase().split(" ");return node=>{if(isElement$6(node)){const win=node.ownerDocument.defaultView;if(win)for(let i=0;i<items.length;i++){const computed=win.getComputedStyle(node,null);if((computed?computed.getPropertyValue(name):null)===items[i])return!0}}return!1}},hasAttribute=attrName=>node=>isElement$6(node)&&node.hasAttribute(attrName),isBogus$2=node=>isElement$6(node)&&node.hasAttribute("data-mce-bogus"),isTable$2=node=>isElement$6(node)&&"TABLE"===node.tagName,hasContentEditableState=value=>node=>{if(isHTMLElement(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1},isTextareaOrInput=matchNodeNames(["textarea","input"]),isText$a=isNodeType(3),isCData=isNodeType(4),isPi=isNodeType(7),isComment=isNodeType(8),isDocument$1=isNodeType(9),isDocumentFragment=isNodeType(11),isBr$6=matchNodeName("br"),isImg=matchNodeName("img"),isContentEditableTrue$3=hasContentEditableState("true"),isContentEditableFalse$b=hasContentEditableState("false"),isTableCell$3=matchNodeNames(["td","th"]),isTableCellOrCaption=matchNodeNames(["td","th","caption"]),isMedia$2=matchNodeNames(["video","audio","object","embed"]),isListItem$2=matchNodeName("li"),isDetails=matchNodeName("details"),isSummary$1=matchNodeName("summary"),isZwsp$2=char=>"\ufeff"===char,api$1=((is,name)=>{const getOption=element=>is(element)?Optional.from(element.dom.nodeValue):Optional.none();return{get:element=>{if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption,set:(element,value)=>{if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}})(isText$b,"text"),get$3=element=>api$1.get(element),getOption=element=>api$1.getOption(element),lazyLookup=items=>{let lookup;return node=>(lookup=lookup||mapToObject(items,always),has$2(lookup,name(node)))},isBr$5=node=>isElement$7(node)&&"br"===name(node),isTextBlock$2=lazyLookup(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isList=lazyLookup(["ul","ol","dl"]),isListItem$1=lazyLookup(["li","dd","dt"]),isTableSection=lazyLookup(["thead","tbody","tfoot"]),isTableCell$2=lazyLookup(["td","th"]),isWsPreserveElement=lazyLookup(["pre","script","textarea","style"]),removeTrailingBr=elm=>{const allBrs=descendants(elm,"br"),brs=filter$5((elm=>{const children=[];let rawNode=elm.dom;for(;rawNode;)children.push(SugarElement.fromDom(rawNode)),rawNode=rawNode.lastChild;return children})(elm).slice(-1),isBr$5);allBrs.length===brs.length&&each$e(brs,remove$5)},createPaddingBr=()=>{const br=SugarElement.fromTag("br");return set$3(br,"data-mce-bogus","1"),br},fillWithPaddingBr=elm=>{empty(elm),append$1(elm,createPaddingBr())},isZwsp$1=isZwsp$2,trim$2=s=>s.replace(/\uFEFF/g,""),isElement$5=isElement$6,isText$9=isText$a,isCaretContainerBlock$1=node=>(isText$9(node)&&(node=node.parentNode),isElement$5(node)&&node.hasAttribute("data-mce-caret")),isCaretContainerInline=node=>isText$9(node)&&isZwsp$1(node.data),isCaretContainer$2=node=>isCaretContainerBlock$1(node)||isCaretContainerInline(node),hasContent=node=>node.firstChild!==node.lastChild||!isBr$6(node.firstChild),isBeforeInline=pos=>{const container=pos.container();return!!isText$a(container)&&("\ufeff"===container.data.charAt(pos.offset())||pos.isAtStart()&&isCaretContainerInline(container.previousSibling))},isAfterInline=pos=>{const container=pos.container();return!!isText$a(container)&&("\ufeff"===container.data.charAt(pos.offset()-1)||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling))},startsWithCaretContainer$1=node=>isText$9(node)&&"\ufeff"===node.data[0],endsWithCaretContainer$1=node=>isText$9(node)&&"\ufeff"===node.data[node.data.length-1],showCaretContainerBlock=caretContainer=>caretContainer&&caretContainer.hasAttribute("data-mce-caret")?((elm=>{var _a;const brs=elm.getElementsByTagName("br"),lastBr=brs[brs.length-1];isBogus$2(lastBr)&&(null===(_a=lastBr.parentNode)||void 0===_a||_a.removeChild(lastBr))})(caretContainer),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("data-mce-style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null,isRangeInCaretContainerBlock=range=>isCaretContainerBlock$1(range.startContainer),isContentEditableTrue$2=isContentEditableTrue$3,isContentEditableFalse$a=isContentEditableFalse$b,isBr$4=isBr$6,isText$8=isText$a,isInvalidTextElement=matchNodeNames(["script","style","textarea"]),isAtomicInline=matchNodeNames(["img","input","textarea","hr","iframe","video","audio","object","embed"]),isTable=matchNodeNames(["table"]),isCaretContainer$1=isCaretContainer$2,isCaretCandidate$3=node=>!isCaretContainer$1(node)&&(isText$8(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr$4(node)||isTable(node)||isNonUiContentEditableFalse(node)),isNonUiContentEditableFalse=node=>!(node=>isElement$6(node)&&"true"===node.getAttribute("unselectable"))(node)&&isContentEditableFalse$a(node),isEditableCaretCandidate$1=(node,root)=>isCaretCandidate$3(node)&&((node,root)=>{for(let tempNode=node.parentNode;tempNode&&tempNode!==root;tempNode=tempNode.parentNode){if(isNonUiContentEditableFalse(tempNode))return!1;if(isContentEditableTrue$2(tempNode))return!0}return!0})(node,root),whiteSpaceRegExp=/^[ \t\r\n]*$/,isWhitespaceText=text=>whiteSpaceRegExp.test(text),isZwsp=text=>{for(const c of text)if(!isZwsp$2(c))return!1;return!0},isNewLineChar=c=>"\n"===c||"\r"===c,normalize$4=(text,tabSpaces=4,isStartOfContent=!0,isEndOfContent=!0)=>{const tabSpace=((s,count)=>count<=0?"":new Array(count+1).join(s))(" ",tabSpaces),normalizedText=text.replace(/\t/g,tabSpace),result=foldl(normalizedText,((acc,c)=>(c=>-1!==" \f\t\v".indexOf(c))(c)||" "===c?acc.pcIsSpace||""===acc.str&&isStartOfContent||acc.str.length===normalizedText.length-1&&isEndOfContent||((text,idx)=>idx<text.length&&idx>=0&&isNewLineChar(text[idx]))(normalizedText,acc.str.length+1)?{pcIsSpace:!1,str:acc.str+" "}:{pcIsSpace:!0,str:acc.str+" "}:{pcIsSpace:isNewLineChar(c),str:acc.str+c}),{pcIsSpace:!1,str:""});return result.str},isWhitespace$1=(node,rootNode)=>isText$a(node)&&isWhitespaceText(node.data)&&!((node,rootNode)=>{const rootElement=SugarElement.fromDom(rootNode),startNode=SugarElement.fromDom(node);return ancestor$2(startNode,"pre,code",curry(eq,rootElement))})(node,rootNode),isContent$1=(node,rootNode)=>isCaretCandidate$3(node)&&!isWhitespace$1(node,rootNode)||(node=>isElement$6(node)&&"A"===node.nodeName&&!node.hasAttribute("href")&&(node.hasAttribute("name")||node.hasAttribute("id")))(node)||isBookmark(node),isBookmark=hasAttribute("data-mce-bookmark"),isBogus$1=hasAttribute("data-mce-bogus"),isBogusAll=(attrName="data-mce-bogus",attrValue="all",node=>isElement$6(node)&&node.getAttribute(attrName)===attrValue);var attrName,attrValue;const hasNonEditableParent=node=>parentElement(SugarElement.fromDom(node)).exists((parent=>!isEditable$2(parent))),isEmpty$2=(elm,skipBogus=!0)=>((targetNode,skipBogus)=>{let brCount=0;if(isContent$1(targetNode,targetNode))return!1;{let node=targetNode.firstChild;if(!node)return!0;const walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll(node)){node=walker.next(!0);continue}if(isBogus$1(node)){node=walker.next();continue}}if(isContentEditableTrue$3(node)&&hasNonEditableParent(node))return!1;if(isBr$6(node))brCount++,node=walker.next();else{if(isContent$1(node,targetNode))return!1;node=walker.next()}}while(node);return brCount<=1}})(elm.dom,skipBogus),isNonHtmlElementRootName=name=>"svg"===name.toLowerCase(),isNonHtmlElementRoot=node=>isNonHtmlElementRootName(node.nodeName),toScopeType=node=>"svg"===(null==node?void 0:node.nodeName)?"svg":"html",namespaceElements=["svg"],makeSelectorFromSchemaMap=map=>map$3((map=>filter$5(keys(map),(key=>!/[A-Z]/.test(key))))(map),(name=>`${name}:`+map$3(namespaceElements,(ns=>`not(${ns} ${name})`)).join(":"))).join(","),updateTransparent=(blocksSelector,transparent)=>isNonNullable(transparent.querySelector(blocksSelector))?(transparent.setAttribute("data-mce-block","true"),"inline-boundary"===transparent.getAttribute("data-mce-selected")&&transparent.removeAttribute("data-mce-selected"),!0):(transparent.removeAttribute("data-mce-block"),!1),updateBlockStateOnChildren=(schema,scope)=>{const transparentSelector=makeSelectorFromSchemaMap(schema.getTransparentElements()),blocksSelector=makeSelectorFromSchemaMap(schema.getBlockElements());return filter$5(scope.querySelectorAll(transparentSelector),(transparent=>updateTransparent(blocksSelector,transparent)))},trimEdge=(el,leftSide)=>{var _a;const childPropertyName=leftSide?"lastChild":"firstChild";for(let child=el[childPropertyName];child;child=child[childPropertyName])if(isEmpty$2(SugarElement.fromDom(child)))return void(null===(_a=child.parentNode)||void 0===_a||_a.removeChild(child))},splitInvalidChildren=(schema,scope,transparentBlocks)=>{const blocksElements=schema.getBlockElements(),rootNode=SugarElement.fromDom(scope),isBlock=el=>name(el)in blocksElements,isRoot=el=>eq(el,rootNode);each$e(fromDom$1(transparentBlocks),(transparentBlock=>{ancestor$4(transparentBlock,isBlock,isRoot).each((parentBlock=>{const invalidChildren=((scope,predicate)=>filter$5(children$1(scope),predicate))(transparentBlock,(el=>isBlock(el)&&!schema.isValidChild(name(parentBlock),name(el))));if(invalidChildren.length>0){const stateScope=parentElement(parentBlock);each$e(invalidChildren,(child=>{ancestor$4(child,isBlock,isRoot).each((parentBlock=>{((parentElm,splitElm)=>{const range=document.createRange(),parentNode=parentElm.parentNode;if(parentNode){range.setStartBefore(parentElm),range.setEndBefore(splitElm);const beforeFragment=range.extractContents();trimEdge(beforeFragment,!0),range.setStartAfter(splitElm),range.setEndAfter(parentElm);const afterFragment=range.extractContents();trimEdge(afterFragment,!1),isEmpty$2(SugarElement.fromDom(beforeFragment))||parentNode.insertBefore(beforeFragment,parentElm),isEmpty$2(SugarElement.fromDom(splitElm))||parentNode.insertBefore(splitElm,parentElm),isEmpty$2(SugarElement.fromDom(afterFragment))||parentNode.insertBefore(afterFragment,parentElm),parentNode.removeChild(parentElm)}})(parentBlock.dom,child.dom)}))})),stateScope.each((scope=>updateBlockStateOnChildren(schema,scope.dom)))}}))}))},updateChildren=(schema,scope)=>{const transparentBlocks=updateBlockStateOnChildren(schema,scope);splitInvalidChildren(schema,scope,transparentBlocks),((schema,scope,transparentBlocks)=>{each$e([...transparentBlocks,...isTransparentBlock(schema,scope)?[scope]:[]],(block=>each$e(descendants(SugarElement.fromDom(block),block.nodeName.toLowerCase()),(elm=>{isTransparentInline(schema,elm.dom)&&unwrap(elm)}))))})(schema,scope,transparentBlocks)},updateElement=(schema,target)=>{if(isTransparentElement(schema,target)){const blocksSelector=makeSelectorFromSchemaMap(schema.getBlockElements());updateTransparent(blocksSelector,target)}},hasBlockAttr=el=>el.hasAttribute("data-mce-block"),isTransparentElementName=(schema,name)=>has$2(schema.getTransparentElements(),name),isTransparentElement=(schema,node)=>isElement$6(node)&&isTransparentElementName(schema,node.nodeName),isTransparentBlock=(schema,node)=>isTransparentElement(schema,node)&&hasBlockAttr(node),isTransparentInline=(schema,node)=>isTransparentElement(schema,node)&&!hasBlockAttr(node),isTransparentAstBlock=(schema,node)=>1===node.type&&isTransparentElementName(schema,node.name)&&isString(node.attr("data-mce-block")),browser$2=detect$2().browser,firstElement=nodes=>find$2(nodes,isElement$7),hasChild=(elm,child)=>elm.children&&contains$2(elm.children,child),getPos=(body,elm,rootElm)=>{let x=0,y=0;const doc=body.ownerDocument;if(rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===get$7(SugarElement.fromDom(body),"position")){const pos=elm.getBoundingClientRect();return x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft,y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop,{x,y}}let offsetParent=elm;for(;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);){const castOffsetParent=offsetParent;x+=castOffsetParent.offsetLeft||0,y+=castOffsetParent.offsetTop||0,offsetParent=castOffsetParent.offsetParent}for(offsetParent=elm.parentNode;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode;y+=(elm=>browser$2.isFirefox()&&"table"===name(elm)?firstElement(children$1(elm)).filter((elm=>"caption"===name(elm))).bind((caption=>firstElement(nextSiblings(caption)).map((body=>{const bodyTop=body.dom.offsetTop,captionTop=caption.dom.offsetTop,captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0})))).getOr(0):0)(SugarElement.fromDom(elm))}return{x,y}},StyleSheetLoader=(documentOrShadowRoot,settings={})=>{let idCount=0;const loadedStates={},edos=SugarElement.fromDom(documentOrShadowRoot),doc=documentOrOwner(edos),addStyle=element=>{append$1(getStyleContainer(edos),element)},removeStyle=id=>{const styleContainer=getStyleContainer(edos);descendant$1(styleContainer,"#"+id).each(remove$5)},getOrCreateState=url=>get$a(loadedStates,url).getOrThunk((()=>({id:"mce-u"+idCount++,passed:[],failed:[],count:0}))),load=url=>new Promise(((success,failure)=>{let link;const urlWithSuffix=Tools._addCacheSuffix(url),state=getOrCreateState(urlWithSuffix);loadedStates[urlWithSuffix]=state,state.count++;const resolve=(callbacks,status)=>{each$e(callbacks,call),state.status=status,state.passed=[],state.failed=[],link&&(link.onload=null,link.onerror=null,link=null)},passed=()=>resolve(state.passed,2),failed=()=>resolve(state.failed,3);if(success&&state.passed.push(success),failure&&state.failed.push(failure),1===state.status)return;if(2===state.status)return void passed();if(3===state.status)return void failed();state.status=1;const linkElem=SugarElement.fromTag("link",doc.dom);setAll$1(linkElem,{rel:"stylesheet",type:"text/css",id:state.id}),settings.contentCssCors&&set$3(linkElem,"crossOrigin","anonymous"),settings.referrerPolicy&&set$3(linkElem,"referrerpolicy",settings.referrerPolicy),link=linkElem.dom,link.onload=passed,link.onerror=failed,addStyle(linkElem),set$3(linkElem,"href",urlWithSuffix)})),unload=url=>{const urlWithSuffix=Tools._addCacheSuffix(url);get$a(loadedStates,urlWithSuffix).each((state=>{0===--state.count&&(delete loadedStates[urlWithSuffix],removeStyle(state.id))}))};return{load,loadRawCss:(key,css)=>{const state=getOrCreateState(key);loadedStates[key]=state,state.count++;const styleElem=SugarElement.fromTag("style",doc.dom);setAll$1(styleElem,{rel:"stylesheet",type:"text/css",id:state.id}),styleElem.dom.innerHTML=css,addStyle(styleElem)},loadAll:urls=>Promise.allSettled(map$3(urls,(url=>load(url).then(constant(url))))).then((results=>{const parts=partition$2(results,(r=>"fulfilled"===r.status));return parts.fail.length>0?Promise.reject(map$3(parts.fail,(result=>result.reason))):map$3(parts.pass,(result=>result.value))})),unload,unloadRawCss:key=>{get$a(loadedStates,key).each((state=>{0===--state.count&&(delete loadedStates[key],removeStyle(state.id))}))},unloadAll:urls=>{each$e(urls,(url=>{unload(url)}))},_setReferrerPolicy:referrerPolicy=>{settings.referrerPolicy=referrerPolicy},_setContentCssCors:contentCssCors=>{settings.contentCssCors=contentCssCors}}},instance=(()=>{const map=new WeakMap;return{forElement:(referenceElement,settings)=>{const rootDom=getRootNode(referenceElement).dom;return Optional.from(map.get(rootDom)).getOrThunk((()=>{const sl=StyleSheetLoader(rootDom,settings);return map.set(rootDom,sl),sl}))}}})(),isInlineContent=(node,root,schema)=>isNonNullable(node)&&(isContent$1(node,root)||schema.isInline(node.nodeName.toLowerCase())),isBookmarkNode$2=node=>(node=>"span"===node.nodeName.toLowerCase())(node)&&"bookmark"===node.getAttribute("data-mce-type"),isKeepTextNode=(node,root,schema)=>isText$a(node)&&node.data.length>0&&((node,root,schema)=>{const prev=new DomTreeWalker(node,root).prev(!1),next=new DomTreeWalker(node,root).next(!1),prevIsInline=isUndefined(prev)||isInlineContent(prev,root,schema),nextIsInline=isUndefined(next)||isInlineContent(next,root,schema);return prevIsInline&&nextIsInline})(node,root,schema),trimNode=(dom,node,schema,root)=>{var _a;const rootNode=root||node;if(isElement$6(node)&&isBookmarkNode$2(node))return node;const children=node.childNodes;for(let i=children.length-1;i>=0;i--)trimNode(dom,children[i],schema,rootNode);if(isElement$6(node)){const currentChildren=node.childNodes;1===currentChildren.length&&isBookmarkNode$2(currentChildren[0])&&(null===(_a=node.parentNode)||void 0===_a||_a.insertBefore(currentChildren[0],node))}return(node=>isDocumentFragment(node)||isDocument$1(node))(node)||isContent$1(node,rootNode)||(node=>!!isElement$6(node)&&node.childNodes.length>0)(node)||isKeepTextNode(node,rootNode,schema)||dom.remove(node),node},makeMap$3=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"},baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},buildEntitiesLookup=(items,radix)=>{const lookup={};if(items){const itemList=items.split(",");radix=radix||10;for(let i=0;i<itemList.length;i+=2){const chr=String.fromCharCode(parseInt(itemList[i],radix));if(!baseEntities[chr]){const entity="&"+itemList[i+1]+";";lookup[chr]=entity,lookup[entity]=chr}}return lookup}},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),encodeRaw=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,(chr=>baseEntities[chr]||chr)),encodeNumeric=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,(chr=>chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";")),encodeNamed=(text,attr,entities)=>{const resolveEntities=entities||namedEntities;return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(chr=>baseEntities[chr]||resolveEntities[chr]||chr))},Entities={encodeRaw,encodeAllRaw:text=>(""+text).replace(rawCharsRegExp,(chr=>baseEntities[chr]||chr)),encodeNumeric,encodeNamed,getEncodeFunc:(name,entities)=>{const entitiesMap=buildEntitiesLookup(entities)||namedEntities,encodeNamedAndNumeric=(text,attr)=>text.replace(attr?attrsCharsRegExp:textCharsRegExp,(chr=>void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entitiesMap[chr]?entitiesMap[chr]:chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";")),encodeCustomNamed=(text,attr)=>encodeNamed(text,attr,entitiesMap),nameMap=makeMap$3(name.replace(/\+/g,","));return nameMap.named&&nameMap.numeric?encodeNamedAndNumeric:nameMap.named?entities?encodeCustomNamed:encodeNamed:nameMap.numeric?encodeNumeric:encodeRaw},decode:text=>text.replace(entityRegExp,((all,numeric)=>numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||(text=>{const elm=SugarElement.fromTag("div").dom;return elm.innerHTML=text,elm.textContent||elm.innerText||text})(all)))},split$1=(items,delim)=>(items=Tools.trim(items))?items.split(delim||" "):[],patternToRegExp=str=>new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$"),parseValidElementsRules=(globalElement,validElements)=>{const elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/;return bind$3(split$1(validElements,","),(rule=>{const matches=elementRuleRegExp.exec(rule);if(matches){const prefix=matches[1],elementName=matches[2],outputName=matches[3],attrsPrefix=matches[4],attrData=matches[5],element={attributes:{},attributesOrder:[]};if(globalElement.each((el=>((from,to)=>{each$d(from.attributes,((value,key)=>{to.attributes[key]=value})),to.attributesOrder.push(...from.attributesOrder)})(el,element))),"#"===prefix?element.paddEmpty=!0:"-"===prefix&&(element.removeEmpty=!0),"!"===attrsPrefix&&(element.removeEmptyAttrs=!0),attrData&&((attrData,targetElement)=>{const attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=~<]+)?(?:([=~<])(.*))?$/,hasPatternsRegExp=/[*?+]/,{attributes,attributesOrder}=targetElement;each$e(split$1(attrData,"|"),(rule=>{const matches=attrRuleRegExp.exec(rule);if(matches){const attr={},attrType=matches[1],attrName=matches[2].replace(/[\\:]:/g,":"),attrPrefix=matches[3],value=matches[4];if("!"===attrType&&(targetElement.attributesRequired=targetElement.attributesRequired||[],targetElement.attributesRequired.push(attrName),attr.required=!0),"-"===attrType)return delete attributes[attrName],void attributesOrder.splice(Tools.inArray(attributesOrder,attrName),1);if(attrPrefix&&("="===attrPrefix?(targetElement.attributesDefault=targetElement.attributesDefault||[],targetElement.attributesDefault.push({name:attrName,value}),attr.defaultValue=value):"~"===attrPrefix?(targetElement.attributesForced=targetElement.attributesForced||[],targetElement.attributesForced.push({name:attrName,value}),attr.forcedValue=value):"<"===attrPrefix&&(attr.validValues=Tools.makeMap(value,"?"))),hasPatternsRegExp.test(attrName)){const attrPattern=attr;targetElement.attributePatterns=targetElement.attributePatterns||[],attrPattern.pattern=patternToRegExp(attrName),targetElement.attributePatterns.push(attrPattern)}else attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr}}))})(attrData,element),outputName&&(element.outputName=elementName),"@"===elementName){if(!globalElement.isNone())return[];globalElement=Optional.some(element)}return[outputName?{name:elementName,element,aliasName:outputName}:{name:elementName,element}]}return[]}))},mapCache={},makeMap$2=Tools.makeMap,each$b=Tools.each,extend$2=Tools.extend,explode$2=Tools.explode,createMap=(defaultValue,extendWith={})=>{const value=makeMap$2(defaultValue," ",makeMap$2(defaultValue.toUpperCase()," "));return extend$2(value,extendWith)},getTextRootBlockElements=schema=>createMap("td th li dt dd figcaption caption details summary",schema.getTextBlockElements()),compileElementMap=(value,mode)=>{if(value){const styles={};return isString(value)&&(value={"*":value}),each$b(value,((value,key)=>{styles[key]=styles[key.toUpperCase()]="map"===mode?makeMap$2(value,/[, ]/):explode$2(value,/[, ]/)})),styles}},Schema=(settings={})=>{var _a;const elements={},children={};let patternElements=[];const customElementsMap={},specialElements={},createLookupTable=(option,defaultValue,extendWith)=>{const value=settings[option];if(value)return makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/));{let newValue=mapCache[option];return newValue||(newValue=createMap(defaultValue,extendWith),mapCache[option]=newValue),newValue}},schemaType=null!==(_a=settings.schema)&&void 0!==_a?_a:"html5",schemaItems=(type=>{const{globalAttributes,phrasingContent,flowContent}=(type=>{let globalAttributes,blockContent,phrasingContent;globalAttributes="id accesskey class dir lang style tabindex title role",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure main header footer hgroup section nav a ins del canvas map",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen svg"),"html5-strict"!==type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,"acronym applet basefont big font strike tt"].join(" "),blockContent=[blockContent,"center dir isindex noframes"].join(" "));const flowContent=[blockContent,phrasingContent].join(" ");return{globalAttributes,blockContent,phrasingContent,flowContent}})(type),schema={},addElement=(name,attributes,children)=>{schema[name]={attributes:mapToObject(attributes,constant({})),attributesOrder:attributes,children:mapToObject(children,constant({}))}},add=(name,attributes="",children="")=>{const childNames=split$1(children),names=split$1(name);let ni=names.length;const allAttributes=split$1([globalAttributes,attributes].join(" "));for(;ni--;)addElement(names[ni],allAttributes.slice(),childNames)},addAttrs=(name,attributes)=>{const names=split$1(name),attrs=split$1(attributes);let ni=names.length;for(;ni--;){const schemaItem=schema[names[ni]];for(let i=0,l=attrs.length;i<l;i++)schemaItem.attributes[attrs[i]]={},schemaItem.attributesOrder.push(attrs[i])}};"html5-strict"!==type&&(each$e(split$1("acronym applet basefont big font strike tt"),(name=>{add(name,"",phrasingContent)})),each$e(split$1("center dir isindex noframes"),(name=>{add(name,"",flowContent)})));return add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("dd div","",flowContent),add("address dt caption","","html4"===type?phrasingContent:flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type","html4"===type?phrasingContent:flowContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"===type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!==type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp bdi","",phrasingContent),add("summary","",[phrasingContent,"h1 h2 h3 h4 h5 h6"].join(" ")),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside main header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name"),addElement("svg","id tabindex lang xml:space class style x y width height viewBox preserveAspectRatio zoomAndPan transform".split(" "),[])),"html5-strict"!==type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!==type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("img","loading"),addAttrs("iframe","sandbox seamless allow allowfullscreen loading")),"html4"!==type&&each$e([schema.video,schema.audio],(item=>{delete item.children.audio,delete item.children.video})),each$e(split$1("a form meter progress dfn"),(name=>{schema[name]&&delete schema[name].children[name]})),delete schema.caption.children.table,delete schema.script,schema})(schemaType);!1===settings.verify_html&&(settings.valid_elements="*[*]");const validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whitespaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),voidElementsMap=createLookupTable("void_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls allowfullscreen"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script code pre svg",voidElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","td th iframe video audio object script code table",voidElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary html body multicol listing",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font s strike u var cite dfn code mark q sup sub samp"),transparentElementsMap=createLookupTable("transparent_elements","a ins del canvas map"),wrapBlockElementsMap=createLookupTable("wrap_block_elements","pre h1 h2 h3 h4 h5 h6");each$b("script noscript iframe noframes noembed title style textarea xmp plaintext".split(" "),(name=>{specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}));const addValidElements=validElements=>{const globalElement=Optional.from(elements["@"]),hasPatternsRegExp=/[*?+]/;each$e(parseValidElementsRules(globalElement,null!=validElements?validElements:""),(({name,element,aliasName})=>{if(aliasName&&(elements[aliasName]=element),hasPatternsRegExp.test(name)){const patternElement=element;patternElement.pattern=patternToRegExp(name),patternElements.push(patternElement)}else elements[name]=element}))},setValidElements=validElements=>{patternElements=[],each$e(keys(elements),(name=>{delete elements[name]})),addValidElements(validElements)},addCustomElements=customElements=>{delete mapCache.text_block_elements,delete mapCache.block_elements,each$e((value=>{const customElementRegExp=/^(~)?(.+)$/;return bind$3(split$1(value,","),(rule=>{const matches=customElementRegExp.exec(rule);if(matches){const inline="~"===matches[1];return[{inline,cloneName:inline?"span":"div",name:matches[2]}]}return[]}))})(null!=customElements?customElements:""),(({inline,name,cloneName})=>{if(children[name]=children[cloneName],customElementsMap[name]=cloneName,nonEmptyElementsMap[name.toUpperCase()]={},nonEmptyElementsMap[name]={},inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){let customRule=elements[cloneName];customRule=extend$2({},customRule),delete customRule.removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each$d(children,((element,elmName)=>{element[cloneName]&&(children[elmName]=element=extend$2({},children[elmName]),element[name]=element[cloneName])}))}))},addValidChildren=validChildren=>{each$e((value=>{const childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;return bind$3(split$1(value,","),(rule=>{const matches=childRuleRegExp.exec(rule);if(matches){const prefix=matches[1],operation=prefix?(prefix=>"-"===prefix?"remove":"add")(prefix):"replace";return[{operation,name:matches[2],validChildren:split$1(matches[3],"|")}]}return[]}))})(null!=validChildren?validChildren:""),(({operation,name,validChildren})=>{const parent="replace"===operation?{"#comment":{}}:children[name];each$e(validChildren,(child=>{"remove"===operation?delete parent[child]:parent[child]={}})),children[name]=parent}))},getElementRule=name=>{const element=elements[name];if(element)return element;let i=patternElements.length;for(;i--;){const patternElement=patternElements[i];if(patternElement.pattern.test(name))return patternElement}};settings.valid_elements?(setValidElements(settings.valid_elements),each$b(schemaItems,((element,name)=>{children[name]=element.children}))):(each$b(schemaItems,((element,name)=>{elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children})),each$b(split$1("strong/b em/i"),(item=>{const items=split$1(item,"/");elements[items[1]].outputName=items[0]})),each$b(textInlineElementsMap,((_val,name)=>{elements[name]&&(settings.padd_empty_block_inline_children&&(elements[name].paddInEmptyBlock=!0),elements[name].removeEmpty=!0)})),each$b(split$1("ol ul blockquote a table tbody"),(name=>{elements[name]&&(elements[name].removeEmpty=!0)})),each$b(split$1("p h1 h2 h3 h4 h5 h6 th td pre div address caption li summary"),(name=>{elements[name]&&(elements[name].paddEmpty=!0)})),each$b(split$1("span"),(name=>{elements[name].removeEmptyAttrs=!0}))),delete elements.svg,addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each$b({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},((parents,item)=>{elements[item]&&(elements[item].parentsRequired=split$1(parents))})),settings.invalid_elements&&each$b(explode$2(settings.invalid_elements),(item=>{elements[item]&&delete elements[item]})),getElementRule("span")||addValidElements("span[!data-mce-type|*]");const getValidStyles=constant(validStyles),getInvalidStyles=constant(invalidStyles),getValidClasses=constant(validClasses),getBoolAttrs=constant(boolAttrMap),getBlockElements=constant(blockElementsMap),getTextBlockElements=constant(textBlockElementsMap),getTextInlineElements=constant(textInlineElementsMap),getVoidElements=constant(Object.seal(voidElementsMap)),getSelfClosingElements=constant(selfClosingElementsMap),getNonEmptyElements=constant(nonEmptyElementsMap),getMoveCaretBeforeOnEnterElements=constant(moveCaretBeforeOnEnterElementsMap),getWhitespaceElements=constant(whitespaceElementsMap),getTransparentElements=constant(transparentElementsMap),getWrapBlockElements=constant(wrapBlockElementsMap),getSpecialElements=constant(Object.seal(specialElements)),isValid=(name,attr)=>{const rule=getElementRule(name);if(rule){if(!attr)return!0;{if(rule.attributes[attr])return!0;const attrPatterns=rule.attributePatterns;if(attrPatterns){let i=attrPatterns.length;for(;i--;)if(attrPatterns[i].pattern.test(attr))return!0}}}return!1},isBlock=name=>has$2(getBlockElements(),name),isInline=name=>!startsWith(name,"#")&&isValid(name)&&!isBlock(name),getCustomElements=constant(customElementsMap);return{type:schemaType,children,elements,getValidStyles,getValidClasses,getBlockElements,getInvalidStyles,getVoidElements,getTextBlockElements,getTextInlineElements,getBoolAttrs,getElementRule,getSelfClosingElements,getNonEmptyElements,getMoveCaretBeforeOnEnterElements,getWhitespaceElements,getTransparentElements,getSpecialElements,isValidChild:(name,child)=>{const parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},isValid,isBlock,isInline,isWrapper:name=>has$2(getWrapBlockElements(),name)||isInline(name),getCustomElements,addValidElements,setValidElements,addCustomElements,addValidChildren}},normalizeHex=hex=>removeLeading(hex,"#").toUpperCase(),toHex=component=>{const hex=component.toString(16);return(1===hex.length?"0"+hex:hex).toUpperCase()},fromRgba=rgbaColour=>(value=>({value:normalizeHex(value)}))(toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue)),rgbRegex=/^\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,rgbaRegex=/^\s*rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?(?:\.\d+)?)\s*\)\s*$/i,rgbaColour=(red,green,blue,alpha)=>({red,green,blue,alpha}),fromStringValues=(red,green,blue,alpha)=>{const r=parseInt(red,10),g=parseInt(green,10),b=parseInt(blue,10),a=parseFloat(alpha);return rgbaColour(r,g,b,a)},fromString=rgbaString=>{if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));const rgbMatch=rgbRegex.exec(rgbaString);if(null!==rgbMatch)return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1"));const rgbaMatch=rgbaRegex.exec(rgbaString);return null!==rgbaMatch?Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4])):Optional.none()},toString=rgba=>`rgba(${rgba.red},${rgba.green},${rgba.blue},${rgba.alpha})`,rgbaToHexString=color=>fromString(color).map(fromRgba).map((h=>"#"+h.value)).getOr(color),Styles=(settings={},schema)=>{const urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={};let validStyles,invalidStyles;schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles());const encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" ");for(let i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];const self={parse:css=>{const styles={};let isEncoded=!1;const urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||self,compress=(prefix,suffix,noJoin)=>{const top=styles[prefix+"-top"+suffix];if(!top)return;const right=styles[prefix+"-right"+suffix];if(!right)return;const bottom=styles[prefix+"-bottom"+suffix];if(!bottom)return;const left=styles[prefix+"-left"+suffix];if(!left)return;const box=[top,right,bottom,left];let i=box.length-1;for(;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=-1===i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])},canCompress=key=>{const value=styles[key];if(!value)return;const values=value.indexOf(",")>-1?[value]:value.split(" ");let i=values.length;for(;i--;)if(values[i]!==values[0])return!1;return styles[key]=values[0],!0},encode=str=>(isEncoded=!0,encodingLookup[str]),decode=(str,keepSlashes)=>(isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,(str=>encodingLookup[str]))),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str),decodeSingleHexSequence=escSeq=>String.fromCharCode(parseInt(escSeq.slice(1),16)),decodeHexSequences=value=>value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence),processUrl=(match,url,url2,url3,str,str2)=>{if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3||""),!settings.allow_script_urls){const scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"};if(css){let matches;for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,(str=>str.replace(/[;:]/g,encode)));matches=styleRegExp.exec(css);){styleRegExp.lastIndex=matches.index+matches[0].length;let name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,"");if(name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"===name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),isString(settings.force_hex_color)&&"off"!==settings.force_hex_color&&fromString(value).each((rgba=>{"always"!==settings.force_hex_color&&1!==rgba.alpha||(value=rgbaToHexString(toString(rgba)))})),value=value.replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),target="border",b="border-style",c="border-color",canCompress(a="border-width")&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c]),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}var target,a,b,c;return styles},serialize:(styles,elementName)=>{let css="";const serializeStyles=(elemName,validStyleList)=>{const styleList=validStyleList[elemName];if(styleList)for(let i=0,l=styleList.length;i<l;i++){const name=styleList[i],value=styles[name];value&&(css+=(css.length>0?" ":"")+name+": "+value+";")}};return elementName&&validStyles?(serializeStyles("*",validStyles),serializeStyles(elementName,validStyles)):each$d(styles,((value,name)=>{value&&((name,elemName)=>{if(!invalidStyles||!elemName)return!0;let styleMap=invalidStyles["*"];return!(styleMap&&styleMap[name]||(styleMap=invalidStyles[elemName],styleMap&&styleMap[name]))})(name,elementName)&&(css+=(css.length>0?" ":"")+name+": "+value+";")})),css}};return self},deprecated={keyLocation:!0,layerX:!0,layerY:!0,returnValue:!0,webkitMovementX:!0,webkitMovementY:!0,keyIdentifier:!0,mozPressure:!0},needsNormalizing=event=>isNullable(event.preventDefault)||(event=>event instanceof Event||isFunction(event.initEvent))(event),clone$3=(originalEvent,data)=>{const event=null!=data?data:{};for(const name in originalEvent)has$2(deprecated,name)||(event[name]=originalEvent[name]);return isNonNullable(originalEvent.composedPath)&&(event.composedPath=()=>originalEvent.composedPath()),isNonNullable(originalEvent.getModifierState)&&(event.getModifierState=keyArg=>originalEvent.getModifierState(keyArg)),isNonNullable(originalEvent.getTargetRanges)&&(event.getTargetRanges=()=>originalEvent.getTargetRanges()),event},normalize$3=(type,originalEvent,fallbackTarget,data)=>{var _a;const event=clone$3(originalEvent,data);return event.type=type,isNullable(event.target)&&(event.target=null!==(_a=event.srcElement)&&void 0!==_a?_a:fallbackTarget),needsNormalizing(originalEvent)&&(event.preventDefault=()=>{event.defaultPrevented=!0,event.isDefaultPrevented=always,isFunction(originalEvent.preventDefault)&&originalEvent.preventDefault()},event.stopPropagation=()=>{event.cancelBubble=!0,event.isPropagationStopped=always,isFunction(originalEvent.stopPropagation)&&originalEvent.stopPropagation()},event.stopImmediatePropagation=()=>{event.isImmediatePropagationStopped=always,event.stopPropagation()},(event=>event.isDefaultPrevented===always||event.isDefaultPrevented===never)(event)||(event.isDefaultPrevented=!0===event.defaultPrevented?always:never,event.isPropagationStopped=!0===event.cancelBubble?always:never,event.isImmediatePropagationStopped=never)),event},mouseEventRe=/^(?:mouse|contextmenu)|click/,addEvent=(target,name,callback,capture)=>{target.addEventListener(name,callback,capture||!1)},removeEvent=(target,name,callback,capture)=>{target.removeEventListener(name,callback,capture||!1)},fix=(originalEvent,data)=>{const event=normalize$3(originalEvent.type,originalEvent,document,data);if((event=>isNonNullable(event)&&mouseEventRe.test(event.type))(originalEvent)&&isUndefined(originalEvent.pageX)&&!isUndefined(originalEvent.clientX)){const eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,mouseEvent=event;mouseEvent.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),mouseEvent.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return event},bindOnReady=(win,callback,eventUtils)=>{const doc=win.document,event={type:"ready"};if(eventUtils.domLoaded)return void callback(event);const readyHandler=()=>{removeEvent(win,"DOMContentLoaded",readyHandler),removeEvent(win,"load",readyHandler),eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event)),win=null};"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),eventUtils.domLoaded||addEvent(win,"load",readyHandler)};class EventUtils{constructor(){this.domLoaded=!1,this.events={},this.count=1,this.expando="mce-data-"+(+new Date).toString(32),this.hasFocusIn="onfocusin"in document.documentElement,this.count=1}bind(target,names,callback,scope){const self=this;let callbackList;const win=window,defaultNativeHandler=evt=>{self.executeHandlers(fix(evt||win.event),id)};if(!target||isText$a(target)||isComment(target))return callback;let id;target[self.expando]?id=target[self.expando]:(id=self.count++,target[self.expando]=id,self.events[id]={}),scope=scope||target;const namesList=names.split(" ");let i=namesList.length;for(;i--;){let name=namesList[i],nativeHandler=defaultNativeHandler,capture=!1,fakeName=!1;"DOMContentLoaded"===name&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"===target.readyState?callback.call(scope,fix({type:name})):(self.hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=evt=>{const event=fix(evt||win.event);event.type="focus"===event.type?"focusin":"focusout",self.executeHandlers(event,id)}),callbackList=self.events[id][name],callbackList?"ready"===name&&self.domLoaded?callback(fix({type:name})):callbackList.push({func:callback,scope}):(self.events[id][name]=callbackList=[{func:callback,scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)))}return target=callbackList=null,callback}unbind(target,names,callback){if(!target||isText$a(target)||isComment(target))return this;const id=target[this.expando];if(id){let eventMap=this.events[id];if(names){const namesList=names.split(" ");let i=namesList.length;for(;i--;){const name=namesList[i],callbackList=eventMap[name];if(callbackList){if(callback){let ci=callbackList.length;for(;ci--;)if(callbackList[ci].func===callback){const nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture,newCallbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));newCallbackList.nativeHandler=nativeHandler,newCallbackList.fakeName=fakeName,newCallbackList.capture=capture,eventMap[name]=newCallbackList}}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}}else each$d(eventMap,((callbackList,name)=>{removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)})),eventMap={};for(const name in eventMap)if(has$2(eventMap,name))return this;delete this.events[id];try{delete target[this.expando]}catch(ex){target[this.expando]=null}}return this}fire(target,name,args){return this.dispatch(target,name,args)}dispatch(target,name,args){if(!target||isText$a(target)||isComment(target))return this;const event=fix({type:name,target},args);do{const id=target[this.expando];id&&this.executeHandlers(event,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!event.isPropagationStopped());return this}clean(target){if(!target||isText$a(target)||isComment(target))return this;if(target[this.expando]&&this.unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName){this.unbind(target);const children=target.getElementsByTagName("*");let i=children.length;for(;i--;)(target=children[i])[this.expando]&&this.unbind(target)}return this}destroy(){this.events={}}cancel(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}executeHandlers(evt,id){const container=this.events[id],callbackList=container&&container[evt.type];if(callbackList)for(let i=0,l=callbackList.length;i<l;i++){const callback=callbackList[i];if(callback&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}}}EventUtils.Event=new EventUtils;const each$a=Tools.each,grep=Tools.grep,numericalCssMap=Tools.makeMap("fill-opacity font-weight line-height opacity orphans widows z-index zoom"," "),legacySetAttribute=(elm,name,value)=>{isNullable(value)||""===value?remove$a(elm,name):set$3(elm,name,value)},camelCaseToHyphens=name=>name.replace(/[A-Z]/g,(v=>"-"+v.toLowerCase())),findNodeIndex=(node,normalized)=>{let idx=0;if(node)for(let lastNodeType=node.nodeType,tempNode=node.previousSibling;tempNode;tempNode=tempNode.previousSibling){const nodeType=tempNode.nodeType;(!normalized||!isText$a(tempNode)||nodeType!==lastNodeType&&tempNode.data.length)&&(idx++,lastNodeType=nodeType)}return idx},updateInternalStyleAttr=(styles,elm)=>{const rawValue=get$9(elm,"style"),value=styles.serialize(styles.parse(rawValue),name(elm));legacySetAttribute(elm,"data-mce-style",value)},applyStyle$1=($elm,cssName,cssValue)=>{const normalizedName=camelCaseToHyphens(cssName);isNullable(cssValue)||""===cssValue?remove$6($elm,normalizedName):set$2($elm,normalizedName,((cssValue,cssName)=>isNumber(cssValue)?has$2(numericalCssMap,cssName)?cssValue+"":cssValue+"px":cssValue)(cssValue,normalizedName))},DOMUtils=(doc,settings={})=>{const addedStyles={},win=window,files={};let counter=0;const styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy}),boundEvents=[],schema=settings.schema?settings.schema:Schema({}),styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,force_hex_color:settings.force_hex_color},settings.schema),events=settings.ownEvents?new EventUtils:EventUtils.Event,blockElementsMap=schema.getBlockElements(),get=elm=>elm&&doc&&isString(elm)?doc.getElementById(elm):elm,_get=elm=>{const value=get(elm);return isNonNullable(value)?SugarElement.fromDom(value):null},getAttrib=(elm,name,defaultVal="")=>{let value;const $elm=_get(elm);if(isNonNullable($elm)&&isElement$7($elm)){const hook=attrHooks[name];value=hook&&hook.get?hook.get($elm.dom,name):get$9($elm,name)}return isNonNullable(value)?value:defaultVal},getAttribs=elm=>{const node=get(elm);return isNullable(node)?[]:node.attributes},setAttrib=(elm,name,value)=>{run(elm,(e=>{if(isElement$6(e)){const $elm=SugarElement.fromDom(e),val=""===value?null:value,originalValue=get$9($elm,name),hook=attrHooks[name];hook&&hook.set?hook.set($elm.dom,val,name):legacySetAttribute($elm,name,val),originalValue!==val&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:$elm.dom,attrName:name,attrValue:val})}}))},getRoot=()=>settings.root_element||doc.body,getPos$1=(elm,rootElm)=>getPos(doc.body,get(elm),rootElm),getStyle=(elm,name,computed)=>{const $elm=get(elm);var node;if(!isNullable($elm)&&(isHTMLElement($elm)||isElement$6(node=$elm)&&"http://www.w3.org/2000/svg"===node.namespaceURI))return computed?get$7(SugarElement.fromDom($elm),camelCaseToHyphens(name)):("float"===(name=name.replace(/-(\D)/g,((a,b)=>b.toUpperCase())))&&(name="cssFloat"),$elm.style?$elm.style[name]:void 0)},getSize=elm=>{const $elm=get(elm);if(!$elm)return{w:0,h:0};let w=getStyle($elm,"width"),h=getStyle($elm,"height");return w&&-1!==w.indexOf("px")||(w="0"),h&&-1!==h.indexOf("px")||(h="0"),{w:parseInt(w,10)||$elm.offsetWidth||$elm.clientWidth,h:parseInt(h,10)||$elm.offsetHeight||$elm.clientHeight}},is=(elm,selector)=>{if(!elm)return!1;const elms=isArray$1(elm)?elm:[elm];return exists(elms,(e=>is$1(SugarElement.fromDom(e),selector)))},getParents=(elm,selector,root,collect)=>{const result=[];let node=get(elm);collect=void 0===collect;const resolvedRoot=root||("BODY"!==getRoot().nodeName?getRoot().parentNode:null);if(isString(selector))if("*"===selector)selector=isElement$6;else{const selectorVal=selector;selector=node=>is(node,selectorVal)}for(;node&&!(node===resolvedRoot||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment(node));){if(!selector||selector(node)){if(!collect)return[node];result.push(node)}node=node.parentNode}return collect?result:null},_findSib=(node,selector,name)=>{let func=selector;if(node){isString(selector)&&(func=node=>is(node,selector));for(let tempNode=node[name];tempNode;tempNode=tempNode[name])if(isFunction(func)&&func(tempNode))return tempNode}return null},run=function(elm,func,scope){const context=null!=scope?scope:this;if(isArray$1(elm)){const result=[];return each$a(elm,((e,i)=>{const node=get(e);node&&result.push(func.call(context,node,i))})),result}{const node=get(elm);return!!node&&func.call(context,node)}},setAttribs=(elm,attrs)=>{run(elm,($elm=>{each$d(attrs,((value,name)=>{setAttrib($elm,name,value)}))}))},setHTML=(elm,html)=>{run(elm,(e=>{const $elm=SugarElement.fromDom(e);set$1($elm,html)}))},add=(parentElm,name,attrs,html,create)=>run(parentElm,(parentElm=>{const newElm=isString(name)?doc.createElement(name):name;return isNonNullable(attrs)&&setAttribs(newElm,attrs),html&&(!isString(html)&&html.nodeType?newElm.appendChild(html):isString(html)&&setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)})),create=(name,attrs,html)=>add(doc.createElement(name),name,attrs,html,!0),encode=Entities.encodeAllRaw,remove=(node,keepChildren)=>run(node,(n=>{const $node=SugarElement.fromDom(n);return keepChildren&&each$e(children$1($node),(child=>{isText$b(child)&&0===child.dom.length?remove$5(child):before$3($node,child)})),remove$5($node),$node.dom})),toggleClass=(elm,cls,state)=>{run(elm,(e=>{if(isElement$6(e)){const $elm=SugarElement.fromDom(e),classes=cls.split(" ");each$e(classes,(c=>{if(isNonNullable(state)){(state?add$2:remove$7)($elm,c)}else toggle$1($elm,c)}))}}))},replace=(newElm,oldElm,keepChildren)=>run(oldElm,(elm=>{var _a;const replacee=isArray$1(oldElm)?newElm.cloneNode(!0):newElm;return keepChildren&&each$a(grep(elm.childNodes),(node=>{replacee.appendChild(node)})),null===(_a=elm.parentNode)||void 0===_a||_a.replaceChild(replacee,elm),elm})),isNonEmptyElement=node=>{if(isElement$6(node)){const isNamedAnchor="a"===node.nodeName.toLowerCase()&&!getAttrib(node,"href")&&getAttrib(node,"id");if(getAttrib(node,"name")||getAttrib(node,"data-mce-bookmark")||isNamedAnchor)return!0}return!1},createRng=()=>doc.createRange(),bind=(target,name,func,scope)=>{if(isArray$1(target)){let i=target.length;const rv=[];for(;i--;)rv[i]=bind(target[i],name,func,scope);return rv}return!settings.collect||target!==doc&&target!==win||boundEvents.push([target,name,func,scope]),events.bind(target,name,func,scope||self)},unbind=(target,name,func)=>{if(isArray$1(target)){let i=target.length;const rv=[];for(;i--;)rv[i]=unbind(target[i],name,func);return rv}if(boundEvents.length>0&&(target===doc||target===win)){let i=boundEvents.length;for(;i--;){const[boundTarget,boundName,boundFunc]=boundEvents[i];target!==boundTarget||name&&name!==boundName||func&&func!==boundFunc||events.unbind(boundTarget,boundName,boundFunc)}}return events.unbind(target,name,func)},getContentEditable=node=>{if(node&&isHTMLElement(node)){const contentEditable=node.getAttribute("data-mce-contenteditable");return contentEditable&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null}return null},self={doc,settings,win,files,stdMode:!0,boxModel:!0,styleSheetLoader,boundEvents,styles,schema,events,isBlock:node=>isString(node)?has$2(blockElementsMap,node):isElement$6(node)&&(has$2(blockElementsMap,node.nodeName)||isTransparentBlock(schema,node)),root:null,clone:(node,deep)=>node.cloneNode(deep),getRoot,getViewPort:argWin=>{const vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height}},getRect:elm=>{const $elm=get(elm),pos=getPos$1($elm),size=getSize($elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize,getParent:(node,selector,root)=>{const parents=getParents(node,selector,root,!1);return parents&&parents.length>0?parents[0]:null},getParents,get,getNext:(node,selector)=>_findSib(node,selector,"nextSibling"),getPrev:(node,selector)=>_findSib(node,selector,"previousSibling"),select:(selector,scope)=>{var _a,_b;const elm=null!==(_b=null!==(_a=get(scope))&&void 0!==_a?_a:settings.root_element)&&void 0!==_b?_b:doc;return isFunction(elm.querySelectorAll)?from(elm.querySelectorAll(selector)):[]},is,add,create,createHTML:(name,attrs,html="")=>{let outHtml="<"+name;for(const key in attrs)hasNonNullableKey(attrs,key)&&(outHtml+=" "+key+'="'+encode(attrs[key])+'"');return isEmpty$3(html)&&has$2(schema.getVoidElements(),name)?outHtml+" />":outHtml+">"+html+"</"+name+">"},createFragment:html=>{const container=doc.createElement("div"),frag=doc.createDocumentFragment();let node;for(frag.appendChild(container),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag.removeChild(container),frag},remove,setStyle:(elm,name,value)=>{run(elm,(e=>{const $elm=SugarElement.fromDom(e);applyStyle$1($elm,name,value),settings.update_styles&&updateInternalStyleAttr(styles,$elm)}))},getStyle,setStyles:(elm,stylesArg)=>{run(elm,(e=>{const $elm=SugarElement.fromDom(e);each$d(stylesArg,((v,n)=>{applyStyle$1($elm,n,v)})),settings.update_styles&&updateInternalStyleAttr(styles,$elm)}))},removeAllAttribs:e=>run(e,(e=>{const attrs=e.attributes;for(let i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))})),setAttrib,setAttribs,getAttrib,getPos:getPos$1,parseStyle:cssText=>styles.parse(cssText),serializeStyle:(stylesArg,name)=>styles.serialize(stylesArg,name),addStyle:cssText=>{if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText])return;addedStyles[cssText]=!0}let styleElm=doc.getElementById("mceDefaultStyles");if(!styleElm){styleElm=doc.createElement("style"),styleElm.id="mceDefaultStyles",styleElm.type="text/css";const head=doc.head;head.firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)}styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:urls=>{urls||(urls=""),each$e(urls.split(","),(url=>{files[url]=!0,styleSheetLoader.load(url).catch(noop)}))},addClass:(elm,cls)=>{toggleClass(elm,cls,!0)},removeClass:(elm,cls)=>{toggleClass(elm,cls,!1)},hasClass:(elm,cls)=>{const $elm=_get(elm),classes=cls.split(" ");return isNonNullable($elm)&&forall(classes,(c=>has($elm,c)))},toggleClass,show:elm=>{run(elm,(e=>remove$6(SugarElement.fromDom(e),"display")))},hide:elm=>{run(elm,(e=>set$2(SugarElement.fromDom(e),"display","none")))},isHidden:elm=>{const $elm=_get(elm);return isNonNullable($elm)&&is$2(getRaw($elm,"display"),"none")},uniqueId:prefix=>(prefix||"mce_")+counter++,setHTML,getOuterHTML:elm=>{const $elm=_get(elm);return isNonNullable($elm)?isElement$6($elm.dom)?$elm.dom.outerHTML:(element=>{const container=SugarElement.fromTag("div"),clone=SugarElement.fromDom(element.dom.cloneNode(!0));return append$1(container,clone),get$6(container)})($elm):""},setOuterHTML:(elm,html)=>{run(elm,($elm=>{isElement$6($elm)&&($elm.outerHTML=html)}))},decode:Entities.decode,encode,insertAfter:(node,reference)=>{const referenceNode=get(reference);return run(node,(node=>{const parent=null==referenceNode?void 0:referenceNode.parentNode,nextSibling=null==referenceNode?void 0:referenceNode.nextSibling;return parent&&(nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node)),node}))},replace,rename:(elm,name)=>{if(elm.nodeName!==name.toUpperCase()){const newElm=create(name);return each$a(getAttribs(elm),(attrNode=>{setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName))})),replace(newElm,elm,!0),newElm}return elm},findCommonAncestor:(a,b)=>{let ps=a;for(;ps;){let pe=b;for(;pe&&ps!==pe;)pe=pe.parentNode;if(ps===pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},run,getAttribs,isEmpty:(node,elements,options)=>{let brCount=0;if(isNonEmptyElement(node))return!1;const firstChild=node.firstChild;if(firstChild){const walker=new DomTreeWalker(firstChild,node),whitespaceElements=schema?schema.getWhitespaceElements():{},nonEmptyElements=elements||(schema?schema.getNonEmptyElements():null);let tempNode=firstChild;do{if(isElement$6(tempNode)){const bogusVal=tempNode.getAttribute("data-mce-bogus");if(bogusVal){tempNode=walker.next("all"===bogusVal);continue}const name=tempNode.nodeName.toLowerCase();if(nonEmptyElements&&nonEmptyElements[name]){if("br"===name){brCount++,tempNode=walker.next();continue}return!1}if(isNonEmptyElement(tempNode))return!1}if(isComment(tempNode))return!1;if(isText$a(tempNode)&&!isWhitespaceText(tempNode.data)&&(!(null==options?void 0:options.includeZwsp)||!isZwsp(tempNode.data)))return!1;if(isText$a(tempNode)&&tempNode.parentNode&&whitespaceElements[tempNode.parentNode.nodeName]&&isWhitespaceText(tempNode.data))return!1;tempNode=walker.next()}while(tempNode)}return brCount<=1},createRng,nodeIndex:findNodeIndex,split:(parentElm,splitElm,replacementElm)=>{let beforeFragment,afterFragment,range=createRng();if(parentElm&&splitElm&&parentElm.parentNode&&splitElm.parentNode){const parentNode=parentElm.parentNode;return range.setStart(parentNode,findNodeIndex(parentElm)),range.setEnd(splitElm.parentNode,findNodeIndex(splitElm)),beforeFragment=range.extractContents(),range=createRng(),range.setStart(splitElm.parentNode,findNodeIndex(splitElm)+1),range.setEnd(parentNode,findNodeIndex(parentElm)+1),afterFragment=range.extractContents(),parentNode.insertBefore(trimNode(self,beforeFragment,schema),parentElm),replacementElm?parentNode.insertBefore(replacementElm,parentElm):parentNode.insertBefore(splitElm,parentElm),parentNode.insertBefore(trimNode(self,afterFragment,schema),parentElm),remove(parentElm),replacementElm||splitElm}},bind,unbind,fire:(target,name,evt)=>events.dispatch(target,name,evt),dispatch:(target,name,evt)=>events.dispatch(target,name,evt),getContentEditable,getContentEditableParent:node=>{const root=getRoot();let state=null;for(let tempNode=node;tempNode&&tempNode!==root&&(state=getContentEditable(tempNode),null===state);tempNode=tempNode.parentNode);return state},isEditable:node=>{if(isNonNullable(node)){const scope=isElement$6(node)?node:node.parentElement;return isNonNullable(scope)&&isHTMLElement(scope)&&isEditable$2(SugarElement.fromDom(scope))}return!1},destroy:()=>{if(boundEvents.length>0){let i=boundEvents.length;for(;i--;){const[boundTarget,boundName,boundFunc]=boundEvents[i];events.unbind(boundTarget,boundName,boundFunc)}}each$d(files,((_,url)=>{styleSheetLoader.unload(url),delete files[url]}))},isChildOf:(node,parent)=>node===parent||parent.contains(node),dumpRng:r=>"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset},attrHooks=((styles,settings,getContext)=>{const keepValues=settings.keep_values,keepUrlHook={set:(elm,value,name)=>{const sugarElm=SugarElement.fromDom(elm);isFunction(settings.url_converter)&&isNonNullable(value)&&(value=settings.url_converter.call(settings.url_converter_scope||getContext(),String(value),name,elm)),legacySetAttribute(sugarElm,"data-mce-"+name,value),legacySetAttribute(sugarElm,name,value)},get:(elm,name)=>{const sugarElm=SugarElement.fromDom(elm);return get$9(sugarElm,"data-mce-"+name)||get$9(sugarElm,name)}},attrHooks={style:{set:(elm,value)=>{const sugarElm=SugarElement.fromDom(elm);keepValues&&legacySetAttribute(sugarElm,"data-mce-style",value),remove$a(sugarElm,"style"),isString(value)&&setAll(sugarElm,styles.parse(value))},get:elm=>{const sugarElm=SugarElement.fromDom(elm),value=get$9(sugarElm,"data-mce-style")||get$9(sugarElm,"style");return styles.serialize(styles.parse(value),name(sugarElm))}}};return keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks})(styles,settings,constant(self));return self};DOMUtils.DOM=DOMUtils(document),DOMUtils.nodeIndex=findNodeIndex;const DOM$b=DOMUtils.DOM;class ScriptLoader{constructor(settings={}){this.states={},this.queue=[],this.scriptLoadedCallbacks={},this.queueLoadedCallbacks=[],this.loading=!1,this.settings=settings}_setReferrerPolicy(referrerPolicy){this.settings.referrerPolicy=referrerPolicy}loadScript(url){return new Promise(((resolve,reject)=>{const dom=DOM$b;let elm;const cleanup=()=>{dom.remove(id),elm&&(elm.onerror=elm.onload=elm=null)},id=dom.uniqueId();elm=document.createElement("script"),elm.id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),this.settings.referrerPolicy&&dom.setAttrib(elm,"referrerpolicy",this.settings.referrerPolicy),elm.onload=()=>{cleanup(),resolve()},elm.onerror=()=>{cleanup(),reject("Failed to load script: "+url)},(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)}))}isDone(url){return 2===this.states[url]}markDone(url){this.states[url]=2}add(url){const self=this;self.queue.push(url);return void 0===self.states[url]&&(self.states[url]=0),new Promise(((resolve,reject)=>{self.scriptLoadedCallbacks[url]||(self.scriptLoadedCallbacks[url]=[]),self.scriptLoadedCallbacks[url].push({resolve,reject})}))}load(url){return this.add(url)}remove(url){delete this.states[url],delete this.scriptLoadedCallbacks[url]}loadQueue(){const queue=this.queue;return this.queue=[],this.loadScripts(queue)}loadScripts(scripts){const self=this,execCallbacks=(name,url)=>{get$a(self.scriptLoadedCallbacks,url).each((callbacks=>{each$e(callbacks,(callback=>callback[name](url)))})),delete self.scriptLoadedCallbacks[url]},processResults=results=>{const failures=filter$5(results,(result=>"rejected"===result.status));return failures.length>0?Promise.reject(bind$3(failures,(({reason})=>isArray$1(reason)?reason:[reason]))):Promise.resolve()},load=urls=>Promise.allSettled(map$3(urls,(url=>2===self.states[url]?(execCallbacks("resolve",url),Promise.resolve()):3===self.states[url]?(execCallbacks("reject",url),Promise.reject(url)):(self.states[url]=1,self.loadScript(url).then((()=>{self.states[url]=2,execCallbacks("resolve",url);const queue=self.queue;return queue.length>0?(self.queue=[],load(queue).then(processResults)):Promise.resolve()}),(()=>(self.states[url]=3,execCallbacks("reject",url),Promise.reject(url)))))))),processQueue=urls=>(self.loading=!0,load(urls).then((results=>{self.loading=!1;const nextQueuedItem=self.queueLoadedCallbacks.shift();return Optional.from(nextQueuedItem).each(call),processResults(results)}))),uniqueScripts=stringArray(scripts);return self.loading?new Promise(((resolve,reject)=>{self.queueLoadedCallbacks.push((()=>{processQueue(uniqueScripts).then(resolve,reject)}))})):processQueue(uniqueScripts)}}ScriptLoader.ScriptLoader=new ScriptLoader;const Cell=initial=>{let value=initial;return{get:()=>value,set:v=>{value=v}}},data={},currentCode=Cell("en"),getLanguageData=()=>get$a(data,currentCode.get()),I18n={getData:()=>map$2(data,(value=>({...value}))),setCode:newCode=>{newCode&&currentCode.set(newCode)},getCode:()=>currentCode.get(),add:(code,items)=>{let langData=data[code];langData||(data[code]=langData={});const lcNames=map$3(keys(items),(name=>name.toLowerCase()));each$d(items,((translation,name)=>{const lcName=name.toLowerCase();lcName!==name&&((items,item)=>{const firstIndex=items.indexOf(item);return-1!==firstIndex&&items.indexOf(item,firstIndex+1)>firstIndex})(lcNames,lcName)?(has$2(items,lcName)||(langData[lcName]=translation),langData[name]=translation):langData[lcName]=translation}))},translate:text=>{const langData=getLanguageData().getOr({}),toString=obj=>isFunction(obj)?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj,isEmpty=text=>""===text||null==text,getLangData=text=>{const textStr=toString(text);return has$2(langData,textStr)?toString(langData[textStr]):get$a(langData,textStr.toLowerCase()).map(toString).getOr(textStr)},removeContext=str=>str.replace(/{context:\w+}$/,"");if(isEmpty(text))return"";if(isObject(str=text)&&has$2(str,"raw"))return toString(text.raw);var str;if((str=>isArray$1(str)&&str.length>1)(text)){const values=text.slice(1);return removeContext(getLangData(text[0]).replace(/\{([0-9]+)\}/g,(($1,$2)=>has$2(values,$2)?toString(values[$2]):$1)))}return removeContext(getLangData(text))},isRtl:()=>getLanguageData().bind((items=>get$a(items,"_dir"))).exists((dir=>"rtl"===dir)),hasCode:code=>has$2(data,code)},AddOnManager=()=>{const items=[],urls={},lookup={},_listeners=[],runListeners=(name,state)=>{const matchedListeners=filter$5(_listeners,(listener=>listener.name===name&&listener.state===state));each$e(matchedListeners,(listener=>listener.resolve()))},isLoaded=name=>has$2(urls,name),loadLanguagePack=(name,languages)=>{const language=I18n.getCode();!language||languages&&-1===(","+(languages||"")+",").indexOf(","+language+",")||ScriptLoader.ScriptLoader.add(urls[name]+"/langs/"+language+".js")},waitFor=(name,state="added")=>"added"===state&&(name=>has$2(lookup,name))(name)||"loaded"===state&&isLoaded(name)?Promise.resolve():new Promise((resolve=>{_listeners.push({name,state,resolve})}));return{items,urls,lookup,get:name=>{if(lookup[name])return lookup[name].instance},requireLangPack:(name,languages)=>{!1!==AddOnManager.languageLoad&&(isLoaded(name)?loadLanguagePack(name,languages):waitFor(name,"loaded").then((()=>loadLanguagePack(name,languages))))},add:(id,addOn)=>(items.push(addOn),lookup[id]={instance:addOn},runListeners(id,"added"),addOn),remove:name=>{delete urls[name],delete lookup[name]},createUrl:(baseUrl,dep)=>isString(dep)?isString(baseUrl)?{prefix:"",resource:dep,suffix:""}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}:dep,load:(name,addOnUrl)=>{if(urls[name])return Promise.resolve();let urlString=isString(addOnUrl)?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;0!==urlString.indexOf("/")&&-1===urlString.indexOf("://")&&(urlString=AddOnManager.baseURL+"/"+urlString),urls[name]=urlString.substring(0,urlString.lastIndexOf("/"));const done=()=>(runListeners(name,"loaded"),Promise.resolve());return lookup[name]?done():ScriptLoader.ScriptLoader.add(urlString).then(done)},waitFor}};AddOnManager.languageLoad=!0,AddOnManager.baseURL="",AddOnManager.PluginManager=AddOnManager(),AddOnManager.ThemeManager=AddOnManager(),AddOnManager.ModelManager=AddOnManager();const repeatable=delay=>{const intervalId=Cell(Optional.none()),revoke=()=>intervalId.get().each((id=>clearInterval(id)));return{clear:()=>{revoke(),intervalId.set(Optional.none())},isSet:()=>intervalId.get().isSome(),get:()=>intervalId.get(),set:functionToRepeat=>{revoke(),intervalId.set(Optional.some(setInterval(functionToRepeat,delay)))}}},value$2=()=>{const subject=(doRevoke=>{const subject=Cell(Optional.none()),revoke=()=>subject.get().each(doRevoke);return{clear:()=>{revoke(),subject.set(Optional.none())},isSet:()=>subject.get().isSome(),get:()=>subject.get(),set:s=>{revoke(),subject.set(Optional.some(s))}}})(noop);return{...subject,on:f=>subject.get().each(f)}},first$1=(fn,rate)=>{let timer=null;return{cancel:()=>{isNull(timer)||(clearTimeout(timer),timer=null)},throttle:(...args)=>{isNull(timer)&&(timer=setTimeout((()=>{timer=null,fn.apply(null,args)}),rate))}}},last$1=(fn,rate)=>{let timer=null;const cancel=()=>{isNull(timer)||(clearTimeout(timer),timer=null)};return{cancel,throttle:(...args)=>{cancel(),timer=setTimeout((()=>{timer=null,fn.apply(null,args)}),rate)}}},annotation=constant("mce-annotation"),dataAnnotation=constant("data-mce-annotation"),dataAnnotationId=constant("data-mce-annotation-uid"),dataAnnotationActive=constant("data-mce-annotation-active"),dataAnnotationClasses=constant("data-mce-annotation-classes"),dataAnnotationAttributes=constant("data-mce-annotation-attrs"),isRoot$1=root=>node=>eq(node,root),identify=(editor,annotationName)=>{const rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),root=SugarElement.fromDom(editor.getBody()),selector=annotationName.fold((()=>"."+annotation()),(an=>`[${dataAnnotation()}="${an}"]`)),newStart=child$1(start,rng.startOffset).getOr(start);return closest$3(newStart,selector,isRoot$1(root)).bind((c=>getOpt(c,`${dataAnnotationId()}`).bind((uid=>getOpt(c,`${dataAnnotation()}`).map((name=>{const elements=findMarkers(editor,uid);return{uid,name,elements}}))))))},isBogusElement=(elem,root)=>has$1(elem,"data-mce-bogus")||ancestor$2(elem,'[data-mce-bogus="all"]',isRoot$1(root)),findMarkers=(editor,uid)=>{const body=SugarElement.fromDom(editor.getBody()),descendants$1=descendants(body,`[${dataAnnotationId()}="${uid}"]`);return filter$5(descendants$1,(descendant=>!isBogusElement(descendant,body)))},findAll=(editor,name)=>{const body=SugarElement.fromDom(editor.getBody()),markers=descendants(body,`[${dataAnnotation()}="${name}"]`),directory={};return each$e(markers,(m=>{if(!isBogusElement(m,body)){const uid=get$9(m,dataAnnotationId()),nodesAlready=get$a(directory,uid).getOr([]);directory[uid]=nodesAlready.concat([m])}})),directory},setup$y=(editor,registry)=>{const changeCallbacks=Cell({}),initData=()=>({listeners:[],previous:value$2()}),withCallbacks=(name,f)=>{updateCallbacks(name,(data=>(f(data),data)))},updateCallbacks=(name,f)=>{const callbackMap=changeCallbacks.get(),outputData=f(get$a(callbackMap,name).getOrThunk(initData));callbackMap[name]=outputData,changeCallbacks.set(callbackMap)},toggleActiveAttr=(uid,state)=>{each$e(findMarkers(editor,uid),(elem=>{state?set$3(elem,dataAnnotationActive(),"true"):remove$a(elem,dataAnnotationActive())}))},onNodeChange=last$1((()=>{const annotations=sort(registry.getNames());each$e(annotations,(name=>{updateCallbacks(name,(data=>{const prev=data.previous.get();return identify(editor,Optional.some(name)).fold((()=>{prev.each((uid=>{(name=>{withCallbacks(name,(data=>{each$e(data.listeners,(f=>f(!1,name)))}))})(name),data.previous.clear(),toggleActiveAttr(uid,!1)}))}),(({uid,name,elements})=>{is$2(prev,uid)||(prev.each((uid=>toggleActiveAttr(uid,!1))),((name,uid,elements)=>{withCallbacks(name,(data=>{each$e(data.listeners,(f=>f(!0,name,{uid,nodes:map$3(elements,(elem=>elem.dom))})))}))})(name,uid,elements),data.previous.set(uid),toggleActiveAttr(uid,!0))})),{previous:data.previous,listeners:data.listeners}}))}))}),30);editor.on("remove",(()=>{onNodeChange.cancel()})),editor.on("NodeChange",(()=>{onNodeChange.throttle()}));return{addListener:(name,f)=>{updateCallbacks(name,(data=>({previous:data.previous,listeners:data.listeners.concat([f])})))}}};let unique=0;const generate$1=prefix=>{const time=(new Date).getTime(),random=Math.floor(1e9*Math.random());return unique++,prefix+"_"+random+unique+String(time)},clone$2=(original,isDeep)=>SugarElement.fromDom(original.dom.cloneNode(isDeep)),shallow$1=original=>clone$2(original,!1),deep$1=original=>clone$2(original,!0),mutate=(original,tag)=>{const nu=((original,tag)=>{const nu=SugarElement.fromTag(tag),attributes=clone$4(original);return setAll$1(nu,attributes),nu})(original,tag);after$4(original,nu);const children=children$1(original);return append(nu,children),remove$5(original),nu},TextWalker=(startNode,rootNode,isBoundary=never)=>{const walker=new DomTreeWalker(startNode,rootNode),walk=direction=>{let next;do{next=walker[direction]()}while(next&&!isText$a(next)&&!isBoundary(next));return Optional.from(next).filter(isText$a)};return{current:()=>Optional.from(walker.current()).filter(isText$a),next:()=>walk("next"),prev:()=>walk("prev"),prev2:()=>walk("prev2")}},TextSeeker=(dom,isBoundary)=>{const isBlockBoundary=isBoundary||(node=>dom.isBlock(node)||isBr$6(node)||isContentEditableFalse$b(node)),walk=(node,offset,walker,process)=>{if(isText$a(node)){const newOffset=process(node,offset,node.data);if(-1!==newOffset)return Optional.some({container:node,offset:newOffset})}return walker().bind((next=>walk(next.container,next.offset,walker,process)))};return{backwards:(node,offset,process,root)=>{const walker=TextWalker(node,null!=root?root:dom.getRoot(),isBlockBoundary);return walk(node,offset,(()=>walker.prev().map((prev=>({container:prev,offset:prev.length})))),process).getOrNull()},forwards:(node,offset,process,root)=>{const walker=TextWalker(node,null!=root?root:dom.getRoot(),isBlockBoundary);return walk(node,offset,(()=>walker.next().map((next=>({container:next,offset:0})))),process).getOrNull()}}},round$2=Math.round,clone$1=rect=>rect?{left:round$2(rect.left),top:round$2(rect.top),bottom:round$2(rect.bottom),right:round$2(rect.right),width:round$2(rect.width),height:round$2(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0},collapse=(rect,toStart)=>(rect=clone$1(rect),toStart||(rect.left=rect.left+rect.width),rect.right=rect.left,rect.width=0,rect),isValidOverflow=(overflowY,rect1,rect2)=>overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2,isAbove$1=(rect1,rect2)=>{const halfHeight=Math.min(rect2.height/2,rect1.height/2);return rect1.bottom-halfHeight<rect2.top||!(rect1.top>rect2.bottom)&&isValidOverflow(rect2.top-rect1.bottom,rect1,rect2)},isBelow$1=(rect1,rect2)=>rect1.top>rect2.bottom||!(rect1.bottom<rect2.top)&&isValidOverflow(rect2.bottom-rect1.top,rect1,rect2),distanceToRectEdgeFromXY=(rect,x,y)=>{const cx=Math.max(Math.min(x,rect.left+rect.width),rect.left),cy=Math.max(Math.min(y,rect.top+rect.height),rect.top);return Math.sqrt((x-cx)*(x-cx)+(y-cy)*(y-cy))},getSelectedNode=range=>{const startContainer=range.startContainer,startOffset=range.startOffset;return startContainer===range.endContainer&&startContainer.hasChildNodes()&&range.endOffset===startOffset+1?startContainer.childNodes[startOffset]:null},getNode$1=(container,offset)=>{if(isElement$6(container)&&container.hasChildNodes()){const childNodes=container.childNodes,safeOffset=((value,min,max)=>Math.min(Math.max(value,min),max))(offset,0,childNodes.length-1);return childNodes[safeOffset]}return container},extendingChars=new RegExp("[̀-ͯ҃-҇҈-҉֑-ֽֿׁ-ׂׄ-ׇׅؐ-ًؚ-ٰٟۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ंऺ़ु-ै्॑-ॗॢ-ॣঁ়াু-ৄ্ৗৢ-ৣਁ-ਂ਼ੁ-ੂੇ-ੈੋ-੍ੑੰ-ੱੵઁ-ં઼ુ-ૅે-ૈ્ૢ-ૣଁ଼ାିୁ-ୄ୍ୖୗୢ-ୣஂாீ்ௗఀా-ీె-ైొ-్ౕ-ౖౢ-ౣಁ಼ಿೂೆೌ-್ೕ-ೖೢ-ೣഁാു-ൄ്ൗൢ-ൣ්ාි-ුූෟัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-ཱ༹༙༵༷-ཾྀ-྄྆-྇ྍ-ྗྙ-ྼ࿆ိ-ူဲ-့္-်ွ-ှၘ-ၙၞ-ၠၱ-ၴႂႅ-ႆႍႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳ឴-឵ិ-ួំ៉-៓៝᠋-᠍ᢩᤠ-ᤢᤧ-ᤨᤲ᤹-᤻ᨗ-ᨘᨛᩖᩘ-ᩞ᩠ᩢᩥ-ᩬᩳ-᩿᩼᪰-᪽᪾ᬀ-ᬃ᬴ᬶ-ᬺᬼᭂ᭫-᭳ᮀ-ᮁᮢ-ᮥᮨ-ᮩ᮫-ᮭ᯦ᯨ-ᯩᯭᯯ-ᯱᰬ-ᰳᰶ-᰷᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸-᳹᷀-᷵᷼-᷿‌-‍⃐-⃜⃝-⃠⃡⃢-⃤⃥-⃰⳯-⵿⳱ⷠ-〪ⷿ-〭〮-゙〯-゚꙯꙰-꙲ꙴ-꙽ꚞ-ꚟ꛰-꛱ꠂ꠆ꠋꠥ-ꠦ꣄꣠-꣱ꤦ-꤭ꥇ-ꥑꦀ-ꦂ꦳ꦶ-ꦹꦼꧥꨩ-ꨮꨱ-ꨲꨵ-ꨶꩃꩌꩼꪰꪲ-ꪴꪷ-ꪸꪾ-꪿꫁ꫬ-ꫭ꫶ꯥꯨ꯭ﬞ︀-️︠-︯ﾞ-ﾟ]"),isExtendingChar=ch=>isString(ch)&&ch.charCodeAt(0)>=768&&extendingChars.test(ch),isElement$4=isElement$6,isCaretCandidate$2=isCaretCandidate$3,isBlock$2=matchStyleValues("display","block table"),isFloated=matchStyleValues("float","left right"),isValidElementCaretCandidate=((...args)=>x=>{for(let i=0;i<args.length;i++)if(!args[i](x))return!1;return!0})(isElement$4,isCaretCandidate$2,not(isFloated)),isNotPre=not(matchStyleValues("white-space","pre pre-line pre-wrap")),isText$7=isText$a,isBr$3=isBr$6,nodeIndex$1=DOMUtils.nodeIndex,resolveIndex$1=(container,offset)=>offset<0&&isElement$6(container)&&container.hasChildNodes()?void 0:getNode$1(container,offset),createRange$1=doc=>doc?doc.createRange():DOMUtils.DOM.createRng(),isWhiteSpace$1=chr=>isString(chr)&&/[\r\n\t ]/.test(chr),isRange=rng=>!!rng.setStart&&!!rng.setEnd,isHiddenWhiteSpaceRange=range=>{const container=range.startContainer,offset=range.startOffset;if(isWhiteSpace$1(range.toString())&&isNotPre(container.parentNode)&&isText$a(container)){const text=container.data;if(isWhiteSpace$1(text[offset-1])||isWhiteSpace$1(text[offset+1]))return!0}return!1},isZeroRect=r=>0===r.left&&0===r.right&&0===r.top&&0===r.bottom,getBoundingClientRect$1=item=>{var _a;let clientRect;const clientRects=item.getClientRects();return clientRect=clientRects.length>0?clone$1(clientRects[0]):clone$1(item.getBoundingClientRect()),!isRange(item)&&isBr$3(item)&&isZeroRect(clientRect)?(brNode=>{const doc=brNode.ownerDocument,rng=createRange$1(doc),nbsp$1=doc.createTextNode(" "),parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode),rng.setStart(nbsp$1,0),rng.setEnd(nbsp$1,1);const clientRect=clone$1(rng.getBoundingClientRect());return parentNode.removeChild(nbsp$1),clientRect})(item):isZeroRect(clientRect)&&isRange(item)&&null!==(_a=(rng=>{const sc=rng.startContainer,ec=rng.endContainer,so=rng.startOffset,eo=rng.endOffset;if(sc===ec&&isText$a(ec)&&0===so&&1===eo){const newRng=rng.cloneRange();return newRng.setEndAfter(ec),getBoundingClientRect$1(newRng)}return null})(item))&&void 0!==_a?_a:clientRect},collapseAndInflateWidth=(clientRect,toStart)=>{const newClientRect=collapse(clientRect,toStart);return newClientRect.width=1,newClientRect.right=newClientRect.left+1,newClientRect},getCaretPositionClientRects=caretPosition=>{const clientRects=[],addUniqueAndValidRect=clientRect=>{var rect1,rect2;0!==clientRect.height&&(clientRects.length>0&&(rect1=clientRect,rect2=clientRects[clientRects.length-1],rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right)||clientRects.push(clientRect))},addCharacterOffset=(container,offset)=>{const range=createRange$1(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset]))return;if(isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return void addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(range),!0)))},container=caretPosition.container(),offset=caretPosition.offset();if(isText$7(container))return addCharacterOffset(container,offset),clientRects;if(isElement$4(container))if(caretPosition.isAtEnd()){const node=resolveIndex$1(container,offset);isText$7(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr$3(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1))}else{const node=resolveIndex$1(container,offset);if(isText$7(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!1)),clientRects;const beforeNode=resolveIndex$1(caretPosition.container(),caretPosition.offset()-1);isValidElementCaretCandidate(beforeNode)&&!isBr$3(beforeNode)&&(isBlock$2(beforeNode)||isBlock$2(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect$1(node),!0))}return clientRects},CaretPosition=(container,offset,clientRects)=>{const getClientRects=()=>(clientRects||(clientRects=getCaretPositionClientRects(CaretPosition(container,offset))),clientRects);return{container:constant(container),offset:constant(offset),toRange:()=>{const range=createRange$1(container.ownerDocument);return range.setStart(container,offset),range.setEnd(container,offset),range},getClientRects,isVisible:()=>getClientRects().length>0,isAtStart:()=>(isText$7(container),0===offset),isAtEnd:()=>isText$7(container)?offset>=container.data.length:offset>=container.childNodes.length,isEqual:caretPosition=>caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset(),getNode:before=>resolveIndex$1(container,before?offset-1:offset)}};CaretPosition.fromRangeStart=range=>CaretPosition(range.startContainer,range.startOffset),CaretPosition.fromRangeEnd=range=>CaretPosition(range.endContainer,range.endOffset),CaretPosition.after=node=>CaretPosition(node.parentNode,nodeIndex$1(node)+1),CaretPosition.before=node=>CaretPosition(node.parentNode,nodeIndex$1(node)),CaretPosition.isAbove=(pos1,pos2)=>lift2(head(pos2.getClientRects()),last$3(pos1.getClientRects()),isAbove$1).getOr(!1),CaretPosition.isBelow=(pos1,pos2)=>lift2(last$3(pos2.getClientRects()),head(pos1.getClientRects()),isBelow$1).getOr(!1),CaretPosition.isAtStart=pos=>!!pos&&pos.isAtStart(),CaretPosition.isAtEnd=pos=>!!pos&&pos.isAtEnd(),CaretPosition.isTextPosition=pos=>!!pos&&isText$a(pos.container()),CaretPosition.isElementPosition=pos=>!CaretPosition.isTextPosition(pos);const trimEmptyTextNode$1=(dom,node)=>{isText$a(node)&&0===node.data.length&&dom.remove(node)},rangeInsertNode=(dom,rng,node)=>{isDocumentFragment(node)?((dom,rng,frag)=>{const firstChild=Optional.from(frag.firstChild),lastChild=Optional.from(frag.lastChild);rng.insertNode(frag),firstChild.each((child=>trimEmptyTextNode$1(dom,child.previousSibling))),lastChild.each((child=>trimEmptyTextNode$1(dom,child.nextSibling)))})(dom,rng,node):((dom,rng,node)=>{rng.insertNode(node),trimEmptyTextNode$1(dom,node.previousSibling),trimEmptyTextNode$1(dom,node.nextSibling)})(dom,rng,node)},isText$6=isText$a,isBogus=isBogus$2,nodeIndex=DOMUtils.nodeIndex,normalizedParent=node=>{const parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode},getChildNodes=node=>node?reduce(node.childNodes,((result,node)=>(isBogus(node)&&"BR"!==node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result)),[]):[],equal=a=>b=>a===b,createPathItem=node=>(isText$6(node)?"text()":node.nodeName.toLowerCase())+"["+(node=>{let nodes,index;nodes=getChildNodes(normalizedParent(node)),index=findIndex$1(nodes,equal(node),node),nodes=nodes.slice(0,index+1);const numTextFragments=reduce(nodes,((result,node,i)=>(isText$6(node)&&isText$6(nodes[i-1])&&result++,result)),0);return nodes=filter$3(nodes,matchNodeNames([node.nodeName])),index=findIndex$1(nodes,equal(node),node),index-numTextFragments})(node)+"]",create$b=(root,caretPosition)=>{let outputOffset,path=[],container=caretPosition.container(),offset=caretPosition.offset();if(isText$6(container))outputOffset=((node,offset)=>{let tempNode=node;for(;(tempNode=tempNode.previousSibling)&&isText$6(tempNode);)offset+=tempNode.data.length;return offset})(container,offset);else{const childNodes=container.childNodes;offset>=childNodes.length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]}path.push(createPathItem(container));let parents=((root,node,predicate)=>{const parents=[];for(let tempNode=node.parentNode;tempNode&&tempNode!==root&&(!predicate||!predicate(tempNode));tempNode=tempNode.parentNode)parents.push(tempNode);return parents})(root,container);return parents=filter$3(parents,not(isBogus$2)),path=path.concat(map$1(parents,(node=>createPathItem(node)))),path.reverse().join("/")+","+outputOffset},resolve$1=(root,path)=>{if(!path)return null;const parts=path.split(","),paths=parts[0].split("/"),offset=parts.length>1?parts[1]:"before",container=reduce(paths,((result,value)=>{const match=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);return match?("text()"===match[1]&&(match[1]="#text"),((node,name,index)=>{let nodes=getChildNodes(node);return nodes=filter$3(nodes,((node,index)=>!isText$6(node)||!isText$6(nodes[index-1]))),nodes=filter$3(nodes,matchNodeNames([name])),nodes[index]})(result,match[1],parseInt(match[2],10))):null}),root);if(!container)return null;if(!isText$6(container)&&container.parentNode){let nodeOffset;return nodeOffset="after"===offset?nodeIndex(container)+1:nodeIndex(container),CaretPosition(container.parentNode,nodeOffset)}return((container,offset)=>{let node=container,targetOffset=0;for(;isText$6(node);){const dataLen=node.data.length;if(offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText$6(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return isText$6(container)&&offset>container.data.length&&(offset=container.data.length),CaretPosition(container,offset)})(container,parseInt(offset,10))},isContentEditableFalse$9=isContentEditableFalse$b,getPoint=(dom,trim,normalized,rng,start)=>{const container=start?rng.startContainer:rng.endContainer;let offset=start?rng.startOffset:rng.endOffset;const point=[],root=dom.getRoot();if(isText$a(container))point.push(normalized?((trim,container,offset)=>{let trimmedOffset=trim(container.data.slice(0,offset)).length;for(let node=container.previousSibling;node&&isText$a(node);node=node.previousSibling)trimmedOffset+=trim(node.data).length;return trimmedOffset})(trim,container,offset):offset);else{let after=0;const childNodes=container.childNodes;offset>=childNodes.length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after)}for(let node=container;node&&node!==root;node=node.parentNode)point.push(dom.nodeIndex(node,normalized));return point},findIndex=(dom,name,element)=>{let count=0;return Tools.each(dom.select(name),(node=>"all"===node.getAttribute("data-mce-bogus")?void 0:node!==element&&void count++)),count},moveEndPoint$1=(rng,start)=>{let container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;if(isElement$6(container)&&"TR"===container.nodeName){const childNodes=container.childNodes;container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)],container&&(offset=start?0:container.childNodes.length,start?rng.setStart(container,offset):rng.setEnd(container,offset))}},normalizeTableCellSelection=rng=>(moveEndPoint$1(rng,!0),moveEndPoint$1(rng,!1),rng),findSibling=(node,offset)=>{if(isElement$6(node)&&(node=getNode$1(node,offset),isContentEditableFalse$9(node)))return node;if(isCaretContainer$2(node)){isText$a(node)&&isCaretContainerBlock$1(node)&&(node=node.parentNode);let sibling=node.previousSibling;if(isContentEditableFalse$9(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse$9(sibling))return sibling}},getOffsetBookmark=(trim,normalized,selection)=>{const element=selection.getNode(),rng=selection.getRng();if("IMG"===element.nodeName||isContentEditableFalse$9(element)){const name=element.nodeName;return{name,index:findIndex(selection.dom,name,element)}}const sibling=(rng=>findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset))(rng);if(sibling){const name=sibling.tagName;return{name,index:findIndex(selection.dom,name,sibling)}}return((trim,selection,normalized,rng)=>{const dom=selection.dom,start=getPoint(dom,trim,normalized,rng,!0),forward=selection.isForward(),fakeCaret=isRangeInCaretContainerBlock(rng)?{isFakeCaret:!0}:{};return selection.isCollapsed()?{start,forward,...fakeCaret}:{start,end:getPoint(dom,trim,normalized,rng,!1),forward,...fakeCaret}})(trim,selection,normalized,rng)},createBookmarkSpan=(dom,id,filled)=>{const args={"data-mce-type":"bookmark",id,style:"overflow:hidden;line-height:0px"};return filled?dom.create("span",args,"&#xFEFF;"):dom.create("span",args)},getPersistentBookmark=(selection,filled)=>{const dom=selection.dom;let rng=selection.getRng();const id=dom.uniqueId(),collapsed=selection.isCollapsed(),element=selection.getNode(),name=element.nodeName,forward=selection.isForward();if("IMG"===name)return{name,index:findIndex(dom,name,element)};const rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(!1);const endBookmarkNode=createBookmarkSpan(dom,id+"_end",filled);rangeInsertNode(dom,rng2,endBookmarkNode)}rng=normalizeTableCellSelection(rng),rng.collapse(!0);const startBookmarkNode=createBookmarkSpan(dom,id+"_start",filled);return rangeInsertNode(dom,rng,startBookmarkNode),selection.moveToBookmark({id,keep:!0,forward}),{id,forward}},getBookmark$2=(selection,type,normalized=!1)=>2===type?getOffsetBookmark(trim$2,normalized,selection):3===type?(selection=>{const rng=selection.getRng();return{start:create$b(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$b(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng)),forward:selection.isForward()}})(selection):type?(selection=>({rng:selection.getRng(),forward:selection.isForward()}))(selection):getPersistentBookmark(selection,!1),getUndoBookmark=curry(getOffsetBookmark,identity,!0),value$1=value=>{const applyHelper=fn=>fn(value),constHelper=constant(value),outputHelper=()=>output,output={tag:!0,inner:value,fold:(_onError,onValue)=>onValue(value),isValue:always,isError:never,map:mapper=>Result.value(mapper(value)),mapError:outputHelper,bind:applyHelper,exists:applyHelper,forall:applyHelper,getOr:constHelper,or:outputHelper,getOrThunk:constHelper,orThunk:outputHelper,getOrDie:constHelper,each:fn=>{fn(value)},toOptional:()=>Optional.some(value)};return output},error=error=>{const outputHelper=()=>output,output={tag:!1,inner:error,fold:(onError,_onValue)=>onError(error),isValue:never,isError:always,map:outputHelper,mapError:mapper=>Result.error(mapper(error)),bind:outputHelper,exists:never,forall:always,getOr:identity,or:identity,getOrThunk:apply$1,orThunk:apply$1,getOrDie:die(String(error)),each:noop,toOptional:Optional.none};return output},Result={value:value$1,error,fromOption:(optional,err)=>optional.fold((()=>error(err)),value$1)},Adt_generate=cases=>{if(!isArray$1(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");const constructors=[],adt={};return each$e(cases,((acase,count)=>{const keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");const key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray$1(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=(...args)=>{const argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);return{fold:(...foldArgs)=>{if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);return foldArgs[count].apply(null,args)},match:branches=>{const branchKeys=keys(branches);if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(reqKey=>contains$2(branchKeys,reqKey))))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)},log:label=>{console.log(label,{constructors,constructor:key,params:args})}}}})),adt};Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const isInlinePattern=pattern=>"inline-command"===pattern.type||"inline-format"===pattern.type,isBlockPattern=pattern=>"block-command"===pattern.type||"block-format"===pattern.type,normalizePattern=pattern=>{const err=message=>Result.error({message,pattern}),formatOrCmd=(name,onFormat,onCommand)=>{if(void 0!==pattern.format){let formats;if(isArray$1(pattern.format)){if(!forall(pattern.format,isString))return err(name+" pattern has non-string items in the `format` array");formats=pattern.format}else{if(!isString(pattern.format))return err(name+" pattern has non-string `format` parameter");formats=[pattern.format]}return Result.value(onFormat(formats))}return void 0!==pattern.cmd?isString(pattern.cmd)?Result.value(onCommand(pattern.cmd,pattern.value)):err(name+" pattern has non-string `cmd` parameter"):err(name+" pattern is missing both `format` and `cmd` parameters")};if(!isObject(pattern))return err("Raw pattern is not an object");if(!isString(pattern.start))return err("Raw pattern is missing `start` parameter");if(void 0!==pattern.end){if(!isString(pattern.end))return err("Inline pattern has non-string `end` parameter");if(0===pattern.start.length&&0===pattern.end.length)return err("Inline pattern has empty `start` and `end` parameters");let start=pattern.start,end=pattern.end;return 0===end.length&&(end=start,start=""),formatOrCmd("Inline",(format=>({type:"inline-format",start,end,format})),((cmd,value)=>({type:"inline-command",start,end,cmd,value})))}return void 0!==pattern.replacement?isString(pattern.replacement)?0===pattern.start.length?err("Replacement pattern has empty `start` parameter"):Result.value({type:"inline-command",start:"",end:pattern.start,cmd:"mceInsertContent",value:pattern.replacement}):err("Replacement pattern has non-string `replacement` parameter"):0===pattern.start.length?err("Block pattern has empty `start` parameter"):formatOrCmd("Block",(formats=>({type:"block-format",start:pattern.start,format:formats[0]})),((command,commandValue)=>({type:"block-command",start:pattern.start,cmd:command,value:commandValue})))},getBlockPatterns=patterns=>filter$5(patterns,isBlockPattern),getInlinePatterns=patterns=>filter$5(patterns,isInlinePattern),fromRawPatterns=patterns=>{const normalized=(results=>{const errors=[],values=[];return each$e(results,(result=>{result.fold((err=>{errors.push(err)}),(value=>{values.push(value)}))})),{errors,values}})(map$3(patterns,normalizePattern));return each$e(normalized.errors,(err=>console.error(err.message,err.pattern))),normalized.values},deviceDetection$1=detect$2().deviceType,isTouch=deviceDetection$1.isTouch(),DOM$a=DOMUtils.DOM,isRegExp=x=>is$4(x,RegExp),option=name=>editor=>editor.options.get(name),stringOrObjectProcessor=value=>isString(value)||isObject(value),bodyOptionProcessor=(editor,defaultValue="")=>value=>{const valid=isString(value);if(valid){if(-1!==value.indexOf("=")){const bodyObj=(value=>{const items=value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(",");return foldl(items,((output,item)=>{const arr=item.split("="),key=arr[0],val=arr.length>1?arr[1]:key;return output[trim$4(key)]=trim$4(val),output}),{})})(value);return{value:get$a(bodyObj,editor.id).getOr(defaultValue),valid}}return{value,valid}}return{valid:!1,message:"Must be a string."}},getIframeAttrs=option("iframe_attrs"),getDocType=option("doctype"),getDocumentBaseUrl=option("document_base_url"),getBodyId=option("body_id"),getBodyClass=option("body_class"),getContentSecurityPolicy=option("content_security_policy"),shouldPutBrInPre$1=option("br_in_pre"),getForcedRootBlock=option("forced_root_block"),getForcedRootBlockAttrs=option("forced_root_block_attrs"),getNewlineBehavior=option("newline_behavior"),getBrNewLineSelector=option("br_newline_selector"),getNoNewLineSelector=option("no_newline_selector"),shouldKeepStyles=option("keep_styles"),shouldEndContainerOnEmptyBlock=option("end_container_on_empty_block"),isAutomaticUploadsEnabled=option("automatic_uploads"),shouldReuseFileName=option("images_reuse_filename"),shouldReplaceBlobUris=option("images_replace_blob_uris"),getIconPackName=option("icons"),getIconsUrl=option("icons_url"),getImageUploadUrl=option("images_upload_url"),getImageUploadBasePath=option("images_upload_base_path"),getImagesUploadCredentials=option("images_upload_credentials"),getImagesUploadHandler=option("images_upload_handler"),shouldUseContentCssCors=option("content_css_cors"),getReferrerPolicy=option("referrer_policy"),getLanguageCode=option("language"),getLanguageUrl=option("language_url"),shouldIndentUseMargin=option("indent_use_margin"),getIndentation=option("indentation"),getContentCss=option("content_css"),getContentStyle=option("content_style"),getFontCss=option("font_css"),getDirectionality=option("directionality"),getInlineBoundarySelector=option("inline_boundaries_selector"),getObjectResizing=option("object_resizing"),getResizeImgProportional=option("resize_img_proportional"),getPlaceholder=option("placeholder"),getEventRoot=option("event_root"),getServiceMessage=option("service_message"),getTheme=option("theme"),getThemeUrl=option("theme_url"),getModel=option("model"),getModelUrl=option("model_url"),isInlineBoundariesEnabled=option("inline_boundaries"),getFormats=option("formats"),getPreviewStyles=option("preview_styles"),canFormatEmptyLines=option("format_empty_lines"),getFormatNoneditableSelector=option("format_noneditable_selector"),getCustomUiSelector=option("custom_ui_selector"),isInline$1=option("inline"),hasHiddenInput=option("hidden_input"),shouldPatchSubmit=option("submit_patch"),shouldAddFormSubmitTrigger=option("add_form_submit_trigger"),shouldAddUnloadTrigger=option("add_unload_trigger"),getCustomUndoRedoLevels=option("custom_undo_redo_levels"),shouldDisableNodeChange=option("disable_nodechange"),isReadOnly$1=option("readonly"),hasEditableRoot$1=option("editable_root"),hasContentCssCors=option("content_css_cors"),getPlugins=option("plugins"),getExternalPlugins$1=option("external_plugins"),shouldBlockUnsupportedDrop=option("block_unsupported_drop"),isVisualAidsEnabled=option("visual"),getVisualAidsTableClass=option("visual_table_class"),getVisualAidsAnchorClass=option("visual_anchor_class"),getIframeAriaText=option("iframe_aria_text"),getSetupCallback=option("setup"),getInitInstanceCallback=option("init_instance_callback"),getUrlConverterCallback=option("urlconverter_callback"),getAutoFocus=option("auto_focus"),shouldBrowserSpellcheck=option("browser_spellcheck"),getProtect=option("protect"),shouldPasteBlockDrop=option("paste_block_drop"),shouldPasteDataImages=option("paste_data_images"),getPastePreProcess=option("paste_preprocess"),getPastePostProcess=option("paste_postprocess"),getNewDocumentContent=option("newdocument_content"),getPasteWebkitStyles=option("paste_webkit_styles"),shouldPasteRemoveWebKitStyles=option("paste_remove_styles_if_webkit"),shouldPasteMergeFormats=option("paste_merge_formats"),isSmartPasteEnabled=option("smart_paste"),isPasteAsTextEnabled=option("paste_as_text"),getPasteTabSpaces=option("paste_tab_spaces"),shouldAllowHtmlDataUrls=option("allow_html_data_urls"),getTextPatterns=option("text_patterns"),getTextPatternsLookup=option("text_patterns_lookup"),getNonEditableClass=option("noneditable_class"),getEditableClass=option("editable_class"),getNonEditableRegExps=option("noneditable_regexp"),shouldPreserveCData=option("preserve_cdata"),shouldHighlightOnFocus=option("highlight_on_focus"),shouldSanitizeXss=option("xss_sanitization"),shouldUseDocumentWrite=option("init_content_sync"),getAllowedImageFileTypes=editor=>Tools.explode(editor.options.get("images_file_types")),hasTableTabNavigation=option("table_tab_navigation"),getDetailsInitialState=option("details_initial_state"),getDetailsSerializedState=option("details_serialized_state"),shouldForceHexColor=option("force_hex_color"),shouldSandboxIframes=option("sandbox_iframes"),isElement$3=isElement$6,isText$5=isText$a,removeNode$1=node=>{const parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},trimCount=text=>{const trimmedText=trim$2(text);return{count:text.length-trimmedText.length,text:trimmedText}},deleteZwspChars=caretContainer=>{let idx;for(;-1!==(idx=caretContainer.data.lastIndexOf("\ufeff"));)caretContainer.deleteData(idx,1)},removeUnchanged=(caretContainer,pos)=>(remove$3(caretContainer),pos),removeElementAndReposition=(caretContainer,pos)=>{const parentNode=pos.container(),newPosition=((xs,x)=>{const r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)})(from(parentNode.childNodes),caretContainer).map((index=>index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos)).getOr(pos);return remove$3(caretContainer),newPosition},removeTextCaretContainer=(caretContainer,pos)=>isText$5(caretContainer)&&pos.container()===caretContainer?((caretContainer,pos)=>{const before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset()));return(before.text+after.text).length>0?(deleteZwspChars(caretContainer),CaretPosition(caretContainer,pos.offset()-before.count)):pos})(caretContainer,pos):removeUnchanged(caretContainer,pos),removeAndReposition=(container,pos)=>CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):((caretContainer,pos)=>pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos))(container,pos),remove$3=caretContainerNode=>{isElement$3(caretContainerNode)&&isCaretContainer$2(caretContainerNode)&&(hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode$1(caretContainerNode)),isText$5(caretContainerNode)&&(deleteZwspChars(caretContainerNode),0===caretContainerNode.data.length&&removeNode$1(caretContainerNode))},isContentEditableFalse$8=isContentEditableFalse$b,isMedia$1=isMedia$2,isTableCell$1=isTableCell$3,getAbsoluteClientRect=(root,element,before)=>{const clientRect=collapse(element.getBoundingClientRect(),before);let scrollX,scrollY;if("BODY"===root.tagName){const docElm=root.ownerDocument.documentElement;scrollX=root.scrollLeft||docElm.scrollLeft,scrollY=root.scrollTop||docElm.scrollTop}else{const rootRect=root.getBoundingClientRect();scrollX=root.scrollLeft-rootRect.left,scrollY=root.scrollTop-rootRect.top}clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1;let margin=element.offsetWidth-element.clientWidth;return margin>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect},FakeCaret=(editor,root,isBlock,hasFocus)=>{const lastVisualCaret=value$2();let cursorInterval,caretContainerNode;const caretBlock=getForcedRootBlock(editor),dom=editor.dom,hide=()=>{(root=>{var _a,_b;const fakeCaretTargetNodes=descendants(SugarElement.fromDom(root),"*[contentEditable=false],video,audio,embed,object");for(let i=0;i<fakeCaretTargetNodes.length;i++){const node=fakeCaretTargetNodes[i].dom;let sibling=node.previousSibling;if(endsWithCaretContainer$1(sibling)){const data=sibling.data;1===data.length?null===(_a=sibling.parentNode)||void 0===_a||_a.removeChild(sibling):sibling.deleteData(data.length-1,1)}sibling=node.nextSibling,startsWithCaretContainer$1(sibling)&&(1===sibling.data.length?null===(_b=sibling.parentNode)||void 0===_b||_b.removeChild(sibling):sibling.deleteData(0,1))}})(root),caretContainerNode&&(remove$3(caretContainerNode),caretContainerNode=null),lastVisualCaret.on((caretState=>{dom.remove(caretState.caret),lastVisualCaret.clear()})),cursorInterval&&(clearInterval(cursorInterval),cursorInterval=void 0)},startBlink=()=>{cursorInterval=setInterval((()=>{lastVisualCaret.on((caretState=>{hasFocus()?dom.toggleClass(caretState.caret,"mce-visual-caret-hidden"):dom.addClass(caretState.caret,"mce-visual-caret-hidden")}))}),500)};return{show:(before,element)=>{let rng;if(hide(),isTableCell$1(element))return null;if(!isBlock(element))return caretContainerNode=((node,before)=>{var _a;const textNode=(null!==(_a=node.ownerDocument)&&void 0!==_a?_a:document).createTextNode("\ufeff"),parentNode=node.parentNode;if(before){const sibling=node.previousSibling;if(isText$9(sibling)){if(isCaretContainer$2(sibling))return sibling;if(endsWithCaretContainer$1(sibling))return sibling.splitText(sibling.data.length-1)}null==parentNode||parentNode.insertBefore(textNode,node)}else{const sibling=node.nextSibling;if(isText$9(sibling)){if(isCaretContainer$2(sibling))return sibling;if(startsWithCaretContainer$1(sibling))return sibling.splitText(1),sibling}node.nextSibling?null==parentNode||parentNode.insertBefore(textNode,node.nextSibling):null==parentNode||parentNode.appendChild(textNode)}return textNode})(element,before),rng=element.ownerDocument.createRange(),isInlineFakeCaretTarget(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng;{const caretContainer=((blockName,node,before)=>{var _a;const blockNode=(null!==(_a=node.ownerDocument)&&void 0!==_a?_a:document).createElement(blockName);blockNode.setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(createPaddingBr().dom);const parentNode=node.parentNode;return before?null==parentNode||parentNode.insertBefore(blockNode,node):node.nextSibling?null==parentNode||parentNode.insertBefore(blockNode,node.nextSibling):null==parentNode||parentNode.appendChild(blockNode),blockNode})(caretBlock,element,before),clientRect=getAbsoluteClientRect(root,element,before);dom.setStyle(caretContainer,"top",clientRect.top),caretContainerNode=caretContainer;const caret=dom.create("div",{class:"mce-visual-caret","data-mce-bogus":"all"});dom.setStyles(caret,{...clientRect}),dom.add(root,caret),lastVisualCaret.set({caret,element,before}),before&&dom.addClass(caret,"mce-visual-caret-before"),startBlink(),rng=element.ownerDocument.createRange(),rng.setStart(caretContainer,0),rng.setEnd(caretContainer,0)}return rng},hide,getCss:()=>".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}",reposition:()=>{lastVisualCaret.on((caretState=>{const clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);dom.setStyles(caretState.caret,{...clientRect})}))},destroy:()=>clearInterval(cursorInterval)}},isFakeCaretTableBrowser=()=>Env.browser.isFirefox(),isInlineFakeCaretTarget=node=>isContentEditableFalse$8(node)||isMedia$1(node),isFakeCaretTarget=node=>(isInlineFakeCaretTarget(node)||isTable$2(node)&&isFakeCaretTableBrowser())&&parentElement(SugarElement.fromDom(node)).exists(isEditable$2),isContentEditableTrue$1=isContentEditableTrue$3,isContentEditableFalse$7=isContentEditableFalse$b,isMedia=isMedia$2,isBlockLike=matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer=isCaretContainer$2,isCaretContainerBlock=isCaretContainerBlock$1,isElement$2=isElement$6,isText$4=isText$a,isCaretCandidate$1=isCaretCandidate$3,isForwards=direction=>direction>0,isBackwards=direction=>direction<0,skipCaretContainers=(walk,shallow)=>{let node;for(;node=walk(shallow);)if(!isCaretContainerBlock(node))return node;return null},findNode=(node,direction,predicateFn,rootNode,shallow)=>{const walker=new DomTreeWalker(node,rootNode),isCefOrCaretContainer=isContentEditableFalse$7(node)||isCaretContainerBlock(node);let tempNode;if(isBackwards(direction)){if(isCefOrCaretContainer&&(tempNode=skipCaretContainers(walker.prev.bind(walker),!0),predicateFn(tempNode)))return tempNode;for(;tempNode=skipCaretContainers(walker.prev.bind(walker),shallow);)if(predicateFn(tempNode))return tempNode}if(isForwards(direction)){if(isCefOrCaretContainer&&(tempNode=skipCaretContainers(walker.next.bind(walker),!0),predicateFn(tempNode)))return tempNode;for(;tempNode=skipCaretContainers(walker.next.bind(walker),shallow);)if(predicateFn(tempNode))return tempNode}return null},getParentBlock$3=(node,rootNode)=>{for(;node&&node!==rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null},isInSameBlock=(caretPosition1,caretPosition2,rootNode)=>getParentBlock$3(caretPosition1.container(),rootNode)===getParentBlock$3(caretPosition2.container(),rootNode),getChildNodeAtRelativeOffset=(relativeOffset,caretPosition)=>{if(!caretPosition)return Optional.none();const container=caretPosition.container(),offset=caretPosition.offset();return isElement$2(container)?Optional.from(container.childNodes[offset+relativeOffset]):Optional.none()},beforeAfter=(before,node)=>{var _a;const range=(null!==(_a=node.ownerDocument)&&void 0!==_a?_a:document).createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range},isNodesInSameBlock=(root,node1,node2)=>getParentBlock$3(node1,root)===getParentBlock$3(node2,root),lean=(left,root,node)=>{const siblingName=left?"previousSibling":"nextSibling";let tempNode=node;for(;tempNode&&tempNode!==root;){let sibling=tempNode[siblingName];if(sibling&&isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse$7(sibling)||isMedia(sibling)){if(isNodesInSameBlock(root,sibling,tempNode))return sibling;break}if(isCaretCandidate$1(sibling))break;tempNode=tempNode.parentNode}return null},before$2=curry(beforeAfter,!0),after$2=curry(beforeAfter,!1),normalizeRange=(direction,root,range)=>{let node;const leanLeft=curry(lean,!0,root),leanRight=curry(lean,!1,root),container=range.startContainer,offset=range.startOffset;if(isCaretContainerBlock$1(container)){const block=isText$4(container)?container.parentNode:container,location=block.getAttribute("data-mce-caret");if("before"===location&&(node=block.nextSibling,isFakeCaretTarget(node)))return before$2(node);if("after"===location&&(node=block.previousSibling,isFakeCaretTarget(node)))return after$2(node)}if(!range.collapsed)return range;if(isText$a(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container),node)return before$2(node);if(node=leanLeft(container),node)return after$2(node)}if(-1===direction){if(node=leanLeft(container),node)return after$2(node);if(node=leanRight(container),node)return before$2(node)}return range}if(endsWithCaretContainer$1(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container),node)?before$2(node):range;if(startsWithCaretContainer$1(container)&&offset<=1)return-1===direction&&(node=leanLeft(container),node)?after$2(node):range;if(offset===container.data.length)return node=leanRight(container),node?before$2(node):range;if(0===offset)return node=leanLeft(container),node?after$2(node):range}return range},getRelativeCefElm=(forward,caretPosition)=>getChildNodeAtRelativeOffset(forward?0:-1,caretPosition).filter(isContentEditableFalse$7),getNormalizedRangeEndPoint=(direction,root,range)=>{const normalizedRange=normalizeRange(direction,root,range);return-1===direction?CaretPosition.fromRangeStart(normalizedRange):CaretPosition.fromRangeEnd(normalizedRange)},getElementFromPosition=pos=>Optional.from(pos.getNode()).map(SugarElement.fromDom),getVisualCaretPosition=(walkFn,caretPosition)=>{let pos=caretPosition;for(;pos=walkFn(pos);)if(pos.isVisible())return pos;return pos},isMoveInsideSameBlock=(from,to)=>{const inSameBlock=isInSameBlock(from,to);return!(inSameBlock||!isBr$6(from.getNode()))||inSameBlock};var HDirection;!function(HDirection){HDirection[HDirection.Backwards=-1]="Backwards",HDirection[HDirection.Forwards=1]="Forwards"}(HDirection||(HDirection={}));const isContentEditableFalse$6=isContentEditableFalse$b,isText$3=isText$a,isElement$1=isElement$6,isBr$2=isBr$6,isCaretCandidate=isCaretCandidate$3,isAtomic=node=>isAtomicInline(node)||(node=>!!isNonUiContentEditableFalse(node)&&!foldl(from(node.getElementsByTagName("*")),((result,elm)=>result||isContentEditableTrue$2(elm)),!1))(node),isEditableCaretCandidate=isEditableCaretCandidate$1,nodeAtIndex=(container,offset)=>container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null,getCaretCandidatePosition=(direction,node)=>{if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText$3(node.previousSibling))return CaretPosition.before(node);if(isText$3(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText$3(node.nextSibling))return CaretPosition.after(node);if(isText$3(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr$2(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)},findCaretPosition$1=(direction,startPos,root)=>{let node,nextNode,innerNode,caretPosition;if(!isElement$1(root)||!startPos)return null;if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){if(caretPosition=CaretPosition.after(root.lastChild),isBackwards(direction)&&isCaretCandidate(root.lastChild)&&isElement$1(root.lastChild))return isBr$2(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition}else caretPosition=startPos;const container=caretPosition.container();let offset=caretPosition.offset();if(isText$3(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode),innerNode)?isText$3(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText$3(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return isBr$2(nextNode)?((root,nextNode)=>{const nextSibling=nextNode.nextSibling;return nextSibling&&isCaretCandidate(nextSibling)?isText$3(nextSibling)?CaretPosition(nextSibling,0):CaretPosition.before(nextSibling):findCaretPosition$1(HDirection.Forwards,CaretPosition.after(nextNode),root)})(root,nextNode):!isAtomic(nextNode)&&(innerNode=findNode(nextNode,direction,isEditableCaretCandidate,nextNode),innerNode)?isText$3(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText$3(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=nextNode||caretPosition.getNode()}if(node&&(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=findNode(node,direction,always,root,!0),isEditableCaretCandidate(node,root)))return getCaretCandidatePosition(direction,node);nextNode=node?findNode(node,direction,isEditableCaretCandidate,root):node;const rootContentEditableFalseElm=last$2(filter$5(((node,root)=>{const parents=[];let tempNode=node;for(;tempNode&&tempNode!==root;)parents.push(tempNode),tempNode=tempNode.parentNode;return parents})(container,root),isContentEditableFalse$6));return!rootContentEditableFalseElm||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:(caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm),caretPosition)},CaretWalker=root=>({next:caretPosition=>findCaretPosition$1(HDirection.Forwards,caretPosition,root),prev:caretPosition=>findCaretPosition$1(HDirection.Backwards,caretPosition,root)}),isBeforeOrStart=position=>CaretPosition.isTextPosition(position)?0===position.offset():isCaretCandidate$3(position.getNode()),isAfterOrEnd=position=>{if(CaretPosition.isTextPosition(position)){const container=position.container();return position.offset()===container.data.length}return isCaretCandidate$3(position.getNode(!0))},isBeforeAfterSameElement=(from,to)=>!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0),shouldSkipPosition=(forward,from,to)=>{return forward?!isBeforeAfterSameElement(from,to)&&(position=from,!(!CaretPosition.isTextPosition(position)&&isBr$6(position.getNode())))&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to);var position},fromPosition=(forward,root,pos)=>{const walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos))},navigate=(forward,root,from)=>fromPosition(forward,root,from).bind((to=>isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,root,to):Optional.some(to))),navigateIgnore=(forward,root,from,ignoreFilter)=>navigate(forward,root,from).bind((pos=>ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos))),positionIn=(forward,element)=>{const startNode=forward?element.firstChild:element.lastChild;return isText$a(startNode)?Optional.some(CaretPosition(startNode,forward?0:startNode.data.length)):startNode?isCaretCandidate$3(startNode)?Optional.some(forward?CaretPosition.before(startNode):isBr$6(node=startNode)?CaretPosition.before(node):CaretPosition.after(node)):((forward,root,start)=>{const position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position)})(forward,element,startNode):Optional.none();var node},nextPosition=curry(fromPosition,!0),prevPosition=curry(fromPosition,!1),firstPositionIn=curry(positionIn,!0),lastPositionIn=curry(positionIn,!1),isCaretNode=node=>isElement$6(node)&&"_mce_caret"===node.id,getParentCaretContainer=(body,node)=>{let currentNode=node;for(;currentNode&&currentNode!==body;){if(isCaretNode(currentNode))return currentNode;currentNode=currentNode.parentNode}return null},isIndexBookmark=bookmark=>has$2(bookmark,"name"),isPathBookmark=bookmark=>Tools.isArray(bookmark.start),isForwardBookmark=bookmark=>!(!isIndexBookmark(bookmark)&&isBoolean(bookmark.forward))||bookmark.forward,addBogus=(dom,node)=>(isElement$6(node)&&dom.isBlock(node)&&!node.innerHTML&&(node.innerHTML='<br data-mce-bogus="1" />'),node),tryFindRangePosition=(node,rng)=>lastPositionIn(node).fold(never,(pos=>(rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),!0))),padEmptyCaretContainer=(root,node,rng)=>!(!(node=>!node.hasChildNodes())(node)||!getParentCaretContainer(root,node))&&(((node,rng)=>{var _a;const textNode=(null!==(_a=node.ownerDocument)&&void 0!==_a?_a:document).createTextNode("\ufeff");node.appendChild(textNode),rng.setStart(textNode,0),rng.setEnd(textNode,0)})(node,rng),!0),setEndPoint=(dom,start,bookmark,rng)=>{const point=bookmark[start?"start":"end"],root=dom.getRoot();if(point){let node=root,offset=point[0];for(let i=point.length-1;node&&i>=1;i--){const children=node.childNodes;if(padEmptyCaretContainer(root,node,rng))return!0;if(point[i]>children.length-1)return!!padEmptyCaretContainer(root,node,rng)||tryFindRangePosition(node,rng);node=children[point[i]]}isText$a(node)&&(offset=Math.min(point[0],node.data.length)),isElement$6(node)&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0},isValidTextNode=node=>isText$a(node)&&node.data.length>0,restoreEndPoint=(dom,suffix,bookmark)=>{const marker=dom.get(bookmark.id+"_"+suffix),markerParent=null==marker?void 0:marker.parentNode,keep=bookmark.keep;if(marker&&markerParent){let container,offset;if("start"===suffix?keep?marker.hasChildNodes()?(container=marker.firstChild,offset=1):isValidTextNode(marker.nextSibling)?(container=marker.nextSibling,offset=0):isValidTextNode(marker.previousSibling)?(container=marker.previousSibling,offset=marker.previousSibling.data.length):(container=markerParent,offset=dom.nodeIndex(marker)+1):(container=markerParent,offset=dom.nodeIndex(marker)):keep?marker.hasChildNodes()?(container=marker.firstChild,offset=1):isValidTextNode(marker.previousSibling)?(container=marker.previousSibling,offset=marker.previousSibling.data.length):(container=markerParent,offset=dom.nodeIndex(marker)):(container=markerParent,offset=dom.nodeIndex(marker)),!keep){const prev=marker.previousSibling,next=marker.nextSibling;let otherMarker;for(Tools.each(Tools.grep(marker.childNodes),(node=>{isText$a(node)&&(node.data=node.data.replace(/\uFEFF/g,""))}));otherMarker=dom.get(bookmark.id+"_"+suffix);)dom.remove(otherMarker,!0);if(isText$a(next)&&isText$a(prev)&&!Env.browser.isOpera()){const idx=prev.data.length;prev.appendData(next.data),dom.remove(next),container=prev,offset=idx}}return Optional.some(CaretPosition(container,offset))}return Optional.none()},resolve=(selection,bookmark)=>{const dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark))return((dom,bookmark)=>{const range=dom.createRng();return setEndPoint(dom,!0,bookmark,range)&&setEndPoint(dom,!1,bookmark,range)?Optional.some({range,forward:isForwardBookmark(bookmark)}):Optional.none()})(dom,bookmark);if((bookmark=>isString(bookmark.start))(bookmark))return((dom,bookmark)=>{const startPos=Optional.from(resolve$1(dom.getRoot(),bookmark.start)),endPos=Optional.from(resolve$1(dom.getRoot(),bookmark.end));return lift2(startPos,endPos,((start,end)=>{const range=dom.createRng();return range.setStart(start.container(),start.offset()),range.setEnd(end.container(),end.offset()),{range,forward:isForwardBookmark(bookmark)}}))})(dom,bookmark);if((bookmark=>has$2(bookmark,"id"))(bookmark))return((dom,bookmark)=>{const startPos=restoreEndPoint(dom,"start",bookmark),endPos=restoreEndPoint(dom,"end",bookmark);return lift2(startPos,endPos.or(startPos),((spos,epos)=>{const range=dom.createRng();return range.setStart(addBogus(dom,spos.container()),spos.offset()),range.setEnd(addBogus(dom,epos.container()),epos.offset()),{range,forward:isForwardBookmark(bookmark)}}))})(dom,bookmark);if(isIndexBookmark(bookmark))return((dom,bookmark)=>Optional.from(dom.select(bookmark.name)[bookmark.index]).map((elm=>{const range=dom.createRng();return range.selectNode(elm),{range,forward:!0}})))(dom,bookmark);if((bookmark=>has$2(bookmark,"rng"))(bookmark))return Optional.some({range:bookmark.rng,forward:isForwardBookmark(bookmark)})}return Optional.none()},getBookmark$1=(selection,type,normalized)=>getBookmark$2(selection,type,normalized),moveToBookmark=(selection,bookmark)=>{resolve(selection,bookmark).each((({range,forward})=>{selection.setRng(range,forward)}))},isBookmarkNode$1=node=>isElement$6(node)&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type"),isNbsp=(expected=" ",actual=>expected===actual);var expected;const isWhiteSpace=chr=>""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr),isContent=chr=>!isWhiteSpace(chr)&&!isNbsp(chr)&&!isZwsp$2(chr),getRanges$1=selection=>{const ranges=[];if(selection)for(let i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));return ranges},getCellsFromRanges=ranges=>filter$5((ranges=>bind$3(ranges,(range=>{const node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[]})))(ranges),isTableCell$2),getCellsFromElementOrRanges=(ranges,element)=>{const selectedCells=descendants(element,"td[data-mce-selected],th[data-mce-selected]");return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges)},getCellsFromEditor=editor=>getCellsFromElementOrRanges(getRanges$1(editor.selection.getSel()),SugarElement.fromDom(editor.getBody())),getClosestTable=(cell,isRoot)=>ancestor$3(cell,"table",isRoot),getFirstChildren=node=>firstChild(node).fold(constant([node]),(child=>[node].concat(getFirstChildren(child)))),getLastChildren=node=>lastChild(node).fold(constant([node]),(child=>"br"===name(child)?prevSibling(child).map((sibling=>[node].concat(getLastChildren(sibling)))).getOr([]):[node].concat(getLastChildren(child)))),hasAllContentsSelected=(elm,rng)=>lift2((rng=>{const sc=rng.startContainer,so=rng.startOffset;return isText$a(sc)?0===so?Optional.some(SugarElement.fromDom(sc)):Optional.none():Optional.from(sc.childNodes[so]).map(SugarElement.fromDom)})(rng),(rng=>{const ec=rng.endContainer,eo=rng.endOffset;return isText$a(ec)?eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none():Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom)})(rng),((startNode,endNode)=>{const start=find$2(getFirstChildren(elm),curry(eq,startNode)),end=find$2(getLastChildren(elm),curry(eq,endNode));return start.isSome()&&end.isSome()})).getOr(!1),moveEndPoint=(dom,rng,node,start)=>{const root=node,walker=new DomTreeWalker(node,root),moveCaretBeforeOnEnterElementsMap=filter$4(dom.schema.getMoveCaretBeforeOnEnterElements(),((_,name)=>!contains$2(["td","th","table"],name.toLowerCase())));let currentNode=node;do{if(isText$a(currentNode)&&0!==Tools.trim(currentNode.data).length)return void(start?rng.setStart(currentNode,0):rng.setEnd(currentNode,currentNode.data.length));if(moveCaretBeforeOnEnterElementsMap[currentNode.nodeName])return void(start?rng.setStartBefore(currentNode):"BR"===currentNode.nodeName?rng.setEndBefore(currentNode):rng.setEndAfter(currentNode))}while(currentNode=start?walker.next():walker.prev());"BODY"===root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},hasAnyRanges=editor=>{const sel=editor.selection.getSel();return isNonNullable(sel)&&sel.rangeCount>0},runOnRanges=(editor,executor)=>{const fakeSelectionNodes=getCellsFromEditor(editor);fakeSelectionNodes.length>0?each$e(fakeSelectionNodes,(elem=>{const node=elem.dom,fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node),fakeNodeRng.setEndAfter(node),executor(fakeNodeRng,!0)})):executor(editor.selection.getRng(),!1)},preserve=(selection,fillBookmark,executor)=>{const bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark),selection.moveToBookmark(bookmark)},isNode=node=>isNumber(null==node?void 0:node.nodeType),isElementNode$1=node=>isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node),preserveSelection=(editor,action,shouldMoveStart)=>{const{selection,dom}=editor,selectedNodeBeforeAction=selection.getNode(),isSelectedBeforeNodeNoneditable=isContentEditableFalse$b(selectedNodeBeforeAction);preserve(selection,!0,(()=>{action()}));isSelectedBeforeNodeNoneditable&&isContentEditableFalse$b(selectedNodeBeforeAction)&&dom.isChildOf(selectedNodeBeforeAction,editor.getBody())?editor.selection.select(selectedNodeBeforeAction):shouldMoveStart(selection.getStart())&&moveStartToNearestText(dom,selection)},moveStartToNearestText=(dom,selection)=>{var _a,_b;const rng=selection.getRng(),{startContainer,startOffset}=rng;if(!((dom,node)=>{if(isElementNode$1(node)&&!/^(TD|TH)$/.test(node.nodeName)){const selectedAttr=dom.getAttrib(node,"data-mce-selected"),value=parseInt(selectedAttr,10);return!isNaN(value)&&value>0}return!1})(dom,selection.getNode())&&isElement$6(startContainer)){const nodes=startContainer.childNodes,root=dom.getRoot();let walker;if(startOffset<nodes.length){const startNode=nodes[startOffset];walker=new DomTreeWalker(startNode,null!==(_a=dom.getParent(startNode,dom.isBlock))&&void 0!==_a?_a:root)}else{const startNode=nodes[nodes.length-1];walker=new DomTreeWalker(startNode,null!==(_b=dom.getParent(startNode,dom.isBlock))&&void 0!==_b?_b:root),walker.next(!0)}for(let node=walker.current();node;node=walker.next()){if("false"===dom.getContentEditable(node))return;if(isText$a(node)&&!isWhiteSpaceNode$1(node))return rng.setStart(node,0),void selection.setRng(rng)}}},getNonWhiteSpaceSibling=(node,next,inc)=>{if(node){const nextName=next?"nextSibling":"previousSibling";for(node=inc?node:node[nextName];node;node=node[nextName])if(isElement$6(node)||!isWhiteSpaceNode$1(node))return node}},isTextBlock$1=(schema,node)=>!!schema.getTextBlockElements()[node.nodeName.toLowerCase()]||isTransparentBlock(schema,node),isValid=(ed,parent,child)=>ed.schema.isValidChild(parent,child),isWhiteSpaceNode$1=(node,allowSpaces=!1)=>{if(isNonNullable(node)&&isText$a(node)){const data=allowSpaces?node.data.replace(/ /g," "):node.data;return isWhitespaceText(data)}return!1},isWrappableNoneditable=(editor,node)=>{const dom=editor.dom;return isElementNode$1(node)&&"false"===dom.getContentEditable(node)&&((editor,node)=>{const formatNoneditableSelector=getFormatNoneditableSelector(editor),selector=isEmpty$3(formatNoneditableSelector)?"[data-mce-cef-wrappable]":`[data-mce-cef-wrappable],${formatNoneditableSelector}`;return is$1(SugarElement.fromDom(node),selector)})(editor,node)&&0===dom.select('[contenteditable="true"]',node).length},replaceVars=(value,vars)=>isFunction(value)?value(vars):(isNonNullable(vars)&&(value=value.replace(/%(\w+)/g,((str,name)=>vars[name]||str))),value),isEq$5=(str1,str2)=>(str2=str2||"",str1=""+((str1=str1||"").nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()===str2.toLowerCase()),normalizeStyleValue=(value,name)=>{if(isNullable(value))return null;{let strValue=String(value);return"color"!==name&&"backgroundColor"!==name||(strValue=rgbaToHexString(strValue)),"fontWeight"===name&&700===value&&(strValue="bold"),"fontFamily"===name&&(strValue=strValue.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),strValue}},getStyle=(dom,node,name)=>{const style=dom.getStyle(node,name);return normalizeStyleValue(style,name)},getTextDecoration=(dom,node)=>{let decoration;return dom.getParent(node,(n=>!!isElement$6(n)&&(decoration=dom.getStyle(n,"text-decoration"),!!decoration&&"none"!==decoration))),decoration},getParents$2=(dom,node,selector)=>dom.getParents(node,selector,dom.getRoot()),isFormatPredicate=(editor,formatName,predicate)=>{const formats=editor.formatter.get(formatName);return isNonNullable(formats)&&exists(formats,predicate)},areSimilarFormats=(editor,formatName,otherFormatName)=>{const validKeys=["inline","block","selector","attributes","styles","classes"],filterObj=format=>filter$4(format,((_,key)=>exists(validKeys,(validKey=>validKey===key))));return isFormatPredicate(editor,formatName,(fmt1=>{const filteredFmt1=filterObj(fmt1);return isFormatPredicate(editor,otherFormatName,(fmt2=>{const filteredFmt2=filterObj(fmt2);return((a1,a2,eq=eqAny)=>eqRecord(eq).eq(a1,a2))(filteredFmt1,filteredFmt2)}))}))},isBlockFormat=format=>hasNonNullableKey(format,"block"),isSelectorFormat=format=>hasNonNullableKey(format,"selector"),isInlineFormat=format=>hasNonNullableKey(format,"inline"),shouldExpandToSelector=format=>isSelectorFormat(format)&&!1!==format.expand&&!isInlineFormat(format),isCaretContainerEmpty=node=>(node=>{const nodes=[];let tempNode=node;for(;tempNode;){if(isText$a(tempNode)&&"\ufeff"!==tempNode.data||tempNode.childNodes.length>1)return[];isElement$6(tempNode)&&nodes.push(tempNode),tempNode=tempNode.firstChild}return nodes})(node).length>0,isEmptyCaretFormatElement=element=>isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom),isBookmarkNode=isBookmarkNode$1,getParents$1=getParents$2,isWhiteSpaceNode=isWhiteSpaceNode$1,isTextBlock=isTextBlock$1,findParentContentEditable=(dom,node)=>{let parent=node;for(;parent;){if(isElement$6(parent)&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node},walkText=(start,node,offset,predicate)=>{const str=node.data;if(start){for(let i=offset;i>0;i--)if(predicate(str.charAt(i-1)))return i}else for(let i=offset;i<str.length;i++)if(predicate(str.charAt(i)))return i;return-1},findSpace=(start,node,offset)=>walkText(start,node,offset,(c=>isNbsp(c)||isWhiteSpace(c))),findContent=(start,node,offset)=>walkText(start,node,offset,isContent),findWordEndPoint=(dom,body,container,offset,start,includeTrailingSpaces)=>{let lastTextNode;const rootNode=dom.getParent(container,dom.isBlock)||body,walk=(container,offset,pred)=>{const textSeeker=TextSeeker(dom),walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,((text,textOffset)=>isBookmarkNode(text.parentNode)?-1:(lastTextNode=text,pred(start,text,textOffset))),rootNode))};return walk(container,offset,findSpace).bind((result=>includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result))).orThunk((()=>lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none()))},findSelectorEndPoint=(dom,formatList,rng,container,siblingName)=>{const sibling=container[siblingName];isText$a(container)&&isEmpty$3(container.data)&&sibling&&(container=sibling);const parents=getParents$1(dom,container);for(let i=0;i<parents.length;i++)for(let y=0;y<formatList.length;y++){const curFormat=formatList[y];if((!isNonNullable(curFormat.collapsed)||curFormat.collapsed===rng.collapsed)&&(isSelectorFormat(curFormat)&&dom.is(parents[i],curFormat.selector)))return parents[i]}return container},findBlockEndPoint=(dom,formatList,container,siblingName)=>{var _a;let node=container;const root=dom.getRoot(),format=formatList[0];if(isBlockFormat(format)&&(node=format.wrapper?null:dom.getParent(container,format.block,root)),!node){const scopeRoot=null!==(_a=dom.getParent(container,"LI,TD,TH,SUMMARY"))&&void 0!==_a?_a:root;node=dom.getParent(isText$a(container)?container.parentNode:container,(node=>node!==root&&isTextBlock(dom.schema,node)),scopeRoot)}if(node&&isBlockFormat(format)&&format.wrapper&&(node=getParents$1(dom,node,"ul,ol").reverse()[0]||node),!node)for(node=container;node&&node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!isEq$5(node,"br")););return node||container},isAtBlockBoundary$1=(dom,root,container,siblingName)=>{const parent=container.parentNode;return!isNonNullable(container[siblingName])&&(!(parent!==root&&!isNullable(parent)&&!dom.isBlock(parent))||isAtBlockBoundary$1(dom,root,parent,siblingName))},findParentContainer=(dom,formatList,container,offset,start)=>{let parent=container;const siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot();if(isText$a(container)&&!isWhiteSpaceNode(container)&&(start?offset>0:offset<container.data.length))return container;for(;parent;){if(!formatList[0].block_expand&&dom.isBlock(parent))return parent;for(let sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){const allowSpaces=isText$a(sibling)&&!isAtBlockBoundary$1(dom,root,sibling,siblingName);if(!isBookmarkNode(sibling)&&(!isBr$6(node=sibling)||!node.getAttribute("data-mce-bogus")||node.nextSibling)&&!isWhiteSpaceNode(sibling,allowSpaces))return parent}if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}var node;return container},isSelfOrParentBookmark=container=>isBookmarkNode(container.parentNode)||isBookmarkNode(container),expandRng=(dom,rng,formatList,includeTrailingSpace=!1)=>{let{startContainer,startOffset,endContainer,endOffset}=rng;const format=formatList[0];if(isElement$6(startContainer)&&startContainer.hasChildNodes()&&(startContainer=getNode$1(startContainer,startOffset),isText$a(startContainer)&&(startOffset=0)),isElement$6(endContainer)&&endContainer.hasChildNodes()&&(endContainer=getNode$1(endContainer,rng.collapsed?endOffset:endOffset-1),isText$a(endContainer)&&(endOffset=endContainer.data.length)),startContainer=findParentContentEditable(dom,startContainer),endContainer=findParentContentEditable(dom,endContainer),isSelfOrParentBookmark(startContainer)&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,startContainer=rng.collapsed?startContainer.previousSibling||startContainer:startContainer.nextSibling||startContainer,isText$a(startContainer)&&(startOffset=rng.collapsed?startContainer.length:0)),isSelfOrParentBookmark(endContainer)&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,endContainer=rng.collapsed?endContainer.nextSibling||endContainer:endContainer.previousSibling||endContainer,isText$a(endContainer)&&(endOffset=rng.collapsed?0:endContainer.length)),rng.collapsed){findWordEndPoint(dom,dom.getRoot(),startContainer,startOffset,!0,includeTrailingSpace).each((({container,offset})=>{startContainer=container,startOffset=offset}));findWordEndPoint(dom,dom.getRoot(),endContainer,endOffset,!1,includeTrailingSpace).each((({container,offset})=>{endContainer=container,endOffset=offset}))}return(isInlineFormat(format)||format.block_expand)&&(isInlineFormat(format)&&isText$a(startContainer)&&0!==startOffset||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),isInlineFormat(format)&&isText$a(endContainer)&&endOffset!==endContainer.data.length||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1))),shouldExpandToSelector(format)&&(startContainer=findSelectorEndPoint(dom,formatList,rng,startContainer,"previousSibling"),endContainer=findSelectorEndPoint(dom,formatList,rng,endContainer,"nextSibling")),(isBlockFormat(format)||isSelectorFormat(format))&&(startContainer=findBlockEndPoint(dom,formatList,startContainer,"previousSibling"),endContainer=findBlockEndPoint(dom,formatList,endContainer,"nextSibling"),isBlockFormat(format)&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(dom,formatList,startContainer,startOffset,!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer(dom,formatList,endContainer,endOffset,!1)))),isElement$6(startContainer)&&startContainer.parentNode&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),isElement$6(endContainer)&&endContainer.parentNode&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer,startOffset,endContainer,endOffset}},walk$3=(dom,rng,callback)=>{var _a;const startOffset=rng.startOffset,startContainer=getNode$1(rng.startContainer,startOffset),endOffset=rng.endOffset,endContainer=getNode$1(rng.endContainer,endOffset-1),exclude=nodes=>{const firstNode=nodes[0];isText$a(firstNode)&&firstNode===startContainer&&startOffset>=firstNode.data.length&&nodes.splice(0,1);const lastNode=nodes[nodes.length-1];return 0===endOffset&&nodes.length>0&&lastNode===endContainer&&isText$a(lastNode)&&nodes.splice(nodes.length-1,1),nodes},collectSiblings=(node,name,endNode)=>{const siblings=[];for(;node&&node!==endNode;node=node[name])siblings.push(node);return siblings},findEndPoint=(node,root)=>dom.getParent(node,(node=>node.parentNode===root),root),walkBoundary=(startNode,endNode,next)=>{const siblingName=next?"nextSibling":"previousSibling";for(let node=startNode,parent=node.parentNode;node&&node!==endNode;node=parent){parent=node.parentNode;const siblings=collectSiblings(node===startNode?node:node[siblingName],siblingName);siblings.length&&(next||siblings.reverse(),callback(exclude(siblings)))}};if(startContainer===endContainer)return callback(exclude([startContainer]));const ancestor=null!==(_a=dom.findCommonAncestor(startContainer,endContainer))&&void 0!==_a?_a:dom.getRoot();if(dom.isChildOf(startContainer,endContainer))return walkBoundary(startContainer,ancestor,!0);if(dom.isChildOf(endContainer,startContainer))return walkBoundary(endContainer,ancestor);const startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,!0);const siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint===endContainer?endPoint.nextSibling:endPoint);siblings.length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)},validBlocks=['pre[class*=language-][contenteditable="false"]',"figure.image","div[data-ephox-embed-iri]","div.tiny-pageembed","div.mce-toc","div[data-mce-toc]"],context=(editor,elem,wrapName,nodeName)=>parent(elem).fold((()=>"skipping"),(parent=>"br"===nodeName||(elem=>isText$b(elem)&&"\ufeff"===get$3(elem))(elem)?"valid":(elem=>isElement$7(elem)&&has(elem,annotation()))(elem)?"existing":isCaretNode(elem.dom)?"caret":exists(validBlocks,(selector=>is$1(elem,selector)))?"valid-block":isValid(editor,wrapName,nodeName)&&isValid(editor,name(parent),wrapName)?"valid":"invalid-child")),applyAnnotation=(elem,masterUId,data,annotationName,decorate,directAnnotation)=>{const{uid=masterUId,...otherData}=data;add$2(elem,annotation()),set$3(elem,`${dataAnnotationId()}`,uid),set$3(elem,`${dataAnnotation()}`,annotationName);const{attributes={},classes=[]}=decorate(uid,otherData);if(setAll$1(elem,attributes),((element,classes)=>{each$e(classes,(x=>{add$2(element,x)}))})(elem,classes),directAnnotation){classes.length>0&&set$3(elem,`${dataAnnotationClasses()}`,classes.join(","));const attributeNames=keys(attributes);attributeNames.length>0&&set$3(elem,`${dataAnnotationAttributes()}`,attributeNames.join(","))}},removeDirectAnnotation=elem=>{remove$7(elem,annotation()),remove$a(elem,`${dataAnnotationId()}`),remove$a(elem,`${dataAnnotation()}`),remove$a(elem,`${dataAnnotationActive()}`);const customAttrNames=getOpt(elem,`${dataAnnotationAttributes()}`).map((names=>names.split(","))).getOr([]),customClasses=getOpt(elem,`${dataAnnotationClasses()}`).map((names=>names.split(","))).getOr([]);var element;each$e(customAttrNames,(name=>remove$a(elem,name))),element=elem,each$e(customClasses,(x=>{remove$7(element,x)})),remove$a(elem,`${dataAnnotationClasses()}`),remove$a(elem,`${dataAnnotationAttributes()}`)},makeAnnotation=(eDoc,uid,data,annotationName,decorate)=>{const master=SugarElement.fromTag("span",eDoc);return applyAnnotation(master,uid,data,annotationName,decorate,!1),master},annotate=(editor,rng,uid,annotationName,decorate,data)=>{const newWrappers=[],master=makeAnnotation(editor.getDoc(),uid,data,annotationName,decorate),wrapper=value$2(),finishWrapper=()=>{wrapper.clear()},processElements=elems=>{each$e(elems,processElement)},processElement=elem=>{switch(context(editor,elem,"span",name(elem))){case"invalid-child":{finishWrapper();const children=children$1(elem);processElements(children),finishWrapper();break}case"valid-block":finishWrapper(),applyAnnotation(elem,uid,data,annotationName,decorate,!0);break;case"valid":{const w=wrapper.get().getOrThunk((()=>{const nu=shallow$1(master);return newWrappers.push(nu),wrapper.set(nu),nu}));wrap$2(elem,w);break}}};return walk$3(editor.dom,rng,(nodes=>{finishWrapper(),(nodes=>{const elems=map$3(nodes,SugarElement.fromDom);processElements(elems)})(nodes)})),newWrappers},annotateWithBookmark=(editor,name,settings,data)=>{editor.undoManager.transact((()=>{const selection=editor.selection,initialRng=selection.getRng(),hasFakeSelection=getCellsFromEditor(editor).length>0,masterUid=generate$1("mce-annotation");if(initialRng.collapsed&&!hasFakeSelection&&((editor,rng)=>{const r=expandRng(editor.dom,rng,[{inline:"span"}]);rng.setStart(r.startContainer,r.startOffset),rng.setEnd(r.endContainer,r.endOffset),editor.selection.setRng(rng)})(editor,initialRng),selection.getRng().collapsed&&!hasFakeSelection){const wrapper=makeAnnotation(editor.getDoc(),masterUid,data,name,settings.decorate);set$1(wrapper," "),selection.getRng().insertNode(wrapper.dom),selection.select(wrapper.dom)}else preserve(selection,!1,(()=>{runOnRanges(editor,(selectionRng=>{annotate(editor,selectionRng,masterUid,name,settings.decorate,data)}))}))}))},Annotator=editor=>{const registry=(()=>{const annotations={};return{register:(name,settings)=>{annotations[name]={name,settings}},lookup:name=>get$a(annotations,name).map((a=>a.settings)),getNames:()=>keys(annotations)}})();((editor,registry)=>{const dataAnnotation$1=dataAnnotation(),identifyParserNode=node=>Optional.from(node.attr(dataAnnotation$1)).bind(registry.lookup),removeDirectAnnotation=node=>{var _a,_b;node.attr(dataAnnotationId(),null),node.attr(dataAnnotation(),null),node.attr(dataAnnotationActive(),null);const customAttrNames=Optional.from(node.attr(dataAnnotationAttributes())).map((names=>names.split(","))).getOr([]),customClasses=Optional.from(node.attr(dataAnnotationClasses())).map((names=>names.split(","))).getOr([]);each$e(customAttrNames,(name=>node.attr(name,null)));const classList=null!==(_b=null===(_a=node.attr("class"))||void 0===_a?void 0:_a.split(" "))&&void 0!==_b?_b:[],newClassList=difference(classList,[annotation()].concat(customClasses));node.attr("class",newClassList.length>0?newClassList.join(" "):null),node.attr(dataAnnotationClasses(),null),node.attr(dataAnnotationAttributes(),null)};editor.serializer.addTempAttr(dataAnnotationActive()),editor.serializer.addAttributeFilter(dataAnnotation$1,(nodes=>{for(const node of nodes)identifyParserNode(node).each((settings=>{!1===settings.persistent&&("span"===node.name?node.unwrap():removeDirectAnnotation(node))}))}))})(editor,registry);const changes=setup$y(editor,registry),isSpan=isTag("span"),removeAnnotations=elements=>{each$e(elements,(element=>{isSpan(element)?unwrap(element):removeDirectAnnotation(element)}))};return{register:(name,settings)=>{registry.register(name,settings)},annotate:(name,data)=>{registry.lookup(name).each((settings=>{annotateWithBookmark(editor,name,settings,data)}))},annotationChanged:(name,callback)=>{changes.addListener(name,callback)},remove:name=>{identify(editor,Optional.some(name)).each((({elements})=>{const bookmark=editor.selection.getBookmark();removeAnnotations(elements),editor.selection.moveToBookmark(bookmark)}))},removeAll:name=>{const bookmark=editor.selection.getBookmark();each$d(findAll(editor,name),((elements,_)=>{removeAnnotations(elements)})),editor.selection.moveToBookmark(bookmark)},getAll:name=>{const directory=findAll(editor,name);return map$2(directory,(elems=>map$3(elems,(elem=>elem.dom))))}}},BookmarkManager=selection=>({getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)});BookmarkManager.isBookmarkNode=isBookmarkNode$1;const isXYWithinRange=(clientX,clientY,range)=>!range.collapsed&&exists(range.getClientRects(),(rect=>((rect,clientX,clientY)=>clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom)(rect,clientX,clientY))),fireError=(editor,errorType,error)=>{editor.dispatch(errorType,error)},fireFormatApply=(editor,format,node,vars)=>{editor.dispatch("FormatApply",{format,node,vars})},fireFormatRemove=(editor,format,node,vars)=>{editor.dispatch("FormatRemove",{format,node,vars})},fireSetContent=(editor,args)=>editor.dispatch("SetContent",args),fireGetContent=(editor,args)=>editor.dispatch("GetContent",args),firePastePlainTextToggle=(editor,state)=>editor.dispatch("PastePlainTextToggle",{state}),VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,modifierPressed:e=>e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e),metaKeyPressed:e=>Env.os.isMacOS()||Env.os.isiOS()?e.metaKey:e.ctrlKey&&!e.altKey},abs=Math.abs,round$1=Math.round,resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},ControlSelection=(selection,editor)=>{const dom=editor.dom,editableDoc=editor.getDoc(),rootDocument=document,rootElement=editor.getBody();let selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop,startX,startY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight;const isImage=elm=>isNonNullable(elm)&&(isImg(elm)||dom.is(elm,"figure.image")),isMedia=elm=>isMedia$2(elm)||dom.hasClass(elm,"mce-preview-object"),contextMenuSelectImage=evt=>{const target=evt.target;((evt,range)=>{if((evt=>"longpress"===evt.type||0===evt.type.indexOf("touch"))(evt)){const touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range)}return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range)})(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()&&editor.selection.select(target)},getResizeTargets=elm=>dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?[elm,elm.firstElementChild]:dom.is(elm,"figure.image")?[elm.querySelector("img")]:[elm],isResizable=elm=>{const selector=getObjectResizing(editor);return!!selector&&("false"!==elm.getAttribute("data-mce-resize")&&(elm!==editor.getBody()&&(dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?is$1(SugarElement.fromDom(elm.firstElementChild),selector):is$1(SugarElement.fromDom(elm),selector))))},setSizeProp=(element,name,value)=>{if(isNonNullable(value)){const targets=getResizeTargets(element);each$e(targets,(target=>{target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)?dom.setStyle(target,name,value):dom.setAttrib(target,name,""+value)}))}},setGhostElmSize=(ghostElm,width,height)=>{setSizeProp(ghostElm,"width",width),setSizeProp(ghostElm,"height",height)},resizeGhostElement=e=>{let deltaX,deltaY,proportional,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,proportional=(isImage(selectedElm)||isMedia(selectedElm))&&!1!==getResizeImgProportional(editor)?!VK.modifierPressed(e):VK.modifierPressed(e),proportional&&(abs(deltaX)>abs(deltaY)?(height=round$1(width*ratio),width=round$1(height/ratio)):(width=round$1(height/ratio),height=round$1(width*ratio))),setGhostElmSize(selectedElmGhost,width,height),resizeHelperX=selectedHandle.startPos.x+deltaX,resizeHelperY=selectedHandle.startPos.y+deltaY,resizeHelperX=resizeHelperX>0?resizeHelperX:0,resizeHelperY=resizeHelperY>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",undefined+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",undefined+(startH-height)),deltaX=rootElement.scrollWidth-startScrollWidth,deltaY=rootElement.scrollHeight-startScrollHeight,deltaX+deltaY!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(((editor,target,width,height,origin)=>{editor.dispatch("ObjectResizeStart",{target,width,height,origin})})(editor,selectedElm,startW,startH,"corner-"+selectedHandle.name),resizeStarted=!0)},endGhostResize=()=>{const wasResizeStarted=resizeStarted;resizeStarted=!1,wasResizeStarted&&(setSizeProp(selectedElm,"width",width),setSizeProp(selectedElm,"height",height)),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),dom.remove(resizeBackdrop),showResizeRect(selectedElm),wasResizeStarted&&(((editor,target,width,height,origin)=>{editor.dispatch("ObjectResized",{target,width,height,origin})})(editor,selectedElm,width,height,"corner-"+selectedHandle.name),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"))),editor.nodeChanged()},showResizeRect=targetElm=>{unbindResizeHandleEvents();const position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top;selectedElm!==targetElm&&(hideResizeRect(),selectedElm=targetElm,width=height=0);const e=editor.dispatch("ObjectSelected",{target:targetElm});isResizable(targetElm)&&!e.isDefaultPrevented()?each$d(resizeHandles,((handle,name)=>{const startDrag=e=>{const target=getResizeTargets(selectedElm)[0];var elm;startX=e.screenX,startY=e.screenY,startW=target.clientWidth,startH=target.clientHeight,ratio=startH/startW,selectedHandle=handle,selectedHandle.name=name,selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,resizeBackdrop=dom.add(rootElement,"div",{class:"mce-resize-backdrop","data-mce-bogus":"all"}),dom.setStyles(resizeBackdrop,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),selectedElmGhost=isMedia(elm=selectedElm)?dom.create("img",{src:Env.transparentSrc}):elm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable="false",dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),setGhostElmSize(selectedElmGhost,targetWidth,targetHeight),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)};let handleElm=dom.get("mceResizeHandle"+name);handleElm&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),dom.bind(handleElm,"mousedown",(e=>{e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)})),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})})):hideResizeRect(!1)},throttledShowResizeRect=first$1(showResizeRect,0),hideResizeRect=(removeSelected=!0)=>{throttledShowResizeRect.cancel(),unbindResizeHandleEvents(),selectedElm&&removeSelected&&selectedElm.removeAttribute("data-mce-selected"),each$d(resizeHandles,((value,name)=>{const handleElm=dom.get("mceResizeHandle"+name);handleElm&&(dom.unbind(handleElm),dom.remove(handleElm))}))},isChildOrEqual=(node,parent)=>dom.isChildOf(node,parent),updateResizeRect=e=>{if(resizeStarted||editor.removed||editor.composing)return;const targetElm="mousedown"===e.type?e.target:selection.getNode(),controlElm=closest$3(SugarElement.fromDom(targetElm),"table,img,figure.image,hr,video,span.mce-preview-object,details").map((e=>e.dom)).filter((e=>dom.isEditable(e.parentElement)||"IMG"===e.nodeName&&dom.isEditable(e))).getOrUndefined(),selectedValue=isNonNullable(controlElm)?dom.getAttrib(controlElm,"data-mce-selected","1"):"1";if(each$e(dom.select("img[data-mce-selected],hr[data-mce-selected]"),(img=>{img.removeAttribute("data-mce-selected")})),isNonNullable(controlElm)&&isChildOrEqual(controlElm,rootElement)&&editor.hasFocus()){disableGeckoResize();const startElm=selection.getStart(!0);if(isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm))return dom.setAttrib(controlElm,"data-mce-selected",selectedValue),void throttledShowResizeRect.throttle(controlElm)}hideResizeRect()},unbindResizeHandleEvents=()=>{each$d(resizeHandles,(handle=>{handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}))},disableGeckoResize=()=>{try{editor.getDoc().execCommand("enableObjectResizing",!1,"false")}catch(ex){}};editor.on("init",(()=>{disableGeckoResize(),editor.on("NodeChange ResizeEditor ResizeWindow ResizeContent drop",updateResizeRect),editor.on("keyup compositionend",(e=>{selectedElm&&"TABLE"===selectedElm.nodeName&&updateResizeRect(e)})),editor.on("hide blur",hideResizeRect),editor.on("contextmenu longpress",contextMenuSelectImage,!0)})),editor.on("remove",unbindResizeHandleEvents);return{isResizable,showResizeRect,hideResizeRect,updateResizeRect,destroy:()=>{throttledShowResizeRect.cancel(),selectedElm=selectedElmGhost=resizeBackdrop=null}}},relativeToNative=(win,startSitu,finishSitu)=>{const range=win.document.createRange();var rng;return rng=range,startSitu.fold((e=>{rng.setStartBefore(e.dom)}),((e,o)=>{rng.setStart(e.dom,o)}),(e=>{rng.setStartAfter(e.dom)})),((rng,situ)=>{situ.fold((e=>{rng.setEndBefore(e.dom)}),((e,o)=>{rng.setEnd(e.dom,o)}),(e=>{rng.setEndAfter(e.dom)}))})(range,finishSitu),range},exactToNative=(win,start,soffset,finish,foffset)=>{const rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},adt$3=Adt_generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),fromRange=(win,type,range)=>type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset),diagnose=(win,selection)=>{const ranges=((win,selection)=>selection.match({domRange:rng=>({ltr:constant(rng),rtl:Optional.none}),relative:(startSitu,finishSitu)=>({ltr:cached((()=>relativeToNative(win,startSitu,finishSitu))),rtl:cached((()=>Optional.some(relativeToNative(win,finishSitu,startSitu))))}),exact:(start,soffset,finish,foffset)=>({ltr:cached((()=>exactToNative(win,start,soffset,finish,foffset))),rtl:cached((()=>Optional.some(exactToNative(win,finish,foffset,start,soffset))))})}))(win,selection);return((win,ranges)=>{const rng=ranges.ltr();if(rng.collapsed)return ranges.rtl().filter((rev=>!1===rev.collapsed)).map((rev=>adt$3.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset))).getOrThunk((()=>fromRange(0,adt$3.ltr,rng)));return fromRange(0,adt$3.ltr,rng)})(0,ranges)};adt$3.ltr,adt$3.rtl;const SimRange_create=(start,soffset,finish,foffset)=>({start,soffset,finish,foffset}),caretPositionFromPoint=(doc,x,y)=>{var _a,_b;return Optional.from(null===(_b=(_a=doc.dom).caretPositionFromPoint)||void 0===_b?void 0:_b.call(_a,x,y)).bind((pos=>{if(null===pos.offsetNode)return Optional.none();const r=doc.dom.createRange();return r.setStart(pos.offsetNode,pos.offset),r.collapse(),Optional.some(r)}))},caretRangeFromPoint=(doc,x,y)=>{var _a,_b;return Optional.from(null===(_b=(_a=doc.dom).caretRangeFromPoint)||void 0===_b?void 0:_b.call(_a,x,y))},availableSearch=document.caretPositionFromPoint?caretPositionFromPoint:document.caretRangeFromPoint?caretRangeFromPoint:Optional.none,adt$2=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Situ={before:adt$2.before,on:adt$2.on,after:adt$2.after,cata:(subject,onBefore,onOn,onAfter)=>subject.fold(onBefore,onOn,onAfter),getStart:situ=>situ.fold(identity,identity,identity)},adt$1=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),SimSelection={domRange:adt$1.domRange,relative:adt$1.relative,exact:adt$1.exact,exactFromRange:simRange=>adt$1.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset),getWin:selection=>{const start=(selection=>selection.match({domRange:rng=>SugarElement.fromDom(rng.startContainer),relative:(startSitu,_finishSitu)=>Situ.getStart(startSitu),exact:(start,_soffset,_finish,_foffset)=>start}))(selection);return defaultView(start)},range:SimRange_create},beforeSpecial=(element,offset)=>{const name$1=name(element);return"input"===name$1?Situ.after(element):contains$2(["br","img"],name$1)?0===offset?Situ.before(element):Situ.after(element):Situ.on(element,offset)},preprocessRelative=(startSitu,finishSitu)=>{const start=startSitu.fold(Situ.before,beforeSpecial,Situ.after),finish=finishSitu.fold(Situ.before,beforeSpecial,Situ.after);return SimSelection.relative(start,finish)},preprocessExact=(start,soffset,finish,foffset)=>{const startSitu=beforeSpecial(start,soffset),finishSitu=beforeSpecial(finish,foffset);return SimSelection.relative(startSitu,finishSitu)},fromElements=(elements,scope)=>{const fragment=(scope||document).createDocumentFragment();return each$e(elements,(element=>{fragment.appendChild(element.dom)})),SugarElement.fromDom(fragment)},toNative=selection=>{const win=SimSelection.getWin(selection).dom,getDomRange=(start,soffset,finish,foffset)=>exactToNative(win,start,soffset,finish,foffset),filtered=(selection=>selection.match({domRange:rng=>{const start=SugarElement.fromDom(rng.startContainer),finish=SugarElement.fromDom(rng.endContainer);return preprocessExact(start,rng.startOffset,finish,rng.endOffset)},relative:preprocessRelative,exact:preprocessExact}))(selection);return diagnose(win,filtered).match({ltr:getDomRange,rtl:getDomRange})},getAtPoint=(win,x,y)=>((win,x,y)=>{const doc=SugarElement.fromDom(win.document);return availableSearch(doc,x,y).map((rng=>SimRange_create(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset)))})(win,x,y),fromPoint=(clientX,clientY,doc)=>{const win=defaultView(SugarElement.fromDom(doc));return getAtPoint(win.dom,clientX,clientY).map((simRange=>{const rng=doc.createRange();return rng.setStart(simRange.start.dom,simRange.soffset),rng.setEnd(simRange.finish.dom,simRange.foffset),rng})).getOrUndefined()},isEq$4=(rng1,rng2)=>isNonNullable(rng1)&&isNonNullable(rng2)&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset,hasParent$1=(node,rootNode,predicate)=>null!==((node,rootNode,predicate)=>{let currentNode=node;for(;currentNode&&currentNode!==rootNode;){if(predicate(currentNode))return currentNode;currentNode=currentNode.parentNode}return null})(node,rootNode,predicate),hasParentWithName=(node,rootNode,name)=>hasParent$1(node,rootNode,(node=>node.nodeName===name)),isCeFalseCaretContainer=(node,rootNode)=>isCaretContainer$2(node)&&!hasParent$1(node,rootNode,isCaretNode),hasBrBeforeAfter=(dom,node,left)=>{const parentNode=node.parentNode;if(parentNode){const walker=new DomTreeWalker(node,dom.getParent(parentNode,dom.isBlock)||dom.getRoot());let currentNode;for(;currentNode=walker[left?"prev":"next"]();)if(isBr$6(currentNode))return!0}return!1},findTextNodeRelative=(dom,isAfterNode,collapsed,left,startNode)=>{const body=dom.getRoot(),nonEmptyElementsMap=dom.schema.getNonEmptyElements(),parentNode=startNode.parentNode;let lastInlineElement,node;if(!parentNode)return Optional.none();const parentBlockContainer=dom.getParent(parentNode,dom.isBlock)||body;if(left&&isBr$6(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer))return Optional.some(CaretPosition(parentNode,dom.nodeIndex(startNode)));const walker=new DomTreeWalker(startNode,parentBlockContainer);for(;node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,body))return Optional.none();if(isText$a(node)&&node.data.length>0)return hasParentWithName(node,body,"A")?Optional.none():Optional.some(CaretPosition(node,left?node.data.length:0));if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return Optional.none();lastInlineElement=node}return isComment(lastInlineElement)?Optional.none():collapsed&&lastInlineElement?Optional.some(CaretPosition(lastInlineElement,0)):Optional.none()},normalizeEndPoint=(dom,collapsed,start,rng)=>{const body=dom.getRoot();let node,normalized=!1,container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;const isAfterNode=isElement$6(container)&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements();let directionLeft=start;if(isCaretContainer$2(container))return Optional.none();if(isElement$6(container)&&offset>container.childNodes.length-1&&(directionLeft=!1),isDocument$1(container)&&(container=body,offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0],node)){if(isCaretContainer$2(node))return Optional.none();if(nonEmptyElementsMap[node.nodeName]||isTable$2(node))return Optional.none()}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=isText$a(container)&&isAfterNode?container.data.length:0,!collapsed&&container===body.lastChild&&isTable$2(container))return Optional.none();if(((root,node)=>{let currentNode=node;for(;currentNode&&currentNode!==root;){if(isContentEditableFalse$b(currentNode))return!0;currentNode=currentNode.parentNode}return!1})(body,container)||isCaretContainer$2(container))return Optional.none();if(isDetails(container))return Optional.none();if(container.hasChildNodes()&&!isTable$2(container)){node=container;const walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse$b(node)||isCaretContainer$2(node)){normalized=!1;break}if(isText$a(node)&&node.data.length>0){offset=directionLeft?0:node.data.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCellOrCaption(node)){offset=dom.nodeIndex(node),container=node.parentNode,directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}return collapsed&&(isText$a(container)&&0===offset&&findTextNodeRelative(dom,isAfterNode,collapsed,!0,container).each((pos=>{container=pos.container(),offset=pos.offset(),normalized=!0})),isElement$6(container)&&(node=container.childNodes[offset],node||(node=container.childNodes[offset-1]),!node||!isBr$6(node)||((node,name)=>{var _a;return(null===(_a=node.previousSibling)||void 0===_a?void 0:_a.nodeName)===name})(node,"A")||hasBrBeforeAfter(dom,node,!1)||hasBrBeforeAfter(dom,node,!0)||findTextNodeRelative(dom,isAfterNode,collapsed,!0,node).each((pos=>{container=pos.container(),offset=pos.offset(),normalized=!0})))),directionLeft&&!collapsed&&isText$a(container)&&offset===container.data.length&&findTextNodeRelative(dom,isAfterNode,collapsed,!1,container).each((pos=>{container=pos.container(),offset=pos.offset(),normalized=!0})),normalized&&container?Optional.some(CaretPosition(container,offset)):Optional.none()},normalize$2=(dom,rng)=>{const collapsed=rng.collapsed,normRng=rng.cloneRange(),startPos=CaretPosition.fromRangeStart(rng);return normalizeEndPoint(dom,collapsed,!0,normRng).each((pos=>{collapsed&&CaretPosition.isAbove(startPos,pos)||normRng.setStart(pos.container(),pos.offset())})),collapsed||normalizeEndPoint(dom,collapsed,!1,normRng).each((pos=>{normRng.setEnd(pos.container(),pos.offset())})),collapsed&&normRng.collapse(!0),isEq$4(rng,normRng)?Optional.none():Optional.some(normRng)},splitText=(node,offset)=>node.splitText(offset),split=rng=>{let startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(startContainer===endContainer&&isText$a(startContainer)){if(startOffset>0&&startOffset<startContainer.data.length)if(endContainer=splitText(startContainer,startOffset),startContainer=endContainer.previousSibling,endOffset>startOffset){endOffset-=startOffset;const newContainer=splitText(endContainer,endOffset).previousSibling;startContainer=endContainer=newContainer,endOffset=newContainer.data.length,startOffset=0}else endOffset=0}else if(isText$a(startContainer)&&startOffset>0&&startOffset<startContainer.data.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),isText$a(endContainer)&&endOffset>0&&endOffset<endContainer.data.length){const newContainer=splitText(endContainer,endOffset).previousSibling;endContainer=newContainer,endOffset=newContainer.data.length}return{startContainer,startOffset,endContainer,endOffset}},RangeUtils=dom=>({walk:(rng,callback)=>walk$3(dom,rng,callback),split,expand:(rng,options={type:"word"})=>{if("word"===options.type){const rangeLike=expandRng(dom,rng,[{inline:"span"}]),newRange=dom.createRng();return newRange.setStart(rangeLike.startContainer,rangeLike.startOffset),newRange.setEnd(rangeLike.endContainer,rangeLike.endOffset),newRange}return rng},normalize:rng=>normalize$2(dom,rng).fold(never,(normalizedRng=>(rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset),rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset),!0)))});RangeUtils.compareRanges=isEq$4,RangeUtils.getCaretRangeFromPoint=fromPoint,RangeUtils.getSelectedNode=getSelectedNode,RangeUtils.getNode=getNode$1;const api=((name,getOffset)=>{const get=element=>{const r=getOffset(element);if(r<=0||null===r){const css=get$7(element,name);return parseFloat(css)||0}return r},aggregate=(element,properties)=>foldl(properties,((acc,property)=>{const val=get$7(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0);return{set:(element,h)=>{if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);const dom=element.dom;isSupported(dom)&&(dom.style[name]=h+"px")},get,getOuter:get,aggregate,max:(element,value,properties)=>{const cumulativeInclusions=aggregate(element,properties);return value>cumulativeInclusions?value-cumulativeInclusions:0}}})("height",(element=>{const dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),getDocument=()=>SugarElement.fromDom(document),walkUp=(navigation,doc)=>navigation.view(doc).fold(constant([]),(f=>{const parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}));var Navigation=Object.freeze({__proto__:null,view:doc=>{var _a;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner:element=>documentOrOwner(element)});const find=element=>{const doc=getDocument(),scroll=get$5(doc),frames=((element,navigation)=>{const d=navigation.owner(element);return walkUp(navigation,d)})(element,Navigation),offset=viewport(element),r=foldr(frames,((b,a)=>{const loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)},excludeFromDescend=element=>"textarea"===name(element),markerInfo=(element,cleanupFun)=>{const pos=(element=>{const doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);const scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)})(element),height=(element=>api.get(element))(element);return{element,bottom:pos.top+height,height,pos,cleanup:cleanupFun}},createMarker$1=(element,offset)=>{const startPoint=((element,offset)=>{const children=children$1(element);if(0===children.length||excludeFromDescend(element))return{element,offset};if(offset<children.length&&!excludeFromDescend(children[offset]))return{element:children[offset],offset:0};{const last=children[children.length-1];return excludeFromDescend(last)?{element,offset}:"img"===name(last)?{element:last,offset:1}:isText$b(last)?{element:last,offset:get$3(last).length}:{element:last,offset:children$1(last).length}}})(element,offset),span=SugarElement.fromHtml('<span data-mce-bogus="all" style="display: inline-block;">\ufeff</span>');return before$3(startPoint.element,span),markerInfo(span,(()=>remove$5(span)))},withMarker=(editor,f,rng,alignToTop)=>{preserveWith(editor,((_s,_e)=>applyWithMarker(editor,f,rng,alignToTop)),rng)},withScrollEvents=(editor,doc,f,marker,alignToTop)=>{const data={elm:marker.element.dom,alignToTop};if(((editor,data)=>editor.dispatch("ScrollIntoView",data).isDefaultPrevented())(editor,data))return;f(editor,doc,get$5(doc).top,marker,alignToTop),((editor,data)=>{editor.dispatch("AfterScrollIntoView",data)})(editor,data)},applyWithMarker=(editor,f,rng,alignToTop)=>{const body=SugarElement.fromDom(editor.getBody()),doc=SugarElement.fromDom(editor.getDoc());body.dom.offsetWidth;const marker=createMarker$1(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop),marker.cleanup()},withElement=(editor,element,f,alignToTop)=>{const doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,(element=>markerInfo(SugarElement.fromDom(element),noop))(element),alignToTop)},preserveWith=(editor,f,rng)=>{const startElement=rng.startContainer,startOffset=rng.startOffset,endElement=rng.endContainer,endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));const newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset),newRng.setEnd(endElement,endOffset),editor.selection.setRng(rng)},scrollToMarker=(editor,marker,viewHeight,alignToTop,doc)=>{const pos=marker.pos;if(alignToTop)to(pos.left,pos.top,doc);else{const y=pos.top-viewHeight+marker.height;to(-editor.getBody().getBoundingClientRect().left,y,doc)}},intoWindowIfNeeded=(editor,doc,scrollTop,viewHeight,marker,alignToTop)=>{const viewportBottom=viewHeight+scrollTop,markerTop=marker.pos.top,markerBottom=marker.bottom,largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop)scrollToMarker(editor,marker,viewHeight,!1!==alignToTop,doc);else if(markerTop>viewportBottom){scrollToMarker(editor,marker,viewHeight,largerThanViewport?!1!==alignToTop:!0===alignToTop,doc)}else markerBottom>viewportBottom&&!largerThanViewport&&scrollToMarker(editor,marker,viewHeight,!0===alignToTop,doc)},intoWindow=(editor,doc,scrollTop,marker,alignToTop)=>{const viewHeight=defaultView(doc).dom.innerHeight;intoWindowIfNeeded(editor,doc,scrollTop,viewHeight,marker,alignToTop)},intoFrame=(editor,doc,scrollTop,marker,alignToTop)=>{const frameViewHeight=defaultView(doc).dom.innerHeight;intoWindowIfNeeded(editor,doc,scrollTop,frameViewHeight,marker,alignToTop);const op=find(marker.element),viewportBounds=getBounds(window);op.top<viewportBounds.y?intoView(marker.element,!1!==alignToTop):op.top>viewportBounds.bottom&&intoView(marker.element,!0===alignToTop)},rangeIntoWindow=(editor,rng,alignToTop)=>withMarker(editor,intoWindow,rng,alignToTop),elementIntoWindow=(editor,element,alignToTop)=>withElement(editor,element,intoWindow,alignToTop),rangeIntoFrame=(editor,rng,alignToTop)=>withMarker(editor,intoFrame,rng,alignToTop),elementIntoFrame=(editor,element,alignToTop)=>withElement(editor,element,intoFrame,alignToTop),scrollRangeIntoView=(editor,rng,alignToTop)=>{(editor.inline?rangeIntoWindow:rangeIntoFrame)(editor,rng,alignToTop)},focus$1=(element,preventScroll=!1)=>element.dom.focus({preventScroll}),hasFocus$1=element=>{const root=getRootNode(element).dom;return element.dom===root.activeElement},active$1=(root=getDocument())=>Optional.from(root.dom.activeElement).map(SugarElement.fromDom),clamp$1=(offset,element)=>{const max=isText$b(element)?get$3(element).length:children$1(element).length+1;return offset>max?max:offset<0?0:offset},normalizeRng=rng=>SimSelection.range(rng.start,clamp$1(rng.soffset,rng.start),rng.finish,clamp$1(rng.foffset,rng.finish)),isOrContains=(root,elm)=>!isRestrictedNode(elm.dom)&&(contains(root,elm)||eq(root,elm)),isRngInRoot=root=>rng=>isOrContains(root,rng.start)&&isOrContains(root,rng.finish),nativeRangeToSelectionRange=r=>SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset),getBookmark=root=>(win=>{const selection=win.getSelection();return(selection&&0!==selection.rangeCount?Optional.from(selection.getRangeAt(0)):Optional.none()).map(nativeRangeToSelectionRange)})(defaultView(root).dom).filter(isRngInRoot(root)),bookmarkToNativeRng=bookmark=>{const rng=document.createRange();try{return rng.setStart(bookmark.start.dom,bookmark.soffset),rng.setEnd(bookmark.finish.dom,bookmark.foffset),Optional.some(rng)}catch(_){return Optional.none()}},store=editor=>{const newBookmark=(editor=>editor.inline||Env.browser.isFirefox())(editor)?getBookmark(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},getRng=editor=>(editor.bookmark?editor.bookmark:Optional.none()).bind((x=>((root,bookmark)=>Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng))(SugarElement.fromDom(editor.getBody()),x))).bind(bookmarkToNativeRng),FocusManager={isEditorUIElement:elm=>{const className=elm.className.toString();return-1!==className.indexOf("tox-")||-1!==className.indexOf("mce-")}},Delay={setEditorTimeout:(editor,callback,time)=>((callback,time)=>(isNumber(time)||(time=0),setTimeout(callback,time)))((()=>{editor.removed||callback()}),time),setEditorInterval:(editor,callback,time)=>{const timer=((callback,time)=>(isNumber(time)||(time=0),setInterval(callback,time)))((()=>{editor.removed?clearInterval(timer):callback()}),time);return timer}},register$6=editor=>{const throttledStore=first$1((()=>{store(editor)}),0);editor.on("init",(()=>{editor.inline&&((editor,throttledStore)=>{const mouseUpPage=()=>{throttledStore.throttle()};DOMUtils.DOM.bind(document,"mouseup",mouseUpPage),editor.on("remove",(()=>{DOMUtils.DOM.unbind(document,"mouseup",mouseUpPage)}))})(editor,throttledStore),((editor,throttledStore)=>{((editor,throttledStore)=>{editor.on("mouseup touchend",(_e=>{throttledStore.throttle()}))})(editor,throttledStore),editor.on("keyup NodeChange AfterSetSelectionRange",(e=>{(e=>"nodechange"===e.type&&e.selectionChange)(e)||store(editor)}))})(editor,throttledStore)})),editor.on("remove",(()=>{throttledStore.cancel()}))};let documentFocusInHandler;const DOM$9=DOMUtils.DOM,isEditorContentAreaElement=elm=>{const classList=elm.classList;return void 0!==classList&&(classList.contains("tox-edit-area")||classList.contains("tox-edit-area__iframe")||classList.contains("mce-content-body"))},isUIElement=(editor,elm)=>{const customSelector=getCustomUiSelector(editor),parent=DOM$9.getParent(elm,(elm=>(elm=>isElement$6(elm)&&FocusManager.isEditorUIElement(elm))(elm)||!!customSelector&&editor.dom.is(elm,customSelector)));return null!==parent},getActiveElement=editor=>{try{const root=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(root).fold((()=>document.body),(x=>x.dom))}catch(ex){return document.body}},registerEvents$1=(editorManager,e)=>{const editor=e.editor;register$6(editor);const toggleContentAreaOnFocus=(editor,fn)=>{if(shouldHighlightOnFocus(editor)&&!0!==editor.inline){fn(SugarElement.fromDom(editor.getContainer()),"tox-edit-focus")}};editor.on("focusin",(()=>{const focusedEditor=editorManager.focusedEditor;isEditorContentAreaElement(getActiveElement(editor))&&toggleContentAreaOnFocus(editor,add$2),focusedEditor!==editor&&(focusedEditor&&focusedEditor.dispatch("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.dispatch("focus",{blurredEditor:focusedEditor}),editor.focus(!0))})),editor.on("focusout",(()=>{Delay.setEditorTimeout(editor,(()=>{const focusedEditor=editorManager.focusedEditor;isEditorContentAreaElement(getActiveElement(editor))&&focusedEditor===editor||toggleContentAreaOnFocus(editor,remove$7),isUIElement(editor,getActiveElement(editor))||focusedEditor!==editor||(editor.dispatch("blur",{focusedEditor:null}),editorManager.focusedEditor=null)}))})),documentFocusInHandler||(documentFocusInHandler=e=>{const activeEditor=editorManager.activeEditor;activeEditor&&getOriginalEventTarget(e).each((target=>{const elem=target;elem.ownerDocument===document&&(elem===document.body||isUIElement(activeEditor,elem)||editorManager.focusedEditor!==activeEditor||(activeEditor.dispatch("blur",{focusedEditor:null}),editorManager.focusedEditor=null))}))},DOM$9.bind(document,"focusin",documentFocusInHandler))},unregisterDocumentEvents=(editorManager,e)=>{editorManager.focusedEditor===e.editor&&(editorManager.focusedEditor=null),!editorManager.activeEditor&&documentFocusInHandler&&(DOM$9.unbind(document,"focusin",documentFocusInHandler),documentFocusInHandler=null)},getFocusInElement=(root,rng)=>(rng=>rng.collapsed?Optional.from(getNode$1(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none())(rng).bind((node=>isTableSection(node)?Optional.some(node):contains(root,node)?Optional.none():Optional.some(root))),normalizeSelection=(editor,rng)=>{getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind((elm=>firstPositionIn(elm.dom))).fold((()=>{editor.selection.normalize()}),(caretPos=>editor.selection.setRng(caretPos.toRange())))},focusBody=body=>{if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus()},hasElementFocus=elm=>{return hasFocus$1(elm)||(element=elm,active$1(getRootNode(element)).filter((e=>element.dom.contains(e.dom)))).isSome();var element},hasFocus=editor=>editor.inline?(editor=>{const rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody))})(editor):(editor=>isNonNullable(editor.iframeElement)&&hasFocus$1(SugarElement.fromDom(editor.iframeElement)))(editor),hasEditorOrUiFocus=editor=>hasFocus(editor)||(editor=>{const dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active$1(dos).filter((elem=>!isEditorContentAreaElement(elem.dom)&&isUIElement(editor,elem.dom))).isSome()})(editor),activateEditor=editor=>editor.editorManager.setActive(editor),focus=(editor,skipFocus)=>{editor.removed||(skipFocus?activateEditor(editor):(editor=>{const selection=editor.selection,body=editor.getBody();let rng=selection.getRng();editor.quirks.refreshContentEditable(),isNonNullable(editor.bookmark)&&!hasFocus(editor)&&getRng(editor).each((bookmarkRng=>{editor.selection.setRng(bookmarkRng),rng=bookmarkRng}));const contentEditableHost=((editor,node)=>editor.dom.getParent(node,(node=>"true"===editor.dom.getContentEditable(node))))(editor,selection.getNode());if(contentEditableHost&&editor.dom.isChildOf(contentEditableHost,body))return focusBody(contentEditableHost),normalizeSelection(editor,rng),void activateEditor(editor);editor.inline||(Env.browser.isOpera()||focusBody(body),editor.getWin().focus()),(Env.browser.isFirefox()||editor.inline)&&(focusBody(body),normalizeSelection(editor,rng)),activateEditor(editor)})(editor))},isEditableRange=(dom,rng)=>rng.collapsed?dom.isEditable(rng.startContainer):dom.isEditable(rng.startContainer)&&dom.isEditable(rng.endContainer),getEndpointElement=(root,rng,start,real,resolve)=>{const container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map((elm=>real&&rng.collapsed?elm:child$1(elm,resolve(elm,offset)).getOr(elm))).bind((elm=>isElement$7(elm)?Optional.some(elm):parent(elm).filter(isElement$7))).map((elm=>elm.dom)).getOr(root)},getStart=(root,rng,real=!1)=>getEndpointElement(root,rng,!0,real,((elm,offset)=>Math.min(childNodesCount(elm),offset))),getEnd$1=(root,rng,real=!1)=>getEndpointElement(root,rng,!1,real,((elm,offset)=>offset>0?offset-1:offset)),skipEmptyTextNodes=(node,forwards)=>{const orig=node;for(;node&&isText$a(node)&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig},processRanges=(editor,ranges)=>map$3(ranges,(range=>{const evt=editor.dispatch("GetSelectionRange",{range});return evt.range!==range?evt.range:range})),elementsWithCursorPosition=["img","br"],isCursorPosition=elem=>{const hasCursorPosition=getOption(elem).filter((text=>0!==text.trim().length||text.indexOf(" ")>-1)).isSome();return hasCursorPosition||contains$2(elementsWithCursorPosition,name(elem))||(elem=>isHTMLElement$1(elem)&&"false"===get$9(elem,"contenteditable"))(elem)},descendantRtl=(scope,predicate)=>{const descend=element=>{const children=children$1(element);for(let i=children.length-1;i>=0;i--){const child=children[i];if(predicate(child))return Optional.some(child);const res=descend(child);if(res.isSome())return res}return Optional.none()};return descend(scope)},create$9=(editor,range)=>{if(findIn(SugarElement.fromDom(editor.getBody())).isNone()){const wrapper=SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>',editor.getDoc());append$1(wrapper,SugarElement.fromDom(range.extractContents())),range.insertNode(wrapper.dom),parent(wrapper).each((elm=>elm.dom.normalize())),(element=wrapper,descendantRtl(element,isCursorPosition)).map((last=>{editor.selection.setCursorLocation(last.dom,(element=>"img"===name(element)?1:getOption(element).fold((()=>children$1(element).length),(v=>v.length)))(last))}))}var element},findIn=elm=>descendant$1(elm,"[data-mce-autocompleter]"),typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},walk$2=(node,root,prev)=>{const startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root){let sibling=node[siblingName];if(sibling)return sibling;for(let parent=node.parent;parent&&parent!==root;parent=parent.parent)if(sibling=parent[siblingName],sibling)return sibling}},isEmptyTextNode=node=>{var _a;const text=null!==(_a=node.value)&&void 0!==_a?_a:"";if(!isWhitespaceText(text))return!1;const parentNode=node.parent;return!parentNode||"span"===parentNode.name&&!parentNode.attr("style")||!/^[ ]+$/.test(text)},isNonEmptyElement=node=>{const isNamedAnchor="a"===node.name&&!node.attr("href")&&node.attr("id");return node.attr("name")||node.attr("id")&&!node.firstChild||node.attr("data-mce-bookmark")||isNamedAnchor};class AstNode{static create(name,attrs){const node=new AstNode(name,typeLookup[name]||1);return attrs&&each$d(attrs,((value,attrName)=>{node.attr(attrName,value)})),node}constructor(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}replace(node){return node.parent&&node.remove(),this.insert(node,this),this.remove(),this}attr(name,value){const self=this;if(!isString(name))return isNonNullable(name)&&each$d(name,((value,key)=>{self.attr(key,value)})),self;const attrs=self.attributes;if(attrs){if(void 0!==value){if(null===value){if(name in attrs.map){delete attrs.map[name];let i=attrs.length;for(;i--;)if(attrs[i].name===name)return attrs.splice(i,1),self}return self}if(name in attrs.map){let i=attrs.length;for(;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name,value});return attrs.map[name]=value,self}return attrs.map[name]}}clone(){const clone=new AstNode(this.name,this.type),selfAttrs=this.attributes;if(selfAttrs){const cloneAttrs=[];cloneAttrs.map={};for(let i=0,l=selfAttrs.length;i<l;i++){const selfAttr=selfAttrs[i];"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value)}clone.attributes=cloneAttrs}return clone.value=this.value,clone}wrap(wrapper){const self=this;return self.parent&&(self.parent.insert(wrapper,self),wrapper.append(self)),self}unwrap(){const self=this;for(let node=self.firstChild;node;){const next=node.next;self.insert(node,self,!0),node=next}self.remove()}remove(){const self=this,parent=self.parent,next=self.next,prev=self.prev;return parent&&(parent.firstChild===self?(parent.firstChild=next,next&&(next.prev=null)):prev&&(prev.next=next),parent.lastChild===self?(parent.lastChild=prev,prev&&(prev.next=null)):next&&(next.prev=prev),self.parent=self.next=self.prev=null),self}append(node){const self=this;node.parent&&node.remove();const last=self.lastChild;return last?(last.next=node,node.prev=last,self.lastChild=node):self.lastChild=self.firstChild=node,node.parent=self,node}insert(node,refNode,before){node.parent&&node.remove();const parent=refNode.parent||this;return before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev&&(refNode.prev.next=node),node.prev=refNode.prev,node.next=refNode,refNode.prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next&&(refNode.next.prev=node),node.next=refNode.next,node.prev=refNode,refNode.next=node),node.parent=parent,node}getAll(name){const self=this,collection=[];for(let node=self.firstChild;node;node=walk$2(node,self))node.name===name&&collection.push(node);return collection}children(){const collection=[];for(let node=this.firstChild;node;node=node.next)collection.push(node);return collection}empty(){const self=this;if(self.firstChild){const nodes=[];for(let node=self.firstChild;node;node=walk$2(node,self))nodes.push(node);let i=nodes.length;for(;i--;){const node=nodes[i];node.parent=node.firstChild=node.lastChild=node.next=node.prev=null}}return self.firstChild=self.lastChild=null,self}isEmpty(elements,whitespace={},predicate){var _a;const self=this;let node=self.firstChild;if(isNonEmptyElement(self))return!1;if(node)do{if(1===node.type){if(node.attr("data-mce-bogus"))continue;if(elements[node.name])return!1;if(isNonEmptyElement(node))return!1}if(8===node.type)return!1;if(3===node.type&&!isEmptyTextNode(node))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(null!==(_a=node.value)&&void 0!==_a?_a:""))return!1;if(predicate&&predicate(node))return!1}while(node=walk$2(node,self));return!0}walk(prev){return walk$2(this,null,prev)}}const unescapedTextParents=Tools.makeMap("NOSCRIPT STYLE SCRIPT XMP IFRAME NOEMBED NOFRAMES PLAINTEXT"," "),containsZwsp=node=>isString(node.nodeValue)&&node.nodeValue.includes("\ufeff"),getTemporaryNodeSelector=tempAttrs=>(0===tempAttrs.length?"":`${map$3(tempAttrs,(attr=>`[${attr}]`)).join(",")},`)+'[data-mce-bogus="all"]',createZwspCommentWalker=body=>document.createTreeWalker(body,NodeFilter.SHOW_COMMENT,(node=>containsZwsp(node)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP)),createUnescapedZwspTextWalker=body=>document.createTreeWalker(body,NodeFilter.SHOW_TEXT,(node=>{if(containsZwsp(node)){const parent=node.parentNode;return parent&&has$2(unescapedTextParents,parent.nodeName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_SKIP})),hasZwspComment=body=>null!==createZwspCommentWalker(body).nextNode(),hasUnescapedZwspText=body=>null!==createUnescapedZwspTextWalker(body).nextNode(),hasTemporaryNode=(tempAttrs,body)=>null!==body.querySelector(getTemporaryNodeSelector(tempAttrs)),trimTemporaryNodes=(tempAttrs,body)=>{each$e(((tempAttrs,body)=>body.querySelectorAll(getTemporaryNodeSelector(tempAttrs)))(tempAttrs,body),(elm=>{const element=SugarElement.fromDom(elm);"all"===get$9(element,"data-mce-bogus")?remove$5(element):each$e(tempAttrs,(attr=>{has$1(element,attr)&&remove$a(element,attr)}))}))},emptyAllNodeValuesInWalker=walker=>{let curr=walker.nextNode();for(;null!==curr;)curr.nodeValue=null,curr=walker.nextNode()},emptyZwspComments=compose(emptyAllNodeValuesInWalker,createZwspCommentWalker),emptyUnescapedZwspTexts=compose(emptyAllNodeValuesInWalker,createUnescapedZwspTextWalker),trim$1=(body,tempAttrs)=>{const conditionalTrims=[{condition:curry(hasTemporaryNode,tempAttrs),action:curry(trimTemporaryNodes,tempAttrs)},{condition:hasZwspComment,action:emptyZwspComments},{condition:hasUnescapedZwspText,action:emptyUnescapedZwspTexts}];let trimmed=body,cloned=!1;return each$e(conditionalTrims,(({condition,action})=>{condition(trimmed)&&(cloned||(trimmed=body.cloneNode(!0),cloned=!0),action(trimmed))})),trimmed},cleanupBogusElements=parent=>{const bogusElements=descendants(parent,"[data-mce-bogus]");each$e(bogusElements,(elem=>{"all"===get$9(elem,"data-mce-bogus")?remove$5(elem):isBr$5(elem)?(before$3(elem,SugarElement.fromText("\ufeff")),remove$5(elem)):unwrap(elem)}))},cleanupInputNames=parent=>{const inputs=descendants(parent,"input");each$e(inputs,(input=>{remove$a(input,"name")}))},getPlainTextContent=(editor,body)=>{const doc=editor.getDoc(),dos=getRootNode(SugarElement.fromDom(editor.getBody())),offscreenDiv=SugarElement.fromTag("div",doc);set$3(offscreenDiv,"data-mce-bogus","all"),setAll(offscreenDiv,{position:"fixed",left:"-9999999px",top:"0"}),set$1(offscreenDiv,body.innerHTML),cleanupBogusElements(offscreenDiv),cleanupInputNames(offscreenDiv);const root=(dos=>isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body))(dos);append$1(root,offscreenDiv);const content=trim$2(offscreenDiv.dom.innerText);return remove$5(offscreenDiv),content},getContentFromBody=(editor,args,body)=>{let content;content="raw"===args.format?Tools.trim(trim$2(trim$1(body,editor.serializer.getTempAttrs()).innerHTML)):"text"===args.format?getPlainTextContent(editor,body):"tree"===args.format?editor.serializer.serialize(body,args):((editor,html)=>{const blockName=getForcedRootBlock(editor),emptyRegExp=new RegExp(`^(<${blockName}[^>]*>(&nbsp;|&#160;|\\s| |<br \\/>|)<\\/${blockName}>[\r\n]*|<br \\/>[\r\n]*)$`);return html.replace(emptyRegExp,"")})(editor,editor.serializer.serialize(body,args));return"text"!==args.format&&!isWsPreserveElement(SugarElement.fromDom(body))&&isString(content)?Tools.trim(content):content},makeMap$1=Tools.makeMap,Writer=settings=>{const html=[],indent=(settings=settings||{}).indent,indentBefore=makeMap$1(settings.indent_before||""),indentAfter=makeMap$1(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="xhtml"!==settings.element_format;return{start:(name,attrs,empty)=>{if(indent&&indentBefore[name]&&html.length>0){const value=html[html.length-1];value.length>0&&"\n"!==value&&html.push("\n")}if(html.push("<",name),attrs)for(let i=0,l=attrs.length;i<l;i++){const attr=attrs[i];html.push(" ",attr.name,'="',encode(attr.value,!0),'"')}if(html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&html.length>0){const value=html[html.length-1];value.length>0&&"\n"!==value&&html.push("\n")}},end:name=>{let value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1],value.length>0&&"\n"!==value&&html.push("\n"))},text:(text,raw)=>{text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:text=>{html.push("<![CDATA[",text,"]]>")},comment:text=>{html.push("\x3c!--",text,"--\x3e")},pi:(name,text)=>{text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:text=>{html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:()=>{html.length=0},getContent:()=>html.join("").replace(/\n$/,"")}},HtmlSerializer=(settings={},schema=Schema())=>{const writer=Writer(settings);settings.validate=!("validate"in settings)||settings.validate;return{serialize:node=>{const validate=settings.validate,handlers={3:node=>{var _a;writer.text(null!==(_a=node.value)&&void 0!==_a?_a:"",node.raw)},8:node=>{var _a;writer.comment(null!==(_a=node.value)&&void 0!==_a?_a:"")},7:node=>{writer.pi(node.name,node.value)},10:node=>{var _a;writer.doctype(null!==(_a=node.value)&&void 0!==_a?_a:"")},4:node=>{var _a;writer.cdata(null!==(_a=node.value)&&void 0!==_a?_a:"")},11:node=>{let tempNode=node;if(tempNode=tempNode.firstChild)do{walk(tempNode)}while(tempNode=tempNode.next)}};writer.reset();const walk=node=>{var _a;const handler=handlers[node.type];if(handler)handler(node);else{const name=node.name,isEmpty=name in schema.getVoidElements();let attrs=node.attributes;if(validate&&attrs&&attrs.length>1){const sortedAttrs=[];sortedAttrs.map={};const elementRule=schema.getElementRule(node.name);if(elementRule){for(let i=0,l=elementRule.attributesOrder.length;i<l;i++){const attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){const attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}for(let i=0,l=attrs.length;i<l;i++){const attrName=attrs[i].name;if(!(attrName in sortedAttrs.map)){const attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue})}}attrs=sortedAttrs}}if(writer.start(name,attrs,isEmpty),isNonHtmlElementRootName(name))isString(node.value)&&writer.text(node.value,!0),writer.end(name);else if(!isEmpty){let child=node.firstChild;if(child){"pre"!==name&&"textarea"!==name||3!==child.type||"\n"!==(null===(_a=child.value)||void 0===_a?void 0:_a[0])||writer.text("\n",!0);do{walk(child)}while(child=child.next)}writer.end(name)}}};return 1!==node.type||settings.inner?3===node.type?handlers[3](node):handlers[11](node):walk(node),writer.getContent()}}},nonInheritableStyles=new Set;each$e(["margin","margin-left","margin-right","margin-top","margin-bottom","padding","padding-left","padding-right","padding-top","padding-bottom","border","border-width","border-style","border-color","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","float","position","left","right","top","bottom","z-index","display","transform","width","max-width","min-width","height","max-height","min-height","overflow","overflow-x","overflow-y","text-overflow","vertical-align","transition","transition-delay","transition-duration","transition-property","transition-timing-function"],(style=>{nonInheritableStyles.add(style)}));const shorthandStyleProps=["font","text-decoration","text-emphasis"],getStyleProps=(dom,node)=>keys(dom.parseStyle(dom.getAttrib(node,"style"))),hasInheritableStyles=(dom,node)=>forall(getStyleProps(dom,node),(style=>!(style=>nonInheritableStyles.has(style))(style))),hasStyleConflict=(dom,node,parentNode)=>{const nodeStyleProps=getStyleProps(dom,node),parentNodeStyleProps=getStyleProps(dom,parentNode),valueMismatch=prop=>{var _a,_b;const nodeValue=null!==(_a=dom.getStyle(node,prop))&&void 0!==_a?_a:"",parentValue=null!==(_b=dom.getStyle(parentNode,prop))&&void 0!==_b?_b:"";return isNotEmpty(nodeValue)&&isNotEmpty(parentValue)&&nodeValue!==parentValue};return exists(nodeStyleProps,(nodeStyleProp=>{const propExists=props=>exists(props,(prop=>prop===nodeStyleProp));if(!propExists(parentNodeStyleProps)&&propExists(shorthandStyleProps)){const longhandProps=filter$5(parentNodeStyleProps,(style=>exists(shorthandStyleProps,(prop=>startsWith(style,prop)))));return exists(longhandProps,valueMismatch)}return valueMismatch(nodeStyleProp)}))},isChar=(forward,predicate,pos)=>Optional.from(pos.container()).filter(isText$a).exists((text=>{const delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta))})),isBeforeSpace=curry(isChar,!0,isWhiteSpace),isAfterSpace=curry(isChar,!1,isWhiteSpace),isEmptyText=pos=>{const container=pos.container();return isText$a(container)&&(0===container.data.length||isZwsp$1(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode))},matchesElementPosition=(before,predicate)=>pos=>getChildNodeAtRelativeOffset(before?0:-1,pos).filter(predicate).isSome(),isImageBlock=node=>isImg(node)&&"block"===get$7(SugarElement.fromDom(node),"display"),isCefNode=node=>isContentEditableFalse$b(node)&&!(node=>isElement$6(node)&&"all"===node.getAttribute("data-mce-bogus"))(node),isBeforeImageBlock=matchesElementPosition(!0,isImageBlock),isAfterImageBlock=matchesElementPosition(!1,isImageBlock),isBeforeMedia=matchesElementPosition(!0,isMedia$2),isAfterMedia=matchesElementPosition(!1,isMedia$2),isBeforeTable=matchesElementPosition(!0,isTable$2),isAfterTable=matchesElementPosition(!1,isTable$2),isBeforeContentEditableFalse=matchesElementPosition(!0,isCefNode),isAfterContentEditableFalse=matchesElementPosition(!1,isCefNode),parents=(start,root)=>((start,root,predicate)=>contains(root,start)?parents$1(start,(elm=>predicate(elm)||eq(elm,root))).slice(0,-1):[])(start,root,never),parentsAndSelf=(start,root)=>[start].concat(parents(start,root)),navigateIgnoreEmptyTextNodes=(forward,root,from)=>navigateIgnore(forward,root,from,isEmptyText),getClosestBlock$1=(root,pos,schema)=>find$2(parentsAndSelf(SugarElement.fromDom(pos.container()),root),(schema=>el=>schema.isBlock(name(el)))(schema)),isAtBeforeAfterBlockBoundary=(forward,root,pos,schema)=>navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((newPos=>getClosestBlock$1(root,pos,schema).fold((()=>!isInSameBlock(newPos,pos,root.dom)),(fromBlock=>!isInSameBlock(newPos,pos,root.dom)&&contains(fromBlock,SugarElement.fromDom(newPos.container())))))),isAtBlockBoundary=(forward,root,pos,schema)=>getClosestBlock$1(root,pos,schema).fold((()=>navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((newPos=>!isInSameBlock(newPos,pos,root.dom)))),(parent=>navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone())),isAtStartOfBlock=curry(isAtBlockBoundary,!1),isAtEndOfBlock=curry(isAtBlockBoundary,!0),isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,!1),isAfterBlock=curry(isAtBeforeAfterBlockBoundary,!0),isBr$1=pos=>getElementFromPosition(pos).exists(isBr$5),findBr=(forward,root,pos,schema)=>{const parentBlocks=filter$5(parentsAndSelf(SugarElement.fromDom(pos.container()),root),(el=>schema.isBlock(name(el)))),scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr$1)},isBeforeBr$1=(root,pos,schema)=>getElementFromPosition(pos).exists(isBr$5)||findBr(!0,root,pos,schema).isSome(),isAfterBr=(root,pos,schema)=>(pos=>Optional.from(pos.getNode(!0)).map(SugarElement.fromDom))(pos).exists(isBr$5)||findBr(!1,root,pos,schema).isSome(),findPreviousBr=curry(findBr,!1),findNextBr=curry(findBr,!0),isInMiddleOfText=pos=>CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd(),getClosestBlock=(root,pos,schema)=>{const parentBlocks=filter$5(parentsAndSelf(SugarElement.fromDom(pos.container()),root),(el=>schema.isBlock(name(el))));return head(parentBlocks).getOr(root)},hasSpaceBefore=(root,pos,schema)=>isInMiddleOfText(pos)?isAfterSpace(pos):isAfterSpace(pos)||prevPosition(getClosestBlock(root,pos,schema).dom,pos).exists(isAfterSpace),hasSpaceAfter=(root,pos,schema)=>isInMiddleOfText(pos)?isBeforeSpace(pos):isBeforeSpace(pos)||nextPosition(getClosestBlock(root,pos,schema).dom,pos).exists(isBeforeSpace),isInPre=pos=>getElementFromPosition(pos).bind((elm=>closest$4(elm,isElement$7))).exists((elm=>(value=>contains$2(["pre","pre-wrap"],value))(get$7(elm,"white-space")))),isAtLineBoundary=(root,pos,schema)=>((root,pos)=>prevPosition(root.dom,pos).isNone())(root,pos)||((root,pos)=>nextPosition(root.dom,pos).isNone())(root,pos)||isAtStartOfBlock(root,pos,schema)||isAtEndOfBlock(root,pos,schema)||isAfterBr(root,pos,schema)||isBeforeBr$1(root,pos,schema),isSiblingCefBlock=(root,direction)=>container=>{return node=new DomTreeWalker(container,root)[direction](),isNonNullable(node)&&isContentEditableFalse$b(node)&&isBlockLike(node);var node},needsToHaveNbsp=(root,pos,schema)=>!isInPre(pos)&&(isAtLineBoundary(root,pos,schema)||hasSpaceBefore(root,pos,schema)||hasSpaceAfter(root,pos,schema)),needsToBeNbspLeft=(root,pos,schema)=>!isInPre(pos)&&(isAtStartOfBlock(root,pos,schema)||isBeforeBlock(root,pos,schema)||isAfterBr(root,pos,schema)||hasSpaceBefore(root,pos,schema)||((root,pos)=>{const prevPos=prevPosition(root.dom,pos).getOr(pos),isPrevCefBlock=isSiblingCefBlock(root.dom,"prev");return pos.isAtStart()&&(isPrevCefBlock(pos.container())||isPrevCefBlock(prevPos.container()))})(root,pos)),needsToBeNbspRight=(root,pos,schema)=>!isInPre(pos)&&(isAtEndOfBlock(root,pos,schema)||isAfterBlock(root,pos,schema)||isBeforeBr$1(root,pos,schema)||hasSpaceAfter(root,pos,schema)||((root,pos)=>{const nextPos=nextPosition(root.dom,pos).getOr(pos),isNextCefBlock=isSiblingCefBlock(root.dom,"next");return pos.isAtEnd()&&(isNextCefBlock(pos.container())||isNextCefBlock(nextPos.container()))})(root,pos)),needsToBeNbsp=(root,pos,schema)=>needsToBeNbspLeft(root,pos,schema)||needsToBeNbspRight(root,(pos=>{const container=pos.container(),offset=pos.offset();return isText$a(container)&&offset<container.data.length?CaretPosition(container,offset+1):pos})(pos),schema),isNbspAt=(text,offset)=>isNbsp(text.charAt(offset)),isWhiteSpaceAt=(text,offset)=>isWhiteSpace(text.charAt(offset)),normalizeNbspAtStart=(root,node,makeNbsp,schema)=>{const text=node.data,firstPos=CaretPosition(node,0);return makeNbsp||!isNbspAt(text,0)||needsToBeNbsp(root,firstPos,schema)?!!(makeNbsp&&isWhiteSpaceAt(text,0)&&needsToBeNbspLeft(root,firstPos,schema))&&(node.data=" "+text.slice(1),!0):(node.data=" "+text.slice(1),!0)},normalizeNbspInMiddleOfTextNode=node=>{const text=node.data,newText=(text=>{const chars=text.split("");return map$3(chars,((chr,i)=>isNbsp(chr)&&i>0&&i<chars.length-1&&isContent(chars[i-1])&&isContent(chars[i+1])?" ":chr)).join("")})(text);return newText!==text&&(node.data=newText,!0)},normalizeNbspAtEnd=(root,node,makeNbsp,schema)=>{const text=node.data,lastPos=CaretPosition(node,text.length-1);return makeNbsp||!isNbspAt(text,text.length-1)||needsToBeNbsp(root,lastPos,schema)?!!(makeNbsp&&isWhiteSpaceAt(text,text.length-1)&&needsToBeNbspRight(root,lastPos,schema))&&(node.data=text.slice(0,-1)+" ",!0):(node.data=text.slice(0,-1)+" ",!0)},normalizeNbsps=(root,pos,schema)=>{const container=pos.container();if(!isText$a(container))return Optional.none();if((pos=>{const container=pos.container();return isText$a(container)&&contains$1(container.data," ")})(pos)){const normalized=normalizeNbspAtStart(root,container,!1,schema)||normalizeNbspInMiddleOfTextNode(container)||normalizeNbspAtEnd(root,container,!1,schema);return someIf(normalized,pos)}if(needsToBeNbsp(root,pos,schema)){const normalized=normalizeNbspAtStart(root,container,!0,schema)||normalizeNbspAtEnd(root,container,!0,schema);return someIf(normalized,pos)}return Optional.none()},normalize$1=(node,offset,count,schema)=>{if(0===count)return;const elm=SugarElement.fromDom(node),root=ancestor$4(elm,(el=>schema.isBlock(name(el)))).getOr(elm),whitespace=node.data.slice(offset,offset+count),isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length),schema),isStartOfContent=0===offset&&needsToBeNbspLeft(root,CaretPosition(node,0),schema);node.replaceData(offset,count,normalize$4(whitespace,4,isStartOfContent,isEndOfContent))},normalizeWhitespaceAfter=(node,offset,schema)=>{const content=node.data.slice(offset),whitespaceCount=content.length-lTrim(content).length;normalize$1(node,offset,whitespaceCount,schema)},normalizeWhitespaceBefore=(node,offset,schema)=>{const content=node.data.slice(0,offset),whitespaceCount=content.length-rTrim(content).length;normalize$1(node,offset-whitespaceCount,whitespaceCount,schema)},mergeTextNodes=(prevNode,nextNode,schema,normalizeWhitespace,mergeToPrev=!0)=>{const whitespaceOffset=rTrim(prevNode.data).length,newNode=mergeToPrev?prevNode:nextNode,removeNode=mergeToPrev?nextNode:prevNode;return mergeToPrev?newNode.appendData(removeNode.data):newNode.insertData(0,removeNode.data),remove$5(SugarElement.fromDom(removeNode)),normalizeWhitespace&&normalizeWhitespaceAfter(newNode,whitespaceOffset,schema),newNode},reposition=(elm,pos)=>((pos,elm)=>{const container=pos.container(),offset=pos.offset();return!CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()})(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos,getPreviousSiblingCaretPosition=elm=>{return isCaretCandidate$3(elm.previousSibling)?Optional.some((node=elm.previousSibling,isText$a(node)?CaretPosition(node,node.data.length):CaretPosition.after(node))):elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none();var node},getNextSiblingCaretPosition=elm=>{return isCaretCandidate$3(elm.nextSibling)?Optional.some((node=elm.nextSibling,isText$a(node)?CaretPosition(node,0):CaretPosition.before(node))):elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none();var node},findCaretPositionBackwards=(rootElement,elm)=>getPreviousSiblingCaretPosition(elm).orThunk((()=>getNextSiblingCaretPosition(elm))).orThunk((()=>((rootElement,elm)=>Optional.from(elm.previousSibling?elm.previousSibling:elm.parentNode).bind((node=>prevPosition(rootElement,CaretPosition.before(node)))).orThunk((()=>nextPosition(rootElement,CaretPosition.after(elm)))))(rootElement,elm))),findCaretPositionForward=(rootElement,elm)=>getNextSiblingCaretPosition(elm).orThunk((()=>getPreviousSiblingCaretPosition(elm))).orThunk((()=>((rootElement,elm)=>nextPosition(rootElement,CaretPosition.after(elm)).orThunk((()=>prevPosition(rootElement,CaretPosition.before(elm)))))(rootElement,elm))),findCaretPosOutsideElmAfterDelete=(forward,rootElement,elm)=>((forward,rootElement,elm)=>forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm))(forward,rootElement,elm).map(curry(reposition,elm)),setSelection$1=(editor,forward,pos)=>{pos.fold((()=>{editor.focus()}),(pos=>{editor.selection.setRng(pos.toRange(),forward)}))},isBlock=(editor,elm)=>elm&&has$2(editor.schema.getBlockElements(),name(elm)),deleteNormalized=(elm,afterDeletePosOpt,schema,normalizeWhitespace)=>{const prevTextOpt=prevSibling(elm).filter(isText$b),nextTextOpt=nextSibling(elm).filter(isText$b);return remove$5(elm),(oa=prevTextOpt,ob=nextTextOpt,oc=afterDeletePosOpt,f=(prev,next,pos)=>{const prevNode=prev.dom,nextNode=next.dom,offset=prevNode.data.length;return mergeTextNodes(prevNode,nextNode,schema,normalizeWhitespace),pos.container()===nextNode?CaretPosition(prevNode,offset):pos},oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()).orThunk((()=>(normalizeWhitespace&&(prevTextOpt.each((elm=>normalizeWhitespaceBefore(elm.dom,elm.dom.length,schema))),nextTextOpt.each((elm=>normalizeWhitespaceAfter(elm.dom,0,schema)))),afterDeletePosOpt)));var oa,ob,oc,f},deleteElement$2=(editor,forward,elm,moveCaret=!0,preserveEmptyCaret=!1)=>{const afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom),parentBlock=ancestor$4(elm,curry(isBlock,editor),(rawNode=editor.getBody(),elm=>elm.dom===rawNode));var rawNode;const normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,editor.schema,((editor,element)=>has$2(editor.schema.getTextInlineElements(),name(element)))(editor,elm));editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):parentBlock.bind((elm=>((elm,preserveEmptyCaret)=>{if(isEmpty$2(elm)){const br=SugarElement.fromHtml('<br data-mce-bogus="1">');return preserveEmptyCaret?each$e(children$1(elm),(node=>{isEmptyCaretFormatElement(node)||remove$5(node)})):empty(elm),append$1(elm,br),Optional.some(CaretPosition.before(br.dom))}return Optional.none()})(elm,preserveEmptyCaret))).fold((()=>{moveCaret&&setSelection$1(editor,forward,normalizedAfterDeletePos)}),(paddPos=>{moveCaret&&setSelection$1(editor,forward,Optional.some(paddPos))}))},strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,isInlineTarget=(editor,elm)=>is$1(SugarElement.fromDom(elm),getInlineBoundarySelector(editor))&&!isTransparentBlock(editor.schema,elm)&&editor.dom.isEditable(elm),isRtl=element=>{var _a;return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||(text=>strongRtl.test(text))(null!==(_a=element.textContent)&&void 0!==_a?_a:"")},findRootInline=(isInlineTarget,rootNode,pos)=>{const parents=((isInlineTarget,rootNode,pos)=>filter$5(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget))(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1])},normalizePosition=(forward,pos)=>{const container=pos.container(),offset=pos.offset();return forward?isCaretContainerInline(container)?isText$a(container.nextSibling)?CaretPosition(container.nextSibling,0):CaretPosition.after(container):isBeforeInline(pos)?CaretPosition(container,offset+1):pos:isCaretContainerInline(container)?isText$a(container.previousSibling)?CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):isAfterInline(pos)?CaretPosition(container,offset-1):pos},normalizeForwards=curry(normalizePosition,!0),normalizeBackwards=curry(normalizePosition,!1),execCommandIgnoreInputEvents=(editor,command)=>{const inputBlocker=e=>e.stopImmediatePropagation();editor.on("beforeinput input",inputBlocker,!0),editor.getDoc().execCommand(command),editor.off("beforeinput input",inputBlocker)},execNativeDeleteCommand=editor=>execCommandIgnoreInputEvents(editor,"Delete"),isTextBlockOrListItem=element=>isTextBlock$2(element)||isListItem$1(element),getParentBlock$2=(rootNode,elm)=>contains(rootNode,elm)?closest$4(elm,isTextBlockOrListItem,(rootNode=>elm=>is$2(parent(elm),rootNode,eq))(rootNode)):Optional.none(),paddEmptyBody=(editor,moveSelection=!0)=>{editor.dom.isEmpty(editor.getBody())&&editor.setContent("",{no_selection:!moveSelection})},willDeleteLastPositionInElement=(forward,fromPos,elm)=>lift2(firstPositionIn(elm),lastPositionIn(elm),((firstPos,lastPos)=>{const normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos),normalizedFromPos=normalizePosition(!1,fromPos);return forward?nextPosition(elm,normalizedFromPos).exists((nextPos=>nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos))):prevPosition(elm,normalizedFromPos).exists((prevPos=>prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos)))})).getOr(!0),freefallRtl=root=>{var element;return(8===type$1(element=root)||"#comment"===name(element)?prevSibling(root):lastChild(root)).bind(freefallRtl).orThunk((()=>Optional.some(root)))},deleteRangeContents=(editor,rng,root,moveSelection=!0)=>{var _a;rng.deleteContents();const lastNode=freefallRtl(root).getOr(root),lastBlock=SugarElement.fromDom(null!==(_a=editor.dom.getParent(lastNode.dom,editor.dom.isBlock))&&void 0!==_a?_a:root.dom);if(lastBlock.dom===editor.getBody()?paddEmptyBody(editor,moveSelection):isEmpty$2(lastBlock)&&(fillWithPaddingBr(lastBlock),moveSelection&&editor.selection.setCursorLocation(lastBlock.dom,0)),!eq(root,lastBlock)){const additionalCleanupNodes=is$2(parent(lastBlock),root)?[]:parent(element=lastBlock).map(children$1).map((elements=>filter$5(elements,(x=>!eq(element,x))))).getOr([]);each$e(additionalCleanupNodes.concat(children$1(root)),(node=>{eq(node,lastBlock)||contains(node,lastBlock)||!isEmpty$2(node)||remove$5(node)}))}var element},sibling=(scope,predicate)=>((scope,predicate)=>{const element=scope.dom;return element.parentNode?child(SugarElement.fromDom(element.parentNode),(x=>!eq(scope,x)&&predicate(x))):Optional.none()})(scope,predicate).isSome(),descendant=(scope,predicate)=>descendant$2(scope,predicate).isSome(),getTableCells=table=>descendants(table,"td,th"),getTable$1=(node,isRoot)=>getClosestTable(SugarElement.fromDom(node),isRoot),adjustQuirksInDetails=details=>(details=>lift2(details.startTable,details.endTable,((startTable,endTable)=>{const isStartTableParentOfEndTable=descendant(startTable,(t=>eq(t,endTable))),isEndTableParentOfStartTable=descendant(endTable,(t=>eq(t,startTable)));return isStartTableParentOfEndTable||isEndTableParentOfStartTable?{...details,startTable:isStartTableParentOfEndTable?Optional.none():details.startTable,endTable:isEndTableParentOfStartTable?Optional.none():details.endTable,isSameTable:!1,isMultiTable:!1}:details})).getOr(details))(details),tableCellRng=(start,end)=>({start,end}),deleteAction=Adt_generate([{singleCellTable:["rng","cell"]},{fullTable:["table"]},{partialTable:["cells","outsideDetails"]},{multiTable:["startTableCells","endTableCells","betweenRng"]}]),getClosestCell$1=(container,isRoot)=>closest$3(SugarElement.fromDom(container),"td,th",isRoot),isExpandedCellRng=cellRng=>!eq(cellRng.start,cellRng.end),getTableFromCellRng=(cellRng,isRoot)=>getClosestTable(cellRng.start,isRoot).bind((startParentTable=>getClosestTable(cellRng.end,isRoot).bind((endParentTable=>someIf(eq(startParentTable,endParentTable),startParentTable))))),getTableSelectionFromCellRng=isRoot=>cellRng=>getTableFromCellRng(cellRng,isRoot).map((table=>((rng,table,cells)=>({rng,table,cells}))(cellRng,table,getTableCells(table)))),getTableSelections=(cellRng,selectionDetails,rng,isRoot)=>{if(rng.collapsed||!cellRng.forall(isExpandedCellRng))return Optional.none();if(selectionDetails.isSameTable){const sameTableSelection=cellRng.bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:sameTableSelection,end:sameTableSelection})}{const startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot),startTableSelection=startCell.bind((isRoot=>startCell=>getClosestTable(startCell,isRoot).bind((table=>last$3(getTableCells(table)).map((endCell=>tableCellRng(startCell,endCell))))))(isRoot)).bind(getTableSelectionFromCellRng(isRoot)),endTableSelection=endCell.bind((isRoot=>endCell=>getClosestTable(endCell,isRoot).bind((table=>head(getTableCells(table)).map((startCell=>tableCellRng(startCell,endCell))))))(isRoot)).bind(getTableSelectionFromCellRng(isRoot));return Optional.some({start:startTableSelection,end:endTableSelection})}},getCellIndex=(cells,cell)=>findIndex$2(cells,(x=>eq(x,cell))),getSelectedCells=tableSelection=>lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),((startIndex,endIndex)=>tableSelection.cells.slice(startIndex,endIndex+1))),isSingleCellTableContentSelected=(optCellRng,rng,isRoot)=>optCellRng.exists((cellRng=>((cellRng,isRoot)=>!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists((table=>{const rows=table.dom.rows;return 1===rows.length&&1===rows[0].cells.length})))(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng))),unselectCells=(rng,selectionDetails)=>{const{startTable,endTable}=selectionDetails,otherContentRng=rng.cloneRange();return startTable.each((table=>otherContentRng.setStartAfter(table.dom))),endTable.each((table=>otherContentRng.setEndBefore(table.dom))),otherContentRng},getActionFromRange=(root,rng)=>{const isRoot=(root=>cur=>eq(root,cur))(root),optCellRng=((rng,isRoot)=>{const startCell=getClosestCell$1(rng.startContainer,isRoot),endCell=getClosestCell$1(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng)})(rng,isRoot),selectionDetails=((rng,isRoot)=>{const startTable=getTable$1(rng.startContainer,isRoot),endTable=getTable$1(rng.endContainer,isRoot),isStartInTable=startTable.isSome(),isEndInTable=endTable.isSome(),isSameTable=lift2(startTable,endTable,eq).getOr(!1);return adjustQuirksInDetails({startTable,endTable,isStartInTable,isEndInTable,isSameTable,isMultiTable:!isSameTable&&isStartInTable&&isEndInTable})})(rng,isRoot);return isSingleCellTableContentSelected(optCellRng,rng,isRoot)?optCellRng.map((cellRng=>deleteAction.singleCellTable(rng,cellRng.start))):selectionDetails.isMultiTable?((cellRng,selectionDetails,rng,isRoot)=>getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((({start,end})=>{const startTableSelectedCells=start.bind(getSelectedCells).getOr([]),endTableSelectedCells=end.bind(getSelectedCells).getOr([]);if(startTableSelectedCells.length>0&&endTableSelectedCells.length>0){const otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.multiTable(startTableSelectedCells,endTableSelectedCells,otherContentRng))}return Optional.none()})))(optCellRng,selectionDetails,rng,isRoot):((cellRng,selectionDetails,rng,isRoot)=>getTableSelections(cellRng,selectionDetails,rng,isRoot).bind((({start,end})=>start.or(end))).bind((tableSelection=>{const{isSameTable}=selectionDetails,selectedCells=getSelectedCells(tableSelection).getOr([]);if(isSameTable&&tableSelection.cells.length===selectedCells.length)return Optional.some(deleteAction.fullTable(tableSelection.table));if(selectedCells.length>0){if(isSameTable)return Optional.some(deleteAction.partialTable(selectedCells,Optional.none()));{const otherContentRng=unselectCells(rng,selectionDetails);return Optional.some(deleteAction.partialTable(selectedCells,Optional.some({...selectionDetails,rng:otherContentRng})))}}return Optional.none()})))(optCellRng,selectionDetails,rng,isRoot)},cleanCells=cells=>each$e(cells,(cell=>{remove$a(cell,"contenteditable"),fillWithPaddingBr(cell)})),deleteContentInsideCell=(editor,cell,rng,isFirstCellInSelection)=>{const insideTableRng=rng.cloneRange();isFirstCellInSelection?(insideTableRng.setStart(rng.startContainer,rng.startOffset),insideTableRng.setEndAfter(cell.dom.lastChild)):(insideTableRng.setStartBefore(cell.dom.firstChild),insideTableRng.setEnd(rng.endContainer,rng.endOffset)),deleteCellContents(editor,insideTableRng,cell,!1).each((action=>action()))},collapseAndRestoreCellSelection=editor=>{const selectedCells=getCellsFromEditor(editor),selectedNode=SugarElement.fromDom(editor.selection.getNode());isTableCell$3(selectedNode.dom)&&isEmpty$2(selectedNode)?editor.selection.setCursorLocation(selectedNode.dom,0):editor.selection.collapse(!0),selectedCells.length>1&&exists(selectedCells,(cell=>eq(cell,selectedNode)))&&set$3(selectedNode,"data-mce-selected","1")},emptySingleTableCells=(editor,cells,outsideDetails)=>Optional.some((()=>{const editorRng=editor.selection.getRng(),cellsToClean=outsideDetails.bind((({rng,isStartInTable})=>{const outsideBlock=((editor,container)=>Optional.from(editor.dom.getParent(container,editor.dom.isBlock)).map(SugarElement.fromDom))(editor,isStartInTable?rng.endContainer:rng.startContainer);rng.deleteContents(),((editor,startInTable,emptyBlock)=>{emptyBlock.each((block=>{startInTable?remove$5(block):(fillWithPaddingBr(block),editor.selection.setCursorLocation(block.dom,0))}))})(editor,isStartInTable,outsideBlock.filter(isEmpty$2));const endPointCell=isStartInTable?cells[0]:cells[cells.length-1];return deleteContentInsideCell(editor,endPointCell,editorRng,isStartInTable),isEmpty$2(endPointCell)?Optional.none():Optional.some(isStartInTable?cells.slice(1):cells.slice(0,-1))})).getOr(cells);cleanCells(cellsToClean),collapseAndRestoreCellSelection(editor)})),emptyMultiTableCells=(editor,startTableCells,endTableCells,betweenRng)=>Optional.some((()=>{const rng=editor.selection.getRng(),startCell=startTableCells[0],endCell=endTableCells[endTableCells.length-1];deleteContentInsideCell(editor,startCell,rng,!0),deleteContentInsideCell(editor,endCell,rng,!1);const startTableCellsToClean=isEmpty$2(startCell)?startTableCells:startTableCells.slice(1),endTableCellsToClean=isEmpty$2(endCell)?endTableCells:endTableCells.slice(0,-1);cleanCells(startTableCellsToClean.concat(endTableCellsToClean)),betweenRng.deleteContents(),collapseAndRestoreCellSelection(editor)})),deleteCellContents=(editor,rng,cell,moveSelection=!0)=>Optional.some((()=>{deleteRangeContents(editor,rng,cell,moveSelection)})),deleteTableElement=(editor,table)=>Optional.some((()=>deleteElement$2(editor,!1,table))),deleteTableRange=(editor,rootElm,rng,startElm)=>getParentCaption(rootElm,startElm).fold((()=>((editor,rootElm,rng)=>getActionFromRange(rootElm,rng).bind((action=>action.fold(curry(deleteCellContents,editor),curry(deleteTableElement,editor),curry(emptySingleTableCells,editor),curry(emptyMultiTableCells,editor)))))(editor,rootElm,rng)),(caption=>((editor,caption)=>emptyElement(editor,caption))(editor,caption))),getParentCell=(rootElm,elm)=>find$2(parentsAndSelf(elm,rootElm),isTableCell$2),getParentCaption=(rootElm,elm)=>find$2(parentsAndSelf(elm,rootElm),isTag("caption")),emptyElement=(editor,elm)=>Optional.some((()=>{fillWithPaddingBr(elm),editor.selection.setCursorLocation(elm.dom,0)})),deleteCaretInsideCaption=(editor,rootElm,forward,fromCaption,from)=>navigate(forward,editor.getBody(),from).fold((()=>Optional.some(noop)),(to=>((fromCaption,forward,from,to)=>firstPositionIn(fromCaption.dom).bind((first=>lastPositionIn(fromCaption.dom).map((last=>forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first))))).getOr(!0))(fromCaption,forward,from,to)?((editor,elm)=>emptyElement(editor,elm))(editor,fromCaption):((rootElm,fromCaption,to)=>getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).fold((()=>Optional.some(noop)),(toCaption=>someIf(!eq(toCaption,fromCaption),noop))))(rootElm,fromCaption,to))),deleteCaretCells=(editor,forward,rootElm,startElm)=>{const from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind((fromCell=>isEmpty$2(fromCell)?emptyElement(editor,fromCell):((editor,rootElm,forward,fromCell,from)=>navigate(forward,editor.getBody(),from).bind((to=>getParentCell(rootElm,SugarElement.fromDom(to.getNode())).bind((toCell=>eq(toCell,fromCell)?Optional.none():Optional.some(noop))))))(editor,rootElm,forward,fromCell,from)))},isNearTable=(forward,pos)=>forward?isBeforeTable(pos):isAfterTable(pos),deleteCaret$3=(editor,forward,startElm)=>{const rootElm=SugarElement.fromDom(editor.getBody());return getParentCaption(rootElm,startElm).fold((()=>deleteCaretCells(editor,forward,rootElm,startElm).orThunk((()=>someIf(((editor,forward)=>{const fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists((pos=>isNearTable(forward,pos)))})(editor,forward),noop)))),(fromCaption=>((editor,forward,rootElm,fromCaption)=>{const from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty$2(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from)})(editor,forward,rootElm,fromCaption)))},backspaceDelete$a=(editor,forward)=>{const startElm=SugarElement.fromDom(editor.selection.getStart(!0)),cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&0===cells.length?deleteCaret$3(editor,forward,startElm):((editor,startElm,selectedCells)=>{const rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return 0!==selectedCells.length?emptySingleTableCells(editor,selectedCells,Optional.none()):deleteTableRange(editor,rootNode,rng,startElm)})(editor,startElm,cells)},getContentEditableRoot$1=(root,node)=>{let tempNode=node;for(;tempNode&&tempNode!==root;){if(isContentEditableTrue$3(tempNode)||isContentEditableFalse$b(tempNode))return tempNode;tempNode=tempNode.parentNode}return null},internalAttributesPrefixes=["data-ephox-","data-mce-","data-alloy-","data-snooker-","_"],each$9=Tools.each,ElementUtils=editor=>{const dom=editor.dom,internalAttributes=new Set(editor.serializer.getTempAttrs()),isAttributeInternal=attributeName=>exists(internalAttributesPrefixes,(value=>startsWith(attributeName,value)))||internalAttributes.has(attributeName);return{compare:(node1,node2)=>{if(node1.nodeName!==node2.nodeName||node1.nodeType!==node2.nodeType)return!1;const getAttribs=node=>{const attribs={};return each$9(dom.getAttribs(node),(attr=>{const name=attr.nodeName.toLowerCase();"style"===name||isAttributeInternal(name)||(attribs[name]=dom.getAttrib(node,name))})),attribs},compareObjects=(obj1,obj2)=>{for(const name in obj1)if(has$2(obj1,name)){const value=obj2[name];if(isUndefined(value))return!1;if(obj1[name]!==value)return!1;delete obj2[name]}for(const name in obj2)if(has$2(obj2,name))return!1;return!0};if(isElement$6(node1)&&isElement$6(node2)){if(!compareObjects(getAttribs(node1),getAttribs(node2)))return!1;if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style"))))return!1}return!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2)},isAttributeInternal}},isHeading=node=>["h1","h2","h3","h4","h5","h6"].includes(node.name),matchNode$1=(nodeFilters,attributeFilters,node,matches)=>{const name=node.name;for(let ni=0,nl=nodeFilters.length;ni<nl;ni++){const filter=nodeFilters[ni];if(filter.name===name){const match=matches.nodes[name];match?match.nodes.push(node):matches.nodes[name]={filter,nodes:[node]}}}if(node.attributes)for(let ai=0,al=attributeFilters.length;ai<al;ai++){const filter=attributeFilters[ai],attrName=filter.name;if(attrName in node.attributes.map){const match=matches.attributes[attrName];match?match.nodes.push(node):matches.attributes[attrName]={filter,nodes:[node]}}}},runFilters=(matches,args)=>{const run=(matchRecord,filteringAttributes)=>{each$d(matchRecord,(match=>{const nodes=from(match.nodes);each$e(match.filter.callbacks,(callback=>{for(let i=nodes.length-1;i>=0;i--){const node=nodes[i];(filteringAttributes?void 0!==node.attr(match.filter.name):node.name===match.filter.name)&&!isNullable(node.parent)||nodes.splice(i,1)}nodes.length>0&&callback(nodes,match.filter.name,args)}))}))};run(matches.nodes,!1),run(matches.attributes,!0)},filter$2=(nodeFilters,attributeFilters,node,args={})=>{const matches=((nodeFilters,attributeFilters,node)=>{const matches={nodes:{},attributes:{}};return node.firstChild&&((root,fn)=>{let node=root;for(;node=node.walk();)fn(node)})(node,(childNode=>{matchNode$1(nodeFilters,attributeFilters,childNode,matches)})),matches})(nodeFilters,attributeFilters,node);runFilters(matches,args)},paddEmptyNode=(settings,args,isBlock,node)=>{if((settings.pad_empty_with_br||args.insert)&&isBlock(node)){const astNode=new AstNode("br",1);args.insert&&astNode.attr("data-mce-bogus","1"),node.empty().append(astNode)}else node.empty().append(new AstNode("#text",3)).value=" "},hasOnlyChild=(node,name)=>{const firstChild=null==node?void 0:node.firstChild;return isNonNullable(firstChild)&&firstChild===node.lastChild&&firstChild.name===name},isEmpty=(schema,nonEmptyElements,whitespaceElements,node)=>node.isEmpty(nonEmptyElements,whitespaceElements,(node=>((schema,node)=>{const rule=schema.getElementRule(node.name);return!0===(null==rule?void 0:rule.paddEmpty)})(schema,node))),findClosestEditingHost=scope=>{let editableNode;for(let node=scope;node;node=node.parent){const contentEditable=node.attr("contenteditable");if("false"===contentEditable)break;"true"===contentEditable&&(editableNode=node)}return Optional.from(editableNode)},removeOrUnwrapInvalidNode=(node,schema,originalNodeParent=node.parent)=>{if(schema.getSpecialElements()[node.name])node.empty().remove();else{const children=node.children();for(const childNode of children)originalNodeParent&&!schema.isValidChild(originalNodeParent.name,childNode.name)&&removeOrUnwrapInvalidNode(childNode,schema,originalNodeParent);node.unwrap()}},cleanInvalidNodes=(nodes,schema,rootNode,onCreate=noop)=>{const textBlockElements=schema.getTextBlockElements(),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhitespaceElements(),nonSplittableElements=Tools.makeMap("tr,td,th,tbody,thead,tfoot,table,summary"),fixed=new Set,isSplittableElement=node=>node!==rootNode&&!nonSplittableElements[node.name];for(let ni=0;ni<nodes.length;ni++){const node=nodes[ni];let parent,newParent,tempNode;if(!node.parent||fixed.has(node))continue;if(textBlockElements[node.name]&&"li"===node.parent.name){let sibling=node.next;for(;sibling&&textBlockElements[sibling.name];)sibling.name="li",fixed.add(sibling),node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap();continue}const parents=[node];for(parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&isSplittableElement(parent);parent=parent.parent)parents.push(parent);if(parent&&parents.length>1)if(isInvalid(schema,node,parent))removeOrUnwrapInvalidNode(node,schema);else{parents.reverse(),newParent=parents[0].clone(),onCreate(newParent);let currentNode=newParent;for(let i=0;i<parents.length-1;i++){schema.isValidChild(currentNode.name,parents[i].name)&&i>0?(tempNode=parents[i].clone(),onCreate(tempNode),currentNode.append(tempNode)):tempNode=currentNode;for(let childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];){const nextNode=childNode.next;tempNode.append(childNode),childNode=nextNode}currentNode=tempNode}isEmpty(schema,nonEmptyElements,whitespaceElements,newParent)?parent.insert(node,parents[0],!0):(parent.insert(newParent,parents[0],!0),parent.insert(node,newParent)),parent=parents[0],(isEmpty(schema,nonEmptyElements,whitespaceElements,parent)||hasOnlyChild(parent,"br"))&&parent.empty().remove()}else if(node.parent){if("li"===node.name){let sibling=node.prev;if(sibling&&("ul"===sibling.name||"ol"===sibling.name)){sibling.append(node);continue}if(sibling=node.next,sibling&&("ul"===sibling.name||"ol"===sibling.name)&&sibling.firstChild){sibling.insert(node,sibling.firstChild,!0);continue}const wrapper=new AstNode("ul",1);onCreate(wrapper),node.wrap(wrapper);continue}if(schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)){const wrapper=new AstNode("div",1);onCreate(wrapper),node.wrap(wrapper)}else removeOrUnwrapInvalidNode(node,schema)}}},isInvalid=(schema,node,parent=node.parent)=>!!parent&&(!(!schema.children[node.name]||schema.isValidChild(parent.name,node.name))||(!("a"!==node.name||!((node,parentName)=>{let tempNode=node;for(;tempNode;){if(tempNode.name===parentName)return!0;tempNode=tempNode.parent}return!1})(parent,"a"))||!(!(node=>"summary"===node.name)(parent)||!isHeading(node))&&!((null==parent?void 0:parent.firstChild)===node&&(null==parent?void 0:parent.lastChild)===node))),normalizeBlockSelectionRange=rng=>{const startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return fromPosition(!1,rootNode,endPos).map((newEndPos=>!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)?((sc,so,ec,eo)=>{const rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng})(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng)).getOr(rng)},normalize=rng=>rng.collapsed?rng:normalizeBlockSelectionRange(rng),isPaddedEmptyBlock=(schema,node)=>schema.getBlockElements()[node.name]&&(node=>isNonNullable(node.firstChild)&&node.firstChild===node.lastChild)(node)&&(node=>"br"===node.name||" "===node.value)(node.firstChild),isListFragment=(schema,fragment)=>{let firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),((schema,node)=>{const nonEmptyElements=schema.getNonEmptyElements();return isNonNullable(node)&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node))})(schema,lastChild)&&(lastChild=null==lastChild?void 0:lastChild.prev),!(!firstChild||firstChild!==lastChild)&&("ul"===firstChild.name||"ol"===firstChild.name)},isListItemPadded=node=>isNonNullable(null==node?void 0:node.firstChild)&&node.firstChild===node.lastChild&&(node=>" "===node.data||isBr$6(node))(node.firstChild),trimListItems=elms=>{return elms.length>0&&(!(elm=elms[elms.length-1]).firstChild||isListItemPadded(elm))?elms.slice(0,-1):elms;var elm},getParentLi=(dom,node)=>{const parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},findLastOf=(node,rootNode)=>{const caretPos=CaretPosition.after(node),newCaretPos=CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertBefore$2=(target,elms,rootNode)=>{const parentElm=target.parentNode;return parentElm&&Tools.each(elms,(elm=>{parentElm.insertBefore(elm,target)})),((node,rootNode)=>{const caretPos=CaretPosition.before(node),newCaretPos=CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null})(target,rootNode)},insertAtCaret$1=(serializer,dom,rng,fragment)=>{const domFragment=((dom,serializer,fragment)=>{const html=serializer.serialize(fragment);return(domFragment=>{var _a,_b;const firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&(null===(_a=firstChild.parentNode)||void 0===_a||_a.removeChild(firstChild)),lastChild&&"mce_marker"===lastChild.id&&(null===(_b=lastChild.parentNode)||void 0===_b||_b.removeChild(lastChild)),domFragment})(dom.createFragment(html))})(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems((elm=domFragment.firstChild,filter$5(null!==(_a=null==elm?void 0:elm.childNodes)&&void 0!==_a?_a:[],(child=>"LI"===child.nodeName))));var elm,_a;const rootNode=dom.getRoot(),isAt=location=>{const caretPos=CaretPosition.fromRangeStart(rng),caretWalker=CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos),newPosNode=null==newPos?void 0:newPos.getNode();return!newPosNode||getParentLi(dom,newPosNode)!==liTarget};return liTarget?isAt(1)?insertBefore$2(liTarget,liElms,rootNode):isAt(2)?((target,elms,rootNode,dom)=>(dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)))(liTarget,liElms,rootNode,dom):((target,elms,rootNode,rng)=>{const parts=((parentNode,rng)=>{const beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]})(target,rng),parentElm=target.parentNode;return parentElm&&(parentElm.insertBefore(parts[0],target),Tools.each(elms,(li=>{parentElm.insertBefore(li,target)})),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target)),findLastOf(elms[elms.length-1],rootNode)})(liTarget,liElms,rootNode,rng):null},mergeableWrappedElements=["pre"],isTableCell=isTableCell$3,trimBrsFromTableCell=(dom,elm,schema)=>{Optional.from(dom.getParent(elm,"td,th")).map(SugarElement.fromDom).each((el=>((elm,schema)=>{lastChild(elm).each((lastChild=>{prevSibling(lastChild).each((lastChildPrevSibling=>{schema.isBlock(name(elm))&&isBr$5(lastChild)&&schema.isBlock(name(lastChildPrevSibling))&&remove$5(lastChild)}))}))})(el,schema)))},moveSelectionToMarker=(editor,marker)=>{var _a,_b,_c;let nextRng;const dom=editor.dom,selection=editor.selection;if(!marker)return;selection.scrollIntoView(marker);const parentEditableElm=getContentEditableRoot$1(editor.getBody(),marker);if(parentEditableElm&&"false"===dom.getContentEditable(parentEditableElm))return dom.remove(marker),void selection.select(parentEditableElm);let rng=dom.createRng();const node=marker.previousSibling;if(isText$a(node)){rng.setStart(node,null!==(_b=null===(_a=node.nodeValue)||void 0===_a?void 0:_a.length)&&void 0!==_b?_b:0);const node2=marker.nextSibling;isText$a(node2)&&(node.appendData(node2.data),null===(_c=node2.parentNode)||void 0===_c||_c.removeChild(node2))}else rng.setStartBefore(marker),rng.setEndBefore(marker);const parentBlock=dom.getParent(marker,dom.isBlock);if(dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)){const isCell=isTableCell(parentBlock);empty(SugarElement.fromDom(parentBlock)),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isCell||(node=>!!node.getAttribute("data-mce-fragment"))(parentBlock)||!(nextRng=(rng=>{let caretPos=CaretPosition.fromRangeStart(rng);return caretPos=CaretWalker(editor.getBody()).next(caretPos),null==caretPos?void 0:caretPos.toRange()})(rng))?dom.add(parentBlock,dom.create("br",isCell?{}:{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))}selection.setRng(rng)},deleteSelectedContent=editor=>{const dom=editor.dom,rng=normalize(editor.selection.getRng());editor.selection.setRng(rng);const startCell=dom.getParent(rng.startContainer,isTableCell);((dom,rng,cell)=>{if(isNonNullable(cell))return cell===dom.getParent(rng.endContainer,isTableCell)&&hasAllContentsSelected(SugarElement.fromDom(cell),rng);return!1})(dom,rng,startCell)?deleteCellContents(editor,rng,SugarElement.fromDom(startCell)):rng.startContainer===rng.endContainer&&rng.endOffset-rng.startOffset==1&&isText$a(rng.startContainer.childNodes[rng.startOffset])?rng.deleteContents():editor.getDoc().execCommand("Delete",!1)},insertHtmlAtCaret=(editor,value,details)=>{var _a,_b;const selection=editor.selection,dom=editor.dom,parser=editor.parser,merge=details.merge,serializer=HtmlSerializer({validate:!0},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>';details.preserve_zwsp||(value=trim$2(value)),-1===value.indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);let rng=selection.getRng();const caretElement=rng.startContainer,body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&((editor,node)=>isNonNullable(node)&&!editor.schema.getVoidElements()[node.nodeName])(editor,body.firstChild)&&dom.isEmpty(body.firstChild)&&(rng=dom.createRng(),rng.setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||deleteSelectedContent(editor);const parentNode=selection.getNode(),parserArgs={context:parentNode.nodeName.toLowerCase(),data:details.data,insert:!0},fragment=parser.parse(value,parserArgs);if(!0===details.paste&&isListFragment(editor.schema,fragment)&&((dom,node)=>!!getParentLi(dom,node))(dom,parentNode))return rng=insertAtCaret$1(serializer,dom,selection.getRng(),fragment),rng&&selection.setRng(rng),value;!0===details.paste&&((dom,fragment,parentNode,root)=>{var _a;const firstNode=fragment.firstChild,lastNode=fragment.lastChild,isPastingSingleElement=firstNode===("bookmark"===lastNode.attr("data-mce-type")?lastNode.prev:lastNode),isWrappedElement=contains$2(mergeableWrappedElements,firstNode.name);if(isPastingSingleElement&&isWrappedElement){const isContentEditable="false"!==firstNode.attr("contenteditable"),isPastingInTheSameBlockTag=(null===(_a=dom.getParent(parentNode,dom.isBlock))||void 0===_a?void 0:_a.nodeName.toLowerCase())===firstNode.name,isPastingInContentEditable=Optional.from(getContentEditableRoot$1(root,parentNode)).forall(isContentEditableTrue$3);return isContentEditable&&isPastingInTheSameBlockTag&&isPastingInContentEditable}return!1})(dom,fragment,parentNode,editor.getBody())&&(null===(_a=fragment.firstChild)||void 0===_a||_a.unwrap()),(fragment=>{let node=fragment;for(;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")})(fragment);let node=fragment.lastChild;if(node&&"mce_marker"===node.attr("id")){const marker=node;for(node=node.prev;node;node=node.walk(!0))if(3===node.type||!dom.isBlock(node.name)){node.parent&&editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid||((dom,node,fragment)=>{var _a;return exists(fragment.children(),isHeading)&&"SUMMARY"===(null===(_a=dom.getParent(node,dom.isBlock))||void 0===_a?void 0:_a.nodeName)})(dom,parentNode,fragment)){editor.selection.setContent(bookmarkHtml);let tempNode,parentNode=selection.getNode();const rootNode=editor.getBody();for(isDocument$1(parentNode)?parentNode=tempNode=rootNode:tempNode=parentNode;tempNode&&tempNode!==rootNode;)parentNode=tempNode,tempNode=tempNode.parentNode;value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode);const root=parser.parse(value),markerNode=(scope=>{for(let markerNode=scope;markerNode;markerNode=markerNode.walk())if("mce_marker"===markerNode.attr("id"))return Optional.some(markerNode);return Optional.none()})(root),editingHost=markerNode.bind(findClosestEditingHost).getOr(root);markerNode.each((marker=>marker.replace(fragment)));const toExtract=fragment.children(),parent=null!==(_b=fragment.parent)&&void 0!==_b?_b:root;fragment.unwrap();const invalidChildren=filter$5(toExtract,(node=>isInvalid(editor.schema,node,parent)));cleanInvalidNodes(invalidChildren,editor.schema,editingHost),filter$2(parser.getNodeFilters(),parser.getAttributeFilters(),root),value=serializer.serialize(root),parentNode===rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else value=serializer.serialize(fragment),((editor,value,parentNode)=>{var _a;if("all"===parentNode.getAttribute("data-mce-bogus"))null===(_a=parentNode.parentNode)||void 0===_a||_a.insertBefore(editor.dom.createFragment(value),parentNode);else{const node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value,{no_events:!0})}})(editor,value,parentNode);var elm;return((editor,merge)=>{const textInlineElements=editor.schema.getTextInlineElements(),dom=editor.dom;if(merge){const root=editor.getBody(),elementUtils=ElementUtils(editor);Tools.each(dom.select("*[data-mce-fragment]"),(node=>{if(isNonNullable(textInlineElements[node.nodeName.toLowerCase()])&&hasInheritableStyles(dom,node))for(let parentNode=node.parentElement;isNonNullable(parentNode)&&parentNode!==root&&!hasStyleConflict(dom,node,parentNode);parentNode=parentNode.parentElement)if(elementUtils.compare(parentNode,node)){dom.remove(node,!0);break}}))}})(editor,merge),moveSelectionToMarker(editor,dom.get("mce_marker")),elm=editor.getBody(),Tools.each(elm.getElementsByTagName("*"),(elm=>{elm.removeAttribute("data-mce-fragment")})),trimBrsFromTableCell(dom,selection.getStart(),editor.schema),((schema,root,caretParent)=>{const parents=parents$1(SugarElement.fromDom(caretParent),(el=>eq(el,SugarElement.fromDom(root))));get$b(parents,parents.length-2).filter(isElement$7).fold((()=>updateChildren(schema,root)),(scope=>updateChildren(schema,scope.dom)))})(editor.schema,editor.getBody(),selection.getStart()),value},isTreeNode=content=>content instanceof AstNode,setEditorHtml=(editor,html,noSelection)=>{editor.dom.setHTML(editor.getBody(),html),!0!==noSelection&&(editor=>{hasFocus(editor)&&firstPositionIn(editor.getBody()).each((pos=>{const node=pos.getNode(),caretPos=isTable$2(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange())}))})(editor)},setContentInternal=(editor,content,args)=>Optional.from(editor.getBody()).map((body=>isTreeNode(content)?((editor,body,content,args)=>{filter$2(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);const html=HtmlSerializer({validate:!1},editor.schema).serialize(content),trimmedHtml=trim$2(isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html));return setEditorHtml(editor,trimmedHtml,args.no_selection),{content,html:trimmedHtml}})(editor,body,content,args):((editor,body,content,args)=>{if(0===(content=trim$2(content)).length||/^\s+$/.test(content)){const padd='<br data-mce-bogus="1">';"TABLE"===body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>");const forcedRootBlockName=getForcedRootBlock(editor);return editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content)):content||(content=padd),setEditorHtml(editor,content,args.no_selection),{content,html:content}}{"raw"!==args.format&&(content=HtmlSerializer({validate:!1},editor.schema).serialize(editor.parser.parse(content,{isRootContent:!0,insert:!0})));const trimmedHtml=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content);return setEditorHtml(editor,trimmedHtml,args.no_selection),{content:trimmedHtml,html:trimmedHtml}}})(editor,body,content,args))).getOr({content,html:isTreeNode(args.content)?"":args.content}),ensureIsRoot=isRoot=>isFunction(isRoot)?isRoot:never,closest$1=(scope,transform,isRoot)=>{const current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((()=>stop(scope)?Optional.none():((scope,transform,isRoot)=>{let element=scope.dom;const stop=ensureIsRoot(isRoot);for(;element.parentNode;){element=element.parentNode;const el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()})(scope,transform,stop)))},isEq$3=isEq$5,matchesUnInheritedFormatSelector=(ed,node,name)=>{const formatList=ed.formatter.get(name);if(formatList)for(let i=0;i<formatList.length;i++){const format=formatList[i];if(isSelectorFormat(format)&&!1===format.inherit&&ed.dom.is(node,format.selector))return!0}return!1},matchParents=(editor,node,name,vars,similar)=>{const root=editor.dom.getRoot();if(node===root)return!1;const matchedNode=editor.dom.getParent(node,(elm=>!!matchesUnInheritedFormatSelector(editor,elm,name)||(elm.parentNode===root||!!matchNode(editor,elm,name,vars,!0))));return!!matchNode(editor,matchedNode,name,vars,similar)},matchName=(dom,node,format)=>!(!isInlineFormat(format)||!isEq$3(node,format.inline))||(!(!isBlockFormat(format)||!isEq$3(node,format.block))||!!isSelectorFormat(format)&&(isElement$6(node)&&dom.is(node,format.selector))),matchItems=(dom,node,format,itemName,similar,vars)=>{const items=format[itemName],matchAttributes="attributes"===itemName;if(isFunction(format.onmatch))return format.onmatch(node,format,itemName);if(items)if(isArrayLike(items)){for(let i=0;i<items.length;i++)if(matchAttributes?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i]))return!0}else for(const key in items)if(has$2(items,key)){const value=matchAttributes?dom.getAttrib(node,key):getStyle(dom,node,key),expectedValue=replaceVars(items[key],vars),isEmptyValue=isNullable(value)||isEmpty$3(value);if(isEmptyValue&&isNullable(expectedValue))continue;if(similar&&isEmptyValue&&!format.exact)return!1;if((!similar||format.exact)&&!isEq$3(value,normalizeStyleValue(expectedValue,key)))return!1}return!0},matchNode=(ed,node,name,vars,similar)=>{const formatList=ed.formatter.get(name),dom=ed.dom;if(formatList&&isElement$6(node))for(let i=0;i<formatList.length;i++){const format=formatList[i];if(matchName(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){const classes=format.classes;if(classes)for(let x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,replaceVars(classes[x],vars)))return;return format}}},match$2=(editor,name,vars,node,similar)=>{if(node)return matchParents(editor,node,name,vars,similar);if(node=editor.selection.getNode(),matchParents(editor,node,name,vars,similar))return!0;const startNode=editor.selection.getStart();return!(startNode===node||!matchParents(editor,startNode,name,vars,similar))},closest=(editor,names)=>{const isRoot=elm=>eq(elm,SugarElement.fromDom(editor.getBody()));return Optional.from(editor.selection.getStart(!0)).bind((rawElm=>closest$1(SugarElement.fromDom(rawElm),(elm=>findMap(names,(name=>((elm,name)=>matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none())(elm,name)))),isRoot))).getOrNull()},matchAllOnNode=(editor,node,formatNames)=>foldl(formatNames,((acc,name)=>{const matchSimilar=((editor,formatName)=>isFormatPredicate(editor,formatName,(format=>{const isVariableValue=val=>isFunction(val)||val.length>1&&"%"===val.charAt(0);return exists(["styles","attributes"],(key=>get$a(format,key).exists((field=>{const fieldValues=isArray$1(field)?field:values(field);return exists(fieldValues,isVariableValue)}))))})))(editor,name);return editor.formatter.matchNode(node,name,{},matchSimilar)?acc.concat([name]):acc}),[]),findFirstTextNode=node=>{if(node){const walker=new DomTreeWalker(node,node);for(let tempNode=walker.current();tempNode;tempNode=walker.next())if(isText$a(tempNode))return tempNode}return null},createCaretContainer=fill=>{const caretContainer=SugarElement.fromTag("span");return setAll$1(caretContainer,{id:"_mce_caret","data-mce-bogus":"1","data-mce-type":"format-caret"}),fill&&append$1(caretContainer,SugarElement.fromText("\ufeff")),caretContainer},removeCaretContainerNode=(editor,node,moveCaret)=>{const dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node))deleteElement$2(editor,!1,SugarElement.fromDom(node),moveCaret,!0);else{const rng=selection.getRng(),block=dom.getParent(node,dom.isBlock),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,textNode=(caretContainerNode=>{const textNode=findFirstTextNode(caretContainerNode);return textNode&&"\ufeff"===textNode.data.charAt(0)&&textNode.deleteData(0,1),textNode})(node);dom.remove(node,!0),startContainer===textNode&&startOffset>0&&rng.setStart(textNode,startOffset-1),endContainer===textNode&&endOffset>0&&rng.setEnd(textNode,endOffset-1),block&&dom.isEmpty(block)&&fillWithPaddingBr(SugarElement.fromDom(block)),selection.setRng(rng)}},removeCaretContainer=(editor,node,moveCaret)=>{const dom=editor.dom,selection=editor.selection;if(node)removeCaretContainerNode(editor,node,moveCaret);else if(!(node=getParentCaretContainer(editor.getBody(),selection.getStart())))for(;node=dom.get("_mce_caret");)removeCaretContainerNode(editor,node,moveCaret)},appendNode=(parentNode,node)=>(parentNode.appendChild(node),node),insertFormatNodesIntoCaretContainer=(formatNodes,caretContainer)=>{var _a;const innerMostFormatNode=foldr(formatNodes,((parentNode,formatNode)=>appendNode(parentNode,formatNode.cloneNode(!1))),caretContainer),doc=null!==(_a=innerMostFormatNode.ownerDocument)&&void 0!==_a?_a:document;return appendNode(innerMostFormatNode,doc.createTextNode("\ufeff"))},removeCaretFormat=(editor,name,vars,similar)=>{const dom=editor.dom,selection=editor.selection;let hasContentAfter=!1;const formatList=editor.formatter.get(name);if(!formatList)return;const rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset;let node=container;isText$a(container)&&(offset!==container.data.length&&(hasContentAfter=!0),node=node.parentNode);const parents=[];let formatNode;for(;node;){if(matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter){const bookmark=selection.getBookmark();rng.collapse(!0);let expandedRng=expandRng(dom,rng,formatList,!0);expandedRng=split(expandedRng),editor.formatter.remove(name,vars,expandedRng,similar),selection.moveToBookmark(bookmark)}else{const caretContainer=getParentCaretContainer(editor.getBody(),formatNode),parentsAfter=isNonNullable(caretContainer)?dom.getParents(formatNode.parentNode,always,caretContainer):[],newCaretContainer=createCaretContainer(!1).dom;((editor,caretContainer,formatNode)=>{var _a,_b;const dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor.schema));block&&dom.isEmpty(block)?null===(_a=formatNode.parentNode)||void 0===_a||_a.replaceChild(caretContainer,formatNode):(removeTrailingBr(SugarElement.fromDom(formatNode)),dom.isEmpty(formatNode)?null===(_b=formatNode.parentNode)||void 0===_b||_b.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))})(editor,newCaretContainer,null!=caretContainer?caretContainer:formatNode);const cleanedFormatNode=((editor,caretContainer,formatNode,name,vars,similar)=>{const formatter=editor.formatter,dom=editor.dom,validFormats=filter$5(keys(formatter.get()),(formatName=>formatName!==name&&!contains$1(formatName,"removeformat"))),matchedFormats=matchAllOnNode(editor,formatNode,validFormats);if(filter$5(matchedFormats,(fmtName=>!areSimilarFormats(editor,fmtName,name))).length>0){const clonedFormatNode=formatNode.cloneNode(!1);return dom.add(caretContainer,clonedFormatNode),formatter.remove(name,vars,clonedFormatNode,similar),dom.remove(clonedFormatNode),Optional.some(clonedFormatNode)}return Optional.none()})(editor,newCaretContainer,formatNode,name,vars,similar),caretTextNode=insertFormatNodesIntoCaretContainer([...parents,...cleanedFormatNode.toArray(),...parentsAfter],newCaretContainer);caretContainer&&removeCaretContainerNode(editor,caretContainer,isNonNullable(caretContainer)),selection.setCursorLocation(caretTextNode,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}},setup$v=editor=>{editor.on("mouseup keydown",(e=>{var element;((editor,keyCode,moveCaret)=>{const selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,moveCaret),8!==keyCode&&46!==keyCode||!selection.isCollapsed()||"\ufeff"!==selection.getStart().innerHTML||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()),!0),37!==keyCode&&39!==keyCode||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()),!0)})(editor,e.keyCode,(element=editor.selection.getRng().endContainer,isText$a(element)&&endsWith(element.data," ")))}))},createCaretFormat=formatNodes=>{const caretContainer=createCaretContainer(!1),innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return{caretContainer,caretPosition:CaretPosition(innerMost,0)}},replaceWithCaretFormat=(targetNode,formatNodes)=>{const{caretContainer,caretPosition}=createCaretFormat(formatNodes);return before$3(SugarElement.fromDom(targetNode),caretContainer),remove$5(SugarElement.fromDom(targetNode)),caretPosition},isFormatElement=(editor,element)=>{if(isCaretNode(element.dom))return!1;const inlineElements=editor.schema.getTextInlineElements();return has$2(inlineElements,name(element))&&!isCaretNode(element.dom)&&!isBogus$2(element.dom)},postProcessHooks={},isPre=matchNodeNames(["pre"]);((name,hook)=>{postProcessHooks[name]||(postProcessHooks[name]=[]),postProcessHooks[name].push(hook)})("pre",(editor=>{const rng=editor.selection.getRng();if(!rng.collapsed){const blocks=editor.selection.getSelectedBlocks(),preBlocks=filter$5(filter$5(blocks,isPre),(blocks=>pre=>{const prev=pre.previousSibling;return isPre(prev)&&contains$2(blocks,prev)})(blocks));each$e(preBlocks,(pre=>{((pre1,pre2)=>{const sPre2=SugarElement.fromDom(pre2),doc=documentOrOwner(sPre2).dom;remove$5(sPre2),append(SugarElement.fromDom(pre1),[SugarElement.fromTag("br",doc),SugarElement.fromTag("br",doc),...children$1(sPre2)])})(pre.previousSibling,pre)}))}}));const listItemStyles=["fontWeight","fontStyle","color","fontSize","fontFamily"],findExpandedListItemFormat=formats=>find$2(formats,(fmt=>isInlineFormat(fmt)&&"span"===fmt.inline&&(fmt=>isObject(fmt.styles)&&exists(keys(fmt.styles),(name=>contains$2(listItemStyles,name))))(fmt))),getExpandedListItemFormat=(formatter,format)=>{const formatList=formatter.get(format);return isArray$1(formatList)?findExpandedListItemFormat(formatList):Optional.none()},isRngStartAtStartOfElement=(rng,elm)=>prevPosition(elm,CaretPosition.fromRangeStart(rng)).isNone(),isRngEndAtEndOfElement=(rng,elm)=>!1===nextPosition(elm,CaretPosition.fromRangeEnd(rng)).exists((pos=>!isBr$6(pos.getNode())||nextPosition(elm,pos).isSome())),isEditableListItem=dom=>elm=>isListItem$2(elm)&&dom.isEditable(elm),getFullySelectedListItems=selection=>filter$5((selection=>{const blocks=selection.getSelectedBlocks(),rng=selection.getRng();if(selection.isCollapsed())return[];if(1===blocks.length)return isRngStartAtStartOfElement(rng,blocks[0])&&isRngEndAtEndOfElement(rng,blocks[0])?blocks:[];{const first=head(blocks).filter((elm=>isRngStartAtStartOfElement(rng,elm))).toArray(),last=last$3(blocks).filter((elm=>isRngEndAtEndOfElement(rng,elm))).toArray(),middle=blocks.slice(1,-1);return first.concat(middle).concat(last)}})(selection),isEditableListItem(selection.dom)),getPartiallySelectedListItems=selection=>filter$5(selection.getSelectedBlocks(),isEditableListItem(selection.dom)),each$8=Tools.each,isElementNode=node=>isElement$6(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus$2(node),findElementSibling=(node,siblingName)=>{for(let sibling=node;sibling;sibling=sibling[siblingName]){if(isText$a(sibling)&&isNotEmpty(sibling.data))return node;if(isElement$6(sibling)&&!isBookmarkNode$1(sibling))return sibling}return node},mergeSiblingsNodes=(editor,prev,next)=>{const elementUtils=ElementUtils(editor),isPrevEditable=isHTMLElement(prev)&&editor.dom.isEditable(prev),isNextEditable=isHTMLElement(next)&&editor.dom.isEditable(next);if(isPrevEditable&&isNextEditable){const prevSibling=findElementSibling(prev,"previousSibling"),nextSibling=findElementSibling(next,"nextSibling");if(elementUtils.compare(prevSibling,nextSibling)){for(let sibling=prevSibling.nextSibling;sibling&&sibling!==nextSibling;){const tmpSibling=sibling;sibling=sibling.nextSibling,prevSibling.appendChild(tmpSibling)}return editor.dom.remove(nextSibling),Tools.each(Tools.grep(nextSibling.childNodes),(node=>{prevSibling.appendChild(node)})),prevSibling}}return next},mergeSiblings=(editor,format,vars,node)=>{var _a;if(node&&!1!==format.merge_siblings){const newNode=null!==(_a=mergeSiblingsNodes(editor,getNonWhiteSpaceSibling(node),node))&&void 0!==_a?_a:node;mergeSiblingsNodes(editor,newNode,getNonWhiteSpaceSibling(newNode,!0))}},processChildElements=(node,filter,process)=>{each$8(node.childNodes,(node=>{isElementNode(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))}))},hasStyle=(dom,name)=>node=>!(!node||!getStyle(dom,node,name)),applyStyle=(dom,name,value)=>node=>{dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),((dom,node)=>{"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)})(dom,node)},removeResult=Adt_generate([{keep:[]},{rename:["name"]},{removed:[]}]),MCE_ATTR_RE=/^(src|href|style)$/,each$7=Tools.each,isEq$2=isEq$5,isChildOfInlineParent=(dom,node,parent)=>dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent),getContainer=(ed,rng,start)=>{let container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"];if(isElement$6(container)){const lastIdx=container.childNodes.length-1;!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]}return isText$a(container)&&start&&offset>=container.data.length&&(container=new DomTreeWalker(container,ed.getBody()).next()||container),isText$a(container)&&!start&&0===offset&&(container=new DomTreeWalker(container,ed.getBody()).prev()||container),container},normalizeTableSelection=(node,start)=>{const prop=start?"firstChild":"lastChild",childNode=node[prop];return(node=>/^(TR|TH|TD)$/.test(node.nodeName))(node)&&childNode?"TR"===node.nodeName&&childNode[prop]||childNode:node},wrap$1=(dom,node,name,attrs)=>{var _a;const wrapper=dom.create(name,attrs);return null===(_a=node.parentNode)||void 0===_a||_a.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},wrapWithSiblings=(dom,node,next,name,attrs)=>{const start=SugarElement.fromDom(node),wrapper=SugarElement.fromDom(dom.create(name,attrs)),siblings=next?nextSiblings(start):prevSiblings(start);return append(wrapper,siblings),next?(before$3(start,wrapper),prepend(wrapper,start)):(after$4(start,wrapper),append$1(wrapper,start)),wrapper.dom},removeNode=(ed,node,format)=>{const parentNode=node.parentNode;let rootBlockElm;const dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);isBlockFormat(format)&&parentNode===dom.getRoot()&&(format.list_block&&isEq$2(node,format.list_block)||each$e(from(node.childNodes),(node=>{isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap$1(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,getForcedRootBlockAttrs(ed))):rootBlockElm=null}))),(format=>isSelectorFormat(format)&&isInlineFormat(format)&&is$2(get$a(format,"mixed"),!0))(format)&&!isEq$2(format.inline,node)||dom.remove(node,!0)},processFormatAttrOrStyle=(name,value,vars)=>isNumber(name)?{name:value,value:null}:{name,value:replaceVars(value,vars)},removeEmptyStyleAttributeIfNeeded=(dom,elm)=>{""===dom.getAttrib(elm,"style")&&(elm.removeAttribute("style"),elm.removeAttribute("data-mce-style"))},removeStyles=(dom,elm,format,vars,compareNode)=>{let stylesModified=!1;each$7(format.styles,((value,name)=>{const{name:styleName,value:styleValue}=processFormatAttrOrStyle(name,value,vars),normalizedStyleValue=normalizeStyleValue(styleValue,styleName);(format.remove_similar||isNull(styleValue)||!isElement$6(compareNode)||isEq$2(getStyle(dom,compareNode,styleName),normalizedStyleValue))&&dom.setStyle(elm,styleName,""),stylesModified=!0})),stylesModified&&removeEmptyStyleAttributeIfNeeded(dom,elm)},removeNodeFormatInternal=(ed,format,vars,node,compareNode)=>{const dom=ed.dom,elementUtils=ElementUtils(ed),schema=ed.schema;if(isInlineFormat(format)&&isTransparentElementName(schema,format.inline)&&isTransparentBlock(schema,node)&&node.parentElement===ed.getBody())return removeNode(ed,node,format),removeResult.removed();if(!format.ceFalseOverride&&node&&"false"===dom.getContentEditableParent(node))return removeResult.keep();if(node&&!matchName(dom,node,format)&&!((node,format)=>format.links&&"A"===node.nodeName)(node,format))return removeResult.keep();const elm=node,preserveAttributes=format.preserve_attributes;if(isInlineFormat(format)&&"all"===format.remove&&isArray$1(preserveAttributes)){const attrsToPreserve=filter$5(dom.getAttribs(elm),(attr=>contains$2(preserveAttributes,attr.name.toLowerCase())));if(dom.removeAllAttribs(elm),each$e(attrsToPreserve,(attr=>dom.setAttrib(elm,attr.name,attr.value))),attrsToPreserve.length>0)return removeResult.rename("span")}if("all"!==format.remove){removeStyles(dom,elm,format,vars,compareNode),each$7(format.attributes,((value,name)=>{const{name:attrName,value:attrValue}=processFormatAttrOrStyle(name,value,vars);if(format.remove_similar||isNull(attrValue)||!isElement$6(compareNode)||isEq$2(dom.getAttrib(compareNode,attrName),attrValue)){if("class"===attrName){const currentValue=dom.getAttrib(elm,attrName);if(currentValue){let valueOut="";if(each$e(currentValue.split(/\s+/),(cls=>{/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)})),valueOut)return void dom.setAttrib(elm,attrName,valueOut)}}if(MCE_ATTR_RE.test(attrName)&&elm.removeAttribute("data-mce-"+attrName),"style"===attrName&&matchNodeNames(["li"])(elm)&&"none"===dom.getStyle(elm,"list-style-type"))return elm.removeAttribute(attrName),void dom.setStyle(elm,"list-style-type","none");"class"===attrName&&elm.removeAttribute("className"),elm.removeAttribute(attrName)}})),each$7(format.classes,(value=>{value=replaceVars(value,vars),isElement$6(compareNode)&&!dom.hasClass(compareNode,value)||dom.removeClass(elm,value)}));const attrs=dom.getAttribs(elm);for(let i=0;i<attrs.length;i++){const attrName=attrs[i].nodeName;if(!elementUtils.isAttributeInternal(attrName))return removeResult.keep()}}return"none"!==format.remove?(removeNode(ed,elm,format),removeResult.removed()):removeResult.keep()},removeNodeFormatFromClone=(editor,format,vars,clone)=>removeNodeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),(newName=>(editor.dom.createFragment().appendChild(clone),editor.dom.rename(clone,newName))),constant(null)),removeFormatInternal=(ed,name,vars,node,similar)=>{const formatList=ed.formatter.get(name),format=formatList[0],dom=ed.dom,selection=ed.selection,splitToFormatRoot=container=>{const formatRoot=((editor,container,name,vars,similar)=>{let formatRoot;return container.parentNode&&each$e(getParents$2(editor.dom,container.parentNode).reverse(),(parent=>{if(!formatRoot&&isElement$6(parent)&&"_start"!==parent.id&&"_end"!==parent.id){const format=matchNode(editor,parent,name,vars,similar);format&&!1!==format.split&&(formatRoot=parent)}})),formatRoot})(ed,container,name,vars,similar);return((editor,formatList,formatRoot,container,target,split,format,vars)=>{var _a,_b;let lastClone,firstClone;const dom=editor.dom;if(formatRoot){const formatRootParent=formatRoot.parentNode;for(let parent=container.parentNode;parent&&parent!==formatRootParent;parent=parent.parentNode){let clone=dom.clone(parent,!1);for(let i=0;i<formatList.length&&(clone=removeNodeFormatFromClone(editor,formatList[i],vars,clone),null!==clone);i++);clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=null!==(_a=dom.split(formatRoot,container))&&void 0!==_a?_a:container),lastClone&&firstClone&&(null===(_b=target.parentNode)||void 0===_b||_b.insertBefore(lastClone,target),firstClone.appendChild(target),isInlineFormat(format)&&mergeSiblings(editor,format,0,lastClone))}return container})(ed,formatList,formatRoot,container,container,!0,format,vars)},removeFormatOnNode=node=>exists(formatList,(fmt=>removeNodeFormat(ed,fmt,vars,node,node))),process=node=>{const children=from(node.childNodes),currentNodeMatches=removeFormatOnNode(node)||exists(formatList,(f=>matchName(dom,node,f))),parentNode=node.parentNode;if(!currentNodeMatches&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&removeFormatOnNode(parentNode),format.deep&&children.length)for(let i=0;i<children.length;i++)process(children[i]);each$e(["underline","line-through","overline"],(decoration=>{isElement$6(node)&&ed.dom.getStyle(node,"text-decoration")===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration&&removeNodeFormat(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:decoration}},void 0,node)}))},unwrap=start=>{const node=dom.get(start?"_start":"_end");if(node){let out=node[start?"firstChild":"lastChild"];return(node=>isBookmarkNode$1(node)&&isElement$6(node)&&("_start"===node.id||"_end"===node.id))(out)&&(out=out[start?"firstChild":"lastChild"]),isText$a(out)&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out}return null},removeRngStyle=rng=>{let startContainer,endContainer,expandedRng=expandRng(dom,rng,formatList,rng.collapsed);if(format.split){if(expandedRng=split(expandedRng),startContainer=getContainer(ed,expandedRng,!0),endContainer=getContainer(ed,expandedRng),startContainer!==endContainer){if(startContainer=normalizeTableSelection(startContainer,!0),endContainer=normalizeTableSelection(endContainer,!1),isChildOfInlineParent(dom,startContainer,endContainer)){const marker=Optional.from(startContainer.firstChild).getOr(startContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!0,"span",{id:"_start","data-mce-type":"bookmark"})),void unwrap(!0)}if(isChildOfInlineParent(dom,endContainer,startContainer)){const marker=Optional.from(endContainer.lastChild).getOr(endContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!1,"span",{id:"_end","data-mce-type":"bookmark"})),void unwrap(!1)}startContainer=wrap$1(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap$1(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"});const newRng=dom.createRng();newRng.setStartAfter(startContainer),newRng.setEndBefore(endContainer),walk$3(dom,newRng,(nodes=>{each$e(nodes,(n=>{isBookmarkNode$1(n)||isBookmarkNode$1(n.parentNode)||splitToFormatRoot(n)}))})),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,expandedRng.startOffset=dom.nodeIndex(startContainer),expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,expandedRng.endOffset=dom.nodeIndex(endContainer)+1}walk$3(dom,expandedRng,(nodes=>{each$e(nodes,process)}))};if(node){if(isNode(node)){const rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)}else removeRngStyle(node);fireFormatRemove(ed,name,node,vars)}else selection.isCollapsed()&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?removeCaretFormat(ed,name,vars,similar):(preserveSelection(ed,(()=>runOnRanges(ed,removeRngStyle)),(startNode=>isInlineFormat(format)&&match$2(ed,name,vars,startNode))),ed.nodeChanged()),((editor,name,vars)=>{"removeformat"===name?each$e(getPartiallySelectedListItems(editor.selection),(li=>{each$e(listItemStyles,(name=>editor.dom.setStyle(li,name,""))),removeEmptyStyleAttributeIfNeeded(editor.dom,li)})):getExpandedListItemFormat(editor.formatter,name).each((liFmt=>{each$e(getPartiallySelectedListItems(editor.selection),(li=>removeStyles(editor.dom,li,liFmt,vars,null)))}))})(ed,name,vars),fireFormatRemove(ed,name,node,vars)},removeFormat$1=(ed,name,vars,node,similar)=>{(node||ed.selection.isEditable())&&removeFormatInternal(ed,name,vars,node,similar)},removeNodeFormat=(editor,format,vars,node,compareNode)=>removeNodeFormatInternal(editor,format,vars,node,compareNode).fold(never,(newName=>(editor.dom.rename(node,newName),!0)),always),each$6=Tools.each,mergeWithChildren=(editor,formatList,vars,node)=>{each$6(formatList,(format=>{isInlineFormat(format)&&each$6(editor.dom.select(format.inline,node),(child=>{isElementNode(child)&&removeNodeFormat(editor,format,vars,child,format.exact?child:null)})),((dom,format,node)=>{if(format.clear_child_styles){const selector=format.links?"*:not(a)":"*";each$8(dom.select(selector,node),(childNode=>{isElementNode(childNode)&&dom.isEditable(childNode)&&each$8(format.styles,((_value,name)=>{dom.setStyle(childNode,name,"")}))}))}})(editor.dom,format,node)}))},each$5=Tools.each,applyStyles=(dom,elm,format,vars)=>{if(each$5(format.styles,((value,name)=>{dom.setStyle(elm,name,replaceVars(value,vars))})),format.styles){const styleVal=dom.getAttrib(elm,"style");styleVal&&dom.setAttrib(elm,"data-mce-style",styleVal)}},applyFormatAction=(ed,name,vars,node)=>{const formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=(elm,fmt=format)=>{isFunction(fmt.onformat)&&fmt.onformat(elm,fmt,vars,node),applyStyles(dom,elm,fmt,vars),each$5(fmt.attributes,((value,name)=>{dom.setAttrib(elm,name,replaceVars(value,vars))})),each$5(fmt.classes,(value=>{const newValue=replaceVars(value,vars);dom.hasClass(elm,newValue)||dom.addClass(elm,newValue)}))},applyNodeStyle=(formatList,node)=>{let found=!1;return each$5(formatList,(format=>!!isSelectorFormat(format)&&("false"===dom.getContentEditable(node)&&!format.ceFalseOverride||(!(!isNonNullable(format.collapsed)||format.collapsed===isCollapsed)||(!(dom.is(node,format.selector)&&!isCaretNode(node))||(setElementFormat(node,format),found=!0,!1)))))),found},createWrapElement=wrapName=>{if(isString(wrapName)){const wrapElm=dom.create(wrapName);return setElementFormat(wrapElm),wrapElm}return null},applyRngStyle=(dom,rng,nodeSpecific)=>{const newWrappers=[];let contentEditable=!0;const wrapName=format.inline||format.block,wrapElm=createWrapElement(wrapName),isMatchingWrappingBlock=node=>(format=>isBlockFormat(format)&&!0===format.wrapper)(format)&&matchNode(ed,node,name,vars),canRenameBlock=(node,parentName,isEditableDescendant)=>{const isValidBlockFormatForNode=(format=>isBlockFormat(format)&&!0!==format.wrapper)(format)&&isTextBlock$1(ed.schema,node)&&isValid(ed,parentName,wrapName);return isEditableDescendant&&isValidBlockFormatForNode};walk$3(dom,rng,(nodes=>{let currentWrapElm;const process=node=>{let hasContentEditableState=!1,lastContentEditable=contentEditable,isWrappableNoneditableElm=!1;const parentNode=node.parentNode,parentName=parentNode.nodeName.toLowerCase(),contentEditableValue=dom.getContentEditable(node);isNonNullable(contentEditableValue)&&(lastContentEditable=contentEditable,contentEditable="true"===contentEditableValue,hasContentEditableState=!0,isWrappableNoneditableElm=isWrappableNoneditable(ed,node));const isEditableDescendant=contentEditable&&!hasContentEditableState;if(isBr$6(node)&&!((editor,format,node,parentName)=>{if(canFormatEmptyLines(editor)&&isInlineFormat(format)&&node.parentNode){const validBRParentElements=getTextRootBlockElements(editor.schema),hasCaretNodeSibling=sibling(SugarElement.fromDom(node),(sibling=>isCaretNode(sibling.dom)));return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty$2(SugarElement.fromDom(node.parentNode),!1)&&!hasCaretNodeSibling}return!1})(ed,format,node,parentName))return currentWrapElm=null,void(isBlockFormat(format)&&dom.remove(node));if(isMatchingWrappingBlock(node))currentWrapElm=null;else{if(canRenameBlock(node,parentName,isEditableDescendant)){const elm=dom.rename(node,wrapName);return setElementFormat(elm),newWrappers.push(elm),void(currentWrapElm=null)}if(isSelectorFormat(format)){let found=applyNodeStyle(formatList,node);if(!found&&isNonNullable(parentNode)&&shouldExpandToSelector(format)&&(found=applyNodeStyle(formatList,parentNode)),!isInlineFormat(format)||found)return void(currentWrapElm=null)}isNonNullable(wrapElm)&&((node,parentName,isEditableDescendant,isWrappableNoneditableElm)=>{const nodeName=node.nodeName.toLowerCase(),isValidWrapNode=isValid(ed,wrapName,nodeName)&&isValid(ed,parentName,wrapName),isZwsp=!nodeSpecific&&isText$a(node)&&isZwsp$1(node.data),isCaret=isCaretNode(node),isCorrectFormatForNode=!isInlineFormat(format)||!dom.isBlock(node);return(isEditableDescendant||isWrappableNoneditableElm)&&isValidWrapNode&&!isZwsp&&!isCaret&&isCorrectFormatForNode})(node,parentName,isEditableDescendant,isWrappableNoneditableElm)?(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),isWrappableNoneditableElm&&hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm.appendChild(node)):(currentWrapElm=null,each$e(from(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=null)}};each$e(nodes,process)})),!0===format.links&&each$e(newWrappers,(node=>{const process=node=>{"A"===node.nodeName&&setElementFormat(node,format),each$e(from(node.childNodes),process)};process(node)})),each$e(newWrappers,(node=>{const childCount=(node=>{let count=0;return each$e(node.childNodes,(node=>{(node=>isNonNullable(node)&&isText$a(node)&&0===node.length)(node)||isBookmarkNode$1(node)||count++})),count})(node);!(newWrappers.length>1)&&dom.isBlock(node)||0!==childCount?(isInlineFormat(format)||isBlockFormat(format)&&format.wrapper)&&(format.exact||1!==childCount||(node=(node=>{const childElement=find$2(node.childNodes,isElementNode$1).filter((child=>"false"!==dom.getContentEditable(child)&&matchName(dom,child,format)));return childElement.map((child=>{const clone=dom.clone(child,!1);return setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,!0),clone})).getOr(node)})(node)),mergeWithChildren(ed,formatList,vars,node),((editor,format,name,vars,node)=>{const parentNode=node.parentNode;matchNode(editor,parentNode,name,vars)&&removeNodeFormat(editor,format,vars,node)||format.merge_with_parents&&parentNode&&editor.dom.getParent(parentNode,(parent=>!!matchNode(editor,parent,name,vars)&&(removeNodeFormat(editor,format,vars,node),!0)))})(ed,format,name,vars,node),((dom,format,vars,node)=>{if(format.styles&&format.styles.backgroundColor){const hasFontSize=hasStyle(dom,"fontSize");processChildElements(node,(elm=>hasFontSize(elm)&&dom.isEditable(elm)),applyStyle(dom,"backgroundColor",replaceVars(format.styles.backgroundColor,vars)))}})(dom,format,vars,node),((dom,format,vars,node)=>{const processTextDecorationsAndColor=n=>{if(isHTMLElement(n)&&isElement$6(n.parentNode)&&dom.isEditable(n)){const parentTextDecoration=getTextDecoration(dom,n.parentNode);dom.getStyle(n,"color")&&parentTextDecoration?dom.setStyle(n,"text-decoration",parentTextDecoration):dom.getStyle(n,"text-decoration")===parentTextDecoration&&dom.setStyle(n,"text-decoration",null)}};format.styles&&(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,processTextDecorationsAndColor,"childNodes"),processTextDecorationsAndColor(node))})(dom,format,0,node),((dom,format,vars,node)=>{if(isInlineFormat(format)&&("sub"===format.inline||"sup"===format.inline)){const hasFontSize=hasStyle(dom,"fontSize");processChildElements(node,(elm=>hasFontSize(elm)&&dom.isEditable(elm)),applyStyle(dom,"fontSize",""));const inverseTagDescendants=filter$5(dom.select("sup"===format.inline?"sub":"sup",node),dom.isEditable);dom.remove(inverseTagDescendants,!0)}})(dom,format,0,node),mergeSiblings(ed,format,0,node)):dom.remove(node,!0)}))},targetNode=isNode(node)?node:selection.getNode();if("false"===dom.getContentEditable(targetNode)&&!isWrappableNoneditable(ed,targetNode))return applyNodeStyle(formatList,node=targetNode),void fireFormatApply(ed,name,node,vars);if(format){if(node)if(isNode(node)){if(!applyNodeStyle(formatList,node)){const rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,expandRng(dom,rng,formatList),!0)}}else applyRngStyle(dom,node,!0);else isCollapsed&&isInlineFormat(format)&&!getCellsFromEditor(ed).length?((editor,name,vars)=>{let caretContainer;const selection=editor.selection,formatList=editor.formatter.get(name);if(!formatList)return;const selectionRng=selection.getRng();let offset=selectionRng.startOffset;const text=selectionRng.startContainer.nodeValue;caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart());const wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){const bookmark=selection.getBookmark();selectionRng.collapse(!0);let rng=expandRng(editor.dom,selectionRng,formatList);rng=split(rng),editor.formatter.apply(name,vars,rng),selection.moveToBookmark(bookmark)}else{let textNode=caretContainer?findFirstTextNode(caretContainer):null;caretContainer&&"\ufeff"===(null==textNode?void 0:textNode.data)||(ownerDocument=editor.getDoc(),node=createCaretContainer(!0).dom,caretContainer=ownerDocument.importNode(node,!0),textNode=caretContainer.firstChild,selectionRng.insertNode(caretContainer),offset=1),editor.formatter.apply(name,vars,caretContainer),selection.setCursorLocation(textNode,offset)}var ownerDocument,node})(ed,name,vars):(selection.setRng(normalize(selection.getRng())),preserveSelection(ed,(()=>{runOnRanges(ed,((selectionRng,fake)=>{const expandedRng=fake?selectionRng:expandRng(dom,selectionRng,formatList);applyRngStyle(dom,expandedRng,!1)}))}),always),ed.nodeChanged()),getExpandedListItemFormat(ed.formatter,name).each((liFmt=>{each$e(getFullySelectedListItems(ed.selection),(li=>applyStyles(dom,li,liFmt,vars)))}));((name,editor)=>{has$2(postProcessHooks,name)&&each$e(postProcessHooks[name],(hook=>{hook(editor)}))})(name,ed)}fireFormatApply(ed,name,node,vars)},applyFormat$1=(editor,name,vars,node)=>{(node||editor.selection.isEditable())&&applyFormatAction(editor,name,vars,node)},hasVars=value=>has$2(value,"vars"),fallbackElement=editor=>editor.selection.getStart(),matchingNode=(editor,parents,format,similar,vars)=>findUntil$1(parents,(node=>{const matchingFormat=editor.formatter.matchNode(node,format,null!=vars?vars:{},similar);return!isUndefined(matchingFormat)}),(node=>!!matchesUnInheritedFormatSelector(editor,node,format)||!similar&&isNonNullable(editor.formatter.matchNode(node,format,vars,!0)))),getParents=(editor,elm)=>{const element=null!=elm?elm:fallbackElement(editor);return filter$5(getParents$2(editor.dom,element),(node=>isElement$6(node)&&!isBogus$2(node)))},updateAndFireChangeCallbacks=(editor,elm,registeredCallbacks)=>{const parents=getParents(editor,elm);each$d(registeredCallbacks,((data,format)=>{const runIfChanged=spec=>{const match=matchingNode(editor,parents,format,spec.similar,hasVars(spec)?spec.vars:void 0),isSet=match.isSome();if(spec.state.get()!==isSet){spec.state.set(isSet);const node=match.getOr(elm);hasVars(spec)?spec.callback(isSet,{node,format,parents}):each$e(spec.callbacks,(callback=>callback(isSet,{node,format,parents})))}};each$e([data.withSimilar,data.withoutSimilar],runIfChanged),each$e(data.withVars,runIfChanged)}))},formatChangedInternal=(editor,registeredFormatListeners,formats,callback,similar,vars)=>(((editor,registeredFormatListeners,formats,callback,similar,vars)=>{const formatChangeItems=registeredFormatListeners.get();each$e(formats.split(","),(format=>{const group=get$a(formatChangeItems,format).getOrThunk((()=>{const base={withSimilar:{state:Cell(!1),similar:!0,callbacks:[]},withoutSimilar:{state:Cell(!1),similar:!1,callbacks:[]},withVars:[]};return formatChangeItems[format]=base,base})),getCurrent=()=>{const parents=getParents(editor);return matchingNode(editor,parents,format,similar,vars).isSome()};if(isUndefined(vars)){const toAppendTo=similar?group.withSimilar:group.withoutSimilar;toAppendTo.callbacks.push(callback),1===toAppendTo.callbacks.length&&toAppendTo.state.set(getCurrent())}else group.withVars.push({state:Cell(getCurrent()),similar,vars,callback})})),registeredFormatListeners.set(formatChangeItems)})(editor,registeredFormatListeners,formats,callback,similar,vars),{unbind:()=>((registeredFormatListeners,formats,callback)=>{const formatChangeItems=registeredFormatListeners.get();each$e(formats.split(","),(format=>get$a(formatChangeItems,format).each((group=>{formatChangeItems[format]={withSimilar:{...group.withSimilar,callbacks:filter$5(group.withSimilar.callbacks,(cb=>cb!==callback))},withoutSimilar:{...group.withoutSimilar,callbacks:filter$5(group.withoutSimilar.callbacks,(cb=>cb!==callback))},withVars:filter$5(group.withVars,(item=>item.callback!==callback))}})))),registeredFormatListeners.set(formatChangeItems)})(registeredFormatListeners,formats,callback)}),explode$1=Tools.explode,create$8=()=>{const filters={};return{addFilter:(name,callback)=>{each$e(explode$1(name),(name=>{has$2(filters,name)||(filters[name]={name,callbacks:[]}),filters[name].callbacks.push(callback)}))},getFilters:()=>values(filters),removeFilter:(name,callback)=>{each$e(explode$1(name),(name=>{if(has$2(filters,name))if(isNonNullable(callback)){const filter=filters[name],newCallbacks=filter$5(filter.callbacks,(c=>c!==callback));newCallbacks.length>0?filter.callbacks=newCallbacks:delete filters[name]}else delete filters[name]}))}}},addFontToSpansFilter=(domParser,styles,fontSizes)=>{domParser.addNodeFilter("font",(nodes=>{each$e(nodes,(node=>{const props=styles.parse(node.attr("style")),color=node.attr("color"),face=node.attr("face"),size=node.attr("size");color&&(props.color=color),face&&(props["font-family"]=face),size&&toInt(size).each((num=>{props["font-size"]=fontSizes[num-1]})),node.name="span",node.attr("style",styles.serialize(props)),((node,names)=>{each$e(names,(name=>{node.attr(name,null)}))})(node,["color","face","size"])}))}))},addFilters=(domParser,settings,schema)=>{var _a;const styles=Styles();settings.convert_fonts_to_spans&&addFontToSpansFilter(domParser,styles,Tools.explode(null!==(_a=settings.font_size_legacy_values)&&void 0!==_a?_a:"")),((domParser,schema,styles)=>{domParser.addNodeFilter("strike",(nodes=>{const convertToSTag="html4"!==schema.type;each$e(nodes,(node=>{if(convertToSTag)node.name="s";else{const props=styles.parse(node.attr("style"));props["text-decoration"]="line-through",node.name="span",node.attr("style",styles.serialize(props))}}))}))})(domParser,schema,styles)},addNodeFilter=(settings,htmlParser,schema)=>{htmlParser.addNodeFilter("br",((nodes,_,args)=>{const blockElements=Tools.extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhitespaceElements();blockElements.body=1;const isBlock=node=>node.name in blockElements||isTransparentAstBlock(schema,node);for(let i=0,l=nodes.length;i<l;i++){let node=nodes[i],parent=node.parent;if(parent&&isBlock(parent)&&node===parent.lastChild){let prev=node.prev;for(;prev;){const prevName=prev.name;if("span"!==prevName||"bookmark"!==prev.attr("data-mce-type")){"br"===prevName&&(node=null);break}prev=prev.prev}if(node&&(node.remove(),isEmpty(schema,nonEmptyElements,whitespaceElements,parent))){const elementRule=schema.getElementRule(parent.name);elementRule&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,args,isBlock,parent))}}else{let lastParent=node;for(;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;if(lastParent===parent){const textNode=new AstNode("#text",3);textNode.value=" ",node.replace(textNode)}}}}))},parseDataUri=uri=>{const[type,...rest]=uri.split(","),data=rest.join(","),matches=/data:([^/]+\/[^;]+)(;.+)?/.exec(type);if(matches){const base64Encoded=";base64"===matches[2],extractedData=base64Encoded?(data=>{const matches=/([a-z0-9+\/=\s]+)/i.exec(data);return matches?matches[1]:""})(data):decodeURIComponent(data);return Optional.some({type:matches[1],data:extractedData,base64Encoded})}return Optional.none()},buildBlob=(type,data,base64Encoded=!0)=>{let str=data;if(base64Encoded)try{str=atob(data)}catch(e){return Optional.none()}const arr=new Uint8Array(str.length);for(let i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);return Optional.some(new Blob([arr],{type}))},uriToBlob=url=>{return startsWith(url,"blob:")?(url=>fetch(url).then((res=>res.ok?res.blob():Promise.reject())).catch((()=>Promise.reject({message:`Cannot convert ${url} to Blob. Resource might not exist or is inaccessible.`,uriType:"blob"}))))(url):startsWith(url,"data:")?(uri=url,new Promise(((resolve,reject)=>{parseDataUri(uri).bind((({type,data,base64Encoded})=>buildBlob(type,data,base64Encoded))).fold((()=>reject("Invalid data URI")),resolve)}))):Promise.reject("Unknown URI format");var uri},blobToDataUri=blob=>new Promise(((resolve,reject)=>{const reader=new FileReader;reader.onloadend=()=>{resolve(reader.result)},reader.onerror=()=>{var _a;reject(null===(_a=reader.error)||void 0===_a?void 0:_a.message)},reader.readAsDataURL(blob)}));let count$1=0;const processDataUri=(dataUri,base64Only,generateBlobInfo)=>parseDataUri(dataUri).bind((({data,type,base64Encoded})=>{if(base64Only&&!base64Encoded)return Optional.none();{const base64=base64Encoded?data:btoa(data);return generateBlobInfo(base64,type)}})),createBlobInfo$1=(blobCache,blob,base64)=>{const blobInfo=blobCache.create((prefix||"blobid")+count$1++,blob,base64);var prefix;return blobCache.add(blobInfo),blobInfo},dataUriToBlobInfo=(blobCache,dataUri,base64Only=!1)=>processDataUri(dataUri,base64Only,((base64,type)=>Optional.from(blobCache.getByData(base64,type)).orThunk((()=>buildBlob(type,base64).map((blob=>createBlobInfo$1(blobCache,blob,base64))))))),registerBase64ImageFilter=(parser,settings)=>{const{blob_cache:blobCache}=settings;if(blobCache){const processImage=img=>{const inputSrc=img.attr("src");(img=>img.attr("src")===Env.transparentSrc||isNonNullable(img.attr("data-mce-placeholder")))(img)||(img=>isNonNullable(img.attr("data-mce-bogus")))(img)||isNullable(inputSrc)||dataUriToBlobInfo(blobCache,inputSrc,!0).each((blobInfo=>{img.attr("src",blobInfo.blobUri())}))};parser.addAttributeFilter("src",(nodes=>each$e(nodes,processImage)))}},isMimeType=(mime,type)=>startsWith(mime,`${type}/`),register$4=(parser,settings)=>{const schema=parser.schema;settings.remove_trailing_brs&&addNodeFilter(settings,parser,schema),parser.addAttributeFilter("href",(nodes=>{let i=nodes.length;const addNoOpener=rel=>{const newRel=rel?Tools.trim(rel):"";return/\b(noopener)\b/g.test(newRel)?newRel:(rel=>rel.split(" ").filter((p=>p.length>0)).concat(["noopener"]).sort().join(" "))(newRel)};if(!settings.allow_unsafe_link_target)for(;i--;){const node=nodes[i];"a"===node.name&&"_blank"===node.attr("target")&&node.attr("rel",addNoOpener(node.attr("rel")))}})),settings.allow_html_in_named_anchor||parser.addAttributeFilter("id,name",(nodes=>{let sibling,prevSibling,parent,node,i=nodes.length;for(;i--;)if(node=nodes[i],"a"===node.name&&node.firstChild&&!node.attr("href"))for(parent=node.parent,sibling=node.lastChild;sibling&&parent;)prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling})),settings.fix_list_elements&&parser.addNodeFilter("ul,ol",(nodes=>{let node,parentNode,i=nodes.length;for(;i--;)if(node=nodes[i],parentNode=node.parent,parentNode&&("ul"===parentNode.name||"ol"===parentNode.name))if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{const li=new AstNode("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}}));const validClasses=schema.getValidClasses();settings.validate&&validClasses&&parser.addAttributeFilter("class",(nodes=>{var _a;let i=nodes.length;for(;i--;){const node=nodes[i],clazz=null!==(_a=node.attr("class"))&&void 0!==_a?_a:"",classList=Tools.explode(clazz," ");let classValue="";for(let ci=0;ci<classList.length;ci++){const className=classList[ci];let valid=!1,validClassesMap=validClasses["*"];validClassesMap&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className)}classValue.length||(classValue=null),node.attr("class",classValue)}})),registerBase64ImageFilter(parser,settings),settings.convert_unsafe_embeds&&parser.addNodeFilter("object,embed",(nodes=>each$e(nodes,(node=>{node.replace(((mime,src,width,height,sandboxIframes)=>{let name;name=isUndefined(mime)?"iframe":isMimeType(mime,"image")?"img":isMimeType(mime,"video")?"video":isMimeType(mime,"audio")?"audio":"iframe";const embed=new AstNode(name,1);return embed.attr("audio"===name?{src}:{src,width,height}),"audio"!==name&&"video"!==name||embed.attr("controls",""),"iframe"===name&&sandboxIframes&&embed.attr("sandbox",""),embed})(node.attr("type"),"object"===node.name?node.attr("data"):node.attr("src"),node.attr("width"),node.attr("height"),settings.sandbox_iframes))})))),settings.sandbox_iframes&&parser.addNodeFilter("iframe",(nodes=>each$e(nodes,(node=>node.attr("sandbox","")))))},{entries,setPrototypeOf,isFrozen,getPrototypeOf,getOwnPropertyDescriptor}=Object;let{freeze,seal,create:create$7}=Object,{apply,construct}="undefined"!=typeof Reflect&&Reflect;freeze||(freeze=function freeze(x){return x}),seal||(seal=function seal(x){return x}),apply||(apply=function apply(fun,thisValue,args){return fun.apply(thisValue,args)}),construct||(construct=function construct(Func,args){return new Func(...args)});const arrayForEach=unapply(Array.prototype.forEach),arrayPop=unapply(Array.prototype.pop),arrayPush=unapply(Array.prototype.push),stringToLowerCase=unapply(String.prototype.toLowerCase),stringToString=unapply(String.prototype.toString),stringMatch=unapply(String.prototype.match),stringReplace=unapply(String.prototype.replace),stringIndexOf=unapply(String.prototype.indexOf),stringTrim=unapply(String.prototype.trim),objectHasOwnProperty=unapply(Object.prototype.hasOwnProperty),regExpTest=unapply(RegExp.prototype.test),typeErrorCreate=function unconstruct(func){return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return construct(func,args)}}(TypeError);function unapply(func){return function(thisArg){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return apply(func,thisArg,args)}}function addToSet(set,array){let transformCaseFunc=arguments.length>2&&void 0!==arguments[2]?arguments[2]:stringToLowerCase;setPrototypeOf&&setPrototypeOf(set,null);let l=array.length;for(;l--;){let element=array[l];if("string"==typeof element){const lcElement=transformCaseFunc(element);lcElement!==element&&(isFrozen(array)||(array[l]=lcElement),element=lcElement)}set[element]=!0}return set}function cleanArray(array){for(let index=0;index<array.length;index++){objectHasOwnProperty(array,index)||(array[index]=null)}return array}function clone(object){const newObject=create$7(null);for(const[property,value]of entries(object)){objectHasOwnProperty(object,property)&&(Array.isArray(value)?newObject[property]=cleanArray(value):value&&"object"==typeof value&&value.constructor===Object?newObject[property]=clone(value):newObject[property]=value)}return newObject}function lookupGetter(object,prop){for(;null!==object;){const desc=getOwnPropertyDescriptor(object,prop);if(desc){if(desc.get)return unapply(desc.get);if("function"==typeof desc.value)return unapply(desc.value)}object=getPrototypeOf(object)}return function fallbackValue(){return null}}const html$1=freeze(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),svg$1=freeze(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),svgFilters=freeze(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),svgDisallowed=freeze(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),mathMl$1=freeze(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),mathMlDisallowed=freeze(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),text=freeze(["#text"]),html=freeze(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),svg=freeze(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),mathMl=freeze(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),xml=freeze(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),MUSTACHE_EXPR=seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ERB_EXPR=seal(/<%[\w\W]*|[\w\W]*%>/gm),TMPLIT_EXPR=seal(/\${[\w\W]*}/gm),DATA_ATTR=seal(/^data-[\-\w.\u00B7-\uFFFF]/),ARIA_ATTR=seal(/^aria-[\-\w]+$/),IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),IS_SCRIPT_OR_DATA=seal(/^(?:\w+script|data):/i),ATTR_WHITESPACE=seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),DOCTYPE_NAME=seal(/^html$/i),CUSTOM_ELEMENT=seal(/^[a-z][.\w]*(-[.\w]+)+$/i);var EXPRESSIONS=Object.freeze({__proto__:null,MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR,DATA_ATTR,ARIA_ATTR,IS_ALLOWED_URI,IS_SCRIPT_OR_DATA,ATTR_WHITESPACE,DOCTYPE_NAME,CUSTOM_ELEMENT});const NODE_TYPE_element=1,NODE_TYPE_text=3,NODE_TYPE_progressingInstruction=7,NODE_TYPE_comment=8,NODE_TYPE_document=9,getGlobal=function getGlobal(){return"undefined"==typeof window?null:window};var purify=function createDOMPurify(){let window=arguments.length>0&&void 0!==arguments[0]?arguments[0]:getGlobal();const DOMPurify=root=>createDOMPurify(root);if(DOMPurify.version="3.1.7",DOMPurify.removed=[],!window||!window.document||window.document.nodeType!==NODE_TYPE_document)return DOMPurify.isSupported=!1,DOMPurify;let{document}=window;const originalDocument=document,currentScript=originalDocument.currentScript,{DocumentFragment,HTMLTemplateElement,Node,Element,NodeFilter,NamedNodeMap=window.NamedNodeMap||window.MozNamedAttrMap,HTMLFormElement,DOMParser,trustedTypes}=window,ElementPrototype=Element.prototype,cloneNode=lookupGetter(ElementPrototype,"cloneNode"),remove=lookupGetter(ElementPrototype,"remove"),getNextSibling=lookupGetter(ElementPrototype,"nextSibling"),getChildNodes=lookupGetter(ElementPrototype,"childNodes"),getParentNode=lookupGetter(ElementPrototype,"parentNode");if("function"==typeof HTMLTemplateElement){const template=document.createElement("template");template.content&&template.content.ownerDocument&&(document=template.content.ownerDocument)}let trustedTypesPolicy,emptyHTML="";const{implementation,createNodeIterator,createDocumentFragment,getElementsByTagName}=document,{importNode}=originalDocument;let hooks={};DOMPurify.isSupported="function"==typeof entries&&"function"==typeof getParentNode&&implementation&&void 0!==implementation.createHTMLDocument;const{MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR,DATA_ATTR,ARIA_ATTR,IS_SCRIPT_OR_DATA,ATTR_WHITESPACE,CUSTOM_ELEMENT}=EXPRESSIONS;let{IS_ALLOWED_URI:IS_ALLOWED_URI$1}=EXPRESSIONS,ALLOWED_TAGS=null;const DEFAULT_ALLOWED_TAGS=addToSet({},[...html$1,...svg$1,...svgFilters,...mathMl$1,...text]);let ALLOWED_ATTR=null;const DEFAULT_ALLOWED_ATTR=addToSet({},[...html,...svg,...mathMl,...xml]);let CUSTOM_ELEMENT_HANDLING=Object.seal(create$7(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),FORBID_TAGS=null,FORBID_ATTR=null,ALLOW_ARIA_ATTR=!0,ALLOW_DATA_ATTR=!0,ALLOW_UNKNOWN_PROTOCOLS=!1,ALLOW_SELF_CLOSE_IN_ATTR=!0,SAFE_FOR_TEMPLATES=!1,SAFE_FOR_XML=!0,WHOLE_DOCUMENT=!1,SET_CONFIG=!1,FORCE_BODY=!1,RETURN_DOM=!1,RETURN_DOM_FRAGMENT=!1,RETURN_TRUSTED_TYPE=!1,SANITIZE_DOM=!0,SANITIZE_NAMED_PROPS=!1,KEEP_CONTENT=!0,IN_PLACE=!1,USE_PROFILES={},FORBID_CONTENTS=null;const DEFAULT_FORBID_CONTENTS=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let DATA_URI_TAGS=null;const DEFAULT_DATA_URI_TAGS=addToSet({},["audio","video","img","source","image","track"]);let URI_SAFE_ATTRIBUTES=null;const DEFAULT_URI_SAFE_ATTRIBUTES=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),MATHML_NAMESPACE="http://www.w3.org/1998/Math/MathML",SVG_NAMESPACE="http://www.w3.org/2000/svg",HTML_NAMESPACE="http://www.w3.org/1999/xhtml";let NAMESPACE=HTML_NAMESPACE,IS_EMPTY_INPUT=!1,ALLOWED_NAMESPACES=null;const DEFAULT_ALLOWED_NAMESPACES=addToSet({},[MATHML_NAMESPACE,SVG_NAMESPACE,HTML_NAMESPACE],stringToString);let PARSER_MEDIA_TYPE=null;const SUPPORTED_PARSER_MEDIA_TYPES=["application/xhtml+xml","text/html"];let transformCaseFunc=null,CONFIG=null;const formElement=document.createElement("form"),isRegexOrFunction=function isRegexOrFunction(testValue){return testValue instanceof RegExp||testValue instanceof Function},_parseConfig=function _parseConfig(){let cfg=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!CONFIG||CONFIG!==cfg){if(cfg&&"object"==typeof cfg||(cfg={}),cfg=clone(cfg),PARSER_MEDIA_TYPE=-1===SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE)?"text/html":cfg.PARSER_MEDIA_TYPE,transformCaseFunc="application/xhtml+xml"===PARSER_MEDIA_TYPE?stringToString:stringToLowerCase,ALLOWED_TAGS=objectHasOwnProperty(cfg,"ALLOWED_TAGS")?addToSet({},cfg.ALLOWED_TAGS,transformCaseFunc):DEFAULT_ALLOWED_TAGS,ALLOWED_ATTR=objectHasOwnProperty(cfg,"ALLOWED_ATTR")?addToSet({},cfg.ALLOWED_ATTR,transformCaseFunc):DEFAULT_ALLOWED_ATTR,ALLOWED_NAMESPACES=objectHasOwnProperty(cfg,"ALLOWED_NAMESPACES")?addToSet({},cfg.ALLOWED_NAMESPACES,stringToString):DEFAULT_ALLOWED_NAMESPACES,URI_SAFE_ATTRIBUTES=objectHasOwnProperty(cfg,"ADD_URI_SAFE_ATTR")?addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES),cfg.ADD_URI_SAFE_ATTR,transformCaseFunc):DEFAULT_URI_SAFE_ATTRIBUTES,DATA_URI_TAGS=objectHasOwnProperty(cfg,"ADD_DATA_URI_TAGS")?addToSet(clone(DEFAULT_DATA_URI_TAGS),cfg.ADD_DATA_URI_TAGS,transformCaseFunc):DEFAULT_DATA_URI_TAGS,FORBID_CONTENTS=objectHasOwnProperty(cfg,"FORBID_CONTENTS")?addToSet({},cfg.FORBID_CONTENTS,transformCaseFunc):DEFAULT_FORBID_CONTENTS,FORBID_TAGS=objectHasOwnProperty(cfg,"FORBID_TAGS")?addToSet({},cfg.FORBID_TAGS,transformCaseFunc):{},FORBID_ATTR=objectHasOwnProperty(cfg,"FORBID_ATTR")?addToSet({},cfg.FORBID_ATTR,transformCaseFunc):{},USE_PROFILES=!!objectHasOwnProperty(cfg,"USE_PROFILES")&&cfg.USE_PROFILES,ALLOW_ARIA_ATTR=!1!==cfg.ALLOW_ARIA_ATTR,ALLOW_DATA_ATTR=!1!==cfg.ALLOW_DATA_ATTR,ALLOW_UNKNOWN_PROTOCOLS=cfg.ALLOW_UNKNOWN_PROTOCOLS||!1,ALLOW_SELF_CLOSE_IN_ATTR=!1!==cfg.ALLOW_SELF_CLOSE_IN_ATTR,SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||!1,SAFE_FOR_XML=!1!==cfg.SAFE_FOR_XML,WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||!1,RETURN_DOM=cfg.RETURN_DOM||!1,RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||!1,RETURN_TRUSTED_TYPE=cfg.RETURN_TRUSTED_TYPE||!1,FORCE_BODY=cfg.FORCE_BODY||!1,SANITIZE_DOM=!1!==cfg.SANITIZE_DOM,SANITIZE_NAMED_PROPS=cfg.SANITIZE_NAMED_PROPS||!1,KEEP_CONTENT=!1!==cfg.KEEP_CONTENT,IN_PLACE=cfg.IN_PLACE||!1,IS_ALLOWED_URI$1=cfg.ALLOWED_URI_REGEXP||IS_ALLOWED_URI,NAMESPACE=cfg.NAMESPACE||HTML_NAMESPACE,CUSTOM_ELEMENT_HANDLING=cfg.CUSTOM_ELEMENT_HANDLING||{},cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck),cfg.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck=cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),cfg.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),SAFE_FOR_TEMPLATES&&(ALLOW_DATA_ATTR=!1),RETURN_DOM_FRAGMENT&&(RETURN_DOM=!0),USE_PROFILES&&(ALLOWED_TAGS=addToSet({},text),ALLOWED_ATTR=[],!0===USE_PROFILES.html&&(addToSet(ALLOWED_TAGS,html$1),addToSet(ALLOWED_ATTR,html)),!0===USE_PROFILES.svg&&(addToSet(ALLOWED_TAGS,svg$1),addToSet(ALLOWED_ATTR,svg),addToSet(ALLOWED_ATTR,xml)),!0===USE_PROFILES.svgFilters&&(addToSet(ALLOWED_TAGS,svgFilters),addToSet(ALLOWED_ATTR,svg),addToSet(ALLOWED_ATTR,xml)),!0===USE_PROFILES.mathMl&&(addToSet(ALLOWED_TAGS,mathMl$1),addToSet(ALLOWED_ATTR,mathMl),addToSet(ALLOWED_ATTR,xml))),cfg.ADD_TAGS&&(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS&&(ALLOWED_TAGS=clone(ALLOWED_TAGS)),addToSet(ALLOWED_TAGS,cfg.ADD_TAGS,transformCaseFunc)),cfg.ADD_ATTR&&(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR&&(ALLOWED_ATTR=clone(ALLOWED_ATTR)),addToSet(ALLOWED_ATTR,cfg.ADD_ATTR,transformCaseFunc)),cfg.ADD_URI_SAFE_ATTR&&addToSet(URI_SAFE_ATTRIBUTES,cfg.ADD_URI_SAFE_ATTR,transformCaseFunc),cfg.FORBID_CONTENTS&&(FORBID_CONTENTS===DEFAULT_FORBID_CONTENTS&&(FORBID_CONTENTS=clone(FORBID_CONTENTS)),addToSet(FORBID_CONTENTS,cfg.FORBID_CONTENTS,transformCaseFunc)),KEEP_CONTENT&&(ALLOWED_TAGS["#text"]=!0),WHOLE_DOCUMENT&&addToSet(ALLOWED_TAGS,["html","head","body"]),ALLOWED_TAGS.table&&(addToSet(ALLOWED_TAGS,["tbody"]),delete FORBID_TAGS.tbody),cfg.TRUSTED_TYPES_POLICY){if("function"!=typeof cfg.TRUSTED_TYPES_POLICY.createHTML)throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL)throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');trustedTypesPolicy=cfg.TRUSTED_TYPES_POLICY,emptyHTML=trustedTypesPolicy.createHTML("")}else void 0===trustedTypesPolicy&&(trustedTypesPolicy=function _createTrustedTypesPolicy(trustedTypes,purifyHostElement){if("object"!=typeof trustedTypes||"function"!=typeof trustedTypes.createPolicy)return null;let suffix=null;purifyHostElement&&purifyHostElement.hasAttribute("data-tt-policy-suffix")&&(suffix=purifyHostElement.getAttribute("data-tt-policy-suffix"));const policyName="dompurify"+(suffix?"#"+suffix:"");try{return trustedTypes.createPolicy(policyName,{createHTML:html=>html,createScriptURL:scriptUrl=>scriptUrl})}catch(_){return console.warn("TrustedTypes policy "+policyName+" could not be created."),null}}(trustedTypes,currentScript)),null!==trustedTypesPolicy&&"string"==typeof emptyHTML&&(emptyHTML=trustedTypesPolicy.createHTML(""));freeze&&freeze(cfg),CONFIG=cfg}},MATHML_TEXT_INTEGRATION_POINTS=addToSet({},["mi","mo","mn","ms","mtext"]),HTML_INTEGRATION_POINTS=addToSet({},["annotation-xml"]),COMMON_SVG_AND_HTML_ELEMENTS=addToSet({},["title","style","font","a","script"]),ALL_SVG_TAGS=addToSet({},[...svg$1,...svgFilters,...svgDisallowed]),ALL_MATHML_TAGS=addToSet({},[...mathMl$1,...mathMlDisallowed]),_forceRemove=function _forceRemove(node){arrayPush(DOMPurify.removed,{element:node});try{getParentNode(node).removeChild(node)}catch(_){remove(node)}},_removeAttribute=function _removeAttribute(name,node){try{arrayPush(DOMPurify.removed,{attribute:node.getAttributeNode(name),from:node})}catch(_){arrayPush(DOMPurify.removed,{attribute:null,from:node})}if(node.removeAttribute(name),"is"===name&&!ALLOWED_ATTR[name])if(RETURN_DOM||RETURN_DOM_FRAGMENT)try{_forceRemove(node)}catch(_){}else try{node.setAttribute(name,"")}catch(_){}},_initDocument=function _initDocument(dirty){let doc=null,leadingWhitespace=null;if(FORCE_BODY)dirty="<remove></remove>"+dirty;else{const matches=stringMatch(dirty,/^[\r\n\t ]+/);leadingWhitespace=matches&&matches[0]}"application/xhtml+xml"===PARSER_MEDIA_TYPE&&NAMESPACE===HTML_NAMESPACE&&(dirty='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+dirty+"</body></html>");const dirtyPayload=trustedTypesPolicy?trustedTypesPolicy.createHTML(dirty):dirty;if(NAMESPACE===HTML_NAMESPACE)try{doc=(new DOMParser).parseFromString(dirtyPayload,PARSER_MEDIA_TYPE)}catch(_){}if(!doc||!doc.documentElement){doc=implementation.createDocument(NAMESPACE,"template",null);try{doc.documentElement.innerHTML=IS_EMPTY_INPUT?emptyHTML:dirtyPayload}catch(_){}}const body=doc.body||doc.documentElement;return dirty&&leadingWhitespace&&body.insertBefore(document.createTextNode(leadingWhitespace),body.childNodes[0]||null),NAMESPACE===HTML_NAMESPACE?getElementsByTagName.call(doc,WHOLE_DOCUMENT?"html":"body")[0]:WHOLE_DOCUMENT?doc.documentElement:body},_createNodeIterator=function _createNodeIterator(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_PROCESSING_INSTRUCTION|NodeFilter.SHOW_CDATA_SECTION,null)},_isClobbered=function _isClobbered(elm){return elm instanceof HTMLFormElement&&("string"!=typeof elm.nodeName||"string"!=typeof elm.textContent||"function"!=typeof elm.removeChild||!(elm.attributes instanceof NamedNodeMap)||"function"!=typeof elm.removeAttribute||"function"!=typeof elm.setAttribute||"string"!=typeof elm.namespaceURI||"function"!=typeof elm.insertBefore||"function"!=typeof elm.hasChildNodes)},_isNode=function _isNode(object){return"function"==typeof Node&&object instanceof Node},_executeHook=function _executeHook(entryPoint,currentNode,data){hooks[entryPoint]&&arrayForEach(hooks[entryPoint],(hook=>{hook.call(DOMPurify,currentNode,data,CONFIG)}))},_sanitizeElements=function _sanitizeElements(currentNode){let content=null;if(_executeHook("beforeSanitizeElements",currentNode,null),_isClobbered(currentNode))return _forceRemove(currentNode),!0;const tagName=transformCaseFunc(currentNode.nodeName);if(_executeHook("uponSanitizeElement",currentNode,{tagName,allowedTags:ALLOWED_TAGS}),currentNode.hasChildNodes()&&!_isNode(currentNode.firstElementChild)&&regExpTest(/<[/\w]/g,currentNode.innerHTML)&&regExpTest(/<[/\w]/g,currentNode.textContent))return _forceRemove(currentNode),!0;if(currentNode.nodeType===NODE_TYPE_progressingInstruction)return _forceRemove(currentNode),!0;if(SAFE_FOR_XML&&currentNode.nodeType===NODE_TYPE_comment&&regExpTest(/<[/\w]/g,currentNode.data))return _forceRemove(currentNode),!0;if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(!FORBID_TAGS[tagName]&&_isBasicCustomElement(tagName)){if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,tagName))return!1;if(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName))return!1}if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]){const parentNode=getParentNode(currentNode)||currentNode.parentNode,childNodes=getChildNodes(currentNode)||currentNode.childNodes;if(childNodes&&parentNode){for(let i=childNodes.length-1;i>=0;--i){const childClone=cloneNode(childNodes[i],!0);childClone.__removalCount=(currentNode.__removalCount||0)+1,parentNode.insertBefore(childClone,getNextSibling(currentNode))}}}return _forceRemove(currentNode),!0}return currentNode instanceof Element&&!function _checkValidNamespace(element){let parent=getParentNode(element);parent&&parent.tagName||(parent={namespaceURI:NAMESPACE,tagName:"template"});const tagName=stringToLowerCase(element.tagName),parentTagName=stringToLowerCase(parent.tagName);return!!ALLOWED_NAMESPACES[element.namespaceURI]&&(element.namespaceURI===SVG_NAMESPACE?parent.namespaceURI===HTML_NAMESPACE?"svg"===tagName:parent.namespaceURI===MATHML_NAMESPACE?"svg"===tagName&&("annotation-xml"===parentTagName||MATHML_TEXT_INTEGRATION_POINTS[parentTagName]):Boolean(ALL_SVG_TAGS[tagName]):element.namespaceURI===MATHML_NAMESPACE?parent.namespaceURI===HTML_NAMESPACE?"math"===tagName:parent.namespaceURI===SVG_NAMESPACE?"math"===tagName&&HTML_INTEGRATION_POINTS[parentTagName]:Boolean(ALL_MATHML_TAGS[tagName]):element.namespaceURI===HTML_NAMESPACE?!(parent.namespaceURI===SVG_NAMESPACE&&!HTML_INTEGRATION_POINTS[parentTagName])&&!(parent.namespaceURI===MATHML_NAMESPACE&&!MATHML_TEXT_INTEGRATION_POINTS[parentTagName])&&!ALL_MATHML_TAGS[tagName]&&(COMMON_SVG_AND_HTML_ELEMENTS[tagName]||!ALL_SVG_TAGS[tagName]):!("application/xhtml+xml"!==PARSER_MEDIA_TYPE||!ALLOWED_NAMESPACES[element.namespaceURI]))}(currentNode)?(_forceRemove(currentNode),!0):"noscript"!==tagName&&"noembed"!==tagName&&"noframes"!==tagName||!regExpTest(/<\/no(script|embed|frames)/i,currentNode.innerHTML)?(SAFE_FOR_TEMPLATES&&currentNode.nodeType===NODE_TYPE_text&&(content=currentNode.textContent,arrayForEach([MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR],(expr=>{content=stringReplace(content,expr," ")})),currentNode.textContent!==content&&(arrayPush(DOMPurify.removed,{element:currentNode.cloneNode()}),currentNode.textContent=content)),_executeHook("afterSanitizeElements",currentNode,null),!1):(_forceRemove(currentNode),!0)},_isValidAttribute=function _isValidAttribute(lcTag,lcName,value){if(SANITIZE_DOM&&("id"===lcName||"name"===lcName)&&(value in document||value in formElement))return!1;if(ALLOW_DATA_ATTR&&!FORBID_ATTR[lcName]&&regExpTest(DATA_ATTR,lcName));else if(ALLOW_ARIA_ATTR&&regExpTest(ARIA_ATTR,lcName));else if(!ALLOWED_ATTR[lcName]||FORBID_ATTR[lcName]){if(!(_isBasicCustomElement(lcTag)&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,lcTag)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))&&(CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck,lcName)||CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName))||"is"===lcName&&CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp&&regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck,value)||CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function&&CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))))return!1}else if(URI_SAFE_ATTRIBUTES[lcName]);else if(regExpTest(IS_ALLOWED_URI$1,stringReplace(value,ATTR_WHITESPACE,"")));else if("src"!==lcName&&"xlink:href"!==lcName&&"href"!==lcName||"script"===lcTag||0!==stringIndexOf(value,"data:")||!DATA_URI_TAGS[lcTag]){if(ALLOW_UNKNOWN_PROTOCOLS&&!regExpTest(IS_SCRIPT_OR_DATA,stringReplace(value,ATTR_WHITESPACE,"")));else if(value)return!1}else;return!0},_isBasicCustomElement=function _isBasicCustomElement(tagName){return"annotation-xml"!==tagName&&stringMatch(tagName,CUSTOM_ELEMENT)},_sanitizeAttributes=function _sanitizeAttributes(currentNode){_executeHook("beforeSanitizeAttributes",currentNode,null);const{attributes}=currentNode;if(!attributes)return;const hookEvent={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ALLOWED_ATTR};let l=attributes.length;for(;l--;){const attr=attributes[l],{name,namespaceURI,value:attrValue}=attr,lcName=transformCaseFunc(name);let value="value"===name?attrValue:stringTrim(attrValue);const initValue=value;if(hookEvent.attrName=lcName,hookEvent.attrValue=value,hookEvent.keepAttr=!0,hookEvent.forceKeepAttr=void 0,_executeHook("uponSanitizeAttribute",currentNode,hookEvent),value=hookEvent.attrValue,hookEvent.forceKeepAttr)continue;if(!hookEvent.keepAttr){_removeAttribute(name,currentNode);continue}if(!ALLOW_SELF_CLOSE_IN_ATTR&&regExpTest(/\/>/i,value)){_removeAttribute(name,currentNode);continue}SAFE_FOR_TEMPLATES&&arrayForEach([MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR],(expr=>{value=stringReplace(value,expr," ")}));const lcTag=transformCaseFunc(currentNode.nodeName);if(_isValidAttribute(lcTag,lcName,value))if(!SANITIZE_NAMED_PROPS||"id"!==lcName&&"name"!==lcName||(_removeAttribute(name,currentNode),value="user-content-"+value),SAFE_FOR_XML&&regExpTest(/((--!?|])>)|<\/(style|title)/i,value))_removeAttribute(name,currentNode);else{if(trustedTypesPolicy&&"object"==typeof trustedTypes&&"function"==typeof trustedTypes.getAttributeType)if(namespaceURI);else switch(trustedTypes.getAttributeType(lcTag,lcName)){case"TrustedHTML":value=trustedTypesPolicy.createHTML(value);break;case"TrustedScriptURL":value=trustedTypesPolicy.createScriptURL(value)}if(value!==initValue)try{namespaceURI?currentNode.setAttributeNS(namespaceURI,name,value):currentNode.setAttribute(name,value),_isClobbered(currentNode)?_forceRemove(currentNode):arrayPop(DOMPurify.removed)}catch(_){}}else _removeAttribute(name,currentNode)}_executeHook("afterSanitizeAttributes",currentNode,null)},_sanitizeShadowDOM=function _sanitizeShadowDOM(fragment){let shadowNode=null;const shadowIterator=_createNodeIterator(fragment);for(_executeHook("beforeSanitizeShadowDOM",fragment,null);shadowNode=shadowIterator.nextNode();)_executeHook("uponSanitizeShadowNode",shadowNode,null),_sanitizeElements(shadowNode)||(shadowNode.content instanceof DocumentFragment&&_sanitizeShadowDOM(shadowNode.content),_sanitizeAttributes(shadowNode));_executeHook("afterSanitizeShadowDOM",fragment,null)};return DOMPurify.sanitize=function(dirty){let cfg=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},body=null,importedNode=null,currentNode=null,returnNode=null;if(IS_EMPTY_INPUT=!dirty,IS_EMPTY_INPUT&&(dirty="\x3c!--\x3e"),"string"!=typeof dirty&&!_isNode(dirty)){if("function"!=typeof dirty.toString)throw typeErrorCreate("toString is not a function");if("string"!=typeof(dirty=dirty.toString()))throw typeErrorCreate("dirty is not a string, aborting")}if(!DOMPurify.isSupported)return dirty;if(SET_CONFIG||_parseConfig(cfg),DOMPurify.removed=[],"string"==typeof dirty&&(IN_PLACE=!1),IN_PLACE){if(dirty.nodeName){const tagName=transformCaseFunc(dirty.nodeName);if(!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName])throw typeErrorCreate("root node is forbidden and cannot be sanitized in-place")}}else if(dirty instanceof Node)body=_initDocument("\x3c!----\x3e"),importedNode=body.ownerDocument.importNode(dirty,!0),importedNode.nodeType===NODE_TYPE_element&&"BODY"===importedNode.nodeName||"HTML"===importedNode.nodeName?body=importedNode:body.appendChild(importedNode);else{if(!RETURN_DOM&&!SAFE_FOR_TEMPLATES&&!WHOLE_DOCUMENT&&-1===dirty.indexOf("<"))return trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(dirty):dirty;if(body=_initDocument(dirty),!body)return RETURN_DOM?null:RETURN_TRUSTED_TYPE?emptyHTML:""}body&&FORCE_BODY&&_forceRemove(body.firstChild);const nodeIterator=_createNodeIterator(IN_PLACE?dirty:body);for(;currentNode=nodeIterator.nextNode();)_sanitizeElements(currentNode)||(currentNode.content instanceof DocumentFragment&&_sanitizeShadowDOM(currentNode.content),_sanitizeAttributes(currentNode));if(IN_PLACE)return dirty;if(RETURN_DOM){if(RETURN_DOM_FRAGMENT)for(returnNode=createDocumentFragment.call(body.ownerDocument);body.firstChild;)returnNode.appendChild(body.firstChild);else returnNode=body;return(ALLOWED_ATTR.shadowroot||ALLOWED_ATTR.shadowrootmode)&&(returnNode=importNode.call(originalDocument,returnNode,!0)),returnNode}let serializedHTML=WHOLE_DOCUMENT?body.outerHTML:body.innerHTML;return WHOLE_DOCUMENT&&ALLOWED_TAGS["!doctype"]&&body.ownerDocument&&body.ownerDocument.doctype&&body.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,body.ownerDocument.doctype.name)&&(serializedHTML="<!DOCTYPE "+body.ownerDocument.doctype.name+">\n"+serializedHTML),SAFE_FOR_TEMPLATES&&arrayForEach([MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR],(expr=>{serializedHTML=stringReplace(serializedHTML,expr," ")})),trustedTypesPolicy&&RETURN_TRUSTED_TYPE?trustedTypesPolicy.createHTML(serializedHTML):serializedHTML},DOMPurify.setConfig=function(){_parseConfig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),SET_CONFIG=!0},DOMPurify.clearConfig=function(){CONFIG=null,SET_CONFIG=!1},DOMPurify.isValidAttribute=function(tag,attr,value){CONFIG||_parseConfig({});const lcTag=transformCaseFunc(tag),lcName=transformCaseFunc(attr);return _isValidAttribute(lcTag,lcName,value)},DOMPurify.addHook=function(entryPoint,hookFunction){"function"==typeof hookFunction&&(hooks[entryPoint]=hooks[entryPoint]||[],arrayPush(hooks[entryPoint],hookFunction))},DOMPurify.removeHook=function(entryPoint){if(hooks[entryPoint])return arrayPop(hooks[entryPoint])},DOMPurify.removeHooks=function(entryPoint){hooks[entryPoint]&&(hooks[entryPoint]=[])},DOMPurify.removeAllHooks=function(){hooks={}},DOMPurify}();const each$4=Tools.each,trim=Tools.trim,queryParts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25},safeSvgDataUrlElements=["img","video"],isInvalidUri=(settings,uri,tagName)=>{const decodedUri=(encodedUri=>{try{return decodeURIComponent(encodedUri)}catch(ex){return unescape(encodedUri)}})(uri).replace(/\s/g,"");return!settings.allow_script_urls&&(!!/((java|vb)script|mhtml):/i.test(decodedUri)||!settings.allow_html_data_urls&&(/^data:image\//i.test(decodedUri)?((allowSvgDataUrls,tagName)=>isNonNullable(allowSvgDataUrls)?!allowSvgDataUrls:!isNonNullable(tagName)||!contains$2(safeSvgDataUrlElements,tagName))(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(decodedUri):/^data:/i.test(decodedUri)))};class URI{static parseDataUri(uri){let type;const uriComponents=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriComponents[0]);return matches&&(type=matches[1]),{type,data:uriComponents[1]}}static isDomSafe(uri,context,options={}){if(options.allow_script_urls)return!0;{const decodedUri=Entities.decode(uri).replace(/[\s\u0000-\u001F]+/g,"");return!isInvalidUri(options,decodedUri,context)}}static getDocumentBaseUrl(loc){var _a;let baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?null!==(_a=loc.href)&&void 0!==_a?_a:"":loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl}constructor(url,settings={}){this.path="",this.directory="",url=trim(url),this.settings=settings;const baseUri=settings.base_uri,self=this;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))return void(self.source=url);const isProtocolRelative=0===url.indexOf("//");if(0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+url),!/^[\w\-]*:?\/\//.test(url)){const baseUrl=baseUri?baseUri.path:new URI(document.location.href).directory;if(""===(null==baseUri?void 0:baseUri.protocol))url="//mce_host"+self.toAbsPath(baseUrl,url);else{const match=/([^#?]*)([#?]?.*)/.exec(url);match&&(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,match[1])+match[2])}}url=url.replace(/@@/g,"(mce_at)");const urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);urlMatch&&each$4(queryParts,((v,i)=>{let part=urlMatch[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part})),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}setPath(path){const pathMatch=/^(.*?)\/?(\w+)?$/.exec(path);pathMatch&&(this.path=pathMatch[0],this.directory=pathMatch[1],this.file=pathMatch[2]),this.source="",this.getURI()}toRelative(uri){if("./"===uri)return uri;const relativeUri=new URI(uri,{base_uri:this});if("mce_host"!==relativeUri.host&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&""!==relativeUri.protocol)return relativeUri.getURI();const tu=this.getURI(),uu=relativeUri.getURI();if(tu===uu||"/"===tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)===uu)return tu;let output=this.toRelPath(this.path,relativeUri.path);return relativeUri.query&&(output+="?"+relativeUri.query),relativeUri.anchor&&(output+="#"+relativeUri.anchor),output}toAbsolute(uri,noHost){const absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri))}isSameOrigin(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;const defaultPort=this.protocol?DEFAULT_PORTS[this.protocol]:null;if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1}toRelPath(base,path){let i,l,breakPoint=0,out="";const normalizedBase=base.substring(0,base.lastIndexOf("/")).split("/"),items=path.split("/");if(normalizedBase.length>=items.length)for(i=0,l=normalizedBase.length;i<l;i++)if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(normalizedBase.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!==breakPoint-1?"/"+items[i]:items[i];return out}toAbsPath(base,path){let nb=0;const tr=/\/$/.test(path)?"/":"",normalizedBase=base.split("/"),normalizedPath=path.split("/"),baseParts=[];each$4(normalizedBase,(k=>{k&&baseParts.push(k)}));const pathParts=[];for(let i=normalizedPath.length-1;i>=0;i--)0!==normalizedPath[i].length&&"."!==normalizedPath[i]&&(".."!==normalizedPath[i]?nb>0?nb--:pathParts.push(normalizedPath[i]):nb++);const i=baseParts.length-nb;let outPath;return outPath=i<=0?reverse(pathParts).join("/"):baseParts.slice(0,i).join("/")+"/"+reverse(pathParts).join("/"),0!==outPath.indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath}getURI(noProtoHost=!1){let s;return this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source}}const filteredUrlAttrs=Tools.makeMap("src,href,data,background,action,formaction,poster,xlink:href");let uid=0;const processNode=(node,settings,schema,scope,evt)=>{var _a,_b,_c,_d;const validate=settings.validate,specialElements=schema.getSpecialElements();8===node.nodeType&&!settings.allow_conditional_comments&&/^\[if/i.test(null!==(_a=node.nodeValue)&&void 0!==_a?_a:"")&&(node.nodeValue=" "+node.nodeValue);const lcTagName=null!==(_b=null==evt?void 0:evt.tagName)&&void 0!==_b?_b:node.nodeName.toLowerCase();if("html"!==scope&&schema.isValid(scope))return void(isNonNullable(evt)&&(evt.allowedTags[lcTagName]=!0));if(1!==node.nodeType||"body"===lcTagName)return;const element=SugarElement.fromDom(node),isInternalElement=has$1(element,"data-mce-type"),bogus=get$9(element,"data-mce-bogus");if(!isInternalElement&&isString(bogus))return void("all"===bogus?remove$5(element):unwrap(element));const rule=schema.getElementRule(lcTagName);if(!validate||rule){if(isNonNullable(evt)&&(evt.allowedTags[lcTagName]=!0),validate&&rule&&!isInternalElement){if(each$e(null!==(_c=rule.attributesForced)&&void 0!==_c?_c:[],(attr=>{set$3(element,attr.name,"{$uid}"===attr.value?"mce_"+uid++:attr.value)})),each$e(null!==(_d=rule.attributesDefault)&&void 0!==_d?_d:[],(attr=>{has$1(element,attr.name)||set$3(element,attr.name,"{$uid}"===attr.value?"mce_"+uid++:attr.value)})),rule.attributesRequired&&!exists(rule.attributesRequired,(attr=>has$1(element,attr))))return void unwrap(element);if(rule.removeEmptyAttrs&&(element=>{const attrs=element.dom.attributes;return null==attrs||0===attrs.length})(element))return void unwrap(element);rule.outputName&&rule.outputName!==lcTagName&&mutate(element,rule.outputName)}}else has$2(specialElements,lcTagName)?remove$5(element):unwrap(element)},shouldKeepAttribute=(settings,schema,scope,tagName,attrName,attrValue)=>"html"!==scope&&!isNonHtmlElementRootName(tagName)||!(attrName in filteredUrlAttrs&&isInvalidUri(settings,attrValue,tagName))&&(!settings.validate||schema.isValid(tagName,attrName)||startsWith(attrName,"data-")||startsWith(attrName,"aria-")),isRequiredAttributeOfInternalElement=(ele,attrName)=>ele.hasAttribute("data-mce-type")&&("id"===attrName||"class"===attrName||"style"===attrName),isBooleanAttribute=(attrName,schema)=>attrName in schema.getBoolAttrs(),filterAttributes=(ele,settings,schema,scope)=>{const{attributes}=ele;for(let i=attributes.length-1;i>=0;i--){const attr=attributes[i],attrName=attr.name,attrValue=attr.value;shouldKeepAttribute(settings,schema,scope,ele.tagName.toLowerCase(),attrName,attrValue)||isRequiredAttributeOfInternalElement(ele,attrName)?isBooleanAttribute(attrName,schema)&&ele.setAttribute(attrName,attrName):ele.removeAttribute(attrName)}},setupPurify=(settings,schema,namespaceTracker)=>{const purify$1=purify();return purify$1.addHook("uponSanitizeElement",((ele,evt)=>{processNode(ele,settings,schema,namespaceTracker.track(ele),evt)})),purify$1.addHook("uponSanitizeAttribute",((ele,evt)=>{((ele,settings,schema,scope,evt)=>{const tagName=ele.tagName.toLowerCase(),{attrName,attrValue}=evt;evt.keepAttr=shouldKeepAttribute(settings,schema,scope,tagName,attrName,attrValue),evt.keepAttr?(evt.allowedAttributes[attrName]=!0,isBooleanAttribute(attrName,schema)&&(evt.attrValue=attrName),settings.allow_svg_data_urls&&startsWith(attrValue,"data:image/svg+xml")&&(evt.forceKeepAttr=!0)):isRequiredAttributeOfInternalElement(ele,attrName)&&(evt.forceKeepAttr=!0)})(ele,settings,schema,namespaceTracker.current(),evt)})),purify$1},sanitizeNamespaceElement=ele=>{const xlinkAttrs=["type","href","role","arcrole","title","show","actuate","label","from","to"].map((name=>`xlink:${name}`)),config={IN_PLACE:!0,USE_PROFILES:{html:!0,svg:!0,svgFilters:!0},ALLOWED_ATTR:xlinkAttrs};return purify().sanitize(ele,config),ele.innerHTML},getSanitizer=(settings,schema)=>{const namespaceTracker=(()=>{let scopes=[];const peek=()=>scopes[scopes.length-1];return{track:node=>{isNonHtmlElementRoot(node)&&scopes.push(node);let currentScope=peek();return currentScope&&!currentScope.contains(node)&&(scopes.pop(),currentScope=peek()),toScopeType(currentScope)},current:()=>toScopeType(peek()),reset:()=>{scopes=[]}}})();if(settings.sanitize){const purify=setupPurify(settings,schema,namespaceTracker),sanitizeHtmlElement=(body,mimeType)=>{purify.sanitize(body,((settings,mimeType)=>{const config={IN_PLACE:!0,ALLOW_UNKNOWN_PROTOCOLS:!0,ALLOWED_TAGS:["#comment","#cdata-section","body"],ALLOWED_ATTR:[],SAFE_FOR_XML:!1};return config.PARSER_MEDIA_TYPE=mimeType,settings.allow_script_urls?config.ALLOWED_URI_REGEXP=/.*/:settings.allow_html_data_urls&&(config.ALLOWED_URI_REGEXP=/^(?!(\w+script|mhtml):)/i),config})(settings,mimeType)),purify.removed=[],namespaceTracker.reset()};return{sanitizeHtmlElement,sanitizeNamespaceElement}}return{sanitizeHtmlElement:(body,_mimeType)=>{const nodeIterator=document.createNodeIterator(body,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT);let node;for(;node=nodeIterator.nextNode();){const currentScope=namespaceTracker.track(node);processNode(node,settings,schema,currentScope),isElement$6(node)&&filterAttributes(node,settings,schema,currentScope)}namespaceTracker.reset()},sanitizeNamespaceElement:noop}},makeMap=Tools.makeMap,extend$1=Tools.extend,transferChildren=(parent,nativeParent,specialElements,nsSanitizer)=>{const parentName=parent.name,isSpecial=parentName in specialElements&&"title"!==parentName&&"textarea"!==parentName&&"noscript"!==parentName,childNodes=nativeParent.childNodes;for(let ni=0,nl=childNodes.length;ni<nl;ni++){const nativeChild=childNodes[ni],child=new AstNode(nativeChild.nodeName.toLowerCase(),nativeChild.nodeType);if(isElement$6(nativeChild)){const attributes=nativeChild.attributes;for(let ai=0,al=attributes.length;ai<al;ai++){const attr=attributes[ai];child.attr(attr.name,attr.value)}isNonHtmlElementRootName(child.name)&&(nsSanitizer(nativeChild),child.value=nativeChild.innerHTML)}else isText$a(nativeChild)?(child.value=nativeChild.data,isSpecial&&(child.raw=!0)):(isComment(nativeChild)||isCData(nativeChild)||isPi(nativeChild))&&(child.value=nativeChild.data);isNonHtmlElementRootName(child.name)||transferChildren(child,nativeChild,specialElements,nsSanitizer),parent.append(child)}},whitespaceCleaner=(root,schema,settings,args)=>{const validate=settings.validate,nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhitespaceElements(),blockElements=extend$1(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),textRootBlockElements=getTextRootBlockElements(schema),allWhiteSpaceRegExp=/[ \t\r\n]+/g,startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,hasWhitespaceParent=node=>{let tempNode=node.parent;for(;isNonNullable(tempNode);){if(tempNode.name in whitespaceElements)return!0;tempNode=tempNode.parent}return!1},isBlock=node=>node.name in blockElements||isTransparentAstBlock(schema,node)||isNonHtmlElementRootName(node.name)&&node.parent===root,isAtEdgeOfBlock=(node,start)=>{const neighbour=start?node.prev:node.next;return!isNonNullable(neighbour)&&!isNullable(node.parent)&&(isBlock(node.parent)&&(node.parent!==root||!0===args.isRootContent))};return[node=>{var _a;if(3===node.type&&!hasWhitespaceParent(node)){let text=null!==(_a=node.value)&&void 0!==_a?_a:"";text=text.replace(allWhiteSpaceRegExp," "),(((node,isBlock)=>isNonNullable(node)&&(isBlock(node)||"br"===node.name))(node.prev,isBlock)||isAtEdgeOfBlock(node,!0))&&(text=text.replace(startWhiteSpaceRegExp,"")),0===text.length?node.remove():node.value=text}},node=>{var _a;if(1===node.type){const elementRule=schema.getElementRule(node.name);if(validate&&elementRule){const isNodeEmpty=isEmpty(schema,nonEmptyElements,whitespaceElements,node);elementRule.paddInEmptyBlock&&isNodeEmpty&&(node=>{let tempNode=node;for(;isNonNullable(tempNode);){if(tempNode.name in textRootBlockElements)return isEmpty(schema,nonEmptyElements,whitespaceElements,tempNode);tempNode=tempNode.parent}return!1})(node)?paddEmptyNode(settings,args,isBlock,node):elementRule.removeEmpty&&isNodeEmpty?isBlock(node)?node.remove():node.unwrap():elementRule.paddEmpty&&(isNodeEmpty||(node=>{var _a;return hasOnlyChild(node,"#text")&&" "===(null===(_a=null==node?void 0:node.firstChild)||void 0===_a?void 0:_a.value)})(node))&&paddEmptyNode(settings,args,isBlock,node)}}else if(3===node.type&&!hasWhitespaceParent(node)){let text=null!==(_a=node.value)&&void 0!==_a?_a:"";(node.next&&isBlock(node.next)||isAtEdgeOfBlock(node,!1))&&(text=text.replace(endWhiteSpaceRegExp,"")),0===text.length?node.remove():node.value=text}}]},DomParser=(settings={},schema=Schema())=>{const nodeFilterRegistry=create$8(),attributeFilterRegistry=create$8(),defaultedSettings={validate:!0,root_name:"body",sanitize:!0,...settings},parser=new DOMParser,sanitizer=getSanitizer(defaultedSettings,schema),addNodeFilter=nodeFilterRegistry.addFilter,getNodeFilters=nodeFilterRegistry.getFilters,removeNodeFilter=nodeFilterRegistry.removeFilter,addAttributeFilter=attributeFilterRegistry.addFilter,getAttributeFilters=attributeFilterRegistry.getFilters,removeAttributeFilter=attributeFilterRegistry.removeFilter,isWrappableNode=(blockElements,node)=>{const isInternalElement=isString(node.attr("data-mce-type")),isInlineElement=1===node.type&&!has$2(blockElements,node.name)&&!isTransparentAstBlock(schema,node)&&!isNonHtmlElementRootName(node.name);return 3===node.type||isInlineElement&&!isInternalElement},exports={schema,addAttributeFilter,getAttributeFilters,removeAttributeFilter,addNodeFilter,getNodeFilters,removeNodeFilter,parse:(html,args={})=>{var _a;const validate=defaultedSettings.validate,rootName=null!==(_a=args.context)&&void 0!==_a?_a:defaultedSettings.root_name,element=((html,rootName,format="html")=>{const mimeType="xhtml"===format?"application/xhtml+xml":"text/html",isSpecialRoot=has$2(schema.getSpecialElements(),rootName.toLowerCase()),content=isSpecialRoot?`<${rootName}>${html}</${rootName}>`:html,wrappedHtml="xhtml"===format?`<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>${content}</body></html>`:`<body>${content}</body>`,body=parser.parseFromString(wrappedHtml,mimeType).body;return sanitizer.sanitizeHtmlElement(body,mimeType),isSpecialRoot?body.firstChild:body})(html,rootName,args.format);updateChildren(schema,element);const rootNode=new AstNode(rootName,11);transferChildren(rootNode,element,schema.getSpecialElements(),sanitizer.sanitizeNamespaceElement),element.innerHTML="";const[whitespacePre,whitespacePost]=whitespaceCleaner(rootNode,schema,defaultedSettings,args),invalidChildren=[],invalidFinder=validate?node=>((node,invalidChildren)=>{isInvalid(schema,node)&&invalidChildren.push(node)})(node,invalidChildren):noop,matches={nodes:{},attributes:{}},matchFinder=node=>matchNode$1(getNodeFilters(),getAttributeFilters(),node,matches);if(((root,preprocessors,postprocessors)=>{const traverseOrder=[];for(let node=root,lastNode=node;node;lastNode=node,node=node.walk()){const tempNode=node;each$e(preprocessors,(preprocess=>preprocess(tempNode))),isNullable(tempNode.parent)&&tempNode!==root?node=lastNode:traverseOrder.push(tempNode)}for(let i=traverseOrder.length-1;i>=0;i--){const node=traverseOrder[i];each$e(postprocessors,(postprocess=>postprocess(node)))}})(rootNode,[whitespacePre,matchFinder],[whitespacePost,invalidFinder]),invalidChildren.reverse(),validate&&invalidChildren.length>0)if(args.context){const{pass:topLevelChildren,fail:otherChildren}=partition$2(invalidChildren,(child=>child.parent===rootNode));cleanInvalidNodes(otherChildren,schema,rootNode,matchFinder),args.invalid=topLevelChildren.length>0}else cleanInvalidNodes(invalidChildren,schema,rootNode,matchFinder);const rootBlockName=((settings,args)=>{var _a;const name=null!==(_a=args.forced_root_block)&&void 0!==_a?_a:settings.forced_root_block;return!1===name?"":!0===name?"p":name})(defaultedSettings,args);return rootBlockName&&("body"===rootNode.name||args.isRootContent)&&((rootNode,rootBlockName)=>{const blockElements=extend$1(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/;let node=rootNode.firstChild,rootBlockNode=null;const trim=rootBlock=>{var _a,_b;rootBlock&&(node=rootBlock.firstChild,node&&3===node.type&&(node.value=null===(_a=node.value)||void 0===_a?void 0:_a.replace(startWhiteSpaceRegExp,"")),node=rootBlock.lastChild,node&&3===node.type&&(node.value=null===(_b=node.value)||void 0===_b?void 0:_b.replace(endWhiteSpaceRegExp,"")))};if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;){const next=node.next;isWrappableNode(blockElements,node)?(rootBlockNode||(rootBlockNode=new AstNode(rootBlockName,1),rootBlockNode.attr(defaultedSettings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node)),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next}trim(rootBlockNode)}})(rootNode,rootBlockName),args.invalid||runFilters(matches,args),rootNode}};return register$4(exports,defaultedSettings),((domParser,settings,schema)=>{settings.inline_styles&&addFilters(domParser,settings,schema)})(exports,defaultedSettings,schema),exports},withSerializedContent=(content,fireEvent,parserSettings)=>{const serializedContent=(content=>isTreeNode(content)?HtmlSerializer({validate:!1}).serialize(content):content)(content),eventArgs=fireEvent(serializedContent);if(eventArgs.isDefaultPrevented())return eventArgs;if(isTreeNode(content)){if(eventArgs.content!==serializedContent){const rootNode=DomParser({validate:!1,forced_root_block:!1,...parserSettings}).parse(eventArgs.content,{context:content.name});return{...eventArgs,content:rootNode}}return{...eventArgs,content}}return eventArgs},preProcessGetContent=(editor,args)=>{if(args.no_events)return Result.value(args);{const eventArgs=((editor,args)=>editor.dispatch("BeforeGetContent",args))(editor,args);return eventArgs.isDefaultPrevented()?Result.error(fireGetContent(editor,{content:"",...eventArgs}).content):Result.value(eventArgs)}},postProcessGetContent=(editor,content,args)=>{if(args.no_events)return content;{const processedEventArgs=withSerializedContent(content,(content=>fireGetContent(editor,{...args,content})),{sanitize:shouldSanitizeXss(editor),sandbox_iframes:shouldSandboxIframes(editor)});return processedEventArgs.content}},preProcessSetContent=(editor,args)=>{if(args.no_events)return Result.value(args);{const processedEventArgs=withSerializedContent(args.content,(content=>((editor,args)=>editor.dispatch("BeforeSetContent",args))(editor,{...args,content})),{sanitize:shouldSanitizeXss(editor),sandbox_iframes:shouldSandboxIframes(editor)});return processedEventArgs.isDefaultPrevented()?(fireSetContent(editor,processedEventArgs),Result.error(void 0)):Result.value(processedEventArgs)}},postProcessSetContent=(editor,content,args)=>{args.no_events||fireSetContent(editor,{...args,content})},tableModel=(element,width,rows)=>({element,width,rows}),tableRow=(element,cells)=>({element,cells}),cellPosition=(x,y)=>({x,y}),getSpan=(td,key)=>getOpt(td,key).bind(toInt).getOr(1),cellExists=(table,x,y)=>{const rows=table.rows;return!!(rows[y]?rows[y].cells:[])[x]},getWidth=rows=>foldl(rows,((acc,row)=>row.cells.length>acc?row.cells.length:acc),0),findElementPos=(table,element)=>{const rows=table.rows;for(let y=0;y<rows.length;y++){const cells=rows[y].cells;for(let x=0;x<cells.length;x++)if(eq(cells[x],element))return Optional.some(cellPosition(x,y))}return Optional.none()},extractRows=(table,sx,sy,ex,ey)=>{const newRows=[],rows=table.rows;for(let y=sy;y<=ey;y++){const cells=rows[y].cells,slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice))}return newRows},fromDom=tableElm=>{const table=tableModel(shallow$1(tableElm),0,[]);return each$e(descendants(tableElm,"tr"),((tr,y)=>{each$e(descendants(tr,"td,th"),((td,x)=>{((table,x,y,tr,td)=>{const rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows;for(let y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(deep$1(tr),[]));for(let x2=x;x2<x+colspan;x2++)rows[y2].cells[x2]=y2===y&&x2===x?td:shallow$1(td)}})(table,((table,x,y)=>{for(;cellExists(table,x,y);)x++;return x})(table,x,y),y,tr,td)}))})),tableModel(table.element,getWidth(table.rows),table.rows)},toDom=table=>((table,rows)=>{const tableElement=shallow$1(table.element),tableBody=SugarElement.fromTag("tbody");return append(tableBody,rows),append$1(tableElement,tableBody),tableElement})(table,(table=>map$3(table.rows,(row=>{const cells=map$3(row.cells,(cell=>{const td=deep$1(cell);return remove$a(td,"colspan"),remove$a(td,"rowspan"),td})),tr=shallow$1(row.element);return append(tr,cells),tr})))(table)),subsection=(table,startElement,endElement)=>findElementPos(table,startElement).bind((startPos=>findElementPos(table,endElement).map((endPos=>((table,startPos,endPos)=>{const sx=startPos.x,sy=startPos.y,ex=endPos.x,ey=endPos.y,newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows)})(table,startPos,endPos))))),getFullySelectedListWrappers=(parents,rng)=>find$2(parents,(elm=>"li"===name(elm)&&hasAllContentsSelected(elm,rng))).fold(constant([]),(_li=>(parents=>find$2(parents,(elm=>"ul"===name(elm)||"ol"===name(elm))))(parents).map((listCont=>{const listElm=SugarElement.fromTag(name(listCont)),listStyles=filter$4(getAllRaw(listCont),((_style,name)=>startsWith(name,"list-style")));return setAll(listElm,listStyles),[SugarElement.fromTag("li"),listElm]})).getOr([]))),getWrapElements=(rootNode,rng,schema)=>{const commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer),parents=parentsAndSelf(commonAnchorContainer,rootNode),wrapElements=filter$5(parents,(el=>schema.isWrapper(name(el)))),listWrappers=getFullySelectedListWrappers(parents,rng),allWrappers=wrapElements.concat(listWrappers.length?listWrappers:(commonAnchorContainer=>isListItem$1(commonAnchorContainer)?parent(commonAnchorContainer).filter(isList).fold(constant([]),(listElm=>[commonAnchorContainer,listElm])):isList(commonAnchorContainer)?[commonAnchorContainer]:[])(commonAnchorContainer));return map$3(allWrappers,shallow$1)},emptyFragment=()=>fromElements([]),getFragmentFromRange=(rootNode,rng,schema)=>((innerElm,elms)=>{const wrapped=foldl(elms,((acc,elm)=>(append$1(elm,acc),elm)),innerElm);return elms.length>0?fromElements([wrapped]):wrapped})(SugarElement.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng,schema)),getTableFragment=(rootNode,selectedTableCells)=>((rootElm,cell)=>ancestor$3(cell,"table",curry(eq,rootElm)))(rootNode,selectedTableCells[0]).bind((tableElm=>{const firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],fullTableModel=fromDom(tableElm);return subsection(fullTableModel,firstCell,lastCell).map((sectionedTableModel=>fromElements([toDom(sectionedTableModel)])))})).getOrThunk(emptyFragment),read$3=(rootNode,ranges,schema)=>{const selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):((rootNode,ranges,schema)=>ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0],schema))(rootNode,ranges,schema)},isCollapsibleWhitespace=(text,index)=>index>=0&&index<text.length&&isWhiteSpace(text.charAt(index)),getInnerText=bin=>trim$2(bin.innerText),extractSelectedContent=(editor,args)=>{if("text"===args.format)return(editor=>Optional.from(editor.selection.getRng()).map((rng=>{var _a;const parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock)),body=editor.getBody(),contextNodeName=(parentBlockOpt=>parentBlockOpt.map((block=>block.nodeName)).getOr("div").toLowerCase())(parentBlockOpt),rangeContentClone=SugarElement.fromDom(rng.cloneContents());cleanupBogusElements(rangeContentClone),cleanupInputNames(rangeContentClone);const bin=editor.dom.add(body,contextNodeName,{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},rangeContentClone.dom),text=getInnerText(bin),nonRenderedText=trim$2(null!==(_a=bin.textContent)&&void 0!==_a?_a:"");if(editor.dom.remove(bin),isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){const parentBlock=parentBlockOpt.getOr(body),parentBlockText=getInnerText(parentBlock),textIndex=parentBlockText.indexOf(text);return-1===textIndex?text:(isCollapsibleWhitespace(parentBlockText,textIndex-1)?" ":"")+text+(isCollapsibleWhitespace(parentBlockText,textIndex+text.length)?" ":"")}return text})).getOr(""))(editor);{const content=((editor,args)=>{const rng=editor.selection.getRng(),tmpElm=editor.dom.create("body"),sel=editor.selection.getSel(),ranges=processRanges(editor,getRanges$1(sel)),fragment=args.contextual?read$3(SugarElement.fromDom(editor.getBody()),ranges,editor.schema).dom:rng.cloneContents();return fragment&&tmpElm.appendChild(fragment),editor.selection.serializer.serialize(tmpElm,args)})(editor,args);return"tree"===args.format?content:editor.selection.isCollapsed()?"":content}},getOuterHtml=elm=>isElement$6(elm)?elm.outerHTML:isText$a(elm)?Entities.encodeRaw(elm.data,!1):isComment(elm)?"\x3c!--"+elm.data+"--\x3e":"",insertAt=(elm,html,index)=>{const fragment=(html=>{let node;const container=document.createElement("div"),frag=document.createDocumentFragment();for(html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag})(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){const target=elm.childNodes[index];elm.insertBefore(fragment,target)}else elm.appendChild(fragment)},write=(fragments,elm)=>(((diff,elm)=>{let index=0;each$e(diff,(action=>{0===action[0]?index++:1===action[0]?(insertAt(elm,action[1],index),index++):2===action[0]&&((elm,index)=>{if(elm.hasChildNodes()&&index<elm.childNodes.length){const target=elm.childNodes[index];elm.removeChild(target)}})(elm,index)}))})(((left,right)=>{const size=left.length+right.length+2,vDown=new Array(size),vUp=new Array(size),buildScript=(start1,end1,start2,end2,script)=>{const middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2){let i=start1,j=start2;for(;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end1-start1>end2-start2?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j)}else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(let i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=(start,diag,end1,end2)=>{let end=start;for(;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return((start,end,diag)=>({start,end,diag}))(start,end,diag)},getMiddleSnake=(start1,end1,start2,end2)=>{const m=end1-start1,n=end2-start2;if(0===m||0===n)return null;const delta=m-n,sum=n+m,offset=(sum%2==0?sum:sum+1)/2;let d,k,i,x,y;for(vDown[1+offset]=start1,vUp[1+offset]=end1+1,d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){for(i=k+offset,k===-d||k!==d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1,x=vDown[i],y=x-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],x=vUp[i]-1,y=x-start1+start2-k;x>=start1&&y>=start2&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}return null},script=[];return buildScript(0,left.length,0,right.length,script),script})(map$3(from(elm.childNodes),getOuterHtml),fragments),elm),elm),lazyTempDocument=cached((()=>document.implementation.createHTMLDocument("undo"))),createFromEditor=editor=>{const tempAttrs=editor.serializer.getTempAttrs(),body=trim$1(editor.getBody(),tempAttrs);return(body=>null!==body.querySelector("iframe"))(body)?(fragments=((elm,trimZwsp)=>filter$5(map$3(from(elm.childNodes),trimZwsp?compose(trim$2,getOuterHtml):getOuterHtml),(item=>item.length>0)))(body,!0),{type:"fragmented",fragments,content:"",bookmark:null,beforeBookmark:null}):{type:"complete",fragments:null,content:trim$2(body.innerHTML),bookmark:null,beforeBookmark:null};var fragments},applyToEditor=(editor,level,before)=>{const bookmark=before?level.beforeBookmark:level.bookmark;"fragmented"===level.type?write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw",no_selection:!isNonNullable(bookmark)||!isPathBookmark(bookmark)||!bookmark.isFakeCaret}),bookmark&&(editor.selection.moveToBookmark(bookmark),editor.selection.scrollIntoView())},getLevelContent=level=>"fragmented"===level.type?level.fragments.join(""):level.content,getCleanLevelContent=level=>{const elm=SugarElement.fromTag("body",lazyTempDocument());return set$1(elm,getLevelContent(level)),each$e(descendants(elm,"*[data-mce-bogus]"),unwrap),get$6(elm)},isEq$1=(level1,level2)=>!(!level1||!level2)&&(!!((level1,level2)=>getLevelContent(level1)===getLevelContent(level2))(level1,level2)||((level1,level2)=>getCleanLevelContent(level1)===getCleanLevelContent(level2))(level1,level2)),isUnlocked=locks=>0===locks.get(),setTyping=(undoManager,typing,locks)=>{isUnlocked(locks)&&(undoManager.typing=typing)},endTyping=(undoManager,locks)=>{undoManager.typing&&(setTyping(undoManager,!1,locks),undoManager.add())},makePlainAdaptor=editor=>({init:{bindEvents:noop},undoManager:{beforeChange:(locks,beforeBookmark)=>((editor,locks,beforeBookmark)=>{isUnlocked(locks)&&beforeBookmark.set(getUndoBookmark(editor.selection))})(editor,locks,beforeBookmark),add:(undoManager,index,locks,beforeBookmark,level,event)=>((editor,undoManager,index,locks,beforeBookmark,level,event)=>{const currentLevel=createFromEditor(editor),newLevel=Tools.extend(level||{},currentLevel);if(!isUnlocked(locks)||editor.removed)return null;const lastLevel=undoManager.data[index.get()];if(editor.dispatch("BeforeAddUndo",{level:newLevel,lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&isEq$1(lastLevel,newLevel))return null;undoManager.data[index.get()]&&beforeBookmark.get().each((bm=>{undoManager.data[index.get()].beforeBookmark=bm}));const customUndoRedoLevels=getCustomUndoRedoLevels(editor);if(customUndoRedoLevels&&undoManager.data.length>customUndoRedoLevels){for(let i=0;i<undoManager.data.length-1;i++)undoManager.data[i]=undoManager.data[i+1];undoManager.data.length--,index.set(undoManager.data.length)}newLevel.bookmark=getUndoBookmark(editor.selection),index.get()<undoManager.data.length-1&&(undoManager.data.length=index.get()+1),undoManager.data.push(newLevel),index.set(undoManager.data.length-1);const args={level:newLevel,lastLevel,originalEvent:event};return index.get()>0?(editor.setDirty(!0),editor.dispatch("AddUndo",args),editor.dispatch("change",args)):editor.dispatch("AddUndo",args),newLevel})(editor,undoManager,index,locks,beforeBookmark,level,event),undo:(undoManager,locks,index)=>((editor,undoManager,locks,index)=>{let level;return undoManager.typing&&(undoManager.add(),undoManager.typing=!1,setTyping(undoManager,!1,locks)),index.get()>0&&(index.set(index.get()-1),level=undoManager.data[index.get()],applyToEditor(editor,level,!0),editor.setDirty(!0),editor.dispatch("Undo",{level})),level})(editor,undoManager,locks,index),redo:(index,data)=>((editor,index,data)=>{let level;return index.get()<data.length-1&&(index.set(index.get()+1),level=data[index.get()],applyToEditor(editor,level,!1),editor.setDirty(!0),editor.dispatch("Redo",{level})),level})(editor,index,data),clear:(undoManager,index)=>((editor,undoManager,index)=>{undoManager.data=[],index.set(0),undoManager.typing=!1,editor.dispatch("ClearUndos")})(editor,undoManager,index),reset:undoManager=>(undoManager=>{undoManager.clear(),undoManager.add()})(undoManager),hasUndo:(undoManager,index)=>((editor,undoManager,index)=>index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$1(createFromEditor(editor),undoManager.data[0]))(editor,undoManager,index),hasRedo:(undoManager,index)=>((undoManager,index)=>index.get()<undoManager.data.length-1&&!undoManager.typing)(undoManager,index),transact:(undoManager,locks,callback)=>((undoManager,locks,callback)=>(endTyping(undoManager,locks),undoManager.beforeChange(),undoManager.ignore(callback),undoManager.add()))(undoManager,locks,callback),ignore:(locks,callback)=>((locks,callback)=>{try{locks.set(locks.get()+1),callback()}finally{locks.set(locks.get()-1)}})(locks,callback),extra:(undoManager,index,callback1,callback2)=>((editor,undoManager,index,callback1,callback2)=>{if(undoManager.transact(callback1)){const bookmark=undoManager.data[index.get()].bookmark,lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,!0),undoManager.transact(callback2)&&(undoManager.data[index.get()-1].beforeBookmark=bookmark)}})(editor,undoManager,index,callback1,callback2)},formatter:{match:(name,vars,node,similar)=>match$2(editor,name,vars,node,similar),matchAll:(names,vars)=>((editor,names,vars)=>{const matchedFormatNames=[],checkedMap={},startElement=editor.selection.getStart();return editor.dom.getParent(startElement,(node=>{for(let i=0;i<names.length;i++){const name=names[i];!checkedMap[name]&&matchNode(editor,node,name,vars)&&(checkedMap[name]=!0,matchedFormatNames.push(name))}}),editor.dom.getRoot()),matchedFormatNames})(editor,names,vars),matchNode:(node,name,vars,similar)=>matchNode(editor,node,name,vars,similar),canApply:name=>((editor,name)=>{const formatList=editor.formatter.get(name),dom=editor.dom;if(formatList&&editor.selection.isEditable()){const startNode=editor.selection.getStart(),parents=getParents$2(dom,startNode);for(let x=formatList.length-1;x>=0;x--){const format=formatList[x];if(!isSelectorFormat(format))return!0;for(let i=parents.length-1;i>=0;i--)if(dom.is(parents[i],format.selector))return!0}}return!1})(editor,name),closest:names=>closest(editor,names),apply:(name,vars,node)=>applyFormat$1(editor,name,vars,node),remove:(name,vars,node,similar)=>removeFormat$1(editor,name,vars,node,similar),toggle:(name,vars,node)=>((editor,name,vars,node)=>{const fmt=editor.formatter.get(name);fmt&&(!match$2(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?applyFormat$1(editor,name,vars,node):removeFormat$1(editor,name,vars,node))})(editor,name,vars,node),formatChanged:(registeredFormatListeners,formats,callback,similar,vars)=>formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar,vars)},editor:{getContent:args=>((editor,args)=>Optional.from(editor.getBody()).fold(constant("tree"===args.format?new AstNode("body",11):""),(body=>getContentFromBody(editor,args,body))))(editor,args),setContent:(content,args)=>setContentInternal(editor,content,args),insertContent:(value,details)=>insertHtmlAtCaret(editor,value,details),addVisual:elm=>((editor,elm)=>{const dom=editor.dom,scope=isNonNullable(elm)?elm:editor.getBody();each$e(dom.select("table,a",scope),(matchedElm=>{switch(matchedElm.nodeName){case"TABLE":const cls=getVisualAidsTableClass(editor),value=dom.getAttrib(matchedElm,"border");value&&"0"!==value||!editor.hasVisual?dom.removeClass(matchedElm,cls):dom.addClass(matchedElm,cls);break;case"A":if(!dom.getAttrib(matchedElm,"href")){const value=dom.getAttrib(matchedElm,"name")||matchedElm.id,cls=getVisualAidsAnchorClass(editor);value&&editor.hasVisual?dom.addClass(matchedElm,cls):dom.removeClass(matchedElm,cls)}}})),editor.dispatch("VisualAid",{element:elm,hasVisual:editor.hasVisual})})(editor,elm)},selection:{getContent:(format,args)=>((editor,format,args={})=>{const defaultedArgs=((args,format)=>({...args,format,get:!0,selection:!0,getInner:!0}))(args,format);return preProcessGetContent(editor,defaultedArgs).fold(identity,(updatedArgs=>{const content=extractSelectedContent(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs)}))})(editor,format,args)},autocompleter:{addDecoration:range=>create$9(editor,range),removeDecoration:()=>((editor,elm)=>findIn(elm).each((wrapper=>{const bookmark=editor.selection.getBookmark();unwrap(wrapper),editor.selection.moveToBookmark(bookmark)})))(editor,SugarElement.fromDom(editor.getBody()))},raw:{getModel:()=>Optional.none()}}),isRtc=editor=>has$2(editor.plugins,"rtc"),setup$t=editor=>{const editorCast=editor;return(editor=>get$a(editor.plugins,"rtc").bind((rtcPlugin=>Optional.from(rtcPlugin.setup))))(editor).fold((()=>(editorCast.rtcInstance=makePlainAdaptor(editor),Optional.none())),(setup=>(editorCast.rtcInstance=(()=>{const nul=constant(null),empty=constant("");return{init:{bindEvents:noop},undoManager:{beforeChange:noop,add:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:constant(void 0),canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:constant({content:"",html:""}),insertContent:constant(""),addVisual:noop},selection:{getContent:empty},autocompleter:{addDecoration:noop,removeDecoration:noop},raw:{getModel:constant(Optional.none())}}})(),Optional.some((()=>setup().then((rtcEditor=>(editorCast.rtcInstance=(rtcEditor=>{const defaultVars=vars=>isObject(vars)?vars:{},{init,undoManager,formatter,editor,selection,autocompleter,raw}=rtcEditor;return{init:{bindEvents:init.bindEvents},undoManager:{beforeChange:undoManager.beforeChange,add:undoManager.add,undo:undoManager.undo,redo:undoManager.redo,clear:undoManager.clear,reset:undoManager.reset,hasUndo:undoManager.hasUndo,hasRedo:undoManager.hasRedo,transact:(_undoManager,_locks,fn)=>undoManager.transact(fn),ignore:(_locks,callback)=>undoManager.ignore(callback),extra:(_undoManager,_index,callback1,callback2)=>undoManager.extra(callback1,callback2)},formatter:{match:(name,vars,_node,similar)=>formatter.match(name,defaultVars(vars),similar),matchAll:formatter.matchAll,matchNode:formatter.matchNode,canApply:name=>formatter.canApply(name),closest:names=>formatter.closest(names),apply:(name,vars,_node)=>formatter.apply(name,defaultVars(vars)),remove:(name,vars,_node,_similar)=>formatter.remove(name,defaultVars(vars)),toggle:(name,vars,_node)=>formatter.toggle(name,defaultVars(vars)),formatChanged:(_rfl,formats,callback,similar,vars)=>formatter.formatChanged(formats,callback,similar,vars)},editor:{getContent:args=>editor.getContent(args),setContent:(content,args)=>({content:editor.setContent(content,args),html:""}),insertContent:(content,_details)=>(editor.insertContent(content),""),addVisual:editor.addVisual},selection:{getContent:(_format,args)=>selection.getContent(args)},autocompleter:{addDecoration:autocompleter.addDecoration,removeDecoration:autocompleter.removeDecoration},raw:{getModel:()=>Optional.some(raw.getRawModel())}}})(rtcEditor),rtcEditor.rtc.isRemote))))))))},getRtcInstanceWithFallback=editor=>editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor),getRtcInstanceWithError=editor=>{const rtcInstance=editor.rtcInstance;if(rtcInstance)return rtcInstance;throw new Error("Failed to get RTC instance not yet initialized.")},bindEvents=editor=>getRtcInstanceWithError(editor).init.bindEvents(),getContent$1=(editor,args={})=>((editor,format,args)=>getRtcInstanceWithError(editor).selection.getContent(format,args))(editor,args.format?args.format:"html",args),removeEmpty=text=>0===text.dom.length?(remove$5(text),Optional.none()):Optional.some(text),mergeAndNormalizeText=(outerNode,innerNode,rng,start,schema)=>{outerNode.bind((outer=>((start?normalizeWhitespaceBefore:normalizeWhitespaceAfter)(outer.dom,start?outer.dom.length:0,schema),innerNode.filter(isText$b).map((inner=>((outer,inner,rng,start,schema)=>{const outerElm=outer.dom,innerElm=inner.dom,oldLength=start?outerElm.length:innerElm.length;start?(mergeTextNodes(outerElm,innerElm,schema,!1,!start),rng.setStart(innerElm,oldLength)):(mergeTextNodes(innerElm,outerElm,schema,!1,!start),rng.setEnd(innerElm,oldLength))})(outer,inner,rng,start,schema)))))).orThunk((()=>{const innerTextNode=((node,start)=>node.filter((elm=>BookmarkManager.isBookmarkNode(elm.dom))).bind(start?nextSibling:prevSibling))(innerNode,start).or(innerNode).filter(isText$b);return innerTextNode.map((inner=>((inner,start,schema)=>{parent(inner).each((root=>{const text=inner.dom;start&&needsToBeNbspLeft(root,CaretPosition(text,0),schema)?normalizeWhitespaceAfter(text,0,schema):!start&&needsToBeNbspRight(root,CaretPosition(text,text.length),schema)&&normalizeWhitespaceBefore(text,text.length,schema)}))})(inner,start,schema)))}))},setContent$1=(editor,content,args={})=>{const defaultedArgs=((args,content)=>({format:"html",...args,set:!0,selection:!0,content}))(args,content);preProcessSetContent(editor,defaultedArgs).each((updatedArgs=>{const cleanedContent=((editor,args)=>{if("raw"!==args.format){const rng=editor.selection.getRng(),contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock),contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{},node=editor.parser.parse(args.content,{forced_root_block:!1,...contextArgs,...args});return HtmlSerializer({validate:!1},editor.schema).serialize(node)}return args.content})(editor,updatedArgs),rng=editor.selection.getRng();((rng,fragment,schema)=>{const firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom),lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents(),rng.insertNode(fragment);const prevText=firstChild.bind(prevSibling).filter(isText$b).bind(removeEmpty),nextText=lastChild.bind(nextSibling).filter(isText$b).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,!0,schema),mergeAndNormalizeText(nextText,lastChild,rng,!1,schema),rng.collapse(!1)})(rng,rng.createContextualFragment(cleanedContent),editor.schema),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng),postProcessSetContent(editor,cleanedContent,updatedArgs)}))},deleteFromCallbackMap=(callbackMap,selector,callback)=>{if(has$2(callbackMap,selector)){const newCallbacks=filter$5(callbackMap[selector],(cb=>cb!==callback));0===newCallbacks.length?delete callbackMap[selector]:callbackMap[selector]=newCallbacks}};var SelectorChanged=(dom,editor)=>{let selectorChangedData,currentSelectors;const findMatchingNode=(selector,nodes)=>find$2(nodes,(node=>dom.is(node,selector))),getParents=elem=>dom.getParents(elem,void 0,dom.getRoot());return{selectorChangedWithUnbind:(selector,callback)=>(selectorChangedData||(selectorChangedData={},currentSelectors={},editor.on("NodeChange",(e=>{const node=e.element,parents=getParents(node),matchedSelectors={};each$d(selectorChangedData,((callbacks,selector)=>{findMatchingNode(selector,parents).each((node=>{currentSelectors[selector]||(each$e(callbacks,(callback=>{callback(!0,{node,selector,parents})})),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks}))})),each$d(currentSelectors,((callbacks,selector)=>{matchedSelectors[selector]||(delete currentSelectors[selector],each$e(callbacks,(callback=>{callback(!1,{node,selector,parents})})))}))}))),selectorChangedData[selector]||(selectorChangedData[selector]=[]),selectorChangedData[selector].push(callback),findMatchingNode(selector,getParents(editor.selection.getStart())).each((()=>{currentSelectors[selector]=selectorChangedData[selector]})),{unbind:()=>{deleteFromCallbackMap(selectorChangedData,selector,callback),deleteFromCallbackMap(currentSelectors,selector,callback)}})}};const isAttachedToDom=node=>!(!node||!node.ownerDocument)&&contains(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node)),EditorSelection=(dom,win,serializer,editor)=>{let selectedRange,explicitRange;const{selectorChangedWithUnbind}=SelectorChanged(dom,editor),setContent=(content,args)=>setContent$1(editor,content,args),collapse=toStart=>{const rng=getRng$1();rng.collapse(!!toStart),setRng(rng)},getSel=()=>win.getSelection?win.getSelection():win.document.selection,getRng$1=()=>{let rng;const tryCompareBoundaryPoints=(how,sourceRange,destinationRange)=>{try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}},doc=win.document;if(isNonNullable(editor.bookmark)&&!hasFocus(editor)){const bookmark=getRng(editor);if(bookmark.isSome())return bookmark.map((r=>processRanges(editor,[r])[0])).getOr(doc.createRange())}try{const selection=getSel();selection&&!isRestrictedNode(selection.anchorNode)&&(rng=selection.rangeCount>0?selection.getRangeAt(0):doc.createRange(),rng=processRanges(editor,[rng])[0])}catch(ex){}if(rng||(rng=doc.createRange()),isDocument$1(rng.startContainer)&&rng.collapsed){const elm=dom.getRoot();rng.setStart(elm,0),rng.setEnd(elm,0)}return selectedRange&&explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)?rng=explicitRange:(selectedRange=null,explicitRange=null)),rng},setRng=(rng,forward)=>{if(!(rng=>!!rng&&isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))(rng))return;const sel=getSel();if(rng=editor.dispatch("SetSelectionRange",{range:rng,forward}).range,sel){explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}if(!rng.collapsed&&rng.startContainer===rng.endContainer&&(null==sel?void 0:sel.setBaseAndExtent)&&rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()){const node=rng.startContainer.childNodes[rng.startOffset];node&&"IMG"===node.nodeName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1))}editor.dispatch("AfterSetSelectionRange",{range:rng,forward})},isForward=()=>{const sel=getSel(),anchorNode=null==sel?void 0:sel.anchorNode,focusNode=null==sel?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode))return!0;const anchorRange=dom.createRng(),focusRange=dom.createRng();try{anchorRange.setStart(anchorNode,sel.anchorOffset),anchorRange.collapse(!0),focusRange.setStart(focusNode,sel.focusOffset),focusRange.collapse(!0)}catch(e){return!0}return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0},exports={dom,win,serializer,editor,expand:(options={type:"word"})=>setRng(RangeUtils(dom).expand(getRng$1(),options)),collapse,setCursorLocation:(node,offset)=>{const rng=dom.createRng();isNonNullable(node)&&isNonNullable(offset)?(rng.setStart(node,offset),rng.setEnd(node,offset),setRng(rng),collapse(!1)):(moveEndPoint(dom,rng,editor.getBody(),!0),setRng(rng))},getContent:args=>getContent$1(editor,args),setContent,getBookmark:(type,normalized)=>bookmarkManager.getBookmark(type,normalized),moveToBookmark:bookmark=>bookmarkManager.moveToBookmark(bookmark),select:(node,content)=>(((dom,node,content)=>Optional.from(node).bind((node=>Optional.from(node.parentNode).map((parent=>{const idx=dom.nodeIndex(node),rng=dom.createRng();return rng.setStart(parent,idx),rng.setEnd(parent,idx+1),content&&(moveEndPoint(dom,rng,node,!0),moveEndPoint(dom,rng,node,!1)),rng})))))(dom,node,content).each(setRng),node),isCollapsed:()=>{const rng=getRng$1(),sel=getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},isEditable:()=>{const rng=getRng$1(),fakeSelectedElements=editor.getBody().querySelectorAll('[data-mce-selected="1"]');return fakeSelectedElements.length>0?forall(fakeSelectedElements,(el=>dom.isEditable(el.parentElement))):isEditableRange(dom,rng)},isForward,setNode:elm=>(setContent(dom.getOuterHTML(elm)),elm),getNode:()=>((root,rng)=>{if(!rng)return root;let startContainer=rng.startContainer,endContainer=rng.endContainer;const startOffset=rng.startOffset,endOffset=rng.endOffset;let node=rng.commonAncestorContainer;rng.collapsed||(startContainer===endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(node=startContainer.childNodes[startOffset]),isText$a(startContainer)&&isText$a(endContainer)&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer&&(node=startContainer)));const elm=isText$a(node)?node.parentNode:node;return isHTMLElement(elm)?elm:root})(editor.getBody(),getRng$1()),getSel,setRng,getRng:getRng$1,getStart:real=>getStart(editor.getBody(),getRng$1(),real),getEnd:real=>getEnd$1(editor.getBody(),getRng$1(),real),getSelectedBlocks:(startElm,endElm)=>((dom,rng,startElm,endElm)=>{const selectedBlocks=[],root=dom.getRoot(),start=dom.getParent(startElm||getStart(root,rng,rng.collapsed),dom.isBlock),end=dom.getParent(endElm||getEnd$1(root,rng,rng.collapsed),dom.isBlock);if(start&&start!==root&&selectedBlocks.push(start),start&&end&&start!==end){let node;const walker=new DomTreeWalker(start,root);for(;(node=walker.next())&&node!==end;)dom.isBlock(node)&&selectedBlocks.push(node)}return end&&start!==end&&end!==root&&selectedBlocks.push(end),selectedBlocks})(dom,getRng$1(),startElm,endElm),normalize:()=>{const rng=getRng$1(),sel=getSel();if(!(getRanges$1(sel).length>1)&&hasAnyRanges(editor)){const normRng=normalize$2(dom,rng);return normRng.each((normRng=>{setRng(normRng,isForward())})),normRng.getOr(rng)}return rng},selectorChanged:(selector,callback)=>(selectorChangedWithUnbind(selector,callback),exports),selectorChangedWithUnbind,getScrollContainer:()=>{let scrollContainer,node=dom.getRoot();for(;node&&"BODY"!==node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:(elm,alignToTop)=>{isNonNullable(elm)?((editor,element,alignToTop)=>{(editor.inline?elementIntoWindow:elementIntoFrame)(editor,element,alignToTop)})(editor,elm,alignToTop):scrollRangeIntoView(editor,getRng$1(),alignToTop)},placeCaretAt:(clientX,clientY)=>setRng(fromPoint(clientX,clientY,editor.getDoc())),getBoundingClientRect:()=>{const rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy:()=>{win=selectedRange=explicitRange=null,controlSelection.destroy()}},bookmarkManager=BookmarkManager(exports),controlSelection=ControlSelection(exports,editor);return exports.bookmarkManager=bookmarkManager,exports.controlSelection=controlSelection,exports},process$1=(editor,node,args)=>((editor,args)=>isNonNullable(editor)&&editor.hasEventListeners("PreProcess")&&!args.no_events)(editor,args)?((editor,node,args)=>{let oldDoc;const dom=editor.dom;let clonedNode=node.cloneNode(!0);const impl=document.implementation;if(impl.createHTMLDocument){const doc=impl.createHTMLDocument("");Tools.each("BODY"===clonedNode.nodeName?clonedNode.childNodes:[clonedNode],(node=>{doc.body.appendChild(doc.importNode(node,!0))})),clonedNode="BODY"!==clonedNode.nodeName?doc.body.firstChild:doc.body,oldDoc=dom.doc,dom.doc=doc}return((editor,args)=>{editor.dispatch("PreProcess",args)})(editor,{...args,node:clonedNode}),oldDoc&&(dom.doc=oldDoc),clonedNode})(editor,node,args):node,addTempAttr=(htmlParser,tempAttrs,name)=>{-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,((nodes,name)=>{let i=nodes.length;for(;i--;)nodes[i].attr(name,null)})),tempAttrs.push(name))},toHtml=(editor,settings,schema,rootNode,args)=>{const content=((settings,schema,node)=>HtmlSerializer(settings,schema).serialize(node))(settings,schema,rootNode);return((editor,args,content)=>{if(!args.no_events&&editor){const outArgs=((editor,args)=>editor.dispatch("PostProcess",args))(editor,{...args,content});return outArgs.content}return content})(editor,args,content)},DomSerializerImpl=(settings,editor)=>{const tempAttrs=["data-mce-selected"],defaultedSettings={entity_encoding:"named",remove_trailing_brs:!0,pad_empty_with_br:!1,...settings},dom=editor&&editor.dom?editor.dom:DOMUtils.DOM,schema=editor&&editor.schema?editor.schema:Schema(defaultedSettings),htmlParser=DomParser(defaultedSettings,schema);((htmlParser,settings,dom)=>{htmlParser.addAttributeFilter("data-mce-tabindex",((nodes,name)=>{let i=nodes.length;for(;i--;){const node=nodes[i];node.attr("tabindex",node.attr("data-mce-tabindex")),node.attr(name,null)}})),htmlParser.addAttributeFilter("src,href,style",((nodes,name)=>{const internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope;let i=nodes.length;for(;i--;){const node=nodes[i];let value=node.attr(internalName);void 0!==value?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attr(name),"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))}})),htmlParser.addAttributeFilter("class",(nodes=>{let i=nodes.length;for(;i--;){const node=nodes[i];let value=node.attr("class");value&&(value=value.replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))}})),htmlParser.addAttributeFilter("data-mce-type",((nodes,name,args)=>{let i=nodes.length;for(;i--;){const node=nodes[i];if("bookmark"===node.attr("data-mce-type")&&!args.cleanup){const hasChildren=Optional.from(node.firstChild).exists((firstChild=>{var _a;return!isZwsp$1(null!==(_a=firstChild.value)&&void 0!==_a?_a:"")}));hasChildren?node.unwrap():node.remove()}}})),htmlParser.addNodeFilter("script,style",((nodes,name)=>{var _a;const trim=value=>value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"");let i=nodes.length;for(;i--;){const node=nodes[i],firstChild=node.firstChild,value=null!==(_a=null==firstChild?void 0:firstChild.value)&&void 0!==_a?_a:"";if("script"===name){const type=node.attr("type");type&&node.attr("type","mce-no/type"===type?null:type.replace(/^mce\-/,"")),"xhtml"===settings.element_format&&firstChild&&value.length>0&&(firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")}else"xhtml"===settings.element_format&&firstChild&&value.length>0&&(firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")}})),htmlParser.addNodeFilter("#comment",(nodes=>{let i=nodes.length;for(;i--;){const node=nodes[i],value=node.value;settings.preserve_cdata&&0===(null==value?void 0:value.indexOf("[CDATA["))?(node.name="#cdata",node.type=4,node.value=dom.decode(value.replace(/^\[CDATA\[|\]\]$/g,""))):0===(null==value?void 0:value.indexOf("mce:protected "))&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(value).substr(14))}})),htmlParser.addNodeFilter("xml:namespace,input",((nodes,name)=>{let i=nodes.length;for(;i--;){const node=nodes[i];7===node.type?node.remove():1===node.type&&("input"!==name||node.attr("type")||node.attr("type","text"))}})),htmlParser.addAttributeFilter("data-mce-type",(nodes=>{each$e(nodes,(node=>{"format-caret"===node.attr("data-mce-type")&&(node.isEmpty(htmlParser.schema.getNonEmptyElements())?node.remove():node.unwrap())}))})),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-block,data-mce-type,data-mce-resize,data-mce-placeholder",((nodes,name)=>{let i=nodes.length;for(;i--;)nodes[i].attr(name,null)})),settings.remove_trailing_brs&&addNodeFilter(settings,htmlParser,htmlParser.schema)})(htmlParser,defaultedSettings,dom);return{schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:(node,parserArgs={})=>{const args={format:"html",...parserArgs},targetNode=process$1(editor,node,args),html=((dom,node,args)=>{const html=trim$2(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html)})(dom,targetNode,args),rootNode=((htmlParser,html,args)=>{const parserArgs=args.selection?{forced_root_block:!1,...args}:args,rootNode=htmlParser.parse(html,parserArgs);return(rootNode=>{const isBr=node=>"br"===(null==node?void 0:node.name),brNode1=rootNode.lastChild;if(isBr(brNode1)){const brNode2=brNode1.prev;isBr(brNode2)&&(brNode1.remove(),brNode2.remove())}})(rootNode),rootNode})(htmlParser,html,args);return"tree"===args.format?rootNode:toHtml(editor,defaultedSettings,schema,rootNode,args)},addRules:schema.addValidElements,setRules:schema.setValidElements,addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters,removeNodeFilter:htmlParser.removeNodeFilter,removeAttributeFilter:htmlParser.removeAttributeFilter}},DomSerializer=(settings,editor)=>{const domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters,removeNodeFilter:domSerializer.removeNodeFilter,removeAttributeFilter:domSerializer.removeAttributeFilter}},getContent=(editor,args={})=>{const defaultedArgs=((args,format)=>({...args,format,get:!0,getInner:!0}))(args,args.format?args.format:"html");return preProcessGetContent(editor,defaultedArgs).fold(identity,(updatedArgs=>{const content=((editor,args)=>getRtcInstanceWithFallback(editor).editor.getContent(args))(editor,updatedArgs);return postProcessGetContent(editor,content,updatedArgs)}))},setContent=(editor,content,args={})=>{const defaultedArgs=((args,content)=>({format:"html",...args,set:!0,content}))(args,content);return preProcessSetContent(editor,defaultedArgs).map((updatedArgs=>{const result=((editor,content,args)=>getRtcInstanceWithFallback(editor).editor.setContent(content,args))(editor,updatedArgs.content,updatedArgs);return postProcessSetContent(editor,result.html,updatedArgs),result.content})).getOr(content)},removedOptions="autoresize_on_init,content_editable_state,padd_empty_with_br,block_elements,boolean_attributes,editor_deselector,editor_selector,elements,file_browser_callback_types,filepicker_validator_handler,force_hex_style_colors,force_p_newlines,gecko_spellcheck,images_dataimg_filter,media_scripts,mode,move_caret_before_on_enter_elements,non_empty_elements,self_closing_elements,short_ended_elements,special,spellchecker_select_languages,spellchecker_whitelist,tab_focus,tabfocus_elements,table_responsive_width,text_block_elements,text_inline_elements,toolbar_drawer,types,validate,whitespace_elements,paste_enable_default_filters,paste_filter_drop,paste_word_valid_elements,paste_retain_style_properties,paste_convert_word_fake_lists".split(","),deprecatedOptions="template_cdate_classes,template_mdate_classes,template_selected_content_classes,template_preview_replace_values,template_replace_values,templates,template_cdate_format,template_mdate_format".split(","),removedPlugins="bbcode,colorpicker,contextmenu,fullpage,legacyoutput,spellchecker,textcolor".split(","),deprecatedPlugins=[{name:"template",replacedWith:"Advanced Template"},{name:"rtc"}],getMatchingOptions=(options,searchingFor)=>{const settingNames=filter$5(searchingFor,(setting=>has$2(options,setting)));return sort(settingNames)},getRemovedOptions=options=>{const settingNames=getMatchingOptions(options,removedOptions),forcedRootBlock=options.forced_root_block;return!1!==forcedRootBlock&&""!==forcedRootBlock||settingNames.push("forced_root_block (false only)"),sort(settingNames)},getDeprecatedOptions=options=>getMatchingOptions(options,deprecatedOptions),getMatchingPlugins=(options,searchingFor)=>{const plugins=Tools.makeMap(options.plugins," "),pluginNames=filter$5(searchingFor,(plugin=>has$2(plugins,plugin)));return sort(pluginNames)},getRemovedPlugins=options=>getMatchingPlugins(options,removedPlugins),getDeprecatedPlugins=options=>getMatchingPlugins(options,deprecatedPlugins.map((entry=>entry.name))),getPluginDescription=name=>find$2(deprecatedPlugins,(entry=>entry.name===name)).fold((()=>name),(entry=>entry.replacedWith?`${name}, replaced by ${entry.replacedWith}`:name)),logWarnings=(rawOptions,normalizedOptions)=>{((rawOptions,normalizedOptions)=>{const removedOptions=getRemovedOptions(rawOptions),removedPlugins=getRemovedPlugins(normalizedOptions),hasRemovedPlugins=removedPlugins.length>0,hasRemovedOptions=removedOptions.length>0,isLegacyMobileTheme="mobile"===normalizedOptions.theme;if(hasRemovedPlugins||hasRemovedOptions||isLegacyMobileTheme){const listJoiner="\n- ",themesMessage=isLegacyMobileTheme?`\n\nThemes:${listJoiner}mobile`:"",pluginsMessage=hasRemovedPlugins?`\n\nPlugins:${listJoiner}${removedPlugins.join(listJoiner)}`:"",optionsMessage=hasRemovedOptions?`\n\nOptions:${listJoiner}${removedOptions.join(listJoiner)}`:"";console.warn("The following deprecated features are currently enabled and have been removed in TinyMCE 6.0. These features will no longer work and should be removed from the TinyMCE configuration. See https://www.tiny.cloud/docs/tinymce/6/migration-from-5x/ for more information."+themesMessage+pluginsMessage+optionsMessage)}})(rawOptions,normalizedOptions),((rawOptions,normalizedOptions)=>{const deprecatedOptions=getDeprecatedOptions(rawOptions),deprecatedPlugins=getDeprecatedPlugins(normalizedOptions),hasDeprecatedPlugins=deprecatedPlugins.length>0,hasDeprecatedOptions=deprecatedOptions.length>0;if(hasDeprecatedPlugins||hasDeprecatedOptions){const listJoiner="\n- ",pluginsMessage=hasDeprecatedPlugins?`\n\nPlugins:${listJoiner}${deprecatedPlugins.map(getPluginDescription).join(listJoiner)}`:"",optionsMessage=hasDeprecatedOptions?`\n\nOptions:${listJoiner}${deprecatedOptions.join(listJoiner)}`:"";console.warn("The following deprecated features are currently enabled but will be removed soon."+pluginsMessage+optionsMessage)}})(rawOptions,normalizedOptions)},DOM$8=DOMUtils.DOM,safeDestroy=x=>Optional.from(x).each((x=>x.destroy())),remove$1=editor=>{if(!editor.removed){const{_selectionOverrides,editorUpload}=editor,body=editor.getBody(),element=editor.getElement();body&&editor.save({is_removing:!0}),editor.removed=!0,editor.unbindAllNativeEvents(),editor.hasHiddenInput&&isNonNullable(null==element?void 0:element.nextSibling)&&DOM$8.remove(element.nextSibling),(editor=>{editor.dispatch("remove")})(editor),editor.editorManager.remove(editor),!editor.inline&&body&&(editor=>{DOM$8.setStyle(editor.id,"display",editor.orgDisplay)})(editor),(editor=>{editor.dispatch("detach")})(editor),DOM$8.remove(editor.getContainer()),safeDestroy(_selectionOverrides),safeDestroy(editorUpload),editor.destroy()}},destroy=(editor,automatic)=>{const{selection,dom}=editor;editor.destroyed||(automatic||editor.removed?(automatic||(editor.editorManager.off("beforeunload",editor._beforeUnload),editor.theme&&editor.theme.destroy&&editor.theme.destroy(),safeDestroy(selection),safeDestroy(dom)),(editor=>{const form=editor.formElement;form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,delete form._mceOldSubmit),DOM$8.unbind(form,"submit reset",editor.formEventDelegate))})(editor),(editor=>{const ed=editor;ed.contentAreaContainer=ed.formElement=ed.container=ed.editorContainer=null,ed.bodyElement=ed.contentDocument=ed.contentWindow=null,ed.iframeElement=ed.targetElm=null;const selection=editor.selection;if(selection){const dom=selection.dom;ed.selection=selection.win=selection.dom=dom.doc=null}})(editor),editor.destroyed=!0):editor.remove())},IconManager=(()=>{const lookup={};return{add:(id,iconPack)=>{lookup[id]=iconPack},get:id=>lookup[id]?lookup[id]:{icons:{}},has:id=>has$2(lookup,id)}})(),ModelManager=AddOnManager.ModelManager,getProp=(propName,elm)=>elm.dom[propName],getComputedSizeProp=(propName,elm)=>parseInt(get$7(elm,propName),10),getClientWidth=curry(getProp,"clientWidth"),getClientHeight=curry(getProp,"clientHeight"),getMarginTop=curry(getComputedSizeProp,"margin-top"),getMarginLeft=curry(getComputedSizeProp,"margin-left"),isXYInContentArea=(editor,clientX,clientY)=>{const bodyElm=SugarElement.fromDom(editor.getBody()),targetElm=editor.inline?bodyElm:(element=bodyElm,SugarElement.fromDom(documentOrOwner(element).dom.documentElement));var element;const transposedPoint=((inline,elm,clientX,clientY)=>{const clientRect=(elm=>elm.dom.getBoundingClientRect())(elm);return{x:clientX-(inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0)}})(editor.inline,targetElm,clientX,clientY);return((bodyElm,clientX,clientY)=>{const clientWidth=getClientWidth(bodyElm),clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight})(targetElm,transposedPoint.x,transposedPoint.y)},isEditorAttachedToDom=editor=>{const rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return(node=rawContainer,Optional.from(node).map(SugarElement.fromDom)).map(inBody).getOr(!1);var node};const NotificationManager=editor=>{const notifications=[],getImplementation=()=>{const theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():(()=>{const unimplemented=()=>{throw new Error("Theme did not provide a NotificationManager implementation.")};return{open:unimplemented,close:unimplemented,getArgs:unimplemented}})()},getTopNotification=()=>Optional.from(notifications[0]),reposition=()=>{each$e(notifications,(notification=>{notification.reposition()}))},closeNotification=notification=>{findIndex$2(notifications,(otherNotification=>otherNotification===notification)).each((index=>{notifications.splice(index,1)}))},open=(spec,fireEvent=!0)=>editor.removed||!isEditorAttachedToDom(editor)?{}:(fireEvent&&editor.dispatch("BeforeOpenNotification",{notification:spec}),find$2(notifications,(notification=>{return a=getImplementation().getArgs(notification),b=spec,!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout);var a,b})).getOrThunk((()=>{editor.editorManager.setActive(editor);const notification=getImplementation().open(spec,(()=>{closeNotification(notification),reposition(),hasEditorOrUiFocus(editor)&&getTopNotification().fold((()=>editor.focus()),(top=>focus$1(SugarElement.fromDom(top.getEl()))))}));return(notification=>{notifications.push(notification)})(notification),reposition(),editor.dispatch("OpenNotification",{notification:{...notification}}),notification}))),getNotifications=constant(notifications);return(editor=>{editor.on("SkinLoaded",(()=>{const serviceMessage=getServiceMessage(editor);serviceMessage&&open({text:serviceMessage,type:"warning",timeout:0},!1),reposition()})),editor.on("show ResizeEditor ResizeWindow NodeChange",(()=>{requestAnimationFrame(reposition)})),editor.on("remove",(()=>{each$e(notifications.slice(),(notification=>{getImplementation().close(notification)}))}))})(editor),{open,close:()=>{getTopNotification().each((notification=>{getImplementation().close(notification),closeNotification(notification),reposition()}))},getNotifications}},PluginManager=AddOnManager.PluginManager,ThemeManager=AddOnManager.ThemeManager;const WindowManager=editor=>{let dialogs=[];const getImplementation=()=>{const theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():(()=>{const unimplemented=()=>{throw new Error("Theme did not provide a WindowManager implementation.")};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented}})()},funcBind=(scope,f)=>(...args)=>f?f.apply(scope,args):void 0,addDialog=dialog=>{dialogs.push(dialog),(dialog=>{editor.dispatch("OpenWindow",{dialog})})(dialog)},closeDialog=dialog=>{(dialog=>{editor.dispatch("CloseWindow",{dialog})})(dialog),dialogs=filter$5(dialogs,(otherDialog=>otherDialog!==dialog)),0===dialogs.length&&editor.focus()},storeSelectionAndOpenDialog=openDialog=>{editor.editorManager.setActive(editor),store(editor),editor.ui.show();const dialog=openDialog();return addDialog(dialog),dialog};return editor.on("remove",(()=>{each$e(dialogs,(dialog=>{getImplementation().close(dialog)}))})),{open:(args,params)=>storeSelectionAndOpenDialog((()=>getImplementation().open(args,params,closeDialog))),openUrl:args=>storeSelectionAndOpenDialog((()=>getImplementation().openUrl(args,closeDialog))),alert:(message,callback,scope)=>{const windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope||windowManagerImpl,callback))},confirm:(message,callback,scope)=>{const windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope||windowManagerImpl,callback))},close:()=>{Optional.from(dialogs[dialogs.length-1]).each((dialog=>{getImplementation().close(dialog),closeDialog(dialog)}))}}},displayNotification=(editor,message)=>{editor.notificationManager.open({type:"error",text:message})},displayError=(editor,message)=>{editor._skinLoaded?displayNotification(editor,message):editor.on("SkinLoaded",(()=>{displayNotification(editor,message)}))},logError=(editor,errorType,msg)=>{fireError(editor,errorType,{message:msg}),console.error(msg)},createLoadError=(type,url,name)=>name?`Failed to load ${type}: ${name} from url ${url}`:`Failed to load ${type} url: ${url}`,initError=(message,...x)=>{const console=window.console;console&&(console.error?console.error(message,...x):console.log(message,...x))},toContentSkinResourceName=url=>"content/"+url+"/content.css",transformToUrls=(editor,cssLinks)=>{const skinUrl=editor.editorManager.baseURL+"/skins/content",contentCssFile=`content${editor.editorManager.suffix}.css`;return map$3(cssLinks,(url=>(url=>tinymce.Resource.has(toContentSkinResourceName(url)))(url)?url:(url=>/^[a-z0-9\-]+$/i.test(url))(url)&&!editor.inline?`${skinUrl}/${url}/${contentCssFile}`:editor.documentBaseURI.toAbsolute(url)))},appendContentCssFromSettings=editor=>{editor.contentCSS=editor.contentCSS.concat((editor=>transformToUrls(editor,getContentCss(editor)))(editor),(editor=>transformToUrls(editor,getFontCss(editor)))(editor))},ImageScanner=(uploadStatus,blobCache)=>{const cachedPromises={};return{findAll:(elm,predicate=always)=>{const images=filter$5((elm=>elm?from(elm.getElementsByTagName("img")):[])(elm),(img=>{const src=img.src;return!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src===Env.transparentSrc)&&(startsWith(src,"blob:")?!uploadStatus.isUploaded(src)&&predicate(img):!!startsWith(src,"data:")&&predicate(img))))})),promises=map$3(images,(img=>{const imageSrc=img.src;if(has$2(cachedPromises,imageSrc))return cachedPromises[imageSrc].then((imageInfo=>isString(imageInfo)?imageInfo:{image:img,blobInfo:imageInfo.blobInfo}));{const newPromise=((blobCache,imageSrc)=>{const invalidDataUri=()=>Promise.reject("Invalid data URI");if(startsWith(imageSrc,"blob:")){const blobInfo=blobCache.getByUri(imageSrc);return isNonNullable(blobInfo)?Promise.resolve(blobInfo):uriToBlob(imageSrc).then((blob=>blobToDataUri(blob).then((dataUri=>processDataUri(dataUri,!1,(base64=>Optional.some(createBlobInfo$1(blobCache,blob,base64)))).getOrThunk(invalidDataUri)))))}return startsWith(imageSrc,"data:")?dataUriToBlobInfo(blobCache,imageSrc).fold(invalidDataUri,(blobInfo=>Promise.resolve(blobInfo))):Promise.reject("Unknown image data format")})(blobCache,imageSrc).then((blobInfo=>(delete cachedPromises[imageSrc],{image:img,blobInfo}))).catch((error=>(delete cachedPromises[imageSrc],error)));return cachedPromises[imageSrc]=newPromise,newPromise}}));return Promise.all(promises)}}},UploadStatus=()=>{let blobUriStatuses={};const createStatus=(status,resultUri)=>({status,resultUri}),hasBlobUri=blobUri=>blobUri in blobUriStatuses;return{hasBlobUri,getResultUri:blobUri=>{const result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:blobUri=>!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status,isUploaded:blobUri=>!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status,markPending:blobUri=>{blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:(blobUri,resultUri)=>{blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:blobUri=>{delete blobUriStatuses[blobUri]},destroy:()=>{blobUriStatuses={}}}};let count=0;const uuid=prefix=>prefix+count+++(()=>{const rnd=()=>Math.round(4294967295*Math.random()).toString(36);return"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd()})(),Uploader=(uploadStatus,settings)=>{const pendingPromises={},defaultHandler=(blobInfo,progress)=>new Promise(((success,failure)=>{const xhr=new XMLHttpRequest;xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=e=>{progress(e.loaded/e.total*100)},xhr.onerror=()=>{failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=()=>{if(xhr.status<200||xhr.status>=300)return void failure("HTTP Error: "+xhr.status);const json=JSON.parse(xhr.responseText);var path1,path2;json&&isString(json.location)?success((path1=settings.basePath,path2=json.location,path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2)):failure("Invalid JSON: "+xhr.responseText)};const formData=new FormData;formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)})),uploadHandler=isFunction(settings.handler)?settings.handler:defaultHandler,handlerSuccess=(blobInfo,url)=>({url,blobInfo,status:!0}),handlerFailure=(blobInfo,error)=>({url:"",blobInfo,status:!1,error}),resolvePending=(blobUri,result)=>{Tools.each(pendingPromises[blobUri],(resolve=>{resolve(result)})),delete pendingPromises[blobUri]},uploadBlobs=(blobInfos,openNotification)=>(blobInfos=Tools.grep(blobInfos,(blobInfo=>!uploadStatus.isUploaded(blobInfo.blobUri()))),Promise.all(Tools.map(blobInfos,(blobInfo=>uploadStatus.isPending(blobInfo.blobUri())?(blobInfo=>{const blobUri=blobInfo.blobUri();return new Promise((resolve=>{pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)}))})(blobInfo):((blobInfo,handler,openNotification)=>(uploadStatus.markPending(blobInfo.blobUri()),new Promise((resolve=>{let notification,progress;try{const closeNotification=()=>{notification&&(notification.close(),progress=noop)},success=url=>{closeNotification(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))},failure=error=>{closeNotification(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error)),resolve(handlerFailure(blobInfo,error))};progress=percent=>{percent<0||percent>100||Optional.from(notification).orThunk((()=>Optional.from(openNotification).map(apply$1))).each((n=>{notification=n,n.progressBar.value(percent)}))},handler(blobInfo,progress).then(success,(err=>{failure(isString(err)?{message:err}:err)}))}catch(ex){resolve(handlerFailure(blobInfo,ex))}}))))(blobInfo,uploadHandler,openNotification)))));return{upload:(blobInfos,openNotification)=>settings.url||uploadHandler!==defaultHandler?uploadBlobs(blobInfos,openNotification):new Promise((resolve=>{resolve([])}))}},openNotification=editor=>()=>editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0}),createUploader=(editor,uploadStatus)=>Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)}),addPaddingToEmpty=editor=>element=>{((editor,element)=>editor.dom.isEmpty(element.dom)&&isNonNullable(editor.schema.getTextBlockElements()[name(element)]))(editor,element)&&append$1(element,SugarElement.fromHtml('<br data-mce-bogus="1" />'))},EditorUpload=editor=>{const blobCache=(()=>{let cache=[];const toBlobInfo=o=>{if(!o.blob||!o.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");const id=o.id||uuid("blobid"),name=o.name||id,blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+"."+(mime=blob.type,{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[mime.toLowerCase()]||"dat")),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)};var mime},findFirst=predicate=>find$2(cache,predicate).getOrUndefined(),get=id=>findFirst((cachedBlobInfo=>cachedBlobInfo.id()===id));return{create:(o,blob,base64,name,filename)=>{if(isString(o))return toBlobInfo({id:o,name,filename,blob,base64});if(isObject(o))return toBlobInfo(o);throw new Error("Unknown input type")},add:blobInfo=>{get(blobInfo.id())||cache.push(blobInfo)},get,getByUri:blobUri=>findFirst((blobInfo=>blobInfo.blobUri()===blobUri)),getByData:(base64,type)=>findFirst((blobInfo=>blobInfo.base64()===base64&&blobInfo.blob().type===type)),findFirst,removeByUri:blobUri=>{cache=filter$5(cache,(blobInfo=>blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)))},destroy:()=>{each$e(cache,(cachedBlobInfo=>{URL.revokeObjectURL(cachedBlobInfo.blobUri())})),cache=[]}}})();let uploader,imageScanner;const uploadStatus=UploadStatus(),urlFilters=[],aliveGuard=callback=>result=>editor.selection?callback(result):[],replaceString=(content,search,replace)=>{let index=0;do{index=content.indexOf(search,index),-1!==index&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1)}while(-1!==index);return content},replaceImageUrl=(content,targetUrl,replacementUrl)=>{const replacementString=`src="${replacementUrl}"${replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':""}`;return content=replaceString(content,`src="${targetUrl}"`,replacementString),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')},replaceUrlInUndoStack=(targetUrl,replacementUrl)=>{each$e(editor.undoManager.data,(level=>{"fragmented"===level.type?level.fragments=map$3(level.fragments,(fragment=>replaceImageUrl(fragment,targetUrl,replacementUrl))):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)}))},uploadImages=()=>(uploader||(uploader=createUploader(editor,uploadStatus)),scanForImages().then(aliveGuard((imageInfos=>{const blobInfos=map$3(imageInfos,(imageInfo=>imageInfo.blobInfo));return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard((result=>{const imagesToRemove=[];let shouldDispatchChange=!1;const filteredResult=map$3(result,((uploadInfo,index)=>{const{blobInfo,image}=imageInfos[index];let removed=!1;return uploadInfo.status&&shouldReplaceBlobUris(editor)?(uploadInfo.url&&!contains$1(image.src,uploadInfo.url)&&(shouldDispatchChange=!0),blobCache.removeByUri(image.src),isRtc(editor)||((image,resultUri)=>{const src=editor.convertURL(resultUri,"src");var url;replaceUrlInUndoStack(image.src,resultUri),setAll$1(SugarElement.fromDom(image),{src:shouldReuseFileName(editor)?(url=resultUri,url+(-1===url.indexOf("?")?"?":"&")+(new Date).getTime()):resultUri,"data-mce-src":src})})(image,uploadInfo.url)):uploadInfo.error&&(uploadInfo.error.remove&&(replaceUrlInUndoStack(image.src,Env.transparentSrc),imagesToRemove.push(image),removed=!0),((editor,message)=>{displayError(editor,I18n.translate(["Failed to upload image: {0}",message]))})(editor,uploadInfo.error.message)),{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo,removed}}));return imagesToRemove.length>0&&!isRtc(editor)?editor.undoManager.transact((()=>{each$e(fromDom$1(imagesToRemove),(sugarElement=>{const parentOpt=parent(sugarElement);remove$5(sugarElement),parentOpt.each(addPaddingToEmpty(editor)),blobCache.removeByUri(sugarElement.dom.src)}))})):shouldDispatchChange&&editor.undoManager.dispatchChange(),filteredResult})))})))),uploadImagesAuto=()=>isAutomaticUploadsEnabled(editor)?uploadImages():Promise.resolve([]),isValidDataUriImage=imgElm=>forall(urlFilters,(filter=>filter(imgElm))),scanForImages=()=>(imageScanner||(imageScanner=ImageScanner(uploadStatus,blobCache)),imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard((result=>{const filteredResult=filter$5(result,(resultItem=>isString(resultItem)?(displayError(editor,resultItem),!1):"blob"!==resultItem.uriType));return isRtc(editor)||each$e(filteredResult,(resultItem=>{replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")})),filteredResult})))),replaceBlobUris=content=>content.replace(/src="(blob:[^"]+)"/g,((match,blobUri)=>{const resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';let blobInfo=blobCache.getByUri(blobUri);if(blobInfo||(blobInfo=foldl(editor.editorManager.get(),((result,editor)=>result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)),void 0)),blobInfo){return'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"'}return match}));return editor.on("SetContent",(()=>{isAutomaticUploadsEnabled(editor)?uploadImagesAuto():scanForImages()})),editor.on("RawSaveContent",(e=>{e.content=replaceBlobUris(e.content)})),editor.on("GetContent",(e=>{e.source_view||"raw"===e.format||"tree"===e.format||(e.content=replaceBlobUris(e.content))})),editor.on("PostRender",(()=>{editor.parser.addNodeFilter("img",(images=>{each$e(images,(img=>{const src=img.attr("src");if(!src||blobCache.getByUri(src))return;const resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}))}))})),{blobCache,addFilter:filter=>{urlFilters.push(filter)},uploadImages,uploadImagesAuto,scanForImages,destroy:()=>{blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null}}},genericBase={remove_similar:!0,inherit:!1},cellBase={selector:"td,th",...genericBase},cellFormats={tablecellbackgroundcolor:{styles:{backgroundColor:"%value"},...cellBase},tablecellverticalalign:{styles:{"vertical-align":"%value"},...cellBase},tablecellbordercolor:{styles:{borderColor:"%value"},...cellBase},tablecellclass:{classes:["%value"],...cellBase},tableclass:{selector:"table",classes:["%value"],...genericBase},tablecellborderstyle:{styles:{borderStyle:"%value"},...cellBase},tablecellborderwidth:{styles:{borderWidth:"%value"},...cellBase}},get=constant(cellFormats),FormatRegistry=editor=>{const formats={},register=(name,format)=>{name&&(isString(name)?(isArray$1(format)||(format=[format]),each$e(format,(format=>{isUndefined(format.deep)&&(format.deep=!isSelectorFormat(format)),isUndefined(format.split)&&(format.split=!isSelectorFormat(format)||isInlineFormat(format)),isUndefined(format.remove)&&isSelectorFormat(format)&&!isInlineFormat(format)&&(format.remove="none"),isSelectorFormat(format)&&isInlineFormat(format)&&(format.mixed=!0,format.block_expand=!0),isString(format.classes)&&(format.classes=format.classes.split(/\s+/))})),formats[name]=format):each$d(name,((format,name)=>{register(name,format)})))};return register((editor=>{const dom=editor.dom,schemaType=editor.schema.type,formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre",styles:{textAlign:"left"},inherit:!1,preview:!1},{selector:"img,audio,video",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"},{selector:"table",collapsed:!1,styles:{marginLeft:"0px",marginRight:"auto"},onformat:table=>{dom.setStyle(table,"float",null)},preview:"font-family font-size"},{selector:".mce-preview-object,[data-ephox-embed-iri]",ceFalseOverride:!0,styles:{float:"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img,audio,video",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"},{selector:".mce-preview-object",ceFalseOverride:!0,styles:{display:"table",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"[data-ephox-embed-iri]",ceFalseOverride:!0,styles:{marginLeft:"auto",marginRight:"auto"},preview:!1}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size"},{selector:"img,audio,video",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"},{selector:"table",collapsed:!1,styles:{marginRight:"0px",marginLeft:"auto"},onformat:table=>{dom.setStyle(table,"float",null)},preview:"font-family font-size"},{selector:".mce-preview-object,[data-ephox-embed-iri]",ceFalseOverride:!0,styles:{float:"right"},preview:!1}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li,pre",styles:{textAlign:"justify"},inherit:!1,preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all",preserve_attributes:["class","style"]}],italic:[{inline:"em",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all",preserve_attributes:["class","style"]}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all",preserve_attributes:["class","style"]}],strikethrough:(()=>{const span={inline:"span",styles:{textDecoration:"line-through"},exact:!0},strike={inline:"strike",remove:"all",preserve_attributes:["class","style"]},s={inline:"s",remove:"all",preserve_attributes:["class","style"]};return"html4"!==schemaType?[s,span,strike]:[span,s,strike]})(),forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},lineheight:{selector:"h1,h2,h3,h4,h5,h6,p,li,td,th,div",styles:{lineHeight:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:!0,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:(node,_fmt,_itemName)=>isElement$6(node)&&node.hasAttribute("href"),onformat:(elm,_fmt,vars)=>{Tools.each(vars,((value,key)=>{dom.setAttrib(elm,key,value)}))}},lang:{inline:"span",clear_child_styles:!0,remove_similar:!0,attributes:{lang:"%value","data-mce-lang":vars=>{var _a;return null!==(_a=null==vars?void 0:vars.customValue)&&void 0!==_a?_a:null}}},removeformat:[{selector:"b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins,small",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre dt dd samp".split(/\s/),(name=>{formats[name]={block:name,remove:"all"}})),formats})(editor)),register(get()),register(getFormats(editor)),{get:name=>isNonNullable(name)?formats[name]:formats,has:name=>has$2(formats,name),register,unregister:name=>(name&&formats[name]&&delete formats[name],formats)}},each$3=Tools.each,dom=DOMUtils.DOM,isPreviewItem=item=>isNonNullable(item)&&isObject(item),parsedSelectorToHtml=(ancestry,editor)=>{const schema=editor&&editor.schema||Schema({}),createElement=sItem=>{const item=isString(sItem)?{name:sItem,classes:[],attrs:{}}:sItem,elm=dom.create(item.name);return((elm,item)=>{item.classes.length>0&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)})(elm,item),elm},wrapInHtml=(elm,ancestors,siblings)=>{let parentCandidate;const ancestor=ancestors[0],ancestorName=isPreviewItem(ancestor)?ancestor.name:void 0,parentRequired=((elm,candidate)=>{const elmRule=schema.getElementRule(elm.nodeName.toLowerCase()),parentsRequired=null==elmRule?void 0:elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&contains$2(parentsRequired,candidate)?candidate:parentsRequired[0])})(elm,ancestorName);if(parentRequired)ancestorName===parentRequired?(parentCandidate=ancestor,ancestors=ancestors.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestor,ancestors=ancestors.slice(1);else if(!siblings)return elm;const parent=parentCandidate?createElement(parentCandidate):dom.create("div");parent.appendChild(elm),siblings&&Tools.each(siblings,(sibling=>{const siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)}));const parentSiblings=isPreviewItem(parentCandidate)?parentCandidate.siblings:void 0;return wrapInHtml(parent,ancestors,parentSiblings)},fragment=dom.create("div");if(ancestry.length>0){const item=ancestry[0],elm=createElement(item),siblings=isPreviewItem(item)?item.siblings:void 0;fragment.appendChild(wrapInHtml(elm,ancestry.slice(1),siblings))}return fragment},parseSelectorItem=item=>{let tagName="div";const obj={name:tagName,classes:[],attrs:{},selector:item=Tools.trim(item)};return"*"!==item&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,(($0,$1,$2,$3,$4)=>{switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["===$3){const m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""}))),obj.name=tagName||"div",obj},getCssText=(editor,format)=>{let previewCss="",previewStyles=getPreviewStyles(editor);if(""===previewStyles)return"";const removeVars=val=>isString(val)?val.replace(/%(\w+)/g,""):"",getComputedStyle=(name,elm)=>dom.getStyle(null!=elm?elm:editor.getBody(),name,!0);if(isString(format)){const formats=editor.formatter.get(format);if(!formats)return"";format=formats[0]}if("preview"in format){const preview=format.preview;if(!1===preview)return"";previewStyles=preview||previewStyles}let previewFrag,name=format.block||format.inline||"span";const items=(selector=format.selector,isString(selector)?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),(item=>{const siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj})).reverse()):[]);var selector;items.length>0?(items[0].name||(items[0].name=name),name=format.selector,previewFrag=parsedSelectorToHtml(items,editor)):previewFrag=parsedSelectorToHtml([name],editor);const previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;each$3(format.styles,((value,name)=>{const newValue=removeVars(value);newValue&&dom.setStyle(previewElm,name,newValue)})),each$3(format.attributes,((value,name)=>{const newValue=removeVars(value);newValue&&dom.setAttrib(previewElm,name,newValue)})),each$3(format.classes,(value=>{const newValue=removeVars(value);dom.hasClass(previewElm,newValue)||dom.addClass(previewElm,newValue)})),editor.dispatch("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag);const rawParentFontSize=getComputedStyle("fontSize"),parentFontSize=/px$/.test(rawParentFontSize)?parseInt(rawParentFontSize,10):0;return each$3(previewStyles.split(" "),(name=>{let value=getComputedStyle(name,previewElm);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=getComputedStyle(name),"#ffffff"===rgbaToHexString(value).toLowerCase())||"color"===name&&"#000000"===rgbaToHexString(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=parseFloat(value)/(/%$/.test(value)?100:1)*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}})),editor.dispatch("AfterPreviewFormats"),dom.remove(previewFrag),previewCss},Formatter=editor=>{const formats=FormatRegistry(editor),formatChangeState=Cell({});return(editor=>{editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(let i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])})(editor),setup$v(editor),isRtc(editor)||((registeredFormatListeners,editor)=>{registeredFormatListeners.set({}),editor.on("NodeChange",(e=>{updateAndFireChangeCallbacks(editor,e.element,registeredFormatListeners.get())})),editor.on("FormatApply FormatRemove",(e=>{const element=Optional.from(e.node).map((nodeOrRange=>isNode(nodeOrRange)?nodeOrRange:nodeOrRange.startContainer)).bind((node=>isElement$6(node)?Optional.some(node):Optional.from(node.parentElement))).getOrThunk((()=>fallbackElement(editor)));updateAndFireChangeCallbacks(editor,element,registeredFormatListeners.get())}))})(formatChangeState,editor),{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:(name,vars,node)=>{((editor,name,vars,node)=>{getRtcInstanceWithError(editor).formatter.apply(name,vars,node)})(editor,name,vars,node)},remove:(name,vars,node,similar)=>{((editor,name,vars,node,similar)=>{getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar)})(editor,name,vars,node,similar)},toggle:(name,vars,node)=>{((editor,name,vars,node)=>{getRtcInstanceWithError(editor).formatter.toggle(name,vars,node)})(editor,name,vars,node)},match:(name,vars,node,similar)=>((editor,name,vars,node,similar)=>getRtcInstanceWithError(editor).formatter.match(name,vars,node,similar))(editor,name,vars,node,similar),closest:names=>((editor,names)=>getRtcInstanceWithError(editor).formatter.closest(names))(editor,names),matchAll:(names,vars)=>((editor,names,vars)=>getRtcInstanceWithError(editor).formatter.matchAll(names,vars))(editor,names,vars),matchNode:(node,name,vars,similar)=>((editor,node,name,vars,similar)=>getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar))(editor,node,name,vars,similar),canApply:name=>((editor,name)=>getRtcInstanceWithError(editor).formatter.canApply(name))(editor,name),formatChanged:(formats,callback,similar,vars)=>((editor,registeredFormatListeners,formats,callback,similar,vars)=>getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar,vars))(editor,formatChangeState,formats,callback,similar,vars),getCssText:curry(getCssText,editor)}},shouldIgnoreCommand=cmd=>{switch(cmd.toLowerCase()){case"undo":case"redo":case"mcefocus":return!0;default:return!1}},UndoManager=editor=>{const beforeBookmark=value$2(),locks=Cell(0),index=Cell(0),undoManager={data:[],typing:!1,beforeChange:()=>{((editor,locks,beforeBookmark)=>{getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark)})(editor,locks,beforeBookmark)},add:(level,event)=>((editor,undoManager,index,locks,beforeBookmark,level,event)=>getRtcInstanceWithError(editor).undoManager.add(undoManager,index,locks,beforeBookmark,level,event))(editor,undoManager,index,locks,beforeBookmark,level,event),dispatchChange:()=>{editor.setDirty(!0);const level=createFromEditor(editor);level.bookmark=getUndoBookmark(editor.selection),editor.dispatch("change",{level,lastLevel:get$b(undoManager.data,index.get()).getOrUndefined()})},undo:()=>((editor,undoManager,locks,index)=>getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index))(editor,undoManager,locks,index),redo:()=>((editor,index,data)=>getRtcInstanceWithError(editor).undoManager.redo(index,data))(editor,index,undoManager.data),clear:()=>{((editor,undoManager,index)=>{getRtcInstanceWithError(editor).undoManager.clear(undoManager,index)})(editor,undoManager,index)},reset:()=>{((editor,undoManager)=>{getRtcInstanceWithError(editor).undoManager.reset(undoManager)})(editor,undoManager)},hasUndo:()=>((editor,undoManager,index)=>getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index))(editor,undoManager,index),hasRedo:()=>((editor,undoManager,index)=>getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index))(editor,undoManager,index),transact:callback=>((editor,undoManager,locks,callback)=>getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback))(editor,undoManager,locks,callback),ignore:callback=>{((editor,locks,callback)=>{getRtcInstanceWithError(editor).undoManager.ignore(locks,callback)})(editor,locks,callback)},extra:(callback1,callback2)=>{((editor,undoManager,index,callback1,callback2)=>{getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2)})(editor,undoManager,index,callback1,callback2)}};return isRtc(editor)||((editor,undoManager,locks)=>{const isFirstTypedCharacter=Cell(!1),addNonTypingUndoLevel=e=>{setTyping(undoManager,!1,locks),undoManager.add({},e)};editor.on("init",(()=>{undoManager.add()})),editor.on("BeforeExecCommand",(e=>{const cmd=e.command;shouldIgnoreCommand(cmd)||(endTyping(undoManager,locks),undoManager.beforeChange())})),editor.on("ExecCommand",(e=>{const cmd=e.command;shouldIgnoreCommand(cmd)||addNonTypingUndoLevel(e)})),editor.on("ObjectResizeStart cut",(()=>{undoManager.beforeChange()})),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("dragend",addNonTypingUndoLevel),editor.on("keyup",(e=>{const keyCode=e.keyCode;if(e.isDefaultPrevented())return;const isMeta=Env.os.isMacOS()&&"Meta"===e.key;(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode||e.ctrlKey||isMeta)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter.get()&&undoManager.typing&&!isEq$1(createFromEditor(editor),undoManager.data[0])&&(editor.isDirty()||editor.setDirty(!0),editor.dispatch("TypingUndo"),isFirstTypedCharacter.set(!1),editor.nodeChanged())})),editor.on("keydown",(e=>{const keyCode=e.keyCode;if(e.isDefaultPrevented())return;if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode)return void(undoManager.typing&&addNonTypingUndoLevel(e));const modKey=e.ctrlKey&&!e.altKey||e.metaKey;if((keyCode<16||keyCode>20)&&224!==keyCode&&91!==keyCode&&!undoManager.typing&&!modKey)return undoManager.beforeChange(),setTyping(undoManager,!0,locks),undoManager.add({},e),void isFirstTypedCharacter.set(!0);(Env.os.isMacOS()?e.metaKey:e.ctrlKey&&!e.altKey)&&undoManager.beforeChange()})),editor.on("mousedown",(e=>{undoManager.typing&&addNonTypingUndoLevel(e)})),editor.on("input",(e=>{var event;e.inputType&&("insertReplacementText"===e.inputType||"insertText"===(event=e).inputType&&null===event.data||(event=>"insertFromPaste"===event.inputType||"insertFromDrop"===event.inputType)(e))&&addNonTypingUndoLevel(e)})),editor.on("AddUndo Undo Redo ClearUndos",(e=>{e.isDefaultPrevented()||editor.nodeChanged()}))})(editor,undoManager,locks),(editor=>{editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo")})(editor),undoManager},nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]),isKeyboardEvent=e=>"keydown"===e.type||"keyup"===e.type,isDeleteEvent=e=>{const keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE},setup$r=editor=>{var _a;const dom=editor.dom,rootBlock=getForcedRootBlock(editor),placeholder=null!==(_a=getPlaceholder(editor))&&void 0!==_a?_a:"",updatePlaceholder=(e,initial)=>{if((e=>{if(isKeyboardEvent(e)){const keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains$2(nonTypingKeycodes,keyCode))}return!1})(e))return;const body=editor.getBody(),showPlaceholder=!(e=>isKeyboardEvent(e)&&!(isDeleteEvent(e)||"keyup"===e.type&&229===e.keyCode))(e)&&((dom,rootElm,forcedRootBlock)=>{if(isEmpty$2(SugarElement.fromDom(rootElm),!1)){const firstElement=rootElm.firstElementChild;return!firstElement||!dom.getStyle(rootElm.firstElementChild,"padding-left")&&!dom.getStyle(rootElm.firstElementChild,"padding-right")&&forcedRootBlock===firstElement.nodeName.toLowerCase()}return!1})(dom,body,rootBlock);(""!==dom.getAttrib(body,"data-mce-placeholder")!==showPlaceholder||initial)&&(dom.setAttrib(body,"data-mce-placeholder",showPlaceholder?placeholder:null),dom.setAttrib(body,"aria-placeholder",showPlaceholder?placeholder:null),((editor,state)=>{editor.dispatch("PlaceholderToggle",{state})})(editor,showPlaceholder),editor.on(showPlaceholder?"keydown":"keyup",updatePlaceholder),editor.off(showPlaceholder?"keyup":"keydown",updatePlaceholder))};isNotEmpty(placeholder)&&editor.on("init",(e=>{updatePlaceholder(e,!0),editor.on("change SetContent ExecCommand",updatePlaceholder),editor.on("paste",(e=>Delay.setEditorTimeout(editor,(()=>updatePlaceholder(e)))))}))},blockBoundary=(from,to)=>({from,to}),getBlockPosition=(rootNode,pos)=>{const rootElm=SugarElement.fromDom(rootNode),containerElm=SugarElement.fromDom(pos.container());return getParentBlock$2(rootElm,containerElm).map((block=>((block,position)=>({block,position}))(block,pos)))},getClosestHost=(root,scope)=>closest$4(scope,(node=>isTableCell$2(node)||isContentEditableTrue$3(node.dom)),(node=>eq(node,root))).filter(isElement$7).getOr(root),readFromRange=(rootNode,forward,rng)=>{const fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind((blockPos=>fromPosition(forward,rootNode,blockPos.position).bind((to=>getBlockPosition(rootNode,to).map((blockPos=>((rootNode,forward,blockPosition)=>isBr$6(blockPosition.position.getNode())&&!isEmpty$2(blockPosition.block)?positionIn(!1,blockPosition.block.dom).bind((lastPositionInBlock=>lastPositionInBlock.isEqual(blockPosition.position)?fromPosition(forward,rootNode,lastPositionInBlock).bind((to=>getBlockPosition(rootNode,to))):Optional.some(blockPosition))).getOr(blockPosition):blockPosition)(rootNode,forward,blockPos)))))));return lift2(fromBlockPos,toBlockPos,blockBoundary).filter((blockBoundary=>(blockBoundary=>!eq(blockBoundary.from.block,blockBoundary.to.block))(blockBoundary)&&((rootNode,blockBoundary)=>{const root=SugarElement.fromDom(rootNode);return eq(getClosestHost(root,blockBoundary.from.block),getClosestHost(root,blockBoundary.to.block))})(rootNode,blockBoundary)&&(blockBoundary=>!1===isContentEditableFalse$b(blockBoundary.from.block.dom)&&!1===isContentEditableFalse$b(blockBoundary.to.block.dom))(blockBoundary)&&(blockBoundary=>{const isValidBlock=block=>isTextBlock$2(block)||hasBlockAttr(block.dom);return isValidBlock(blockBoundary.from.block)&&isValidBlock(blockBoundary.to.block)})(blockBoundary)))},extractChildren=(block,schema)=>{const children=((block,schema)=>{const children=children$1(block);return findIndex$2(children,(el=>schema.isBlock(name(el)))).fold(constant(children),(index=>children.slice(0,index)))})(block,schema);return each$e(children,remove$5),children},removeEmptyRoot=(rootNode,block)=>{const parents=parentsAndSelf(block,rootNode);return find$2(parents.reverse(),(element=>isEmpty$2(element))).each(remove$5)},nestedBlockMerge=(rootNode,fromBlock,toBlock,schema,insertionPoint)=>{if(isEmpty$2(toBlock))return fillWithPaddingBr(toBlock),firstPositionIn(toBlock.dom);0===filter$5(prevSiblings(insertionPoint),(el=>!isEmpty$2(el))).length&&isEmpty$2(fromBlock)&&before$3(insertionPoint,SugarElement.fromTag("br"));const position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));return each$e(extractChildren(fromBlock,schema),(child=>{before$3(insertionPoint,child)})),removeEmptyRoot(rootNode,fromBlock),position},sidelongBlockMerge=(rootNode,fromBlock,toBlock,schema)=>{if(isEmpty$2(toBlock)){if(isEmpty$2(fromBlock)){const getInlineToBlockDescendants=el=>{const helper=(node,elements)=>firstChild(node).fold((()=>elements),(child=>((schema,node)=>schema.isInline(name(node)))(schema,child)?helper(child,elements.concat(shallow$1(child))):elements));return helper(el,[])},newFromBlockDescendants=foldr(getInlineToBlockDescendants(toBlock),((element,descendant)=>(wrap$2(element,descendant),descendant)),createPaddingBr());empty(fromBlock),append$1(fromBlock,newFromBlockDescendants)}return remove$5(toBlock),firstPositionIn(fromBlock.dom)}const position=lastPositionIn(toBlock.dom);return each$e(extractChildren(fromBlock,schema),(child=>{append$1(toBlock,child)})),removeEmptyRoot(rootNode,fromBlock),position},getInsertionPoint=(fromBlock,toBlock)=>contains(toBlock,fromBlock)?((toBlock,block)=>{const parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1])})(toBlock,fromBlock):Optional.none(),trimBr=(first,block)=>{positionIn(first,block.dom).bind((position=>Optional.from(position.getNode()))).map(SugarElement.fromDom).filter(isBr$5).each(remove$5)},mergeBlockInto=(rootNode,fromBlock,toBlock,schema)=>(trimBr(!0,fromBlock),trimBr(!1,toBlock),getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock,schema),curry(nestedBlockMerge,rootNode,fromBlock,toBlock,schema))),mergeBlocks=(rootNode,forward,block1,block2,schema)=>forward?mergeBlockInto(rootNode,block2,block1,schema):mergeBlockInto(rootNode,block1,block2,schema),backspaceDelete$9=(editor,forward)=>{const rootNode=SugarElement.fromDom(editor.getBody()),position=((rootNode,forward,rng)=>rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none())(rootNode.dom,forward,editor.selection.getRng()).map((blockBoundary=>()=>{mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block,editor.schema).each((pos=>{editor.selection.setRng(pos.toRange())}))}));return position},isRawNodeInTable=(root,rawNode)=>{const node=SugarElement.fromDom(rawNode),isRoot=curry(eq,root);return ancestor$4(node,isTableCell$2,isRoot).isSome()},isEverythingSelected=(root,rng)=>{const noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone(),noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!((root,rng)=>isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer))(root,rng)&&noPrevious&&noNext},deleteRange$2=editor=>{const rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?(editor=>Optional.some((()=>{editor.setContent(""),editor.selection.setCursorLocation()})))(editor):((rootNode,selection,schema)=>{const rng=selection.getRng();return lift2(getParentBlock$2(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$2(rootNode,SugarElement.fromDom(rng.endContainer)),((block1,block2)=>eq(block1,block2)?Optional.none():Optional.some((()=>{rng.deleteContents(),mergeBlocks(rootNode,!0,block1,block2,schema).each((pos=>{selection.setRng(pos.toRange())}))})))).getOr(Optional.none())})(rootNode,editor.selection,editor.schema)},backspaceDelete$8=(editor,_forward)=>editor.selection.isCollapsed()?Optional.none():deleteRange$2(editor),showCaret=(direction,editor,node,before,scrollIntoView)=>Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView)),selectNode=(editor,node)=>editor.dispatch("BeforeObjectSelected",{target:node}).isDefaultPrevented()?Optional.none():Optional.some((node=>{const rng=node.ownerDocument.createRange();return rng.selectNode(node),rng})(node)),renderRangeCaret=(editor,range,scrollIntoView)=>range.collapsed?((editor,range,scrollIntoView)=>{const normalizedRange=normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(normalizedRange),caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode))return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),!1);const caretPositionBeforeNode=caretPosition.getNode(!0);if(isInlineFakeCaretTarget(caretPositionBeforeNode))return showCaret(1,editor,caretPositionBeforeNode,!1,!1);const ceRoot=getContentEditableRoot$1(editor.dom.getRoot(),caretPosition.getNode());return isInlineFakeCaretTarget(ceRoot)?showCaret(1,editor,ceRoot,!1,scrollIntoView):Optional.none()})(editor,range,scrollIntoView).getOr(range):range,isBeforeBoundary=pos=>isBeforeContentEditableFalse(pos)||isBeforeMedia(pos),isAfterBoundary=pos=>isAfterContentEditableFalse(pos)||isAfterMedia(pos),deleteContentAndShowCaret=(editor,range,node,direction,forward,peekCaretPosition)=>{showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,!0).each((caretRange=>{if(range.collapsed){const deleteRange=range.cloneRange();forward?deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset):deleteRange.setStart(caretRange.endContainer,caretRange.endOffset),deleteRange.deleteContents()}else range.deleteContents();editor.selection.setRng(caretRange)})),((dom,node)=>{isText$a(node)&&0===node.data.length&&dom.remove(node)})(editor.dom,node)},backspaceDelete$7=(editor,forward)=>((editor,forward)=>{const range=editor.selection.getRng();if(!isText$a(range.commonAncestorContainer))return Optional.none();const direction=forward?HDirection.Forwards:HDirection.Backwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev),isBeforeFn=forward?isBeforeBoundary:isAfterBoundary,caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),nextCaretPosition=getNextPosFn(caretPosition),normalizedNextCaretPosition=nextCaretPosition?normalizePosition(forward,nextCaretPosition):nextCaretPosition;if(!normalizedNextCaretPosition||!isMoveInsideSameBlock(caretPosition,normalizedNextCaretPosition))return Optional.none();if(isBeforeFn(normalizedNextCaretPosition))return Optional.some((()=>deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,normalizedNextCaretPosition)));const peekCaretPosition=getNextPosFn(normalizedNextCaretPosition);return peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(normalizedNextCaretPosition,peekCaretPosition)?Optional.some((()=>deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition))):Optional.none()})(editor,forward),getEdgeCefPosition=(editor,atStart)=>{const root=editor.getBody();return atStart?firstPositionIn(root).filter(isBeforeContentEditableFalse):lastPositionIn(root).filter(isAfterContentEditableFalse)},isCefAtEdgeSelected=editor=>{const rng=editor.selection.getRng();return!rng.collapsed&&(getEdgeCefPosition(editor,!0).exists((pos=>pos.isEqual(CaretPosition.fromRangeStart(rng))))||getEdgeCefPosition(editor,!1).exists((pos=>pos.isEqual(CaretPosition.fromRangeEnd(rng)))))},DeleteAction=Adt_generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),deleteEmptyBlockOrMoveToCef=(root,forward,from,to)=>{const toCefElm=to.getNode(!forward);return getParentBlock$2(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map((blockElm=>isEmpty$2(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm))).orThunk((()=>Optional.some(DeleteAction.moveToElement(toCefElm))))},findCefPosition=(root,forward,from,schema)=>fromPosition(forward,root,from).bind((to=>{return node=to.getNode(),isNonNullable(node)&&(isTableCell$2(SugarElement.fromDom(node))||isListItem$1(SugarElement.fromDom(node)))||((root,forward,from,to,schema)=>{const inSameBlock=elm=>schema.isInline(elm.nodeName.toLowerCase())&&!isInSameBlock(from,to,root);return getRelativeCefElm(!forward,from).fold((()=>getRelativeCefElm(forward,to).fold(never,inSameBlock)),inSameBlock)})(root,forward,from,to,schema)?Optional.none():forward&&isContentEditableFalse$b(to.getNode())||!forward&&isContentEditableFalse$b(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(root,forward,from,to):forward&&isAfterContentEditableFalse(from)||!forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):Optional.none();var node})),getContentEditableAction=(root,forward,from,schema)=>((forward,from)=>{const elm=from.getNode(!forward),caretLocation=forward?"after":"before";return isElement$6(elm)&&elm.getAttribute("data-mce-caret")===caretLocation})(forward,from)?((forward,elm)=>isNullable(elm)?Optional.none():forward&&isContentEditableFalse$b(elm.nextSibling)?Optional.some(DeleteAction.moveToElement(elm.nextSibling)):!forward&&isContentEditableFalse$b(elm.previousSibling)?Optional.some(DeleteAction.moveToElement(elm.previousSibling)):Optional.none())(forward,from.getNode(!forward)).orThunk((()=>findCefPosition(root,forward,from,schema))):findCefPosition(root,forward,from,schema).bind((deleteAction=>((root,from,deleteAction)=>deleteAction.fold((elm=>Optional.some(DeleteAction.remove(elm))),(elm=>Optional.some(DeleteAction.moveToElement(elm))),(to=>isInSameBlock(from,to,root)?Optional.none():Optional.some(DeleteAction.moveToPosition(to)))))(root,from,deleteAction))),getAncestorCe=(editor,node)=>Optional.from(getContentEditableRoot$1(editor.getBody(),node)),backspaceDeleteCaret=(editor,forward)=>{const selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse$b).fold((()=>((root,forward,rng,schema)=>{const normalizedRange=normalizeRange(forward?1:-1,root,rng),from=CaretPosition.fromRangeStart(normalizedRange),rootElement=SugarElement.fromDom(root);return!forward&&isAfterContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode(!0))):forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode())):!forward&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from,schema)?findPreviousBr(rootElement,from,schema).map((br=>DeleteAction.remove(br.getNode()))):forward&&isAfterContentEditableFalse(from)&&isBeforeBr$1(rootElement,from,schema)?findNextBr(rootElement,from,schema).map((br=>DeleteAction.remove(br.getNode()))):getContentEditableAction(root,forward,from,schema)})(editor.getBody(),forward,editor.selection.getRng(),editor.schema).map((deleteAction=>()=>deleteAction.fold(((editor,forward)=>element=>(editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element)),!0))(editor,forward),((editor,forward)=>element=>{const pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0})(editor,forward),(editor=>pos=>(editor.selection.setRng(pos.toRange()),!0))(editor))))),(()=>Optional.some(noop)))},backspaceDeleteRange=(editor,forward)=>{const selectedNode=editor.selection.getNode();if(isContentEditableFalse$b(selectedNode)&&!isTableCell$3(selectedNode)){return getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse$b).fold((()=>Optional.some((()=>{var rootElement;rootElement=SugarElement.fromDom(editor.getBody()),each$e(descendants(rootElement,".mce-offscreen-selection"),remove$5),deleteElement$2(editor,forward,SugarElement.fromDom(editor.selection.getNode())),paddEmptyBody(editor)}))),(()=>Optional.some(noop)))}return isCefAtEdgeSelected(editor)?Optional.some((()=>{deleteRangeContents(editor,editor.selection.getRng(),SugarElement.fromDom(editor.getBody()))})):Optional.none()},paddEmptyElement=editor=>{const dom=editor.dom,selection=editor.selection,ceRoot=getContentEditableRoot$1(editor.getBody(),selection.getNode());if(isContentEditableTrue$3(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){const br=dom.create("br",{"data-mce-bogus":"1"});dom.setHTML(ceRoot,""),ceRoot.appendChild(br),selection.setRng(CaretPosition.before(br).toRange())}return!0},backspaceDelete$6=(editor,forward)=>editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):backspaceDeleteRange(editor,forward),backspaceDelete$5=(editor,forward)=>editor.selection.isCollapsed()?((editor,forward)=>{const fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter((pos=>forward?isBeforeImageBlock(pos):isAfterImageBlock(pos))).bind((pos=>getChildNodeAtRelativeOffset(forward?0:-1,pos))).map((elm=>()=>editor.selection.select(elm)))})(editor,forward):Optional.none(),isText$2=isText$a,startsWithCaretContainer=node=>isText$2(node)&&"\ufeff"===node.data[0],endsWithCaretContainer=node=>isText$2(node)&&"\ufeff"===node.data[node.data.length-1],createZwsp=node=>{var _a;return(null!==(_a=node.ownerDocument)&&void 0!==_a?_a:document).createTextNode("\ufeff")},insertInline=(before,node)=>before?(node=>{var _a;if(isText$2(node.previousSibling))return endsWithCaretContainer(node.previousSibling)||node.previousSibling.appendData("\ufeff"),node.previousSibling;if(isText$2(node))return startsWithCaretContainer(node)||node.insertData(0,"\ufeff"),node;{const newNode=createZwsp(node);return null===(_a=node.parentNode)||void 0===_a||_a.insertBefore(newNode,node),newNode}})(node):(node=>{var _a,_b;if(isText$2(node.nextSibling))return startsWithCaretContainer(node.nextSibling)||node.nextSibling.insertData(0,"\ufeff"),node.nextSibling;if(isText$2(node))return endsWithCaretContainer(node)||node.appendData("\ufeff"),node;{const newNode=createZwsp(node);return node.nextSibling?null===(_a=node.parentNode)||void 0===_a||_a.insertBefore(newNode,node.nextSibling):null===(_b=node.parentNode)||void 0===_b||_b.appendChild(newNode),newNode}})(node),insertInlineBefore=curry(insertInline,!0),insertInlineAfter=curry(insertInline,!1),insertInlinePos=(pos,before)=>isText$a(pos.container())?insertInline(before,pos.container()):insertInline(before,pos.getNode()),isPosCaretContainer=(pos,caret)=>{const caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode)},renderCaret=(caret,location)=>location.fold((element=>{remove$3(caret.get());const text=insertInlineBefore(element);return caret.set(text),Optional.some(CaretPosition(text,text.length-1))}),(element=>firstPositionIn(element).map((pos=>{if(isPosCaretContainer(pos,caret)){const node=caret.get();return CaretPosition(node,1)}{remove$3(caret.get());const text=insertInlinePos(pos,!0);return caret.set(text),CaretPosition(text,1)}}))),(element=>lastPositionIn(element).map((pos=>{if(isPosCaretContainer(pos,caret)){const node=caret.get();return CaretPosition(node,node.length-1)}{remove$3(caret.get());const text=insertInlinePos(pos,!1);return caret.set(text),CaretPosition(text,text.length-1)}}))),(element=>{remove$3(caret.get());const text=insertInlineAfter(element);return caret.set(text),Optional.some(CaretPosition(text,1))})),evaluateUntil=(fns,args)=>{for(let i=0;i<fns.length;i++){const result=fns[i].apply(null,args);if(result.isSome())return result}return Optional.none()},Location=Adt_generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope$1=(rootNode,node)=>{const parentBlock=getParentBlock$3(node,rootNode);return parentBlock||rootNode},before=(isInlineTarget,rootNode,pos)=>{const nPos=normalizeForwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((()=>nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((inline=>Location.before(inline)))),Optional.none)},isNotInsideFormatCaretContainer=(rootNode,elm)=>null===getParentCaretContainer(rootNode,elm),findInsideRootInline=(isInlineTarget,rootNode,pos)=>findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode)),start$1=(isInlineTarget,rootNode,pos)=>{const nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((inline=>prevPosition(inline,nPos).isNone()?Optional.some(Location.start(inline)):Optional.none()))},end=(isInlineTarget,rootNode,pos)=>{const nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((inline=>nextPosition(inline,nPos).isNone()?Optional.some(Location.end(inline)):Optional.none()))},after=(isInlineTarget,rootNode,pos)=>{const nPos=normalizeBackwards(pos),scope=rescope$1(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((()=>prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((inline=>Location.after(inline)))),Optional.none)},isValidLocation=location=>!isRtl(getElement(location)),readLocation=(isInlineTarget,rootNode,pos)=>evaluateUntil([before,start$1,end,after],[isInlineTarget,rootNode,pos]).filter(isValidLocation),getElement=location=>location.fold(identity,identity,identity,identity),getName=location=>location.fold(constant("before"),constant("start"),constant("end"),constant("after")),outside=location=>location.fold(Location.before,Location.before,Location.after,Location.after),inside=location=>location.fold(Location.start,Location.start,Location.end,Location.end),betweenInlines=(forward,isInlineTarget,rootNode,from,to,location)=>lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),((fromInline,toInline)=>fromInline!==toInline&&((rootNode,node1,node2)=>{const block1=getParentBlock$3(node1,rootNode),block2=getParentBlock$3(node2,rootNode);return isNonNullable(block1)&&block1===block2})(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location)).getOr(location),skipNoMovement=(fromLocation,toLocation)=>fromLocation.fold(always,(fromLocation=>{return location2=toLocation,!(getName(location1=fromLocation)===getName(location2)&&getElement(location1)===getElement(location2));var location1,location2})),findLocationSimple=(forward,location)=>forward?location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none):location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end)),findLocation$1=(forward,isInlineTarget,rootNode,pos)=>{const from=normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk((()=>((forward,isInlineTarget,rootNode,fromLocation,pos)=>{const from=normalizePosition(forward,pos);return fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward)).fold((()=>fromLocation.map(outside)),(to=>readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation)))).filter(isValidLocation)})(forward,isInlineTarget,rootNode,fromLocation,pos)))},moveRel=(forward,selection,pos)=>{const delta=forward?1:-1;return selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange()),selection.getSel().modify("move",forward?"forward":"backward","word"),!0},moveByWord=(forward,editor)=>{const rng=editor.selection.getRng(),pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);return!!(editor=>isFunction(editor.selection.getSel().modify))(editor)&&(forward&&isBeforeInline(pos)?moveRel(!0,editor.selection,pos):!(forward||!isAfterInline(pos))&&moveRel(!1,editor.selection,pos))};var BreakType;!function(BreakType){BreakType[BreakType.Br=0]="Br",BreakType[BreakType.Block=1]="Block",BreakType[BreakType.Wrap=2]="Wrap",BreakType[BreakType.Eol=3]="Eol"}(BreakType||(BreakType={}));const flip=(direction,positions)=>direction===HDirection.Backwards?reverse(positions):positions,walk$1=(direction,caretWalker,pos)=>direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos),getBreakType=(scope,direction,currentPos,nextPos)=>isBr$6(nextPos.getNode(direction===HDirection.Forwards))?BreakType.Br:!1===isInSameBlock(currentPos,nextPos)?BreakType.Block:BreakType.Wrap,getPositionsUntil=(predicate,direction,scope,start)=>{const caretWalker=CaretWalker(scope);let currentPos=start;const positions=[];for(;currentPos;){const nextPos=walk$1(direction,caretWalker,currentPos);if(!nextPos)break;if(isBr$6(nextPos.getNode(!1)))return direction===HDirection.Forwards?{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)}:{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};if(nextPos.isVisible()){if(predicate(currentPos,nextPos)){const breakType=getBreakType(0,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType,breakAt:Optional.some(nextPos)}}positions.push(nextPos),currentPos=nextPos}else currentPos=nextPos}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()}},getAdjacentLinePositions=(direction,getPositionsUntilBreak,scope,start)=>getPositionsUntilBreak(scope,start).breakAt.map((pos=>{const positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions)})).getOr([]),findClosestHorizontalPositionFromPoint=(positions,x)=>foldl(positions,((acc,newPos)=>acc.fold((()=>Optional.some(newPos)),(lastPos=>lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),((lastRect,newRect)=>{const lastDist=Math.abs(x-lastRect.left);return Math.abs(x-newRect.left)<=lastDist?newPos:lastPos})).or(acc)))),Optional.none()),findClosestHorizontalPosition=(positions,pos)=>head(pos.getClientRects()).bind((targetRect=>findClosestHorizontalPositionFromPoint(positions,targetRect.left))),getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1),getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1),getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine),getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine),isAtFirstLine=(scope,pos)=>getPositionsUntilPreviousLine(scope,pos).breakAt.isNone(),isAtLastLine=(scope,pos)=>getPositionsUntilNextLine(scope,pos).breakAt.isNone(),getClosestPositionAbove=(scope,pos)=>findClosestHorizontalPosition(getPositionsAbove(scope,pos),pos),getClosestPositionBelow=(scope,pos)=>findClosestHorizontalPosition(getPositionsBelow(scope,pos),pos),isContentEditableFalse$4=isContentEditableFalse$b,distanceToRectLeft$1=(clientRect,clientX)=>Math.abs(clientRect.left-clientX),distanceToRectRight$1=(clientRect,clientX)=>Math.abs(clientRect.right-clientX),findClosestClientRect=(clientRects,clientX)=>reduce(clientRects,((oldClientRect,clientRect)=>{const oldDistance=Math.min(distanceToRectLeft$1(oldClientRect,clientX),distanceToRectRight$1(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft$1(clientRect,clientX),distanceToRectRight$1(clientRect,clientX));return newDistance===oldDistance&&hasNonNullableKey(clientRect,"node")&&isContentEditableFalse$4(clientRect.node)||newDistance<oldDistance?clientRect:oldClientRect})),getNodeClientRects=node=>{const toArrayWithNode=clientRects=>map$3(clientRects,(rect=>{const clientRect=clone$1(rect);return clientRect.node=node,clientRect}));if(isElement$6(node))return toArrayWithNode(node.getClientRects());if(isText$a(node)){const rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}return[]},getClientRects=nodes=>bind$3(nodes,getNodeClientRects);var VDirection;!function(VDirection){VDirection[VDirection.Up=-1]="Up",VDirection[VDirection.Down=1]="Down"}(VDirection||(VDirection={}));const walkUntil=(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition)=>{let line=0;const result=[],add=node=>{let clientRects=getClientRects([node]);-1===direction&&(clientRects=clientRects.reverse());for(let i=0;i<clientRects.length;i++){const clientRect=clientRects[i];if(!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,last$2(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}return!1},targetClientRect=last$2(caretPosition.getClientRects());if(!targetClientRect)return result;const node=caretPosition.getNode();return node&&(add(node),((direction,root,predicateFn,node)=>{let currentNode=node;for(;currentNode=findNode(currentNode,direction,isEditableCaretCandidate$1,root);)if(predicateFn(currentNode))return})(direction,root,add,node)),result},upUntil=curry(walkUntil,VDirection.Up,isAbove$1,isBelow$1),downUntil=curry(walkUntil,VDirection.Down,isBelow$1,isAbove$1),getLastClientRect=caretPosition=>last$2(caretPosition.getClientRects()),isAboveLine=lineNumber=>clientRect=>((lineNumber,clientRect)=>clientRect.line>lineNumber)(lineNumber,clientRect),isLine=lineNumber=>clientRect=>((lineNumber,clientRect)=>clientRect.line===lineNumber)(lineNumber,clientRect),moveToRange=(editor,rng)=>{editor.selection.setRng(rng),scrollRangeIntoView(editor,editor.selection.getRng())},renderRangeCaretOpt=(editor,range,scrollIntoView)=>Optional.some(renderRangeCaret(editor,range,scrollIntoView)),moveHorizontally=(editor,direction,range,isBefore,isAfter,isElement)=>{const forwards=direction===HDirection.Forwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev),isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){const node=getSelectedNode(range);if(isElement(node))return showCaret(direction,editor,node,direction===HDirection.Backwards,!1);if(isCefAtEdgeSelected(editor)){const newRange=range.cloneRange();return newRange.collapse(direction===HDirection.Backwards),Optional.from(newRange)}}const caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition))return selectNode(editor,caretPosition.getNode(!forwards));let nextCaretPosition=getNextPosFn(caretPosition);const rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition)return rangeIsInContainerBlock?Optional.some(range):Optional.none();if(nextCaretPosition=normalizePosition(forwards,nextCaretPosition),isBeforeFn(nextCaretPosition))return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,!1);const peekCaretPosition=getNextPosFn(nextCaretPosition);return peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)?showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,!1):rangeIsInContainerBlock?renderRangeCaretOpt(editor,nextCaretPosition.toRange(),!1):Optional.none()},moveVertically=(editor,direction,range,isBefore,isAfter,isElement)=>{const caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),caretClientRect=last$2(caretPosition.getClientRects()),forwards=direction===VDirection.Down,root=editor.getBody();if(!caretClientRect)return Optional.none();if(isCefAtEdgeSelected(editor)){const caretPosition=forwards?CaretPosition.fromRangeEnd(range):CaretPosition.fromRangeStart(range);return(forwards?getClosestPositionBelow:getClosestPositionAbove)(root,caretPosition).orThunk((()=>Optional.from(caretPosition))).map((pos=>pos.toRange()))}const linePositions=(forwards?downUntil:upUntil)(root,isAboveLine(1),caretPosition),nextLinePositions=filter$5(linePositions,isLine(1)),clientX=caretClientRect.left,nextLineRect=findClosestClientRect(nextLinePositions,clientX);if(nextLineRect&&isElement(nextLineRect.node)){const dist1=Math.abs(clientX-nextLineRect.left),dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,!1)}let currentNode;if(currentNode=isBefore(caretPosition)?caretPosition.getNode():isAfter(caretPosition)?caretPosition.getNode(!0):getSelectedNode(range),currentNode){const caretPositions=((direction,root,predicateFn,node)=>{const caretWalker=CaretWalker(root);let walkFn,isBelowFn,isAboveFn,caretPosition;const result=[];let line=0;1===direction?(walkFn=caretWalker.next,isBelowFn=isBelow$1,isAboveFn=isAbove$1,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=isAbove$1,isAboveFn=isBelow$1,caretPosition=CaretPosition.before(node));const targetClientRect=getLastClientRect(caretPosition);do{if(!caretPosition.isVisible())continue;const rect=getLastClientRect(caretPosition);if(isAboveFn(rect,targetClientRect))continue;result.length>0&&isBelowFn(rect,last$2(result))&&line++;const clientRect=clone$1(rect);if(clientRect.position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}while(caretPosition=walkFn(caretPosition));return result})(direction,root,isAboveLine(1),currentNode);let closestNextLineRect=findClosestClientRect(filter$5(caretPositions,isLine(1)),clientX);if(closestNextLineRect)return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1);if(closestNextLineRect=last$2(filter$5(caretPositions,isLine(0))),closestNextLineRect)return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1)}return 0===nextLinePositions.length?getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map((pos=>renderRangeCaret(editor,pos.toRange(),!1))):Optional.none()},getLineEndPoint=(editor,forward)=>{const rng=editor.selection.getRng(),from=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng),host=(node=from.container(),rootNode=editor.getBody(),ancestor$4(SugarElement.fromDom(node),(node=>isContentEditableTrue$1(node.dom)),(node=>node.dom===rootNode)).map((elm=>elm.dom)).getOr(rootNode));var node,rootNode;if(forward){const lineInfo=getPositionsUntilNextLine(host,from);return last$3(lineInfo.positions)}{const lineInfo=getPositionsUntilPreviousLine(host,from);return head(lineInfo.positions)}},moveToLineEndPoint$3=(editor,forward,isElementPosition)=>getLineEndPoint(editor,forward).filter(isElementPosition).exists((pos=>(editor.selection.setRng(pos.toRange()),!0))),setCaretPosition=(editor,pos)=>{const rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},setSelected=(state,elm)=>{state?elm.setAttribute("data-mce-selected","inline-boundary"):elm.removeAttribute("data-mce-selected")},renderCaretLocation=(editor,caret,location)=>renderCaret(caret,location).map((pos=>(setCaretPosition(editor,pos),location))),findLocation=(editor,caret,forward)=>{const rootNode=editor.getBody(),from=((range,root,forward)=>{const start=CaretPosition.fromRangeStart(range);if(range.collapsed)return start;{const end=CaretPosition.fromRangeEnd(range);return forward?prevPosition(root,end).getOr(end):nextPosition(root,start).getOr(start)}})(editor.selection.getRng(),rootNode,forward),isInlineTarget$1=curry(isInlineTarget,editor);return findLocation$1(forward,isInlineTarget$1,rootNode,from).bind((location=>renderCaretLocation(editor,caret,location)))},safeRemoveCaretContainer=(editor,caret)=>{const caretValue=caret.get();if(editor.selection.isCollapsed()&&!editor.composing&&caretValue){const pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!(pos=>isBeforeInline(pos)||isAfterInline(pos))(pos)&&(setCaretPosition(editor,removeAndReposition(caretValue,pos)),caret.set(null))}},move$3=(editor,caret,forward)=>!!isInlineBoundariesEnabled(editor)&&findLocation(editor,caret,forward).isSome(),moveWord=(forward,editor,_caret)=>!!isInlineBoundariesEnabled(editor)&&moveByWord(forward,editor),setupSelectedState=editor=>{const caret=Cell(null),isInlineTarget$1=curry(isInlineTarget,editor);return editor.on("NodeChange",(e=>{isInlineBoundariesEnabled(editor)&&(((isInlineTarget,dom,elms)=>{const inlineBoundaries=map$3(descendants(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),(e=>e.dom)),selectedInlines=filter$5(inlineBoundaries,isInlineTarget),targetInlines=filter$5(elms,isInlineTarget);each$e(difference(selectedInlines,targetInlines),curry(setSelected,!1)),each$e(difference(targetInlines,selectedInlines),curry(setSelected,!0))})(isInlineTarget$1,editor.dom,e.parents),safeRemoveCaretContainer(editor,caret),((isInlineTarget,editor,caret,elms)=>{if(editor.selection.isCollapsed()){const inlines=filter$5(elms,isInlineTarget);each$e(inlines,(_inline=>{const pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind((location=>renderCaretLocation(editor,caret,location)))}))}})(isInlineTarget$1,editor,caret,e.parents))})),caret},moveNextWord=curry(moveWord,!0),movePrevWord=curry(moveWord,!1),moveToLineEndPoint$2=(editor,forward,caret)=>{if(isInlineBoundariesEnabled(editor)){const linePoint=getLineEndPoint(editor,forward).getOrThunk((()=>{const rng=editor.selection.getRng();return forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng)}));return readLocation(curry(isInlineTarget,editor),editor.getBody(),linePoint).exists((loc=>{const outsideLoc=outside(loc);return renderCaret(caret,outsideLoc).exists((pos=>(setCaretPosition(editor,pos),!0)))}))}return!1},setCaretLocation=(editor,caret)=>location=>renderCaret(caret,location).map((pos=>()=>setCaretPosition(editor,pos))),deleteFromTo=(editor,caret,from,to)=>{const rootNode=editor.getBody(),isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore((()=>{editor.selection.setRng(((from,to)=>{const range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range})(from,to)),execNativeDeleteCommand(editor),readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).bind(setCaretLocation(editor,caret)).each(call)})),editor.nodeChanged()},backspaceDeleteCollapsed=(editor,caret,forward,from)=>{const rootNode=((rootNode,node)=>{const parentBlock=getParentBlock$3(node,rootNode);return parentBlock||rootNode})(editor.getBody(),from.container()),isInlineTarget$1=curry(isInlineTarget,editor),fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind((location=>forward?location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none):location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location)))))).map(setCaretLocation(editor,caret)).getOrThunk((()=>{const toPosition=navigate(forward,rootNode,from),toLocation=toPosition.bind((pos=>readLocation(isInlineTarget$1,rootNode,pos)));return lift2(fromLocation,toLocation,(()=>findRootInline(isInlineTarget$1,rootNode,from).bind((elm=>(elm=>lift2(firstPositionIn(elm),lastPositionIn(elm),((firstPos,lastPos)=>{const normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos);return nextPosition(elm,normalizedFirstPos).forall((pos=>pos.isEqual(normalizedLastPos)))})).getOr(!0))(elm)?Optional.some((()=>{deleteElement$2(editor,forward,SugarElement.fromDom(elm))})):Optional.none())))).getOrThunk((()=>toLocation.bind((()=>toPosition.map((to=>()=>{forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from)}))))))}))},backspaceDelete$4=(editor,caret,forward)=>{if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){const from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return Optional.none()},getParentsUntil=(editor,pred)=>{const rootElm=SugarElement.fromDom(editor.getBody()),startElm=SugarElement.fromDom(editor.selection.getStart()),parents=parentsAndSelf(startElm,rootElm);return findIndex$2(parents,pred).fold(constant(parents),(index=>parents.slice(0,index)))},hasOnlyOneChild=elm=>1===childNodesCount(elm),getParentInlinesUntilMultichildInline=editor=>getParentsUntil(editor,(elm=>editor.schema.isBlock(name(elm))||(elm=>childNodesCount(elm)>1)(elm))),getFormatNodes=(editor,parentInlines)=>{const isFormatElement$1=curry(isFormatElement,editor);return bind$3(parentInlines,(elm=>isFormatElement$1(elm)?[elm.dom]:[]))},getFormatNodesAtStart=editor=>{const parentInlines=(editor=>getParentsUntil(editor,(el=>editor.schema.isBlock(name(el)))))(editor);return getFormatNodes(editor,parentInlines)},deleteCaret$1=(editor,forward)=>{const parentInlines=filter$5(getParentInlinesUntilMultichildInline(editor),hasOnlyOneChild);return last$3(parentInlines).bind((target=>{const fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return willDeleteLastPositionInElement(forward,fromPos,target.dom)&&!isEmptyCaretFormatElement(target)?Optional.some((()=>((forward,editor,target,parentInlines)=>{const formatNodes=getFormatNodes(editor,parentInlines);if(0===formatNodes.length)deleteElement$2(editor,forward,target);else{const pos=replaceWithCaretFormat(target.dom,formatNodes);editor.selection.setRng(pos.toRange())}})(forward,editor,target,parentInlines))):Optional.none()}))},createCaretFormatAtStart=(editor,formatNodes)=>{const startElm=editor.selection.getStart(),pos=((editor,elm)=>{const parentElm=elm.parentElement;return isBr$6(elm)&&!isNull(parentElm)&&editor.dom.isEmpty(parentElm)})(editor,startElm)||(elm=startElm,isEmptyCaretFormatElement(SugarElement.fromDom(elm)))?replaceWithCaretFormat(startElm,formatNodes):((rng,formatNodes)=>{const{caretContainer,caretPosition}=createCaretFormat(formatNodes);return rng.insertNode(caretContainer.dom),caretPosition})(editor.selection.getRng(),formatNodes);var elm;editor.selection.setRng(pos.toRange())},rangeStartsAtTextContainer=rng=>isText$a(rng.startContainer),rangeEndsAtEndOfStartContainer=rng=>(rng=>{const startParent=rng.startContainer.parentNode,endParent=rng.endContainer.parentNode;return!isNull(startParent)&&!isNull(endParent)&&startParent.isEqualNode(endParent)})(rng)&&(rng=>{const endContainer=rng.endContainer;return rng.endOffset===(isText$a(endContainer)?endContainer.length:endContainer.childNodes.length)})(rng),requiresDeleteRangeOverride=editor=>{const rng=editor.selection.getRng();return(rng=>0===rng.startOffset&&rangeStartsAtTextContainer(rng))(rng)&&((editor,rng)=>{const startParent=rng.startContainer.parentElement;return!isNull(startParent)&&isFormatElement(editor,SugarElement.fromDom(startParent))})(editor,rng)&&(rng=>rangeEndsAtEndOfStartContainer(rng)||(rng=>!rng.endContainer.isEqualNode(rng.commonAncestorContainer))(rng))(rng)},deleteRange$1=editor=>{if(requiresDeleteRangeOverride(editor)){const formatNodes=getFormatNodesAtStart(editor);return Optional.some((()=>{execNativeDeleteCommand(editor),((editor,updateFormats)=>{const missingFormats=difference(updateFormats,getFormatNodesAtStart(editor));missingFormats.length>0&&createCaretFormatAtStart(editor,missingFormats)})(editor,formatNodes)}))}return Optional.none()},backspaceDelete$3=(editor,forward)=>editor.selection.isCollapsed()?deleteCaret$1(editor,forward):deleteRange$1(editor),hasAncestorInlineCaret=(elm,schema)=>((scope,predicate,isRoot)=>ancestor$4(scope,predicate,isRoot).isSome())(elm,(node=>isCaretNode(node.dom)),(el=>schema.isBlock(name(el)))),requiresRefreshCaretOverride=editor=>{const rng=editor.selection.getRng();return rng.collapsed&&(rangeStartsAtTextContainer(rng)||editor.dom.isEmpty(rng.startContainer))&&!(editor=>hasAncestorInlineCaret(SugarElement.fromDom(editor.selection.getStart()),editor.schema))(editor)},refreshCaret=editor=>(requiresRefreshCaretOverride(editor)&&createCaretFormatAtStart(editor,[]),!0),deleteElement=(editor,forward,element)=>isNonNullable(element)?Optional.some((()=>{editor._selectionOverrides.hideFakeCaret(),deleteElement$2(editor,forward,SugarElement.fromDom(element))})):Optional.none(),backspaceDelete$2=(editor,forward)=>editor.selection.isCollapsed()?((editor,forward)=>{const isNearMedia=forward?isBeforeMedia:isAfterMedia,direction=forward?HDirection.Forwards:HDirection.Backwards,fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());return isNearMedia(fromPos)?deleteElement(editor,forward,fromPos.getNode(!forward)):Optional.from(normalizePosition(forward,fromPos)).filter((pos=>isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos))).bind((pos=>deleteElement(editor,forward,pos.getNode(!forward))))})(editor,forward):((editor,forward)=>{const selectedNode=editor.selection.getNode();return isMedia$2(selectedNode)?deleteElement(editor,forward,selectedNode):Optional.none()})(editor,forward),parseIndentValue=value=>toInt(null!=value?value:"").getOr(0),getIndentStyleName=(useMargin,element)=>(useMargin||"table"===name(element)?"margin":"padding")+("rtl"===get$7(element,"direction")?"-right":"-left"),canOutdent=editor=>{const blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||((editor,blocks)=>forall(blocks,(block=>{const indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block),intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0);return"false"!==editor.dom.getContentEditable(block.dom)&&intentValue>0})))(editor,blocks))},isListComponent=el=>isList(el)||isListItem$1(el),getBlocksToIndent=editor=>filter$5(fromDom$1(editor.selection.getSelectedBlocks()),(el=>!isListComponent(el)&&!(el=>parent(el).exists(isListComponent))(el)&&closest$4(el,(elm=>isContentEditableTrue$3(elm.dom)||isContentEditableFalse$b(elm.dom))).exists((elm=>isContentEditableTrue$3(elm.dom))))),handle=(editor,command)=>{var _a,_b;const{dom}=editor,indentation=getIndentation(editor),indentUnit=null!==(_b=null===(_a=/[a-z%]+$/i.exec(indentation))||void 0===_a?void 0:_a[0])&&void 0!==_b?_b:"px",indentValue=parseIndentValue(indentation),useMargin=shouldIndentUseMargin(editor);each$e(getBlocksToIndent(editor),(block=>{((dom,command,useMargin,value,unit,element)=>{const indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element)),parsedValue=parseIndentValue(dom.getStyle(element,indentStyleName));if("outdent"===command){const styleValue=Math.max(0,parsedValue-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:"")}else{const styleValue=parsedValue+value+unit;dom.setStyle(element,indentStyleName,styleValue)}})(dom,command,useMargin,indentValue,indentUnit,block.dom)}))},outdent=editor=>handle(editor,"outdent"),backspaceDelete$1=editor=>{if(editor.selection.isCollapsed()&&canOutdent(editor)){const dom=editor.dom,rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),block=dom.getParent(rng.startContainer,dom.isBlock);if(null!==block&&isAtStartOfBlock(SugarElement.fromDom(block),pos,editor.schema))return Optional.some((()=>outdent(editor)))}return Optional.none()},findAction=(editor,caret,forward)=>findMap([backspaceDelete$1,backspaceDelete$6,backspaceDelete$7,(editor,forward)=>backspaceDelete$4(editor,caret,forward),backspaceDelete$9,backspaceDelete$a,backspaceDelete$5,backspaceDelete$2,backspaceDelete$8,backspaceDelete$3],(item=>item(editor,forward))).filter((_=>editor.selection.isEditable())),forwardDeleteCommand=(editor,caret)=>{findAction(editor,caret,!0).fold((()=>{editor.selection.isEditable()&&(editor=>{execCommandIgnoreInputEvents(editor,"ForwardDelete")})(editor)}),call)},setup$q=(editor,caret)=>{editor.addCommand("delete",(()=>{((editor,caret)=>{findAction(editor,caret,!1).fold((()=>{editor.selection.isEditable()&&(execNativeDeleteCommand(editor),paddEmptyBody(editor))}),call)})(editor,caret)})),editor.addCommand("forwardDelete",(()=>{forwardDeleteCommand(editor,caret)}))},getTouch=event=>void 0===event.touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0]),setup$p=editor=>{const startData=value$2(),longpressFired=Cell(!1),debounceLongpress=last$1((e=>{editor.dispatch("longpress",{...e,type:"longpress"}),longpressFired.set(!0)}),400);editor.on("touchstart",(e=>{getTouch(e).each((touch=>{debounceLongpress.cancel();const data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e),longpressFired.set(!1),startData.set(data)}))}),!0),editor.on("touchmove",(e=>{debounceLongpress.cancel(),getTouch(e).each((touch=>{startData.on((data=>{((touch,data)=>{const distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5})(touch,data)&&(startData.clear(),longpressFired.set(!1),editor.dispatch("longpresscancel"))}))}))}),!0),editor.on("touchend touchcancel",(e=>{debounceLongpress.cancel(),"touchcancel"!==e.type&&startData.get().filter((data=>data.target.isEqualNode(e.target))).each((()=>{longpressFired.get()?e.preventDefault():editor.dispatch("tap",{...e,type:"tap"})}))}),!0)},isBlockElement=(blockElements,node)=>has$2(blockElements,node.nodeName),isValidTarget=(schema,node)=>!!isText$a(node)||!!isElement$6(node)&&!(isBlockElement(schema.getBlockElements(),node)||isBookmarkNode$1(node)||isTransparentBlock(schema,node)||isNonHtmlElementRoot(node)),shouldRemoveTextNode=(blockElements,node)=>{if(isText$a(node)){if(0===node.data.length)return!0;if(/^\s+$/.test(node.data))return!node.nextSibling||isBlockElement(blockElements,node.nextSibling)||isNonHtmlElementRoot(node.nextSibling)}return!1},createRootBlock=editor=>editor.dom.create(getForcedRootBlock(editor),getForcedRootBlockAttrs(editor)),addRootBlocks=editor=>{const dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),startNode=selection.getStart(),rootNode=editor.getBody();let rootBlockNode,tempNode,wrapped=!1;const forcedRootBlock=getForcedRootBlock(editor);if(!startNode||!isElement$6(startNode))return;const rootNodeName=rootNode.nodeName.toLowerCase();if(!schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())||((blockElements,root,node)=>exists(parents(SugarElement.fromDom(node),SugarElement.fromDom(root)),(elm=>isBlockElement(blockElements,elm.dom))))(blockElements,rootNode,startNode))return;const rng=selection.getRng(),{startContainer,startOffset,endContainer,endOffset}=rng,restoreSelection=hasFocus(editor);let node=rootNode.firstChild;for(;node;)if(isElement$6(node)&&updateElement(schema,node),isValidTarget(schema,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=createRootBlock(editor),rootNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;wrapped&&restoreSelection&&(rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng),editor.nodeChanged())},insertEmptyLine=(editor,root,insertBlock)=>{const block=SugarElement.fromDom(createRootBlock(editor)),br=createPaddingBr();append$1(block,br),insertBlock(root,block);const rng=document.createRange();return rng.setStartBefore(br.dom),rng.setEndBefore(br.dom),rng},hasClass=checkClassName=>node=>-1!==(" "+node.attr("class")+" ").indexOf(checkClassName),replaceMatchWithSpan=(editor,content,cls)=>function(match){const args=arguments,index=args[args.length-2],prevChar=index>0?content.charAt(index-1):"";if('"'===prevChar)return match;if(">"===prevChar){const findStartTagIndex=content.lastIndexOf("<",index);if(-1!==findStartTagIndex){if(-1!==content.substring(findStartTagIndex,index).indexOf('contenteditable="false"'))return match}}return'<span class="'+cls+'" data-mce-content="'+editor.dom.encode(args[0])+'">'+editor.dom.encode("string"==typeof args[1]?args[1]:args[0])+"</span>"},isValidContent=(nonEditableRegExps,content)=>forall(nonEditableRegExps,(re=>{const matches=content.match(re);return null!==matches&&matches[0].length===content.length})),setup$n=editor=>{const editClass=" "+Tools.trim(getEditableClass(editor))+" ",nonEditClass=" "+Tools.trim(getNonEditableClass(editor))+" ",hasEditClass=hasClass(editClass),hasNonEditClass=hasClass(nonEditClass),nonEditableRegExps=getNonEditableRegExps(editor);nonEditableRegExps.length>0&&editor.on("BeforeSetContent",(e=>{((editor,nonEditableRegExps,e)=>{let i=nonEditableRegExps.length,content=e.content;if("raw"!==e.format){for(;i--;)content=content.replace(nonEditableRegExps[i],replaceMatchWithSpan(editor,content,getNonEditableClass(editor)));e.content=content}})(editor,nonEditableRegExps,e)})),editor.parser.addAttributeFilter("class",(nodes=>{let i=nodes.length;for(;i--;){const node=nodes[i];hasEditClass(node)?node.attr("contenteditable","true"):hasNonEditClass(node)&&node.attr("contenteditable","false")}})),editor.serializer.addAttributeFilter("contenteditable",(nodes=>{let i=nodes.length;for(;i--;){const node=nodes[i];if(!hasEditClass(node)&&!hasNonEditClass(node))continue;const content=node.attr("data-mce-content");nonEditableRegExps.length>0&&content?isValidContent(nonEditableRegExps,content)?(node.name="#text",node.type=3,node.raw=!0,node.value=content):node.remove():node.attr("contenteditable",null)}}))},showBlockCaretContainer=(editor,blockCaretContainer)=>{blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),editor.selection.setRng(editor.selection.getRng()),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=(editor,e)=>{const blockCaretContainer=(editor=>descendant$1(SugarElement.fromDom(editor.getBody()),"*[data-mce-caret]").map((elm=>elm.dom)).getOrNull())(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(editor,blockCaretContainer)):void(hasContent(blockCaretContainer)&&(showBlockCaretContainer(editor,blockCaretContainer),editor.undoManager.add()))},isContentEditableFalse$3=isContentEditableFalse$b,exitPreBlock=(editor,direction,range)=>{const caretWalker=CaretWalker(editor.getBody()),getVisualCaretPosition$1=curry(getVisualCaretPosition,1===direction?caretWalker.next:caretWalker.prev);if(range.collapsed){const pre=editor.dom.getParent(range.startContainer,"PRE");if(!pre)return;if(!getVisualCaretPosition$1(CaretPosition.fromRangeStart(range))){const newBlock=SugarElement.fromDom((editor=>{const textBlock=editor.dom.create(getForcedRootBlock(editor));return textBlock.innerHTML='<br data-mce-bogus="1">',textBlock})(editor));1===direction?after$4(SugarElement.fromDom(pre),newBlock):before$3(SugarElement.fromDom(pre),newBlock),editor.selection.select(newBlock.dom,!0),editor.selection.collapse()}}},getHorizontalRange=(editor,forward)=>{const direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return((direction,editor,range)=>moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$3))(direction,editor,range).orThunk((()=>(exitPreBlock(editor,direction,range),Optional.none())))},getVerticalRange=(editor,down)=>{const direction=down?1:-1,range=editor.selection.getRng();return((direction,editor,range)=>moveVertically(editor,direction,range,(caretPosition=>isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition)),(caretPosition=>isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition)),isContentEditableFalse$3))(direction,editor,range).orThunk((()=>(exitPreBlock(editor,direction,range),Optional.none())))},moveH$2=(editor,forward)=>getHorizontalRange(editor,((selection,forward)=>{const elm=forward?selection.getEnd(!0):selection.getStart(!0);return isRtl(elm)?!forward:forward})(editor.selection,forward)).exists((newRange=>(moveToRange(editor,newRange),!0))),moveV$4=(editor,down)=>getVerticalRange(editor,down).exists((newRange=>(moveToRange(editor,newRange),!0))),moveToLineEndPoint$1=(editor,forward)=>moveToLineEndPoint$3(editor,forward,forward?isAfterContentEditableFalse:isBeforeContentEditableFalse),selectToEndPoint=(editor,forward)=>getEdgeCefPosition(editor,!forward).map((pos=>{const rng=pos.toRange(),curRng=editor.selection.getRng();return forward?rng.setStart(curRng.startContainer,curRng.startOffset):rng.setEnd(curRng.endContainer,curRng.endOffset),rng})).exists((rng=>(moveToRange(editor,rng),!0))),isTarget=node=>contains$2(["figcaption"],name(node)),moveCaretToNewEmptyLine=(editor,forward)=>{const root=SugarElement.fromDom(editor.getBody()),pos=CaretPosition.fromRangeStart(editor.selection.getRng());return((pos,root,schema)=>{const isRoot=curry(eq,root);return closest$4(SugarElement.fromDom(pos.container()),(el=>schema.isBlock(name(el))),isRoot).filter(isTarget)})(pos,root,editor.schema).exists((()=>{if(((root,forward,pos)=>forward?isAtLastLine(root.dom,pos):isAtFirstLine(root.dom,pos))(root,forward,pos)){const rng=insertEmptyLine(editor,root,forward?append$1:prepend);return editor.selection.setRng(rng),!0}return!1}))},moveV$3=(editor,forward)=>!!editor.selection.isCollapsed()&&moveCaretToNewEmptyLine(editor,forward),move$2=(editor,forward)=>forward?Optional.from(editor.dom.getParent(editor.selection.getNode(),"details")).map((details=>((editor,details)=>{const rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng);return!(editor.getBody().lastChild!==details||!isAtLastLine(details,pos)||(editor.execCommand("InsertNewBlockAfter"),0))})(editor,details))).getOr(!1):Optional.from(editor.dom.getParent(editor.selection.getNode(),"summary")).bind((summary=>Optional.from(editor.dom.getParent(summary,"details")).map((details=>((editor,details,summary)=>{const rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng);return!(editor.getBody().firstChild!==details||!isAtFirstLine(summary,pos)||(editor.execCommand("InsertNewBlockBefore"),0))})(editor,details,summary))))).getOr(!1),moveV$2=(editor,forward)=>move$2(editor,forward),baseKeyPattern={shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0},matchesEvent=(pattern,evt)=>evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey,match$1=(patterns,evt)=>bind$3((patterns=>map$3(patterns,(pattern=>({...baseKeyPattern,...pattern}))))(patterns),(pattern=>matchesEvent(pattern,evt)?[pattern]:[])),matchDelayed=(patterns,evt)=>bind$3((patterns=>map$3(patterns,(pattern=>({...baseKeyPattern,...pattern}))))(patterns),(pattern=>matchesEvent(pattern,evt)?[pattern]:[])),action=(f,...x)=>()=>f.apply(null,x),execute=(patterns,evt)=>find$2(match$1(patterns,evt),(pattern=>pattern.action())),executeWithDelayedAction=(patterns,evt)=>findMap(matchDelayed(patterns,evt),(pattern=>pattern.action())),moveH$1=(editor,forward)=>{const direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((newRange=>(moveToRange(editor,newRange),!0)))},moveV$1=(editor,down)=>{const direction=down?1:-1,range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia$2).exists((newRange=>(moveToRange(editor,newRange),!0)))},moveToLineEndPoint=(editor,forward)=>moveToLineEndPoint$3(editor,forward,forward?isAfterMedia:isBeforeMedia),adt=Adt_generate([{none:["current"]},{first:["current"]},{middle:["current","target"]},{last:["current"]}]),CellLocation={...adt,none:current=>adt.none(current)},filterFirstLayer=(scope,selector,predicate)=>bind$3(children$1(scope),(x=>is$1(x,selector)?predicate(x)?[x]:[]:filterFirstLayer(x,selector,predicate))),cell=(element,isRoot)=>((tags,element,isRoot=never)=>isRoot(element)?Optional.none():contains$2(tags,name(element))?Optional.some(element):ancestor$3(element,tags.join(","),(elm=>is$1(elm,"table")||isRoot(elm))))(["td","th"],element,isRoot),cells=ancestor=>filterFirstLayer(ancestor,"th,td",always),table=(element,isRoot)=>closest$3(element,"table",isRoot),walk=(all,current,index,direction,isEligible=always)=>{const forwards=1===direction;if(!forwards&&index<=0)return CellLocation.first(all[0]);if(forwards&&index>=all.length-1)return CellLocation.last(all[all.length-1]);{const newIndex=index+direction,elem=all[newIndex];return isEligible(elem)?CellLocation.middle(current,elem):walk(all,current,newIndex,direction,isEligible)}},detect=(current,isRoot)=>table(current,isRoot).bind((table=>{const all=cells(table);return findIndex$2(all,(x=>eq(current,x))).map((index=>({index,all})))})),getClosestCell=(getYAxisValue,isTargetCorner,table,x,y)=>{const cells=descendants(SugarElement.fromDom(table),"td,th,caption").map((e=>e.dom)),corners=filter$5(((getYAxisValue,tds)=>bind$3(tds,(td=>{const rect=((rect,delta)=>({left:rect.left-delta,top:rect.top-delta,right:rect.right+2*delta,bottom:rect.bottom+2*delta,width:rect.width+delta,height:rect.height+delta}))(clone$1(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}]})))(getYAxisValue,cells),(corner=>isTargetCorner(corner,y)));return((corners,x,y)=>foldl(corners,((acc,newCorner)=>acc.fold((()=>Optional.some(newCorner)),(oldCorner=>{const oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y)),newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner)}))),Optional.none()))(corners,x,y).map((corner=>corner.cell))},getClosestCellAbove=curry(getClosestCell,(rect=>rect.bottom),((corner,y)=>corner.y<y)),getClosestCellBelow=curry(getClosestCell,(rect=>rect.top),((corner,y)=>corner.y>y)),findClosestPositionInAboveCell=(table,pos)=>head(pos.getClientRects()).bind((rect=>getClosestCellAbove(table,rect.left,rect.top))).bind((cell=>{return findClosestHorizontalPosition(lastPositionIn(scope=cell).map((pos=>getPositionsUntilPreviousLine(scope,pos).positions.concat(pos))).getOr([]),pos);var scope})),findClosestPositionInBelowCell=(table,pos)=>last$3(pos.getClientRects()).bind((rect=>getClosestCellBelow(table,rect.left,rect.top))).bind((cell=>{return findClosestHorizontalPosition(firstPositionIn(scope=cell).map((pos=>[pos].concat(getPositionsUntilNextLine(scope,pos).positions))).getOr([]),pos);var scope})),isAtTableCellLine=(getPositionsUntil,scope,pos)=>{const lineInfo=getPositionsUntil(scope,pos);return(lineInfo=>lineInfo.breakType===BreakType.Wrap&&0===lineInfo.positions.length)(lineInfo)||!isBr$6(pos.getNode())&&(lineInfo=>lineInfo.breakType===BreakType.Br&&1===lineInfo.positions.length)(lineInfo)?!((getPositionsUntil,scope,lineInfo)=>lineInfo.breakAt.exists((breakPos=>getPositionsUntil(scope,breakPos).breakAt.isSome())))(getPositionsUntil,scope,lineInfo):lineInfo.breakAt.isNone()},isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine),isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine),navigateHorizontally=(editor,forward,table,_td)=>{const rng=editor.selection.getRng(),direction=forward?1:-1;return!(!isFakeCaretTableBrowser()||!((forward,rng,table)=>{const caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists((pos=>pos.isEqual(caretPos)))})(forward,rng,table))&&(showCaret(direction,editor,table,!forward,!1).each((newRng=>{moveToRange(editor,newRng)})),!0)},getTable=(previous,pos)=>{const node=pos.getNode(previous);return isTable$2(node)?Optional.some(node):Optional.none()},moveCaret=(editor,down,pos)=>{const table=getTable(!!down,pos),last=!1===down;table.fold((()=>moveToRange(editor,pos.toRange())),(table=>positionIn(last,editor.getBody()).filter((lastPos=>lastPos.isEqual(pos))).fold((()=>moveToRange(editor,pos.toRange())),(_=>((down,editor,table)=>{editor.undoManager.transact((()=>{const insertFn=down?after$4:before$3,rng=insertEmptyLine(editor,SugarElement.fromDom(table),insertFn);moveToRange(editor,rng)}))})(down,editor,table)))))},navigateVertically=(editor,down,table,td)=>{const rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){const newPos=((root,table,start)=>findClosestPositionInAboveCell(table,start).orThunk((()=>head(start.getClientRects()).bind((rect=>findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left))))).getOr(CaretPosition.before(table)))(root,table,pos);return moveCaret(editor,down,newPos),!0}if(down&&isAtLastTableCellLine(td,pos)){const newPos=((root,table,start)=>findClosestPositionInBelowCell(table,start).orThunk((()=>head(start.getClientRects()).bind((rect=>findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left))))).getOr(CaretPosition.after(table)))(root,table,pos);return moveCaret(editor,down,newPos),!0}return!1},move$1=(editor,forward,mover)=>Optional.from(editor.dom.getParent(editor.selection.getNode(),"td,th")).bind((td=>Optional.from(editor.dom.getParent(td,"table")).map((table=>mover(editor,forward,table,td))))).getOr(!1),moveH=(editor,forward)=>move$1(editor,forward,navigateHorizontally),moveV=(editor,forward)=>move$1(editor,forward,navigateVertically),tabGo=(editor,isRoot,cell)=>cell.fold(Optional.none,Optional.none,((_current,next)=>{return(element=next,descendant$2(element,isCursorPosition)).map((cell=>(cell=>{const selection=SimSelection.exact(cell,0,cell,0);return toNative(selection)})(cell)));var element}),(current=>(editor.execCommand("mceTableInsertRowAfter"),tabForward(editor,isRoot,current)))),tabForward=(editor,isRoot,cell)=>tabGo(editor,isRoot,((current,isEligible,isRoot)=>detect(current,isRoot).fold((()=>CellLocation.none(current)),(info=>walk(info.all,current,info.index,1,isEligible))))(cell,isEditable$2)),tabBackward=(editor,isRoot,cell)=>tabGo(editor,isRoot,((current,isEligible,isRoot)=>detect(current,isRoot).fold((()=>CellLocation.none()),(info=>walk(info.all,current,info.index,-1,isEligible))))(cell,isEditable$2)),handleTab=(editor,forward)=>{const rootElements=["table","li","dl"],body=SugarElement.fromDom(editor.getBody()),isRoot=element=>{const name$1=name(element);return eq(element,body)||contains$2(rootElements,name$1)},rng=editor.selection.getRng(),container=SugarElement.fromDom(forward?rng.endContainer:rng.startContainer);return cell(container,isRoot).map((cell=>{table(cell,isRoot).each((table=>{editor.model.table.clearSelectedCells(table.dom)})),editor.selection.collapse(!forward);return(forward?tabForward:tabBackward)(editor,isRoot,cell).each((range=>{editor.selection.setRng(range)})),!0})).getOr(!1)},setup$l=(editor,caret)=>{editor.on("keydown",(evt=>{evt.isDefaultPrevented()||((editor,caret,evt)=>{const isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.RIGHT,action:action(moveH$2,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$2,editor,!1)},{keyCode:VK.UP,action:action(moveV$4,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$4,editor,!0)},...isMac?[{keyCode:VK.UP,action:action(selectToEndPoint,editor,!1),metaKey:!0,shiftKey:!0},{keyCode:VK.DOWN,action:action(selectToEndPoint,editor,!0),metaKey:!0,shiftKey:!0}]:[],{keyCode:VK.RIGHT,action:action(moveH,editor,!0)},{keyCode:VK.LEFT,action:action(moveH,editor,!1)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.DOWN,action:action(moveV,editor,!0)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.UP,action:action(moveV$2,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$2,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$1,editor,!1)},{keyCode:VK.UP,action:action(moveV$1,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$1,editor,!0)},{keyCode:VK.RIGHT,action:action(move$3,editor,caret,!0)},{keyCode:VK.LEFT,action:action(move$3,editor,caret,!1)},{keyCode:VK.RIGHT,ctrlKey:!isMac,altKey:isMac,action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!isMac,altKey:isMac,action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$3,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$3,editor,!0)}],evt).each((_=>{evt.preventDefault()}))})(editor,caret,evt)}))},point=(container,offset)=>({container,offset}),DOM$7=DOMUtils.DOM,alwaysNext=startNode=>node=>startNode===node?-1:0,textBefore=(node,offset,rootNode)=>{if(isText$a(node)&&offset>=0)return Optional.some(point(node,offset));{const textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).map((prev=>point(prev.container,prev.container.data.length)))}},scanLeft=(node,offset,rootNode)=>{if(!isText$a(node))return Optional.none();const text=node.data;if(offset>=0&&offset<=text.length)return Optional.some(point(node,offset));{const textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.backwards(node,offset,alwaysNext(node),rootNode)).bind((prev=>{const prevText=prev.container.data;return scanLeft(prev.container,offset+prevText.length,rootNode)}))}},scanRight=(node,offset,rootNode)=>{if(!isText$a(node))return Optional.none();const text=node.data;if(offset<=text.length)return Optional.some(point(node,offset));{const textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).bind((next=>scanRight(next.container,offset-text.length,rootNode)))}},repeatLeft=(dom,node,offset,process,rootNode)=>{const search=TextSeeker(dom,(dom=>node=>dom.isBlock(node)||contains$2(["BR","IMG","HR","INPUT"],node.nodeName)||"false"===dom.getContentEditable(node))(dom));return Optional.from(search.backwards(node,offset,process,rootNode))},getText=rng=>trim$2(rng.toString().replace(/\u00A0/g," ")),isWhitespace=chr=>""!==chr&&-1!=="  \f\n\r\t\v".indexOf(chr),stripTrigger=(text,trigger)=>text.substring(trigger.length),findStart=(dom,initRange,trigger,minChars=0)=>{if(!(rng=initRange).collapsed||!isText$a(rng.startContainer))return Optional.none();var rng;const buffer={text:"",offset:0},root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,((element,offset,text)=>(buffer.text=text+buffer.text,buffer.offset+=offset,((text,index,trigger)=>{let i;const firstChar=trigger.charAt(0);for(i=index-1;i>=0;i--){const char=text.charAt(i);if(isWhitespace(char))return Optional.none();if(firstChar===char&&contains$1(text,trigger,i,index))break}return Optional.some(i)})(buffer.text,buffer.offset,trigger).getOr(offset))),root).bind((spot=>{const range=initRange.cloneRange();if(range.setStart(spot.container,spot.offset),range.setEnd(initRange.endContainer,initRange.endOffset),range.collapsed)return Optional.none();const text=getText(range);return 0!==text.lastIndexOf(trigger)||stripTrigger(text,trigger).length<minChars?Optional.none():Optional.some({text:stripTrigger(text,trigger),range,trigger})}))},getContext=(dom,initRange,trigger,minChars=0)=>{return(elm=SugarElement.fromDom(initRange.startContainer),closest$3(elm,"[data-mce-autocompleter]")).fold((()=>findStart(dom,initRange,trigger,minChars)),(elm=>{const range=dom.createRng();range.selectNode(elm.dom);const text=getText(range);return Optional.some({range,text:stripTrigger(text,trigger),trigger})}));var elm},toLast=node=>{if((node=>3===node.nodeType)(node))return point(node,node.data.length);{const children=node.childNodes;return children.length>0?toLast(children[children.length-1]):point(node,children.length)}},toLeaf=(node,offset)=>{const children=node.childNodes;return children.length>0&&offset<children.length?toLeaf(children[offset],0):children.length>0&&(node=>1===node.nodeType)(node)&&children.length===offset?toLast(children[children.length-1]):point(node,offset)},isStartOfWord=dom=>rng=>{const leaf=toLeaf(rng.startContainer,rng.startOffset);return!((dom,leaf)=>{var _a;const root=null!==(_a=dom.getParent(leaf.container,dom.isBlock))&&void 0!==_a?_a:dom.getRoot();return repeatLeft(dom,leaf.container,leaf.offset,((_element,offset)=>0===offset?-1:offset),root).filter((spot=>{const char=spot.container.data.charAt(spot.offset-1);return!isWhitespace(char)})).isSome()})(dom,leaf)},lookup=(editor,getDatabase)=>{const database=getDatabase(),rng=editor.selection.getRng();return((dom,initRange,database)=>findMap(database.triggers,(trigger=>getContext(dom,initRange,trigger))))(editor.dom,rng,database).bind((context=>lookupWithContext(editor,getDatabase,context)))},lookupWithContext=(editor,getDatabase,context,fetchOptions={})=>{var _a;const database=getDatabase(),startText=null!==(_a=editor.selection.getRng().startContainer.nodeValue)&&void 0!==_a?_a:"",autocompleters=filter$5(database.lookupByTrigger(context.trigger),(autocompleter=>context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk((()=>isStartOfWord(editor.dom)))(context.range,startText,context.text)));if(0===autocompleters.length)return Optional.none();const lookupData=Promise.all(map$3(autocompleters,(ac=>ac.fetch(context.text,ac.maxResults,fetchOptions).then((results=>({matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn}))))));return Optional.some({lookupData,context})};var SimpleResultType;!function(SimpleResultType){SimpleResultType[SimpleResultType.Error=0]="Error",SimpleResultType[SimpleResultType.Value=1]="Value"}(SimpleResultType||(SimpleResultType={}));const fold$1=(res,onError,onValue)=>res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue),svalue=v=>({stype:SimpleResultType.Value,svalue:v}),serror=e=>({stype:SimpleResultType.Error,serror:e}),SimpleResult_toResult=res=>fold$1(res,Result.error,Result.value),SimpleResult_svalue=svalue,SimpleResult_partition=results=>{const values=[],errors=[];return each$e(results,(obj=>{fold$1(obj,(err=>errors.push(err)),(val=>values.push(val)))})),{values,errors}},SimpleResult_serror=serror,SimpleResult_bindError=(res,f)=>res.stype===SimpleResultType.Error?f(res.serror):res,SimpleResult_map=(res,f)=>res.stype===SimpleResultType.Value?{stype:SimpleResultType.Value,svalue:f(res.svalue)}:res,SimpleResult_mapError=(res,f)=>res.stype===SimpleResultType.Error?{stype:SimpleResultType.Error,serror:f(res.serror)}:res,SimpleResult_fold=fold$1,formatObj=input=>isObject(input)&&keys(input).length>100?" removed due to size":JSON.stringify(input,null,2),nu=(path,getErrorInfo)=>SimpleResult_serror([{path,getErrorInfo}]),chooseFrom=(path,input,branches,ch)=>get$a(branches,ch).fold((()=>((path,branches,branch)=>nu(path,(()=>'The chosen schema: "'+branch+'" did not exist in branches: '+formatObj(branches))))(path,branches,ch)),(vp=>vp.extract(path.concat(["branch: "+ch]),input))),choose$1=(key,branches)=>({extract:(path,input)=>get$a(input,key).fold((()=>((path,key)=>nu(path,(()=>'Choice schema did not contain choice key: "'+key+'"')))(path,key)),(chosen=>chooseFrom(path,input,branches,chosen))),toString:()=>"chooseOn("+key+"). Possible values: "+keys(branches)}),baseMerge=merger=>(...objects)=>{if(0===objects.length)throw new Error("Can't merge zero objects");const ret={};for(let j=0;j<objects.length;j++){const curObject=objects[j];for(const key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret},deepMerge=baseMerge(((old,nu)=>isPlainObject(old)&&isPlainObject(nu)?deepMerge(old,nu):nu)),defaulted$1=(baseMerge(((old,nu)=>nu)),fallback=>({tag:"defaultedThunk",process:constant(fallback)})),mergeErrors=errors=>compose(SimpleResult_serror,flatten)(errors),ResultCombine_consolidateArr=objects=>{const partitions=SimpleResult_partition(objects);return partitions.errors.length>0?mergeErrors(partitions.errors):SimpleResult_svalue(partitions.values)},fold=(value,ifField,ifCustom)=>{switch(value.tag){case"field":return ifField(value.key,value.newKey,value.presence,value.prop);case"custom":return ifCustom(value.newKey,value.instantiator)}},value=validator=>({extract:(path,val)=>SimpleResult_bindError(validator(val),(err=>((path,err)=>nu(path,constant(err)))(path,err))),toString:constant("val")}),anyValue$1=value(SimpleResult_svalue),requiredAccess=(path,obj,key,bundle)=>get$a(obj,key).fold((()=>((path,key,obj)=>nu(path,(()=>'Could not find valid *required* value for "'+key+'" in '+formatObj(obj))))(path,key,obj)),bundle),fallbackAccess=(obj,key,fallback,bundle)=>bundle(get$a(obj,key).getOrThunk((()=>fallback(obj)))),extractField=(field,path,obj,key,prop)=>{const bundle=av=>prop.extract(path.concat([key]),av),bundleAsOption=optValue=>optValue.fold((()=>SimpleResult_svalue(Optional.none())),(ov=>{const result=prop.extract(path.concat([key]),ov);return SimpleResult_map(result,Optional.some)}));switch(field.tag){case"required":return requiredAccess(path,obj,key,bundle);case"defaultedThunk":return fallbackAccess(obj,key,field.process,bundle);case"option":return((obj,key,bundle)=>bundle(get$a(obj,key)))(obj,key,bundleAsOption);case"defaultedOptionThunk":return((obj,key,fallback,bundle)=>bundle(get$a(obj,key).map((val=>!0===val?fallback(obj):val))))(obj,key,field.process,bundleAsOption);case"mergeWithThunk":return fallbackAccess(obj,key,constant({}),(v=>{const result=deepMerge(field.process(obj),v);return bundle(result)}))}},objOf=values=>({extract:(path,o)=>((path,obj,fields)=>{const success={},errors=[];for(const field of fields)fold(field,((key,newKey,presence,prop)=>{const result=extractField(presence,path,obj,key,prop);SimpleResult_fold(result,(err=>{errors.push(...err)}),(res=>{success[newKey]=res}))}),((newKey,instantiator)=>{success[newKey]=instantiator(obj)}));return errors.length>0?SimpleResult_serror(errors):SimpleResult_svalue(success)})(path,o,values),toString:()=>{const fieldStrings=map$3(values,(value=>fold(value,((key,_okey,_presence,prop)=>key+" -> "+prop.toString()),((newKey,_instantiator)=>"state("+newKey+")"))));return"obj{\n"+fieldStrings.join("\n")+"}"}}),arrOf=prop=>({extract:(path,array)=>{const results=map$3(array,((a,i)=>prop.extract(path.concat(["["+i+"]"]),a)));return ResultCombine_consolidateArr(results)},toString:()=>"array("+prop.toString()+")"}),asRaw=(label,prop,obj)=>SimpleResult_toResult(((label,prop,obj)=>{const res=prop.extract([label],obj);return SimpleResult_mapError(res,(errs=>({input:obj,errors:errs})))})(label,prop,obj)),formatError=errInfo=>"Errors: \n"+(errors=>{const es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant("... (only showing first ten failures)")}]):errors;return map$3(es,(e=>"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()))})(errInfo.errors).join("\n")+"\n\nInput object: "+formatObj(errInfo.input),choose=(key,branches)=>choose$1(key,map$2(branches,objOf)),anyValue=constant(anyValue$1),typedValue=(validator,expectedType)=>value((a=>{const actualType=typeof a;return validator(a)?SimpleResult_svalue(a):SimpleResult_serror(`Expected type: ${expectedType} but got: ${actualType}`)})),number=typedValue(isNumber,"number"),string=typedValue(isString,"string"),boolean=typedValue(isBoolean,"boolean"),functionProcessor=typedValue(isFunction,"function"),field=(key,newKey,presence,prop)=>({tag:"field",key,newKey,presence,prop}),customField=(newKey,instantiator)=>({tag:"custom",newKey,instantiator}),validateEnum=values=>{return validator=value=>contains$2(values,value)?Result.value(value):Result.error(`Unsupported value: "${value}", choose one of "${values.join(", ")}".`),value((v=>validator(v).fold(SimpleResult_serror,SimpleResult_svalue)));var validator},requiredOf=(key,schema)=>field(key,key,{tag:"required",process:{}},schema),requiredString=key=>requiredOf(key,string),requiredFunction=key=>requiredOf(key,functionProcessor),optionOf=(key,schema)=>field(key,key,{tag:"option",process:{}},schema),optionString=key=>optionOf(key,string),defaultedOf=(key,fallback,schema)=>field(key,key,defaulted$1(fallback),schema),defaultedNumber=(key,fallback)=>defaultedOf(key,fallback,number),defaultedStringEnum=(key,fallback,values)=>defaultedOf(key,fallback,validateEnum(values)),defaultedBoolean=(key,fallback)=>defaultedOf(key,fallback,boolean),defaultedFunction=(key,fallback)=>defaultedOf(key,fallback,functionProcessor),type=requiredString("type"),fetch$1=requiredFunction("fetch"),onAction=requiredFunction("onAction"),onSetup=defaultedFunction("onSetup",(()=>noop)),optionalText=optionString("text"),optionalIcon=optionString("icon"),optionalTooltip=optionString("tooltip"),optionalLabel=optionString("label"),active=defaultedBoolean("active",!1),enabled=defaultedBoolean("enabled",!0),primary=defaultedBoolean("primary",!1),defaultedType=type=>((key,fallback)=>defaultedOf(key,fallback,string))("type",type),autocompleterSchema=objOf([type,requiredString("trigger"),defaultedNumber("minChars",1),(num=1,((key,fallback)=>field(key,key,defaulted$1(fallback),anyValue()))("columns",num)),defaultedNumber("maxResults",10),(key="matches",optionOf(key,functionProcessor)),fetch$1,onAction,((key,fallback,schema)=>defaultedOf(key,fallback,arrOf(schema)))("highlightOn",[],string)]);var key,num;const baseToolbarButtonFields=[enabled,optionalTooltip,optionalIcon,optionalText,onSetup],baseToolbarToggleButtonFields=[active].concat(baseToolbarButtonFields),contextBarFields=[defaultedFunction("predicate",never),defaultedStringEnum("scope","node",["node","editor"]),defaultedStringEnum("position","selection",["node","selection","line"])],contextButtonFields=baseToolbarButtonFields.concat([defaultedType("contextformbutton"),primary,onAction,customField("original",identity)]),contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType("contextformbutton"),primary,onAction,customField("original",identity)]),launchButtonFields=baseToolbarButtonFields.concat([defaultedType("contextformbutton")]),launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaultedType("contextformtogglebutton")]),toggleOrNormal=choose("type",{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields});objOf([defaultedType("contextform"),defaultedFunction("initValue",constant("")),optionalLabel,((key,schema)=>field(key,key,{tag:"required",process:{}},arrOf(schema)))("commands",toggleOrNormal),optionOf("launch",choose("type",{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields));const register$2=editor=>{const popups=editor.ui.registry.getAll().popups,dataset=map$2(popups,(popup=>{return(spec=popup,asRaw("Autocompleter",autocompleterSchema,{trigger:spec.ch,...spec})).fold((err=>{throw new Error(formatError(err))}),identity);var spec})),triggers=stringArray(mapToArray(dataset,(v=>v.trigger))),datasetValues=values(dataset);return{dataset,triggers,lookupByTrigger:trigger=>filter$5(datasetValues,(dv=>dv.trigger===trigger))}},setup$k=editor=>{const activeAutocompleter=value$2(),uiActive=Cell(!1),isActive=activeAutocompleter.isSet,cancelIfNecessary=()=>{isActive()&&((editor=>{getRtcInstanceWithError(editor).autocompleter.removeDecoration()})(editor),(editor=>{editor.dispatch("AutocompleterEnd")})(editor),uiActive.set(!1),activeAutocompleter.clear())},commenceIfNecessary=context=>{isActive()||(((editor,range)=>{getRtcInstanceWithError(editor).autocompleter.addDecoration(range)})(editor,context.range),activeAutocompleter.set({trigger:context.trigger,matchLength:context.text.length}))},getAutocompleters=cached((()=>register$2(editor))),load=fetchOptions=>{(fetchOptions=>activeAutocompleter.get().map((ac=>getContext(editor.dom,editor.selection.getRng(),ac.trigger).bind((newContext=>lookupWithContext(editor,getAutocompleters,newContext,fetchOptions))))).getOrThunk((()=>lookup(editor,getAutocompleters))))(fetchOptions).fold(cancelIfNecessary,(lookupInfo=>{commenceIfNecessary(lookupInfo.context),lookupInfo.lookupData.then((lookupData=>{activeAutocompleter.get().map((ac=>{const context=lookupInfo.context;ac.trigger===context.trigger&&(context.text.length-ac.matchLength>=10?cancelIfNecessary():(activeAutocompleter.set({...ac,matchLength:context.text.length}),uiActive.get()?((editor,args)=>{editor.dispatch("AutocompleterUpdate",args)})(editor,{lookupData}):(uiActive.set(!0),((editor,args)=>{editor.dispatch("AutocompleterStart",args)})(editor,{lookupData}))))}))}))}))};editor.addCommand("mceAutocompleterReload",((_ui,value)=>{const fetchOptions=isObject(value)?value.fetchOptions:{};load(fetchOptions)})),editor.addCommand("mceAutocompleterClose",cancelIfNecessary),((editor,api)=>{const update=last$1(api.load,50);editor.on("keypress compositionend",(e=>{27!==e.which&&update.throttle()})),editor.on("keydown",(e=>{const keyCode=e.which;8===keyCode?update.throttle():27===keyCode&&api.cancelIfNecessary()})),editor.on("remove",update.cancel)})(editor,{cancelIfNecessary,load})},isSafari=detect$2().browser.isSafari(),emptyNodeContents=node=>fillWithPaddingBr(SugarElement.fromDom(node)),isEntireNodeSelected=(rng,node)=>{var _a;return 0===rng.startOffset&&rng.endOffset===(null===(_a=node.textContent)||void 0===_a?void 0:_a.length)},getParentDetailsElementAtPos=(dom,pos)=>Optional.from(dom.getParent(pos.container(),"details")),isInDetailsElement=(dom,pos)=>getParentDetailsElementAtPos(dom,pos).isSome(),isCaretAtStartOfSummary=(caretPos,detailsElements)=>detailsElements.startSummary.exists((summary=>((caretPos,element)=>firstPositionIn(element).exists((pos=>pos.isEqual(caretPos))))(caretPos,summary))),isCaretAtEndOfSummary=(caretPos,detailsElements)=>detailsElements.startSummary.exists((summary=>((caretPos,element)=>lastPositionIn(element).exists((pos=>isBr$6(pos.getNode())&&prevPosition(element,pos).exists((pos2=>pos2.isEqual(caretPos)))||pos.isEqual(caretPos))))(caretPos,summary))),setCaretToPosition=(editor,position)=>{const node=position.getNode();isUndefined(node)||editor.selection.setCursorLocation(node,position.offset())},moveCaretToDetailsPos=(editor,pos,forward)=>{const details=editor.dom.getParent(pos.container(),"details");if(details&&!details.open){const summary=editor.dom.select("summary",details)[0];if(summary){(forward?firstPositionIn(summary):lastPositionIn(summary)).each((pos=>setCaretToPosition(editor,pos)))}}else setCaretToPosition(editor,pos)},shouldPreventDeleteIntoDetails=(editor,forward,granularity)=>{const{dom,selection}=editor,root=editor.getBody();if("character"===granularity){const caretPos=CaretPosition.fromRangeStart(selection.getRng()),parentBlock=dom.getParent(caretPos.container(),dom.isBlock),parentDetailsAtCaret=getParentDetailsElementAtPos(dom,caretPos),inEmptyParentBlock=parentBlock&&dom.isEmpty(parentBlock),isFirstBlock=isNull(null==parentBlock?void 0:parentBlock.previousSibling),isLastBlock=isNull(null==parentBlock?void 0:parentBlock.nextSibling);if(inEmptyParentBlock){if(forward?isLastBlock:isFirstBlock){if(navigate(!forward,root,caretPos).exists((pos=>isInDetailsElement(dom,pos)&&!equals(parentDetailsAtCaret,getParentDetailsElementAtPos(dom,pos)))))return!0}}return navigate(forward,root,caretPos).fold(never,(pos=>{const parentDetailsAtNewPos=getParentDetailsElementAtPos(dom,pos);if(isInDetailsElement(dom,pos)&&!equals(parentDetailsAtCaret,parentDetailsAtNewPos)){if(forward||moveCaretToDetailsPos(editor,pos,!1),parentBlock&&inEmptyParentBlock){if(forward&&isFirstBlock)return!0;if(!forward&&isLastBlock)return!0;moveCaretToDetailsPos(editor,pos,forward),editor.dom.remove(parentBlock)}return!0}return!1}))}return!1},shouldPreventDeleteSummaryAction=(editor,detailElements,forward,granularity)=>{const rng=editor.selection.getRng(),caretPos=CaretPosition.fromRangeStart(rng),root=editor.getBody();return"selection"===granularity?((rng,detailsElements)=>{const startInSummary=detailsElements.startSummary.exists((element=>element.contains(rng.startContainer))),endInSummary=detailsElements.startSummary.exists((element=>element.contains(rng.endContainer))),isPartiallySelectedDetailsElements=detailsElements.startDetails.forall((startDetails=>detailsElements.endDetails.forall((endDetails=>startDetails!==endDetails))));return(startInSummary||endInSummary)&&!(startInSummary&&endInSummary)||isPartiallySelectedDetailsElements})(rng,detailElements):forward?isCaretAtEndOfSummary(caretPos,detailElements)||((root,caretPos,detailsElements)=>detailsElements.startDetails.exists((details=>nextPosition(root,caretPos).forall((pos=>!details.contains(pos.container()))))))(root,caretPos,detailElements):isCaretAtStartOfSummary(caretPos,detailElements)||((caretPos,detailsElements)=>detailsElements.startDetails.exists((details=>prevPosition(details,caretPos).forall((pos=>detailsElements.startSummary.exists((summary=>!summary.contains(caretPos.container())&&summary.contains(pos.container()))))))))(caretPos,detailElements)},shouldPreventDeleteAction=(editor,forward,granularity)=>((dom,rng)=>{const startDetails=Optional.from(dom.getParent(rng.startContainer,"details")),endDetails=Optional.from(dom.getParent(rng.endContainer,"details"));if(startDetails.isSome()||endDetails.isSome()){const startSummary=startDetails.bind((details=>Optional.from(dom.select("summary",details)[0])));return Optional.some({startSummary,startDetails,endDetails})}return Optional.none()})(editor.dom,editor.selection.getRng()).fold((()=>shouldPreventDeleteIntoDetails(editor,forward,granularity)),(detailsElements=>shouldPreventDeleteSummaryAction(editor,detailsElements,forward,granularity)||shouldPreventDeleteIntoDetails(editor,forward,granularity))),handleDeleteActionSafari=(editor,forward,granularity)=>{const selection=editor.selection,node=selection.getNode(),rng=selection.getRng(),caretPos=CaretPosition.fromRangeStart(rng);return!!isSummary$1(node)&&("selection"===granularity&&isEntireNodeSelected(rng,node)||willDeleteLastPositionInElement(forward,caretPos,node)?emptyNodeContents(node):editor.undoManager.transact((()=>{const sel=selection.getSel();let{anchorNode,anchorOffset,focusNode,focusOffset}=null!=sel?sel:{};const applySelection=()=>{isNonNullable(anchorNode)&&isNonNullable(anchorOffset)&&isNonNullable(focusNode)&&isNonNullable(focusOffset)&&(null==sel||sel.setBaseAndExtent(anchorNode,anchorOffset,focusNode,focusOffset))},appendAllChildNodes=(from,to)=>{each$e(from.childNodes,(child=>{isNode(child)&&to.appendChild(child)}))},container=editor.dom.create("span",{"data-mce-bogus":"1"});appendAllChildNodes(node,container),node.appendChild(container),applySelection(),"word"!==granularity&&"line"!==granularity||null==sel||sel.modify("extend",forward?"right":"left",granularity),!selection.isCollapsed()&&isEntireNodeSelected(selection.getRng(),container)?emptyNodeContents(node):(editor.execCommand(forward?"ForwardDelete":"Delete"),anchorNode=null==sel?void 0:sel.anchorNode,anchorOffset=null==sel?void 0:sel.anchorOffset,focusNode=null==sel?void 0:sel.focusNode,focusOffset=null==sel?void 0:sel.focusOffset,appendAllChildNodes(container,node),applySelection()),editor.dom.remove(container)})),!0)},backspaceDelete=(editor,forward,granularity)=>shouldPreventDeleteAction(editor,forward,granularity)||isSafari&&handleDeleteActionSafari(editor,forward,granularity)?Optional.some(noop):Optional.none(),createAndFireInputEvent=eventType=>(editor,inputType,specifics={})=>{const target=editor.getBody(),overrides={bubbles:!0,composed:!0,data:null,isComposing:!1,detail:0,view:null,target,currentTarget:target,eventPhase:Event.AT_TARGET,originalTarget:target,explicitOriginalTarget:target,isTrusted:!1,srcElement:target,cancelable:!1,preventDefault:noop,inputType},input=clone$3(new InputEvent(eventType));return editor.dispatch(eventType,{...input,...overrides,...specifics})},fireInputEvent=createAndFireInputEvent("input"),fireBeforeInputEvent=createAndFireInputEvent("beforeinput"),platform$2=detect$2(),os=platform$2.os,isMacOSOriOS=os.isMacOS()||os.isiOS(),isFirefox=platform$2.browser.isFirefox(),setup$j=(editor,caret)=>{let isBackspaceKeydown=!1;editor.on("keydown",(evt=>{isBackspaceKeydown=evt.keyCode===VK.BACKSPACE,evt.isDefaultPrevented()||((editor,caret,evt)=>{const inputType=evt.keyCode===VK.BACKSPACE?"deleteContentBackward":"deleteContentForward",isCollapsed=editor.selection.isCollapsed(),unmodifiedGranularity=isCollapsed?"character":"selection",getModifiedGranularity=isWord=>isCollapsed?isWord?"word":"line":"selection";executeWithDelayedAction([{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,caret,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$a,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$a,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,!1,unmodifiedGranularity)},{keyCode:VK.DELETE,action:action(backspaceDelete,editor,!0,unmodifiedGranularity)},...isMacOSOriOS?[{keyCode:VK.BACKSPACE,altKey:!0,action:action(backspaceDelete,editor,!1,getModifiedGranularity(!0))},{keyCode:VK.DELETE,altKey:!0,action:action(backspaceDelete,editor,!0,getModifiedGranularity(!0))},{keyCode:VK.BACKSPACE,metaKey:!0,action:action(backspaceDelete,editor,!1,getModifiedGranularity(!1))}]:[{keyCode:VK.BACKSPACE,ctrlKey:!0,action:action(backspaceDelete,editor,!1,getModifiedGranularity(!0))},{keyCode:VK.DELETE,ctrlKey:!0,action:action(backspaceDelete,editor,!0,getModifiedGranularity(!0))}],{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$9,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,!0)}],evt).filter((_=>editor.selection.isEditable())).each((applyAction=>{evt.preventDefault(),fireBeforeInputEvent(editor,inputType).isDefaultPrevented()||(applyAction(),fireInputEvent(editor,inputType))}))})(editor,caret,evt)})),editor.on("keyup",(evt=>{evt.isDefaultPrevented()||((editor,evt,isBackspaceKeydown)=>{execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)},...isMacOSOriOS?[{keyCode:VK.BACKSPACE,altKey:!0,action:action(refreshCaret,editor)},{keyCode:VK.DELETE,altKey:!0,action:action(refreshCaret,editor)},...isBackspaceKeydown?[{keyCode:isFirefox?224:91,action:action(refreshCaret,editor)}]:[]]:[{keyCode:VK.BACKSPACE,ctrlKey:!0,action:action(refreshCaret,editor)},{keyCode:VK.DELETE,ctrlKey:!0,action:action(refreshCaret,editor)}]],evt)})(editor,evt,isBackspaceKeydown),isBackspaceKeydown=!1}))},moveToCaretPosition=(editor,root)=>{const dom=editor.dom,moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(!root)return;if(/^(LI|DT|DD)$/.test(root.nodeName)){const firstChild=(node=>{for(;node;){if(isElement$6(node)||isText$a(node)&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}return null})(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(" "),root.firstChild)}const rng=dom.createRng();if(root.normalize(),root.hasChildNodes()){const walker=new DomTreeWalker(root,root);let node,lastNode=root;for(;node=walker.current();){if(isText$a(node)){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else isBr$6(root)?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)},getEditableRoot=(dom,node)=>{const root=dom.getRoot();let editableRoot,parent=node;for(;parent!==root&&parent&&"false"!==dom.getContentEditable(parent);){if("true"===dom.getContentEditable(parent)){editableRoot=parent;break}parent=parent.parentNode}return parent!==root?editableRoot:root},getParentBlock$1=editor=>Optional.from(editor.dom.getParent(editor.selection.getStart(!0),editor.dom.isBlock)),emptyBlock=elm=>{elm.innerHTML='<br data-mce-bogus="1">'},setForcedBlockAttrs=(editor,node)=>{if(getForcedRootBlock(editor).toLowerCase()===node.tagName.toLowerCase()){((editor,node,forcedRootBlockAttrs)=>{const dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each((attrStyles=>{const newStyles={...getAllRaw(SugarElement.fromDom(node)),...attrStyles};dom.setStyles(node,newStyles)}));const attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map((attrClasses=>attrClasses.split(/\s+/))),currentClassesOpt=Optional.from(node.className).map((currentClasses=>filter$5(currentClasses.split(/\s+/),(clazz=>""!==clazz))));lift2(attrClassesOpt,currentClassesOpt,((attrClasses,currentClasses)=>{const filteredClasses=filter$5(currentClasses,(clazz=>!contains$2(attrClasses,clazz))),newClasses=[...attrClasses,...filteredClasses];dom.setAttrib(node,"class",newClasses.join(" "))}));const appliedAttrs=["style","class"],remainingAttrs=filter$4(forcedRootBlockAttrs,((_,attrs)=>!contains$2(appliedAttrs,attrs)));dom.setAttribs(node,remainingAttrs)})(editor,node,getForcedRootBlockAttrs(editor))}},createNewBlock=(editor,container,parentBlock,editableRoot,keepStyles=!0,name,styles)=>{const dom=editor.dom,schema=editor.schema,newBlockName=getForcedRootBlock(editor),parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";let node=container;const textInlineElements=schema.getTextInlineElements();let block;block=name||"TABLE"===parentBlockName||"HR"===parentBlockName?dom.create(name||newBlockName,styles||{}):parentBlock.cloneNode(!1);let caretNode=block;if(keepStyles){do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node))continue;const clonedNode=node.cloneNode(!1);dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}}while((node=node.parentNode)&&node!==editableRoot)}else dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);return setForcedBlockAttrs(editor,block),emptyBlock(caretNode),block},isLastEmptyBlockInDetails=(editor,shiftKey,element)=>!shiftKey&&element.nodeName.toLowerCase()===getForcedRootBlock(editor)&&editor.dom.isEmpty(element)&&((root,element,isTextBlock)=>{let node=element;for(;node&&node!==root&&isNull(node.nextSibling);){const parent=node.parentElement;if(!parent||!isTextBlock(parent))return isDetails(parent);node=parent}return!1})(editor.getBody(),element,(el=>has$2(editor.schema.getTextBlockElements(),el.nodeName.toLowerCase()))),insertNewLine=(editor,createNewBlock,parentBlock)=>{var _a,_b,_c;const newBlock=createNewBlock(getForcedRootBlock(editor)),root=((editor,element)=>editor.dom.getParent(element,isDetails))(editor,parentBlock);root&&(editor.dom.insertAfter(newBlock,root),moveToCaretPosition(editor,newBlock),(null!==(_c=null===(_b=null===(_a=parentBlock.parentElement)||void 0===_a?void 0:_a.childNodes)||void 0===_b?void 0:_b.length)&&void 0!==_c?_c:0)>1&&editor.dom.remove(parentBlock))},hasParent=(elm,parentName)=>{const parentNode=null==elm?void 0:elm.parentNode;return isNonNullable(parentNode)&&parentNode.nodeName===parentName},isListBlock=elm=>isNonNullable(elm)&&/^(OL|UL|LI)$/.test(elm.nodeName),isListItem=elm=>isNonNullable(elm)&&/^(LI|DT|DD)$/.test(elm.nodeName),getContainerBlock=containerBlock=>{const containerBlockParent=containerBlock.parentNode;return isListItem(containerBlockParent)?containerBlockParent:containerBlock},isFirstOrLastLi=(containerBlock,parentBlock,first)=>{let node=containerBlock[first?"firstChild":"lastChild"];for(;node&&!isElement$6(node);)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock},getStyles=elm=>foldl(mapToArray(getAllRaw(SugarElement.fromDom(elm)),((style,styleName)=>`${styleName}: ${style};`)),((acc,s)=>acc+s),""),insert$4=(editor,createNewBlock,containerBlock,parentBlock,newBlockName)=>{const dom=editor.dom,rng=editor.selection.getRng(),containerParent=containerBlock.parentNode;if(containerBlock===editor.getBody()||!containerParent)return;var elm;isListBlock(elm=containerBlock)&&isListBlock(elm.parentNode)&&(newBlockName="LI");const parentBlockStyles=isListItem(parentBlock)?getStyles(parentBlock):void 0;let newBlock=isListItem(parentBlock)&&parentBlockStyles?createNewBlock(newBlockName,{style:getStyles(parentBlock)}):createNewBlock(newBlockName);if(isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1))if(hasParent(containerBlock,"LI")){const containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent),(elm=>{var _a;return(null===(_a=elm.parentNode)||void 0===_a?void 0:_a.firstChild)===elm})(containerBlock)?dom.remove(containerBlockParent):dom.remove(containerBlock)}else dom.replace(newBlock,containerBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!0))hasParent(containerBlock,"LI")?(dom.insertAfter(newBlock,getContainerBlock(containerBlock)),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerParent.insertBefore(newBlock,containerBlock),dom.remove(parentBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!1))dom.insertAfter(newBlock,getContainerBlock(containerBlock)),dom.remove(parentBlock);else{containerBlock=getContainerBlock(containerBlock);const tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock);const fragment=tmpRng.extractContents();if("LI"===newBlockName&&((elm,name)=>elm.firstChild&&elm.firstChild.nodeName===name)(fragment,"LI")){const previousChildren=filter$5(map$3(newBlock.children,SugarElement.fromDom),not(isTag("br")));newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock),each$e(previousChildren,(child=>prepend(SugarElement.fromDom(newBlock),child))),parentBlockStyles&&newBlock.setAttribute("style",parentBlockStyles)}else dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock);dom.remove(parentBlock)}moveToCaretPosition(editor,newBlock)},isEmptyAnchor=(dom,elm)=>elm&&"A"===elm.nodeName&&dom.isEmpty(elm),containerAndSiblingName=(container,nodeName)=>container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName,canSplitBlock=(dom,node)=>isNonNullable(node)&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&dom.isEditable(node.parentNode)&&"false"!==dom.getContentEditable(node),normalizeZwspOffset=(start,container,offset)=>isText$a(container)?start?1===offset&&"\ufeff"===container.data.charAt(offset-1)?0:offset:offset===container.data.length-1&&"\ufeff"===container.data.charAt(offset)?container.data.length:offset:offset,blockbreak={insert:(editor,evt)=>{let container,offset,parentBlockName,containerBlock,isAfterLastNodeInContainer=!1;const dom=editor.dom,nonEmptyElementsMap=editor.schema.getNonEmptyElements(),rng=editor.selection.getRng(),newBlockName=getForcedRootBlock(editor),start=SugarElement.fromDom(rng.startContainer),child=child$1(start,rng.startOffset),isCef=child.exists((element=>isHTMLElement$1(element)&&!isEditable$2(element))),collapsedAndCef=rng.collapsed&&isCef,createNewBlock$1=(name,styles)=>createNewBlock(editor,container,parentBlock,editableRoot,shouldKeepStyles(editor),name,styles),isCaretAtStartOrEndOfBlock=start=>{const normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$a(container)&&(start?normalizedOffset>0:normalizedOffset<container.data.length))return!1;if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&isElement$6(container)&&container===parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;const walker=new DomTreeWalker(container,parentBlock);let node;for(isText$a(container)&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!==container.data.length||walker.next());node=walker.current();){if(isElement$6(node)){if(!node.getAttribute("data-mce-bogus")){const name=node.nodeName.toLowerCase();if(nonEmptyElementsMap[name]&&"br"!==name)return!1}}else if(isText$a(node)&&!isWhitespaceText(node.data))return!1;start?walker.prev():walker.next()}return!0},insertNewBlockAfter=()=>{let block;return block=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!==containerBlockName?createNewBlock$1(newBlockName):createNewBlock$1(),((editor,container)=>{const optionValue=shouldEndContainerOnEmptyBlock(editor);return!isNullable(container)&&(isString(optionValue)?contains$2(Tools.explode(optionValue),container.nodeName.toLowerCase()):optionValue)})(editor,containerBlock)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock,void 0,{includeZwsp:!0})?block=dom.split(containerBlock,parentBlock):dom.insertAfter(block,parentBlock),moveToCaretPosition(editor,block),block};normalize$2(dom,rng).each((normRng=>{rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)})),container=rng.startContainer,offset=rng.startOffset;const shiftKey=!(!evt||!evt.shiftKey),ctrlKey=!(!evt||!evt.ctrlKey);isElement$6(container)&&container.hasChildNodes()&&!collapsedAndCef&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$a(container)?container.data.length:0);const editableRoot=getEditableRoot(dom,container);if(!editableRoot||((editor,node)=>{const parentList=editor.dom.getParent(node,"ol,ul,dl");return null!==parentList&&"false"===editor.dom.getContentEditableParent(parentList)})(editor,container))return;shiftKey||(container=((editor,newBlockName,rng,container,offset)=>{var _a,_b;const dom=editor.dom,editableRoot=null!==(_a=getEditableRoot(dom,container))&&void 0!==_a?_a:dom.getRoot();let parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(dom,parentBlock)){if(parentBlock=parentBlock||editableRoot,!parentBlock.hasChildNodes()){const newBlock=dom.create(newBlockName);return setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock}let startNode,node=container;for(;node&&node.parentNode!==parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;const startNodeName=null===(_b=null==startNode?void 0:startNode.parentElement)||void 0===_b?void 0:_b.nodeName;if(startNode&&startNodeName&&editor.schema.isValidChild(startNodeName,newBlockName.toLowerCase())){const startNodeParent=startNode.parentNode,newBlock=dom.create(newBlockName);for(setForcedBlockAttrs(editor,newBlock),startNodeParent.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);){const next=node.nextSibling;newBlock.appendChild(node),node=next}rng.setStart(container,offset),rng.setEnd(container,offset)}}return container})(editor,newBlockName,rng,container,offset));let parentBlock=dom.getParent(container,dom.isBlock)||dom.getRoot();containerBlock=isNonNullable(null==parentBlock?void 0:parentBlock.parentNode)?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";const containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";if("LI"===containerBlockName&&!ctrlKey){parentBlock=containerBlock,containerBlock=containerBlock.parentNode,parentBlockName=containerBlockName}if(isElement$6(containerBlock)&&isLastEmptyBlockInDetails(editor,shiftKey,parentBlock))return insertNewLine(editor,createNewBlock$1,parentBlock);if(/^(LI|DT|DD)$/.test(parentBlockName)&&isElement$6(containerBlock)&&dom.isEmpty(parentBlock))return void insert$4(editor,createNewBlock$1,containerBlock,parentBlock,newBlockName);if(!(collapsedAndCef||parentBlock!==editor.getBody()&&canSplitBlock(dom,parentBlock)))return;const parentBlockParent=parentBlock.parentNode;let newBlock;if(collapsedAndCef)newBlock=createNewBlock$1(newBlockName),child.fold((()=>{append$1(start,SugarElement.fromDom(newBlock))}),(child=>{before$3(child,SugarElement.fromDom(newBlock))})),editor.selection.setCursorLocation(newBlock,0);else if(isCaretContainerBlock$1(parentBlock))newBlock=showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock);else if(isCaretAtStartOrEndOfBlock(!1))newBlock=insertNewBlockAfter();else if(isCaretAtStartOrEndOfBlock(!0)&&parentBlockParent){newBlock=parentBlockParent.insertBefore(createNewBlock$1(),parentBlock);const isNearChildren=SugarElement.fromDom(rng.startContainer).dom.hasChildNodes()&&rng.collapsed;moveToCaretPosition(editor,containerAndSiblingName(parentBlock,"HR")||isNearChildren?newBlock:parentBlock)}else{const tmpRng=(rng=>{const newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng})(rng).cloneRange();tmpRng.setEndAfter(parentBlock);const fragment=tmpRng.extractContents();(fragment=>{each$e(descendants$1(SugarElement.fromDom(fragment),isText$b),(text=>{const rawNode=text.dom;rawNode.nodeValue=trim$2(rawNode.data)}))})(fragment),(node=>{let currentNode=node;do{isText$a(currentNode)&&(currentNode.data=currentNode.data.replace(/^[\r\n]+/,"")),currentNode=currentNode.firstChild}while(currentNode)})(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),((dom,nonEmptyElementsMap,block)=>{var _a;const firstChilds=[];if(!block)return;let currentNode=block;for(;currentNode=currentNode.firstChild;){if(dom.isBlock(currentNode))return;isElement$6(currentNode)&&!nonEmptyElementsMap[currentNode.nodeName.toLowerCase()]&&firstChilds.push(currentNode)}let i=firstChilds.length;for(;i--;)currentNode=firstChilds[i],(!currentNode.hasChildNodes()||currentNode.firstChild===currentNode.lastChild&&""===(null===(_a=currentNode.firstChild)||void 0===_a?void 0:_a.nodeValue)||isEmptyAnchor(dom,currentNode))&&dom.remove(currentNode)})(dom,nonEmptyElementsMap,newBlock),((dom,block)=>{block.normalize();const lastChild=block.lastChild;(!lastChild||isElement$6(lastChild)&&/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0)))&&dom.add(block,"br")})(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):(setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock))}dom.setAttrib(newBlock,"id",""),editor.dispatch("NewBlock",{newBlock})},fakeEventName:"insertParagraph"},moveSelectionToBr=(editor,brElm,extraBr)=>{const rng=editor.dom.createRng();extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)},insertBrAtCaret=(editor,evt)=>{const selection=editor.selection,dom=editor.dom,rng=selection.getRng();let brElm,extraBr=!1;normalize$2(dom,rng).each((normRng=>{rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}));let offset=rng.startOffset,container=rng.startContainer;if(isElement$6(container)&&container.hasChildNodes()){const isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$a(container)?container.data.length:0}let parentBlock=dom.getParent(container,dom.isBlock);const containerBlock=parentBlock&&parentBlock.parentNode?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=!(!evt||!evt.ctrlKey);"LI"!==containerBlockName||isControlKey||(parentBlock=containerBlock),isText$a(container)&&offset>=container.data.length&&(((schema,container,parentBlock)=>{const walker=new DomTreeWalker(container,parentBlock);let node;const nonEmptyElementsMap=schema.getNonEmptyElements();for(;node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||isText$a(node)&&node.length>0)return!0;return!1})(editor.schema,container,parentBlock||dom.getRoot())||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rangeInsertNode(dom,rng,brElm),moveSelectionToBr(editor,brElm,extraBr),editor.undoManager.add()},insertBrBefore=(editor,inline)=>{const br=SugarElement.fromTag("br");before$3(SugarElement.fromDom(inline),br),editor.undoManager.add()},insertBrAfter=(editor,inline)=>{hasBrAfter(editor.getBody(),inline)||after$4(SugarElement.fromDom(inline),SugarElement.fromTag("br"));const br=SugarElement.fromTag("br");after$4(SugarElement.fromDom(inline),br),moveSelectionToBr(editor,br.dom,!1),editor.undoManager.add()},hasBrAfter=(rootNode,startNode)=>{return pos=CaretPosition.after(startNode),!!isBr$6(pos.getNode())||nextPosition(rootNode,CaretPosition.after(startNode)).map((pos=>isBr$6(pos.getNode()))).getOr(!1);var pos},isAnchorLink=elm=>elm&&"A"===elm.nodeName&&"href"in elm,isInsideAnchor=location=>location.fold(never,isAnchorLink,isAnchorLink,never),insertBrOutsideAnchor=(editor,location)=>{location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop)},linebreak={insert:(editor,evt)=>{const anchorLocation=(editor=>{const isInlineTarget$1=curry(isInlineTarget,editor),position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor)})(editor);anchorLocation.isSome()?anchorLocation.each(curry(insertBrOutsideAnchor,editor)):insertBrAtCaret(editor,evt)},fakeEventName:"insertLineBreak"},matchesSelector=(editor,selector)=>getParentBlock$1(editor).filter((parentBlock=>selector.length>0&&is$1(SugarElement.fromDom(parentBlock),selector))).isSome(),newLineAction=Adt_generate([{br:[]},{block:[]},{none:[]}]),shouldBlockNewLine=(editor,_shiftKey)=>(editor=>matchesSelector(editor,getNoNewLineSelector(editor)))(editor),inListBlock=requiredState=>(editor,_shiftKey)=>(editor=>getParentBlock$1(editor).filter((elm=>isListItem$1(SugarElement.fromDom(elm)))).isSome())(editor)===requiredState,inBlock=(blockName,requiredState)=>(editor,_shiftKey)=>{const state=(editor=>getParentBlock$1(editor).fold(constant(""),(parentBlock=>parentBlock.nodeName.toUpperCase())))(editor)===blockName.toUpperCase();return state===requiredState},inCefBlock=editor=>{const editableRoot=getEditableRoot(editor.dom,editor.selection.getStart());return isNullable(editableRoot)},inPreBlock=requiredState=>inBlock("pre",requiredState),shouldPutBrInPre=requiredState=>(editor,_shiftKey)=>shouldPutBrInPre$1(editor)===requiredState,inBrContext=(editor,_shiftKey)=>(editor=>matchesSelector(editor,getBrNewLineSelector(editor)))(editor),hasShiftKey=(_editor,shiftKey)=>shiftKey,canInsertIntoEditableRoot=editor=>{const forcedRootBlock=getForcedRootBlock(editor),rootEditable=getEditableRoot(editor.dom,editor.selection.getStart());return isNonNullable(rootEditable)&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock)},isInRootWithEmptyOrCEF=editor=>{const rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),isCefOpt=child$1(start,rng.startOffset).map((element=>isHTMLElement$1(element)&&!isEditable$2(element)));return rng.collapsed&&isCefOpt.getOr(!0)},match=(predicates,action)=>(editor,shiftKey)=>foldl(predicates,((res,p)=>res&&p(editor,shiftKey)),!0)?Optional.some(action):Optional.none(),insertBreak=(breakType,editor,evt)=>{if(editor.selection.isCollapsed()||(editor=>{editor.execCommand("delete")})(editor),isNonNullable(evt)){if(fireBeforeInputEvent(editor,breakType.fakeEventName).isDefaultPrevented())return}breakType.insert(editor,evt),isNonNullable(evt)&&fireInputEvent(editor,breakType.fakeEventName)},insert$1=(editor,evt)=>{const br=()=>insertBreak(linebreak,editor,evt),block=()=>insertBreak(blockbreak,editor,evt),logicalAction=((editor,evt)=>evaluateUntil([match([shouldBlockNewLine],newLineAction.none()),match([inPreBlock(!0),inCefBlock],newLineAction.none()),match([inBlock("summary",!0)],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1),hasShiftKey],newLineAction.br()),match([inPreBlock(!0),shouldPutBrInPre(!1)],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0),hasShiftKey],newLineAction.block()),match([inPreBlock(!0),shouldPutBrInPre(!0)],newLineAction.br()),match([inListBlock(!0),hasShiftKey],newLineAction.br()),match([inListBlock(!0)],newLineAction.block()),match([inBrContext],newLineAction.br()),match([hasShiftKey],newLineAction.br()),match([canInsertIntoEditableRoot],newLineAction.block()),match([isInRootWithEmptyOrCEF],newLineAction.block())],[editor,!(!evt||!evt.shiftKey)]).getOr(newLineAction.none()))(editor,evt);switch(getNewlineBehavior(editor)){case"linebreak":logicalAction.fold(br,br,noop);break;case"block":logicalAction.fold(block,block,noop);break;case"invert":logicalAction.fold(block,br,noop);break;default:logicalAction.fold(br,block,noop)}},platform$1=detect$2(),isIOSSafari=platform$1.os.isiOS()&&platform$1.browser.isSafari(),handleEnterKeyEvent=(editor,event)=>{var undoManager;event.isDefaultPrevented()||(event.preventDefault(),(undoManager=editor.undoManager).typing&&(undoManager.typing=!1,undoManager.add()),editor.undoManager.transact((()=>{insert$1(editor,event)})))},setup$i=editor=>{let iOSSafariKeydownBookmark=Optional.none();editor.on("keydown",(event=>{event.keyCode===VK.ENTER&&(isIOSSafari&&(rng=>{if(!rng.collapsed)return!1;const startContainer=rng.startContainer;if(isText$a(startContainer)){const koreanCharRegex=/^[\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uD7B0-\uD7FF]$/,char=startContainer.data.charAt(rng.startOffset-1);return koreanCharRegex.test(char)}return!1})(editor.selection.getRng())?(editor=>{iOSSafariKeydownBookmark=Optional.some(editor.selection.getBookmark()),editor.undoManager.add()})(editor):handleEnterKeyEvent(editor,event))})),editor.on("keyup",(event=>{event.keyCode===VK.ENTER&&iOSSafariKeydownBookmark.each((()=>((editor,event)=>{editor.undoManager.undo(),iOSSafariKeydownBookmark.fold(noop,(b=>editor.selection.moveToBookmark(b))),handleEnterKeyEvent(editor,event),iOSSafariKeydownBookmark=Optional.none()})(editor,event)))}))},setup$h=(editor,caret)=>{editor.on("keydown",(evt=>{evt.isDefaultPrevented()||((editor,caret,evt)=>{const isMac=Env.os.isMacOS()||Env.os.isiOS();execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,!1)},...isMac?[]:[{keyCode:VK.HOME,action:action(selectToEndPoint,editor,!1),ctrlKey:!0,shiftKey:!0},{keyCode:VK.END,action:action(selectToEndPoint,editor,!0),ctrlKey:!0,shiftKey:!0}],{keyCode:VK.END,action:action(moveToLineEndPoint,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,!0,caret)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,!1,caret)}],evt).each((_=>{evt.preventDefault()}))})(editor,caret,evt)}))},setup$g=editor=>{editor.on("input",(e=>{e.isComposing||(editor=>{const root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()&&normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng()),editor.schema).each((pos=>{editor.selection.setRng(pos.toRange())}))})(editor)}))},platform=detect$2(),stopImmediatePropagation=e=>e.stopImmediatePropagation(),isPageUpDown=evt=>evt.keyCode===VK.PAGE_UP||evt.keyCode===VK.PAGE_DOWN,setNodeChangeBlocker=(blocked,editor,block)=>{block&&!blocked.get()?editor.on("NodeChange",stopImmediatePropagation,!0):!block&&blocked.get()&&editor.off("NodeChange",stopImmediatePropagation),blocked.set(block)},setup$f=(editor,caret)=>{if(platform.os.isMacOS())return;const blocked=Cell(!1);editor.on("keydown",(evt=>{isPageUpDown(evt)&&setNodeChangeBlocker(blocked,editor,!0)})),editor.on("keyup",(evt=>{evt.isDefaultPrevented()||((editor,caret,evt)=>{execute([{keyCode:VK.PAGE_UP,action:action(moveToLineEndPoint$2,editor,!1,caret)},{keyCode:VK.PAGE_DOWN,action:action(moveToLineEndPoint$2,editor,!0,caret)}],evt)})(editor,caret,evt),isPageUpDown(evt)&&blocked.get()&&(setNodeChangeBlocker(blocked,editor,!1),editor.nodeChanged())}))},insertTextAtPosition=(text,pos)=>{const container=pos.container(),offset=pos.offset();return isText$a(container)?(container.insertData(offset,text),Optional.some(CaretPosition(container,offset+text.length))):getElementFromPosition(pos).map((elm=>{const textNode=SugarElement.fromText(text);return pos.isAtEnd()?after$4(elm,textNode):before$3(elm,textNode),CaretPosition(textNode.dom,text.length)}))},insertNbspAtPosition=curry(insertTextAtPosition," "),insertSpaceAtPosition=curry(insertTextAtPosition," "),setSelection=editor=>pos=>{editor.selection.setRng(pos.toRange()),editor.nodeChanged()},insertSpaceOrNbspAtSelection=editor=>{const pos=CaretPosition.fromRangeStart(editor.selection.getRng()),root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){const isInlineTarget$1=curry(isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind((root=>location=>location.fold((element=>prevPosition(root.dom,CaretPosition.before(element))),(element=>firstPositionIn(element)),(element=>lastPositionIn(element)),(element=>nextPosition(root.dom,CaretPosition.after(element)))))(root)).map((checkPos=>()=>((root,pos,schema)=>checkPos=>needsToHaveNbsp(root,checkPos,schema)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos))(root,pos,editor.schema)(checkPos).each(setSelection(editor))))}return Optional.none()},insertSpaceInSummaryAtSelectionOnFirefox=editor=>{return someIf(Env.browser.isFirefox()&&editor.selection.isEditable()&&(domUtils=editor.dom,node=editor.selection.getRng().startContainer,domUtils.isEditable(domUtils.getParent(node,"summary"))),(()=>{const root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()||editor.getDoc().execCommand("Delete");((root,pos,schema)=>needsToHaveNbsp(root,pos,schema)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos))(root,CaretPosition.fromRangeStart(editor.selection.getRng()),editor.schema).each(setSelection(editor))}));var domUtils,node},setup$d=editor=>{editor.on("keydown",(evt=>{evt.isDefaultPrevented()||((editor,evt)=>{executeWithDelayedAction([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)},{keyCode:VK.SPACEBAR,action:action(insertSpaceInSummaryAtSelectionOnFirefox,editor)}],evt).each((applyAction=>{evt.preventDefault(),fireBeforeInputEvent(editor,"insertText",{data:" "}).isDefaultPrevented()||(applyAction(),fireInputEvent(editor,"insertText",{data:" "}))}))})(editor,evt)}))},tableTabNavigation=editor=>hasTableTabNavigation(editor)?[{keyCode:VK.TAB,action:action(handleTab,editor,!0)},{keyCode:VK.TAB,shiftKey:!0,action:action(handleTab,editor,!1)}]:[],setup$c=editor=>{editor.on("keydown",(evt=>{evt.isDefaultPrevented()||((editor,evt)=>{execute([...tableTabNavigation(editor)],evt).each((_=>{evt.preventDefault()}))})(editor,evt)}))},setup$b=editor=>{if(editor.addShortcut("Meta+P","","mcePrint"),setup$k(editor),isRtc(editor))return Cell(null);{const caret=setupSelectedState(editor);return(editor=>{editor.on("beforeinput",(e=>{editor.selection.isEditable()&&!exists(e.getTargetRanges(),(rng=>!isEditableRange(editor.dom,rng)))||e.preventDefault()}))})(editor),(editor=>{editor.on("keyup compositionstart",curry(handleBlockContainer,editor))})(editor),setup$l(editor,caret),setup$j(editor,caret),setup$i(editor),setup$d(editor),setup$g(editor),setup$c(editor),setup$h(editor,caret),setup$f(editor,caret),caret}};class NodeChange{constructor(editor){let lastRng;this.lastPath=[],this.editor=editor;const self=this;"onselectionchange"in editor.getDoc()||editor.on("NodeChange click mouseup keyup focus",(e=>{const nativeRng=editor.selection.getRng(),fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};"nodechange"!==e.type&&isEq$4(fakeRng,lastRng)||editor.dispatch("SelectionChange"),lastRng=fakeRng})),editor.on("contextmenu",(()=>{editor.dispatch("SelectionChange")})),editor.on("SelectionChange",(()=>{const startElm=editor.selection.getStart(!0);startElm&&hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})})),editor.on("mouseup",(e=>{!e.isDefaultPrevented()&&hasAnyRanges(editor)&&("IMG"===editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,(()=>{editor.nodeChanged()})):editor.nodeChanged())}))}nodeChanged(args={}){const selection=this.editor.selection;let node;if(this.editor.initialized&&selection&&!shouldDisableNodeChange(this.editor)&&!this.editor.mode.isReadOnly()){const root=this.editor.getBody();node=selection.getStart(!0)||root,node.ownerDocument===this.editor.getDoc()&&this.editor.dom.isChildOf(node,root)||(node=root);const parents=[];this.editor.dom.getParent(node,(node=>node===root||(parents.push(node),!1))),this.editor.dispatch("NodeChange",{...args,element:node,parents})}}isSameElementPath(startElm){let i;const editor=this.editor,currentPath=reverse(editor.dom.getParents(startElm,always,editor.getBody()));if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===this.lastPath[i];i--);if(-1===i)return this.lastPath=currentPath,!0}return this.lastPath=currentPath,!1}}const imageId=generate$1("image"),eventId=generate$1("event"),mkSetEventFn=type=>transfer=>{transfer[eventId]=type},setDragstartEvent=mkSetEventFn(0),setDropEvent=mkSetEventFn(2),setDragendEvent=mkSetEventFn(1),isInDragStartEvent=(expectedType=0,transfer=>{const dt=transfer;return Optional.from(dt[eventId]).exists((type=>type===expectedType))});var expectedType;const modeId=generate$1("mode"),mkSetModeFn=mode=>transfer=>{transfer[modeId]=mode},setMode$1=(transfer,mode)=>mkSetModeFn(mode)(transfer),setReadWriteMode=mkSetModeFn(0),setReadOnlyMode=mkSetModeFn(2),setProtectedMode=mkSetModeFn(1),checkMode=expectedMode=>transfer=>{const dt=transfer;return Optional.from(dt[modeId]).exists((mode=>mode===expectedMode))},isInReadWriteMode=checkMode(0),isInProtectedMode=checkMode(1),validDropEffects=["none","copy","link","move"],validEffectAlloweds=["none","copy","copyLink","copyMove","link","linkMove","move","all","uninitialized"],createDataTransfer=()=>{const dataTransferImpl=new window.DataTransfer;let dropEffect="move",effectAllowed="all";const dataTransfer={get dropEffect(){return dropEffect},set dropEffect(effect){contains$2(validDropEffects,effect)&&(dropEffect=effect)},get effectAllowed(){return effectAllowed},set effectAllowed(allowed){isInDragStartEvent(dataTransfer)&&contains$2(validEffectAlloweds,allowed)&&(effectAllowed=allowed)},get items(){return((dataTransfer,itemsImpl)=>({...itemsImpl,get length(){return itemsImpl.length},add:(data,type)=>{if(isInReadWriteMode(dataTransfer)){if(!isString(data))return itemsImpl.add(data);if(!isUndefined(type))return itemsImpl.add(data,type)}return null},remove:idx=>{isInReadWriteMode(dataTransfer)&&itemsImpl.remove(idx)},clear:()=>{isInReadWriteMode(dataTransfer)&&itemsImpl.clear()}}))(dataTransfer,dataTransferImpl.items)},get files(){return isInProtectedMode(dataTransfer)?Object.freeze({length:0,item:_=>null}):dataTransferImpl.files},get types(){return dataTransferImpl.types},setDragImage:(image,x,y)=>{var imageData;isInReadWriteMode(dataTransfer)&&(imageData={image,x,y},dataTransfer[imageId]=imageData,dataTransferImpl.setDragImage(image,x,y))},getData:format=>isInProtectedMode(dataTransfer)?"":dataTransferImpl.getData(format),setData:(format,data)=>{isInReadWriteMode(dataTransfer)&&dataTransferImpl.setData(format,data)},clearData:format=>{isInReadWriteMode(dataTransfer)&&dataTransferImpl.clearData(format)}};return setReadWriteMode(dataTransfer),dataTransfer},cloneDataTransfer=original=>{const clone=createDataTransfer(),originalMode=(transfer=>{const dt=transfer;return Optional.from(dt[modeId])})(original);return setReadOnlyMode(original),setDragstartEvent(clone),clone.dropEffect=original.dropEffect,clone.effectAllowed=original.effectAllowed,(transfer=>{const dt=transfer;return Optional.from(dt[imageId])})(original).each((imageData=>clone.setDragImage(imageData.image,imageData.x,imageData.y))),each$e(original.types,(type=>{"Files"!==type&&clone.setData(type,original.getData(type))})),each$e(original.files,(file=>clone.items.add(file))),(transfer=>{const dt=transfer;return Optional.from(dt[eventId])})(original).each((type=>{((transfer,type)=>{mkSetEventFn(type)(transfer)})(clone,type)})),originalMode.each((mode=>{setMode$1(original,mode),setMode$1(clone,mode)})),clone},setHtmlData=(dataTransfer,html)=>dataTransfer.setData("text/html",html),internalHtmlMime=constant("x-tinymce/html"),mark=html=>"\x3c!-- x-tinymce/html --\x3e"+html,isMarked=html=>-1!==html.indexOf("\x3c!-- x-tinymce/html --\x3e"),toBlockElements=(text,rootTag,rootAttrs)=>{const blocks=text.split(/\n\n/),tagOpen=((rootTag,rootAttrs)=>{let tag="<"+rootTag;const attrs=mapToArray(rootAttrs,((value,key)=>key+'="'+Entities.encodeAllRaw(value)+'"'));return attrs.length&&(tag+=" "+attrs.join(" ")),tag+">"})(rootTag,rootAttrs),tagClose="</"+rootTag+">",paragraphs=map$3(blocks,(p=>p.split(/\n/).join("<br />")));return 1===paragraphs.length?paragraphs[0]:map$3(paragraphs,(p=>tagOpen+p+tagClose)).join("")},getEl=editor=>editor.dom.get("mcepastebin"),isPasteBin=elm=>isNonNullable(elm)&&"mcepastebin"===elm.id,isDefaultPasteBinContent=content=>"%MCEPASTEBIN%"===content,PasteBin=editor=>{const lastRng=Cell(null);return{create:()=>((editor,lastRngCell)=>{const{dom,selection}=editor,body=editor.getBody();lastRngCell.set(selection.getRng());const pasteBinElm=dom.add(editor.getBody(),"div",{id:"mcepastebin",class:"mce-pastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0"},"%MCEPASTEBIN%");Env.browser.isFirefox()&&dom.setStyle(pasteBinElm,"left","rtl"===dom.getStyle(body,"direction",!0)?65535:-65535),dom.bind(pasteBinElm,"beforedeactivate focusin focusout",(e=>{e.stopPropagation()})),pasteBinElm.focus(),selection.select(pasteBinElm,!0)})(editor,lastRng),remove:()=>((editor,lastRngCell)=>{const dom=editor.dom;if(getEl(editor)){let pasteBinClone;const lastRng=lastRngCell.get();for(;pasteBinClone=getEl(editor);)dom.remove(pasteBinClone),dom.unbind(pasteBinClone);lastRng&&editor.selection.setRng(lastRng)}lastRngCell.set(null)})(editor,lastRng),getEl:()=>getEl(editor),getHtml:()=>(editor=>{const dom=editor.dom,copyAndRemove=(toElm,fromElm)=>{toElm.appendChild(fromElm),dom.remove(fromElm,!0)},[pasteBinElm,...pasteBinClones]=filter$5(editor.getBody().childNodes,isPasteBin);each$e(pasteBinClones,(pasteBinClone=>{copyAndRemove(pasteBinElm,pasteBinClone)}));const dirtyWrappers=dom.select("div[id=mcepastebin]",pasteBinElm);for(let i=dirtyWrappers.length-1;i>=0;i--){const cleanWrapper=dom.create("div");pasteBinElm.insertBefore(cleanWrapper,dirtyWrappers[i]),copyAndRemove(cleanWrapper,dirtyWrappers[i])}return pasteBinElm?pasteBinElm.innerHTML:""})(editor),getLastRng:lastRng.get}},filter$1=(content,items)=>(Tools.each(items,(v=>{content=is$4(v,RegExp)?content.replace(v,""):content.replace(v[0],v[1])})),content),trimHtml=html=>html=filter$1(html,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/gi,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,(all,s1,s2)=>s1||s2?" ":" "],/<br class="Apple-interchange-newline">/g,/<br>$/i]),processResult=(content,cancelled)=>({content,cancelled}),filterContent=(editor,content,internal)=>{const preProcessArgs=((editor,html,internal)=>editor.dispatch("PastePreProcess",{content:html,internal}))(editor,content,internal),filteredContent=((editor,html)=>{const parser=DomParser({sanitize:shouldSanitizeXss(editor),sandbox_iframes:shouldSandboxIframes(editor)},editor.schema);parser.addNodeFilter("meta",(nodes=>{Tools.each(nodes,(node=>{node.remove()}))}));const fragment=parser.parse(html,{forced_root_block:!1,isRootContent:!0});return HtmlSerializer({validate:!0},editor.schema).serialize(fragment)})(editor,preProcessArgs.content);return editor.hasEventListeners("PastePostProcess")&&!preProcessArgs.isDefaultPrevented()?((editor,html,internal)=>{const tempBody=editor.dom.create("div",{style:"display:none"},html),postProcessArgs=((editor,node,internal)=>editor.dispatch("PastePostProcess",{node,internal}))(editor,tempBody,internal);return processResult(postProcessArgs.node.innerHTML,postProcessArgs.isDefaultPrevented())})(editor,filteredContent,internal):processResult(filteredContent,preProcessArgs.isDefaultPrevented())},pasteHtml$1=(editor,html)=>(editor.insertContent(html,{merge:shouldPasteMergeFormats(editor),paste:!0}),!0),isAbsoluteUrl=url=>/^https?:\/\/[\w\-\/+=.,!;:&%@^~(){}?#]+$/i.test(url),linkSelection=(editor,html,pasteHtmlFn)=>!(editor.selection.isCollapsed()||!isAbsoluteUrl(html))&&((editor,url,pasteHtmlFn)=>(editor.undoManager.extra((()=>{pasteHtmlFn(editor,url)}),(()=>{editor.execCommand("mceInsertLink",!1,url)})),!0))(editor,html,pasteHtmlFn),insertImage=(editor,html,pasteHtmlFn)=>!!((editor,url)=>isAbsoluteUrl(url)&&exists(getAllowedImageFileTypes(editor),(type=>endsWith(url.toLowerCase(),`.${type.toLowerCase()}`))))(editor,html)&&((editor,url,pasteHtmlFn)=>(editor.undoManager.extra((()=>{pasteHtmlFn(editor,url)}),(()=>{editor.insertContent('<img src="'+url+'">')})),!0))(editor,html,pasteHtmlFn),insertContent=(editor,html,pasteAsText)=>{pasteAsText||!isSmartPasteEnabled(editor)?pasteHtml$1(editor,html):((editor,html)=>{Tools.each([linkSelection,insertImage,pasteHtml$1],(action=>!action(editor,html,pasteHtml$1)))})(editor,html)},uniqueId=(prefix=>{let count=0;return()=>prefix+count++})("mceclip"),createPasteDataTransfer=html=>{const dataTransfer=createDataTransfer();return setHtmlData(dataTransfer,html),setReadOnlyMode(dataTransfer),dataTransfer},doPaste=(editor,content,internal,pasteAsText,shouldSimulateInputEvent)=>{const res=((editor,html,internal)=>filterContent(editor,html,internal))(editor,content,internal);if(!res.cancelled){const content=res.content,doPasteAction=()=>insertContent(editor,content,pasteAsText);if(shouldSimulateInputEvent){fireBeforeInputEvent(editor,"insertFromPaste",{dataTransfer:createPasteDataTransfer(content)}).isDefaultPrevented()||(doPasteAction(),fireInputEvent(editor,"insertFromPaste"))}else doPasteAction()}},pasteHtml=(editor,html,internalFlag,shouldSimulateInputEvent)=>{const internal=internalFlag||isMarked(html);doPaste(editor,(html=>html.replace("\x3c!-- x-tinymce/html --\x3e",""))(html),internal,!1,shouldSimulateInputEvent)},pasteText=(editor,text,shouldSimulateInputEvent)=>{const encodedText=editor.dom.encode(text).replace(/\r\n/g,"\n"),normalizedText=normalize$4(encodedText,getPasteTabSpaces(editor)),html=toBlockElements(normalizedText,getForcedRootBlock(editor),getForcedRootBlockAttrs(editor));doPaste(editor,html,!1,!0,shouldSimulateInputEvent)},getDataTransferItems=dataTransfer=>{const items={};if(dataTransfer&&dataTransfer.types)for(let i=0;i<dataTransfer.types.length;i++){const contentType=dataTransfer.types[i];try{items[contentType]=dataTransfer.getData(contentType)}catch(ex){items[contentType]=""}}return items},hasContentType=(clipboardContent,mimeType)=>mimeType in clipboardContent&&clipboardContent[mimeType].length>0,hasHtmlOrText=content=>hasContentType(content,"text/html")||hasContentType(content,"text/plain"),createBlobInfo=(editor,blobCache,file,base64)=>{const id=uniqueId(),useFileName=shouldReuseFileName(editor)&&isNonNullable(file.name),name=useFileName?((editor,str)=>{const m=str.match(/([\s\S]+?)(?:\.[a-z0-9.]+)$/i);return isNonNullable(m)?editor.dom.encode(m[1]):void 0})(editor,file.name):id,filename=useFileName?file.name:void 0,blobInfo=blobCache.create(id,file,base64,name,filename);return blobCache.add(blobInfo),blobInfo},isImage=editor=>{const allowedExtensions=getAllowedImageFileTypes(editor);return file=>startsWith(file.type,"image/")&&exists(allowedExtensions,(extension=>(ext=>{const lowerExt=ext.toLowerCase(),mimeOverrides={jpg:"jpeg",jpe:"jpeg",jfi:"jpeg",jif:"jpeg",jfif:"jpeg",pjpeg:"jpeg",pjp:"jpeg",svg:"svg+xml"};return Tools.hasOwn(mimeOverrides,lowerExt)?"image/"+mimeOverrides[lowerExt]:"image/"+lowerExt})(extension)===file.type))},pasteImageData=(editor,e,rng)=>{const dataTransfer="paste"===e.type?e.clipboardData:e.dataTransfer;var items;if(shouldPasteDataImages(editor)&&dataTransfer){const images=((editor,dataTransfer)=>{const items=dataTransfer.items?bind$3(from(dataTransfer.items),(item=>"file"===item.kind?[item.getAsFile()]:[])):[],files=dataTransfer.files?from(dataTransfer.files):[];return filter$5(items.length>0?items:files,isImage(editor))})(editor,dataTransfer);if(images.length>0)return e.preventDefault(),(items=images,Promise.all(map$3(items,(file=>blobToDataUri(file).then((uri=>({file,uri}))))))).then((fileResults=>{rng&&editor.selection.setRng(rng),each$e(fileResults,(result=>{((editor,imageItem)=>{parseDataUri(imageItem.uri).each((({data,type,base64Encoded})=>{const base64=base64Encoded?data:btoa(data),file=imageItem.file,blobCache=editor.editorUpload.blobCache,existingBlobInfo=blobCache.getByData(base64,type),blobInfo=null!=existingBlobInfo?existingBlobInfo:createBlobInfo(editor,blobCache,file,base64);pasteHtml(editor,`<img src="${blobInfo.blobUri()}">`,!1,!0)}))})(editor,result)}))})),!0}return!1},insertClipboardContent=(editor,clipboardContent,html,plainTextMode,shouldSimulateInputEvent)=>{let content=trimHtml(html);const isInternal=hasContentType(clipboardContent,internalHtmlMime())||isMarked(html),isPlainTextHtml=!isInternal&&(text=>!/<(?:\/?(?!(?:div|p|br|span)>)\w+|(?:(?!(?:span style="white-space:\s?pre;?">)|br\s?\/>))\w+\s[^>]+)>/i.test(text))(content),isAbsoluteUrl$1=isAbsoluteUrl(content);(isDefaultPasteBinContent(content)||!content.length||isPlainTextHtml&&!isAbsoluteUrl$1)&&(plainTextMode=!0),(plainTextMode||isAbsoluteUrl$1)&&(content=hasContentType(clipboardContent,"text/plain")&&isPlainTextHtml?clipboardContent["text/plain"]:(html=>{const schema=Schema(),domParser=DomParser({},schema);let text="";const voidElements=schema.getVoidElements(),ignoreElements=Tools.makeMap("script noscript style textarea video audio iframe object"," "),blockElements=schema.getBlockElements(),walk=node=>{const name=node.name,currentNode=node;if("br"!==name){if("wbr"!==name)if(voidElements[name]&&(text+=" "),ignoreElements[name])text+=" ";else{if(3===node.type&&(text+=node.value),!(node.name in schema.getVoidElements())){let currentNode=node.firstChild;if(currentNode)do{walk(currentNode)}while(currentNode=currentNode.next)}blockElements[name]&&currentNode.next&&(text+="\n","p"===name&&(text+="\n"))}}else text+="\n"};return html=filter$1(html,[/<!\[[^\]]+\]>/g]),walk(domParser.parse(html)),text})(content)),isDefaultPasteBinContent(content)||(plainTextMode?pasteText(editor,content,shouldSimulateInputEvent):pasteHtml(editor,content,isInternal,shouldSimulateInputEvent))},registerEventHandlers=(editor,pasteBin,pasteFormat)=>{let keyboardPastePlainTextState;editor.on("keydown",(e=>{(e=>VK.metaKeyPressed(e)&&86===e.keyCode||e.shiftKey&&45===e.keyCode)(e)&&!e.isDefaultPrevented()&&(keyboardPastePlainTextState=e.shiftKey&&86===e.keyCode)})),editor.on("paste",(e=>{if(e.isDefaultPrevented()||(e=>{var _a,_b;return Env.os.isAndroid()&&0===(null===(_b=null===(_a=e.clipboardData)||void 0===_a?void 0:_a.items)||void 0===_b?void 0:_b.length)})(e))return;const plainTextMode="text"===pasteFormat.get()||keyboardPastePlainTextState;keyboardPastePlainTextState=!1;const clipboardContent=getDataTransferItems(e.clipboardData);!hasHtmlOrText(clipboardContent)&&pasteImageData(editor,e,pasteBin.getLastRng()||editor.selection.getRng())||(hasContentType(clipboardContent,"text/html")?(e.preventDefault(),insertClipboardContent(editor,clipboardContent,clipboardContent["text/html"],plainTextMode,!0)):hasContentType(clipboardContent,"text/plain")&&hasContentType(clipboardContent,"text/uri-list")?(e.preventDefault(),insertClipboardContent(editor,clipboardContent,clipboardContent["text/plain"],plainTextMode,!0)):(pasteBin.create(),Delay.setEditorTimeout(editor,(()=>{const html=pasteBin.getHtml();pasteBin.remove(),insertClipboardContent(editor,clipboardContent,html,plainTextMode,!1)}),0)))}))},registerEventsAndFilters=(editor,pasteBin,pasteFormat)=>{registerEventHandlers(editor,pasteBin,pasteFormat),(editor=>{const isWebKitFakeUrl=src=>startsWith(src,"webkit-fake-url"),isDataUri=src=>startsWith(src,"data:");editor.parser.addNodeFilter("img",((nodes,name,args)=>{if(!shouldPasteDataImages(editor)&&(args=>{var _a;return!0===(null===(_a=args.data)||void 0===_a?void 0:_a.paste)})(args))for(const node of nodes){const src=node.attr("src");isString(src)&&!node.attr("data-mce-object")&&src!==Env.transparentSrc&&(isWebKitFakeUrl(src)||!shouldAllowHtmlDataUrls(editor)&&isDataUri(src))&&node.remove()}}))})(editor)},register$1=(editor,pasteFormat)=>{editor.addCommand("mceTogglePlainTextPaste",(()=>{((editor,pasteFormat)=>{"text"===pasteFormat.get()?(pasteFormat.set("html"),firePastePlainTextToggle(editor,!1)):(pasteFormat.set("text"),firePastePlainTextToggle(editor,!0)),editor.focus()})(editor,pasteFormat)})),editor.addCommand("mceInsertClipboardContent",((ui,value)=>{value.html&&pasteHtml(editor,value.html,value.internal,!1),value.text&&pasteText(editor,value.text,!1)}))},setClipboardData=(evt,data,fallback,done)=>{((clipboardData,html,text)=>{if(!clipboardData)return!1;try{return clipboardData.clearData(),clipboardData.setData("text/html",html),clipboardData.setData("text/plain",text),clipboardData.setData(internalHtmlMime(),html),!0}catch(e){return!1}})(evt.clipboardData,data.html,data.text)?(evt.preventDefault(),done()):fallback(data.html,done)},fallback=editor=>(html,done)=>{const{dom,selection}=editor,outer=dom.create("div",{contenteditable:"false","data-mce-bogus":"all"}),inner=dom.create("div",{contenteditable:"true"},html);dom.setStyles(outer,{position:"fixed",top:"0",left:"-3000px",width:"1000px",overflow:"hidden"}),outer.appendChild(inner),dom.add(editor.getBody(),outer);const range=selection.getRng();inner.focus();const offscreenRange=dom.createRng();offscreenRange.selectNodeContents(inner),selection.setRng(offscreenRange),Delay.setEditorTimeout(editor,(()=>{selection.setRng(range),dom.remove(outer),done()}),0)},getData=editor=>({html:mark(editor.selection.getContent({contextual:!0})),text:editor.selection.getContent({format:"text"})}),hasSelectedContent=editor=>!editor.selection.isCollapsed()||(editor=>!!editor.dom.getParent(editor.selection.getStart(),"td[data-mce-selected],th[data-mce-selected]",editor.getBody()))(editor),register=editor=>{editor.on("cut",(editor=>evt=>{!evt.isDefaultPrevented()&&hasSelectedContent(editor)&&editor.selection.isEditable()&&setClipboardData(evt,getData(editor),fallback(editor),(()=>{if(Env.browser.isChromium()||Env.browser.isFirefox()){const rng=editor.selection.getRng();Delay.setEditorTimeout(editor,(()=>{editor.selection.setRng(rng),editor.execCommand("Delete")}),0)}else editor.execCommand("Delete")}))})(editor)),editor.on("copy",(editor=>evt=>{!evt.isDefaultPrevented()&&hasSelectedContent(editor)&&setClipboardData(evt,getData(editor),fallback(editor),noop)})(editor))},getCaretRangeFromEvent=(editor,e)=>{var _a,_b;return RangeUtils.getCaretRangeFromPoint(null!==(_a=e.clientX)&&void 0!==_a?_a:0,null!==(_b=e.clientY)&&void 0!==_b?_b:0,editor.getDoc())},setFocusedRange=(editor,rng)=>{editor.focus(),rng&&editor.selection.setRng(rng)},setup$a=(editor,draggingInternallyState)=>{shouldPasteBlockDrop(editor)&&editor.on("dragend dragover draggesture dragdrop drop drag",(e=>{e.preventDefault(),e.stopPropagation()})),shouldPasteDataImages(editor)||editor.on("drop",(e=>{const dataTransfer=e.dataTransfer;dataTransfer&&(dataTransfer=>exists(dataTransfer.files,(file=>/^image\//.test(file.type))))(dataTransfer)&&e.preventDefault()})),editor.on("drop",(e=>{if(e.isDefaultPrevented())return;const rng=getCaretRangeFromEvent(editor,e);if(isNullable(rng))return;const dropContent=getDataTransferItems(e.dataTransfer),internal=hasContentType(dropContent,internalHtmlMime());if((!hasHtmlOrText(dropContent)||(content=>{const plainTextContent=content["text/plain"];return!!plainTextContent&&0===plainTextContent.indexOf("file://")})(dropContent))&&pasteImageData(editor,e,rng))return;const internalContent=dropContent[internalHtmlMime()],content=internalContent||dropContent["text/html"]||dropContent["text/plain"],needsInternalDrop=((dom,schema,target,dropContent)=>{const parentTransparent=dom.getParent(target,(node=>isTransparentBlock(schema,node)));if(!isNull(dom.getParent(target,"summary")))return!0;if(parentTransparent&&has$2(dropContent,"text/html")){const fragment=(new DOMParser).parseFromString(dropContent["text/html"],"text/html").body;return!isNull(fragment.querySelector(parentTransparent.nodeName.toLowerCase()))}return!1})(editor.dom,editor.schema,rng.startContainer,dropContent),isInternalDrop=draggingInternallyState.get();isInternalDrop&&!needsInternalDrop||content&&(e.preventDefault(),Delay.setEditorTimeout(editor,(()=>{editor.undoManager.transact((()=>{(internalContent||isInternalDrop&&needsInternalDrop)&&editor.execCommand("Delete"),setFocusedRange(editor,rng);const trimmedContent=trimHtml(content);dropContent["text/html"]?pasteHtml(editor,trimmedContent,internal,!0):pasteText(editor,trimmedContent,!0)}))})))})),editor.on("dragstart",(_e=>{draggingInternallyState.set(!0)})),editor.on("dragover dragend",(e=>{shouldPasteDataImages(editor)&&!draggingInternallyState.get()&&(e.preventDefault(),setFocusedRange(editor,getCaretRangeFromEvent(editor,e))),"dragend"===e.type&&draggingInternallyState.set(!1)})),(editor=>{editor.on("input",(e=>{const hasNoSummary=el=>isNull(el.querySelector("summary"));if("deleteByDrag"===e.inputType){const brokenDetailElements=filter$5(editor.dom.select("details"),hasNoSummary);each$e(brokenDetailElements,(details=>{isBr$6(details.firstChild)&&details.firstChild.remove();const summary=editor.dom.create("summary");summary.appendChild(createPaddingBr().dom),details.prepend(summary)}))}}))})(editor)},rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,rgbToHex=value=>Tools.trim(value).replace(rgbRegExp,rgbaToHexString).toLowerCase(),removeWebKitStyles=(editor,content,internal)=>{const webKitStylesOption=getPasteWebkitStyles(editor);if(internal||"all"===webKitStylesOption||!shouldPasteRemoveWebKitStyles(editor))return content;const webKitStyles=webKitStylesOption?webKitStylesOption.split(/[, ]/):[];if(webKitStyles&&"none"!==webKitStylesOption){const dom=editor.dom,node=editor.selection.getNode();content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,((all,before,value,after)=>{const inputStyles=dom.parseStyle(dom.decode(value)),outputStyles={};for(let i=0;i<webKitStyles.length;i++){const inputValue=inputStyles[webKitStyles[i]];let compareInput=inputValue,currentValue=dom.getStyle(node,webKitStyles[i],!0);/color/.test(webKitStyles[i])&&(compareInput=rgbToHex(compareInput),currentValue=rgbToHex(currentValue)),currentValue!==compareInput&&(outputStyles[webKitStyles[i]]=inputValue)}const outputStyle=dom.serializeStyle(outputStyles,"span");return outputStyle?before+' style="'+outputStyle+'"'+after:before+after}))}else content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3");return content=content.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,((all,before,value,after)=>before+' style="'+value+'"'+after)),content},setup$7=editor=>{const draggingInternallyState=Cell(!1),pasteFormat=Cell(isPasteAsTextEnabled(editor)?"text":"html"),pasteBin=PasteBin(editor);(editor=>{(Env.browser.isChromium()||Env.browser.isSafari())&&((editor,filterFunc)=>{editor.on("PastePreProcess",(e=>{e.content=filterFunc(editor,e.content,e.internal)}))})(editor,removeWebKitStyles)})(editor),register$1(editor,pasteFormat),(editor=>{const processEvent=f=>e=>{f(editor,e)},preProcess=getPastePreProcess(editor);isFunction(preProcess)&&editor.on("PastePreProcess",processEvent(preProcess));const postProcess=getPastePostProcess(editor);isFunction(postProcess)&&editor.on("PastePostProcess",processEvent(postProcess))})(editor),editor.on("PreInit",(()=>{register(editor),setup$a(editor,draggingInternallyState),registerEventsAndFilters(editor,pasteBin,pasteFormat)}))},setup$6=editor=>{(editor=>{editor.on("click",(e=>{editor.dom.getParent(e.target,"details")&&e.preventDefault()}))})(editor),(editor=>{editor.parser.addNodeFilter("details",(elms=>{const initialStateOption=getDetailsInitialState(editor);each$e(elms,(details=>{"expanded"===initialStateOption?details.attr("open","open"):"collapsed"===initialStateOption&&details.attr("open",null)}))})),editor.serializer.addNodeFilter("details",(elms=>{const serializedStateOption=getDetailsSerializedState(editor);each$e(elms,(details=>{"expanded"===serializedStateOption?details.attr("open","open"):"collapsed"===serializedStateOption&&details.attr("open",null)}))}))})(editor)},isBr=isBr$6,isText=isText$a,isContentEditableFalse$2=elm=>isContentEditableFalse$b(elm.dom),isRoot=rootNode=>elm=>eq(SugarElement.fromDom(rootNode),elm),getClosestScope=(node,rootNode,schema)=>closest$4(SugarElement.fromDom(node),(elm=>(elm=>isContentEditableTrue$3(elm.dom))(elm)||schema.isBlock(name(elm))),isRoot(rootNode)).getOr(SugarElement.fromDom(rootNode)).dom,getClosestCef=(node,rootNode)=>closest$4(SugarElement.fromDom(node),isContentEditableFalse$2,isRoot(rootNode)),findEdgeCaretCandidate=(startNode,scope,forward)=>{const walker=new DomTreeWalker(startNode,scope),next=forward?walker.next.bind(walker):walker.prev.bind(walker);let result=startNode;for(let current=forward?startNode:next();current&&!isBr(current);current=next())isCaretCandidate$3(current)&&(result=current);return result},onTripleClickSelect=editor=>{const rng=((startRng,rootNode,schema)=>{const clickNode=CaretPosition.fromRangeStart(startRng).getNode(),scope=getClosestScope(clickNode,rootNode,schema),startNode=findEdgeCaretCandidate(clickNode,scope,!1),endNode=findEdgeCaretCandidate(clickNode,scope,!0),rng=document.createRange();return getClosestCef(startNode,scope).fold((()=>{isText(startNode)?rng.setStart(startNode,0):rng.setStartBefore(startNode)}),(cef=>rng.setStartBefore(cef.dom))),getClosestCef(endNode,scope).fold((()=>{isText(endNode)?rng.setEnd(endNode,endNode.data.length):rng.setEndAfter(endNode)}),(cef=>rng.setEndAfter(cef.dom))),rng})(editor.selection.getRng(),editor.getBody(),editor.schema);editor.selection.setRng(normalize(rng))};var FakeCaretPosition;!function(FakeCaretPosition){FakeCaretPosition.Before="before",FakeCaretPosition.After="after"}(FakeCaretPosition||(FakeCaretPosition={}));const distanceToRectLeft=(clientRect,clientX)=>Math.abs(clientRect.left-clientX),distanceToRectRight=(clientRect,clientX)=>Math.abs(clientRect.right-clientX),isOverlapping=(r1,r2)=>{const overlap=((r1,r2)=>Math.max(0,Math.min(r1.bottom,r2.bottom)-Math.max(r1.top,r2.top)))(r1,r2)/Math.min(r1.height,r2.height);return((r1,r2)=>r1.top<r2.bottom&&r1.bottom>r2.top)(r1,r2)&&overlap>.5},splitRectsPerAxis=(rects,y)=>(rects=>foldl(rects,((acc,rect)=>acc.fold((()=>Optional.some(rect)),(prevRect=>{const left=Math.min(rect.left,prevRect.left),top=Math.min(rect.top,prevRect.top),right=Math.max(rect.right,prevRect.right),bottom=Math.max(rect.bottom,prevRect.bottom);return Optional.some({top,right,bottom,left,width:right-left,height:bottom-top})}))),Optional.none()))(filter$5(rects,(rect=>{return(clientY=y)>=(clientRect=rect).top&&clientY<=clientRect.bottom;var clientY,clientRect}))).fold((()=>[[],rects]),(boundingRect=>{const{pass:horizontal,fail:vertical}=partition$2(rects,(rect=>isOverlapping(rect,boundingRect)));return[horizontal,vertical]})),horizontalDistance=(rect,x,_y)=>x>rect.left&&x<rect.right?0:Math.min(Math.abs(rect.left-x),Math.abs(rect.right-x)),closestChildCaretCandidateNodeRect=(children,clientX,clientY,findCloserTextNode)=>{const caretCandidateRect=rect=>isCaretCandidate$3(rect.node)?Optional.some(rect):isElement$6(rect.node)?closestChildCaretCandidateNodeRect(from(rect.node.childNodes),clientX,clientY,!1):Optional.none(),findClosestCaretCandidateNodeRect=(rects,distance)=>{const sortedRects=sort(rects,((r1,r2)=>distance(r1,clientX,clientY)-distance(r2,clientX,clientY)));return findMap(sortedRects,caretCandidateRect).map((closest=>findCloserTextNode&&!isText$a(closest.node)&&sortedRects.length>1?((closest,sndClosest,distance)=>caretCandidateRect(sndClosest).filter((rect=>Math.abs(distance(closest,clientX,clientY)-distance(rect,clientX,clientY))<2&&isText$a(rect.node))))(closest,sortedRects[1],distance).getOr(closest):closest))},[horizontalRects,verticalRects]=splitRectsPerAxis(getClientRects(children),clientY),{pass:above,fail:below}=partition$2(verticalRects,(rect=>rect.top<clientY));return findClosestCaretCandidateNodeRect(horizontalRects,horizontalDistance).orThunk((()=>findClosestCaretCandidateNodeRect(below,distanceToRectEdgeFromXY))).orThunk((()=>findClosestCaretCandidateNodeRect(above,distanceToRectEdgeFromXY)))},closestCaretCandidateNodeRect=(root,clientX,clientY)=>{const rootElm=SugarElement.fromDom(root),ownerDoc=documentOrOwner(rootElm),element=SugarElement.fromPoint(ownerDoc,clientX,clientY).filter((elm=>contains(rootElm,elm))).getOr(rootElm);return((rootElm,scope,clientX,clientY)=>{const helper=(scope,prevScope)=>{const childNodesWithoutGhost=filter$5(scope.dom.childNodes,not((node=>isElement$6(node)&&node.classList.contains("mce-drag-container"))));return prevScope.fold((()=>closestChildCaretCandidateNodeRect(childNodesWithoutGhost,clientX,clientY,!0)),(prevScope=>{const uncheckedChildren=filter$5(childNodesWithoutGhost,(node=>node!==prevScope.dom));return closestChildCaretCandidateNodeRect(uncheckedChildren,clientX,clientY,!0)})).orThunk((()=>(eq(scope,rootElm)?Optional.none():parentElement(scope)).bind((newScope=>helper(newScope,Optional.some(scope))))))};return helper(scope,Optional.none())})(rootElm,element,clientX,clientY)},closestFakeCaretCandidate=(root,clientX,clientY)=>closestCaretCandidateNodeRect(root,clientX,clientY).filter((rect=>isFakeCaretTarget(rect.node))).map((rect=>((rect,clientX)=>({node:rect.node,position:distanceToRectLeft(rect,clientX)<distanceToRectRight(rect,clientX)?FakeCaretPosition.Before:FakeCaretPosition.After}))(rect,clientX))),getAbsolutePosition=elm=>{var _a,_b;const clientRect=elm.getBoundingClientRect(),doc=elm.ownerDocument,docElem=doc.documentElement,win=doc.defaultView;return{top:clientRect.top+(null!==(_a=null==win?void 0:win.scrollY)&&void 0!==_a?_a:0)-docElem.clientTop,left:clientRect.left+(null!==(_b=null==win?void 0:win.scrollX)&&void 0!==_b?_b:0)-docElem.clientLeft}},calc=(editor,event)=>{return bodyPosition=(editor=>editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0})(editor),scrollPosition=(editor=>{const body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}})(editor),mousePosition=((editor,event)=>{if(event.target.ownerDocument!==editor.getDoc()){const iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=(editor=>{const body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll})(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}return{left:event.pageX,top:event.pageY}})(editor,event),{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top};var bodyPosition,scrollPosition,mousePosition},getTargetProps=target=>({target,srcElement:target}),makeDragEvent=(type,target,dataTransfer,mouseEvent)=>{const dataTransferForDispatch=((dataTransfer,eventType)=>{const copy=cloneDataTransfer(dataTransfer);return"dragstart"===eventType?(setDragstartEvent(copy),setReadWriteMode(copy)):"drop"===eventType?(setDropEvent(copy),setReadOnlyMode(copy)):(setDragendEvent(copy),setProtectedMode(copy)),copy})(dataTransfer,type);return isUndefined(mouseEvent)?((type,target,dataTransfer)=>{const fail=die("Function not supported on simulated event.");return{bubbles:!0,cancelBubble:!1,cancelable:!0,composed:!1,currentTarget:null,defaultPrevented:!1,eventPhase:0,isTrusted:!0,returnValue:!1,timeStamp:0,type,composedPath:fail,initEvent:fail,preventDefault:noop,stopImmediatePropagation:noop,stopPropagation:noop,AT_TARGET:window.Event.AT_TARGET,BUBBLING_PHASE:window.Event.BUBBLING_PHASE,CAPTURING_PHASE:window.Event.CAPTURING_PHASE,NONE:window.Event.NONE,altKey:!1,button:0,buttons:0,clientX:0,clientY:0,ctrlKey:!1,metaKey:!1,movementX:0,movementY:0,offsetX:0,offsetY:0,pageX:0,pageY:0,relatedTarget:null,screenX:0,screenY:0,shiftKey:!1,x:0,y:0,detail:0,view:null,which:0,initUIEvent:fail,initMouseEvent:fail,getModifierState:fail,dataTransfer,...getTargetProps(target)}})(type,target,dataTransferForDispatch):((type,mouseEvent,target,dataTransfer)=>({...mouseEvent,dataTransfer,type,...getTargetProps(target)}))(type,mouseEvent,target,dataTransferForDispatch)},isContentEditableFalse$1=isContentEditableFalse$b,isContentEditable=((...args)=>x=>{for(let i=0;i<args.length;i++)if(args[i](x))return!0;return!1})(isContentEditableFalse$1,isContentEditableTrue$3),createGhost=(editor,elm,width,height)=>{const dom=editor.dom,clonedElm=elm.cloneNode(!0);dom.setStyles(clonedElm,{width,height}),dom.setAttrib(clonedElm,"data-mce-selected",null);const ghostElm=dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width,height}),dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm},scrollEditor=(direction,amount)=>win=>()=>{const current="left"===direction?win.scrollX:win.scrollY;win.scroll({[direction]:current+amount,behavior:"smooth"})},scrollLeft=scrollEditor("left",-32),scrollRight=scrollEditor("left",32),scrollUp=scrollEditor("top",-32),scrollDown=scrollEditor("top",32),removeElement=elm=>{elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},start=(state,editor)=>e=>{if((e=>0===e.button)(e)){const ceElm=find$2(editor.dom.getParents(e.target),isContentEditable).getOr(null);if(isNonNullable(ceElm)&&((dom,rootElm,elm)=>isContentEditableFalse$1(elm)&&elm!==rootElm&&dom.isEditable(elm.parentElement))(editor.dom,editor.getBody(),ceElm)){const elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.set({element:ceElm,dataTransfer:createDataTransfer(),dragging:!1,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight),intervalId:repeatable(100)})}}},dispatchDragEvent=(editor,type,target,dataTransfer,mouseEvent)=>{"dragstart"===type&&setHtmlData(dataTransfer,editor.dom.getOuterHTML(target));const event=makeDragEvent(type,target,dataTransfer,mouseEvent);return editor.dispatch(type,event)},move=(state,editor)=>{const throttledPlaceCaretAt=first$1(((clientX,clientY)=>((editor,clientX,clientY)=>{editor._selectionOverrides.hideFakeCaret(),closestFakeCaretCandidate(editor.getBody(),clientX,clientY).fold((()=>editor.selection.placeCaretAt(clientX,clientY)),(caretInfo=>{const range=editor._selectionOverrides.showCaret(1,caretInfo.node,caretInfo.position===FakeCaretPosition.Before,!1);range?editor.selection.setRng(range):editor.selection.placeCaretAt(clientX,clientY)}))})(editor,clientX,clientY)),0);editor.on("remove",throttledPlaceCaretAt.cancel);const state_=state;return e=>state.on((state=>{const movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){const args=dispatchDragEvent(editor,"dragstart",state.element,state.dataTransfer,e);if(isNonNullable(args.dataTransfer)&&(state.dataTransfer=args.dataTransfer),args.isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){const mouseEventOriginatedFromWithinTheEditor=e.currentTarget===editor.getDoc().documentElement,targetPos=((state,position)=>({pageX:position.pageX-state.relX,pageY:position.pageY+5}))(state,calc(editor,e));ghostElm=state.ghost,bodyElm=editor.getBody(),ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm),((ghostElm,position,width,height,maxX,maxY,mouseY,mouseX,contentAreaContainer,win,state,mouseEventOriginatedFromWithinTheEditor)=>{let overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px";const clientHeight=contentAreaContainer.clientHeight,clientWidth=contentAreaContainer.clientWidth,outerMouseY=mouseY+contentAreaContainer.getBoundingClientRect().top,outerMouseX=mouseX+contentAreaContainer.getBoundingClientRect().left;state.on((state=>{state.intervalId.clear(),state.dragging&&mouseEventOriginatedFromWithinTheEditor&&(mouseY+8>=clientHeight?state.intervalId.set(scrollDown(win)):mouseY-8<=0?state.intervalId.set(scrollUp(win)):mouseX+8>=clientWidth?state.intervalId.set(scrollRight(win)):mouseX-8<=0?state.intervalId.set(scrollLeft(win)):outerMouseY+16>=window.innerHeight?state.intervalId.set(scrollDown(window)):outerMouseY-16<=0?state.intervalId.set(scrollUp(window)):outerMouseX+16>=window.innerWidth?state.intervalId.set(scrollRight(window)):outerMouseX-16<=0&&state.intervalId.set(scrollLeft(window)))}))})(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY,e.clientY,e.clientX,editor.getContentAreaContainer(),editor.getWin(),state_,mouseEventOriginatedFromWithinTheEditor),throttledPlaceCaretAt.throttle(e.clientX,e.clientY)}var ghostElm,bodyElm}))},drop=(state,editor)=>e=>{state.on((state=>{var _a;if(state.intervalId.clear(),state.dragging){if(((editor,targetElement,dragElement)=>!isNullable(targetElement)&&targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&editor.dom.isEditable(targetElement))(editor,(selection=>{const sel=selection.getSel();if(isNonNullable(sel)){const startContainer=sel.getRangeAt(0).startContainer;return isText$a(startContainer)?startContainer.parentNode:startContainer}return null})(editor.selection),state.element)){const dropTarget=null!==(_a=editor.getDoc().elementFromPoint(e.clientX,e.clientY))&&void 0!==_a?_a:editor.getBody();dispatchDragEvent(editor,"drop",dropTarget,state.dataTransfer,e).isDefaultPrevented()||editor.undoManager.transact((()=>{((dom,elm)=>{const parentBlock=dom.getParent(elm.parentNode,dom.isBlock);removeElement(elm),parentBlock&&parentBlock!==dom.getRoot()&&dom.isEmpty(parentBlock)&&fillWithPaddingBr(SugarElement.fromDom(parentBlock))})(editor.dom,state.element),(dataTransfer=>{const html=dataTransfer.getData("text/html");return""===html?Optional.none():Optional.some(html)})(state.dataTransfer).each((content=>editor.insertContent(content))),editor._selectionOverrides.hideFakeCaret()}))}dispatchDragEvent(editor,"dragend",editor.getBody(),state.dataTransfer,e)}})),removeDragState(state)},stopDragging=(state,editor,e)=>{state.on((state=>{state.intervalId.clear(),state.dragging&&e.fold((()=>dispatchDragEvent(editor,"dragend",state.element,state.dataTransfer)),(mouseEvent=>dispatchDragEvent(editor,"dragend",state.element,state.dataTransfer,mouseEvent)))})),removeDragState(state)},removeDragState=state=>{state.on((state=>{state.intervalId.clear(),removeElement(state.ghost)})),state.clear()},bindFakeDragEvents=editor=>{const state=value$2(),pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start(state,editor),dragHandler=move(state,editor),dropHandler=drop(state,editor),dragEndHandler=((state,editor)=>e=>stopDragging(state,editor,Optional.some(e)))(state,editor);editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",(()=>{pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)})),editor.on("keydown",(e=>{e.keyCode===VK.ESC&&stopDragging(state,editor,Optional.none())}))},init$2=editor=>{bindFakeDragEvents(editor),shouldBlockUnsupportedDrop(editor)&&(editor=>{const preventFileDrop=e=>{if(!e.isDefaultPrevented()){const dataTransfer=e.dataTransfer;dataTransfer&&(contains$2(dataTransfer.types,"Files")||dataTransfer.files.length>0)&&(e.preventDefault(),"drop"===e.type&&displayError(editor,"Dropped file type is not supported"))}},preventFileDropIfUIElement=e=>{isUIElement(editor,e.target)&&preventFileDrop(e)},setup=()=>{const pageDom=DOMUtils.DOM,dom=editor.dom,doc=document,editorRoot=editor.inline?editor.getBody():editor.getDoc(),eventNames=["drop","dragover"];each$e(eventNames,(name=>{pageDom.bind(doc,name,preventFileDropIfUIElement),dom.bind(editorRoot,name,preventFileDrop)})),editor.on("remove",(()=>{each$e(eventNames,(name=>{pageDom.unbind(doc,name,preventFileDropIfUIElement),dom.unbind(editorRoot,name,preventFileDrop)}))}))};editor.on("init",(()=>{Delay.setEditorTimeout(editor,setup,0)}))})(editor)},isContentEditableFalse=isContentEditableFalse$b,getContentEditableRoot=(editor,node)=>getContentEditableRoot$1(editor.getBody(),node),SelectionOverrides=editor=>{const selection=editor.selection,dom=editor.dom,rootNode=editor.getBody(),fakeCaret=FakeCaret(editor,rootNode,dom.isBlock,(()=>hasFocus(editor))),realSelectionId="sel-"+dom.uniqueId();let selectedElement;const isFakeSelectionTargetElement=node=>node!==rootNode&&(isContentEditableFalse(node)||isMedia$2(node))&&dom.isChildOf(node,rootNode)&&dom.isEditable(node.parentNode),showCaret=(direction,node,before,scrollIntoView=!0)=>editor.dispatch("ShowCaret",{target:node,direction,before}).isDefaultPrevented()?null:(scrollIntoView&&selection.scrollIntoView(node,-1===direction),fakeCaret.show(before,node)),registerEvents=()=>{editor.on("click",(e=>{dom.isEditable(e.target)||(e.preventDefault(),editor.focus())})),editor.on("blur NewBlock",removeElementSelection),editor.on("ResizeWindow FullscreenStateChanged",fakeCaret.reposition),editor.on("tap",(e=>{const targetElm=e.target,contentEditableRoot=getContentEditableRoot(editor,targetElm);isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):isFakeSelectionTargetElement(targetElm)&&selectNode(editor,targetElm).each(setElementSelection)}),!0),editor.on("mousedown",(e=>{const targetElm=e.target;if(targetElm!==rootNode&&"HTML"!==targetElm.nodeName&&!dom.isChildOf(targetElm,rootNode))return;if(!isXYInContentArea(editor,e.clientX,e.clientY))return;removeElementSelection(),hideFakeCaret();const closestContentEditable=getContentEditableRoot(editor,targetElm);isContentEditableFalse(closestContentEditable)?(e.preventDefault(),selectNode(editor,closestContentEditable).each(setElementSelection)):closestFakeCaretCandidate(rootNode,e.clientX,e.clientY).each((caretInfo=>{e.preventDefault();(range=>{range&&selection.setRng(range)})(showCaret(1,caretInfo.node,caretInfo.position===FakeCaretPosition.Before,!1)),isHTMLElement(closestContentEditable)?closestContentEditable.focus():editor.getBody().focus()}))})),editor.on("keypress",(e=>{VK.modifierPressed(e)||isContentEditableFalse(selection.getNode())&&e.preventDefault()})),editor.on("GetSelectionRange",(e=>{let rng=e.range;if(selectedElement){if(!selectedElement.parentNode)return void(selectedElement=null);rng=rng.cloneRange(),rng.selectNode(selectedElement),e.range=rng}})),editor.on("SetSelectionRange",(e=>{e.range=normalizeVoidElementSelection(e.range);const rng=setElementSelection(e.range,e.forward);rng&&(e.range=rng)}));editor.on("AfterSetSelectionRange",(e=>{const rng=e.range,parent=rng.startContainer.parentElement;var node;isRangeInCaretContainer(rng)||isElement$6(node=parent)&&"mcepastebin"===node.id||hideFakeCaret(),(node=>isNonNullable(node)&&dom.hasClass(node,"mce-offscreen-selection"))(parent)||removeElementSelection()})),init$2(editor),(editor=>{const renderFocusCaret=first$1((()=>{if(!editor.removed&&editor.getBody().contains(document.activeElement)){const rng=editor.selection.getRng();if(rng.collapsed){const caretRange=renderRangeCaret(editor,rng,!1);editor.selection.setRng(caretRange)}}}),0);editor.on("focus",(()=>{renderFocusCaret.throttle()})),editor.on("blur",(()=>{renderFocusCaret.cancel()}))})(editor),(editor=>{editor.on("init",(()=>{editor.on("focusin",(e=>{const target=e.target;if(isMedia$2(target)){const ceRoot=getContentEditableRoot$1(editor.getBody(),target),node=isContentEditableFalse$b(ceRoot)?ceRoot:target;editor.selection.getNode()!==node&&selectNode(editor,node).each((rng=>editor.selection.setRng(rng)))}}))}))})(editor)},isWithinCaretContainer=node=>isCaretContainer$2(node)||startsWithCaretContainer$1(node)||endsWithCaretContainer$1(node),isRangeInCaretContainer=rng=>isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer),normalizeVoidElementSelection=rng=>{const voidElements=editor.schema.getVoidElements(),newRng=dom.createRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return has$2(voidElements,startContainer.nodeName.toLowerCase())?0===startOffset?newRng.setStartBefore(startContainer):newRng.setStartAfter(startContainer):newRng.setStart(startContainer,startOffset),has$2(voidElements,endContainer.nodeName.toLowerCase())?0===endOffset?newRng.setEndBefore(endContainer):newRng.setEndAfter(endContainer):newRng.setEnd(endContainer,endOffset),newRng},selectElement=elm=>{const targetClone=elm.cloneNode(!0),e=editor.dispatch("ObjectSelected",{target:elm,targetClone});if(e.isDefaultPrevented())return null;const range=((node,targetClone)=>{const body=SugarElement.fromDom(editor.getBody()),doc=editor.getDoc(),realSelectionContainer=descendant$1(body,"#"+realSelectionId).getOrThunk((()=>{const newContainer=SugarElement.fromHtml('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>',doc);return set$3(newContainer,"id",realSelectionId),append$1(body,newContainer),newContainer})),newRange=dom.createRng();empty(realSelectionContainer),append(realSelectionContainer,[SugarElement.fromText(" ",doc),SugarElement.fromDom(targetClone),SugarElement.fromText(" ",doc)]),newRange.setStart(realSelectionContainer.dom.firstChild,1),newRange.setEnd(realSelectionContainer.dom.lastChild,0),setAll(realSelectionContainer,{top:dom.getPos(node,editor.getBody()).y+"px"}),focus$1(realSelectionContainer);const sel=selection.getSel();return sel&&(sel.removeAllRanges(),sel.addRange(newRange)),newRange})(elm,e.targetClone),nodeElm=SugarElement.fromDom(elm);return each$e(descendants(SugarElement.fromDom(editor.getBody()),"*[data-mce-selected]"),(elm=>{eq(nodeElm,elm)||remove$a(elm,"data-mce-selected")})),dom.getAttrib(elm,"data-mce-selected")||elm.setAttribute("data-mce-selected","1"),selectedElement=elm,hideFakeCaret(),range},setElementSelection=(range,forward)=>{if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range)){const dir=forward?1:-1,caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range),beforeNode=caretPosition.getNode(!forward);if(isNonNullable(beforeNode)){if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!!forward&&!caretPosition.isAtEnd(),!1);if(isCaretContainerInline(beforeNode)&&isContentEditableFalse$b(beforeNode.nextSibling)){const rng=dom.createRng();return rng.setStart(beforeNode,0),rng.setEnd(beforeNode,0),rng}}const afterNode=caretPosition.getNode(forward);if(isNonNullable(afterNode)){if(isFakeCaretTarget(afterNode))return showCaret(dir,afterNode,!forward&&!caretPosition.isAtEnd(),!1);if(isCaretContainerInline(afterNode)&&isContentEditableFalse$b(afterNode.previousSibling)){const rng=dom.createRng();return rng.setStart(afterNode,1),rng.setEnd(afterNode,1),rng}}}return null}let startContainer=range.startContainer,startOffset=range.startOffset;const endOffset=range.endOffset;if(isText$a(startContainer)&&0===startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),!isElement$6(startContainer))return null;if(endOffset===startOffset+1&&startContainer===range.endContainer){const node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node))return selectElement(node)}return null},removeElementSelection=()=>{selectedElement&&selectedElement.removeAttribute("data-mce-selected"),descendant$1(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).each(remove$5),selectedElement=null},hideFakeCaret=()=>{fakeCaret.hide()};return isRtc(editor)||registerEvents(),{showCaret,showBlockCaretContainer:blockCaretContainer=>{blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),selection.scrollIntoView(blockCaretContainer))},hideFakeCaret,destroy:()=>{fakeCaret.destroy(),selectedElement=null}}},getNormalizedTextOffset=(container,offset)=>{let normalizedOffset=offset;for(let node=container.previousSibling;isText$a(node);node=node.previousSibling)normalizedOffset+=node.data.length;return normalizedOffset},generatePath=(dom,root,node,offset,normalized)=>{if(isText$a(node)&&(offset<0||offset>node.data.length))return[];const p=normalized&&isText$a(node)?[getNormalizedTextOffset(node,offset)]:[offset];let current=node;for(;current!==root&&current.parentNode;)p.push(dom.nodeIndex(current,normalized)),current=current.parentNode;return current===root?p.reverse():[]},generatePathRange=(dom,root,startNode,startOffset,endNode,endOffset,normalized=!1)=>({start:generatePath(dom,root,startNode,startOffset,normalized),end:generatePath(dom,root,endNode,endOffset,normalized)}),resolvePath=(root,path)=>{const nodePath=path.slice(),offset=nodePath.pop();if(isNumber(offset)){return foldl(nodePath,((optNode,index)=>optNode.bind((node=>Optional.from(node.childNodes[index])))),Optional.some(root)).bind((node=>isText$a(node)&&(offset<0||offset>node.data.length)?Optional.none():Optional.some({node,offset})))}return Optional.none()},resolvePathRange=(root,range)=>resolvePath(root,range.start).bind((({node:startNode,offset:startOffset})=>resolvePath(root,range.end).map((({node:endNode,offset:endOffset})=>{const rng=document.createRange();return rng.setStart(startNode,startOffset),rng.setEnd(endNode,endOffset),rng})))),cleanEmptyNodes=(dom,node,isRoot)=>{if(node&&dom.isEmpty(node)&&!isRoot(node)){const parent=node.parentNode;dom.remove(node,isText$a(node.firstChild)&&isWhitespaceText(node.firstChild.data)),cleanEmptyNodes(dom,parent,isRoot)}},deleteRng=(dom,rng,isRoot,clean=!0)=>{const startParent=rng.startContainer.parentNode,endParent=rng.endContainer.parentNode;rng.deleteContents(),clean&&!isRoot(rng.startContainer)&&(isText$a(rng.startContainer)&&0===rng.startContainer.data.length&&dom.remove(rng.startContainer),isText$a(rng.endContainer)&&0===rng.endContainer.data.length&&dom.remove(rng.endContainer),cleanEmptyNodes(dom,startParent,isRoot),startParent!==endParent&&cleanEmptyNodes(dom,endParent,isRoot))},getParentBlock=(editor,rng)=>Optional.from(editor.dom.getParent(rng.startContainer,editor.dom.isBlock)),resolveFromDynamicPatterns=(patternSet,block,beforeText)=>{const dynamicPatterns=patternSet.dynamicPatternsLookup({text:beforeText,block});return{...patternSet,blockPatterns:getBlockPatterns(dynamicPatterns).concat(patternSet.blockPatterns),inlinePatterns:getInlinePatterns(dynamicPatterns).concat(patternSet.inlinePatterns)}},getBeforeText=(dom,block,node,offset)=>{const rng=dom.createRng();return rng.setStart(block,0),rng.setEnd(node,offset),rng.toString()},stripPattern=(dom,block,pattern)=>{const firstTextNode=((node,offset,rootNode)=>{if(isText$a(node)&&offset>=node.length)return Optional.some(point(node,offset));{const textSeeker=TextSeeker(DOM$7);return Optional.from(textSeeker.forwards(node,offset,alwaysNext(node),rootNode)).map((prev=>point(prev.container,0)))}})(block,0,block);firstTextNode.each((spot=>{const node=spot.container;scanRight(node,pattern.start.length,block).each((end=>{const rng=dom.createRng();rng.setStart(node,0),rng.setEnd(end.container,end.offset),deleteRng(dom,rng,(e=>e===block))}));const text=SugarElement.fromDom(node),textContent=get$3(text);/^\s[^\s]/.test(textContent)&&((element,value)=>{api$1.set(element,value)})(text,textContent.slice(1))}))},applyPattern$1=(editor,match)=>{const dom=editor.dom,pattern=match.pattern,rng=resolvePathRange(dom.getRoot(),match.range).getOrDie("Unable to resolve path range");return getParentBlock(editor,rng).each((block=>{"block-format"===pattern.type?((name,formatter)=>{const formatSet=formatter.get(name);return isArray$1(formatSet)&&head(formatSet).exists((format=>has$2(format,"block")))})(pattern.format,editor.formatter)&&editor.undoManager.transact((()=>{stripPattern(editor.dom,block,pattern),editor.formatter.apply(pattern.format)})):"block-command"===pattern.type&&editor.undoManager.transact((()=>{stripPattern(editor.dom,block,pattern),editor.execCommand(pattern.cmd,!1,pattern.value)}))})),!0},findPattern$1=(patterns,text)=>{const sortedPatterns=(patterns=>sort(patterns,((a,b)=>b.start.length-a.start.length)))(patterns),nuText=text.replace(" "," ");return find$2(sortedPatterns,(pattern=>0===text.indexOf(pattern.start)||0===nuText.indexOf(pattern.start)))},newMarker=(dom,id)=>dom.create("span",{"data-mce-type":"bookmark",id}),rangeFromMarker=(dom,marker)=>{const rng=dom.createRng();return rng.setStartAfter(marker.start),rng.setEndBefore(marker.end),rng},createMarker=(dom,markerPrefix,pathRange)=>{const rng=resolvePathRange(dom.getRoot(),pathRange).getOrDie("Unable to resolve path range"),startNode=rng.startContainer,endNode=rng.endContainer,textEnd=0===rng.endOffset?endNode:endNode.splitText(rng.endOffset),textStart=0===rng.startOffset?startNode:startNode.splitText(rng.startOffset),startParentNode=textStart.parentNode;return{prefix:markerPrefix,end:textEnd.parentNode.insertBefore(newMarker(dom,markerPrefix+"-end"),textEnd),start:startParentNode.insertBefore(newMarker(dom,markerPrefix+"-start"),textStart)}},removeMarker=(dom,marker,isRoot)=>{cleanEmptyNodes(dom,dom.get(marker.prefix+"-end"),isRoot),cleanEmptyNodes(dom,dom.get(marker.prefix+"-start"),isRoot)},isReplacementPattern=pattern=>0===pattern.start.length,findPatternStartFromSpot=(dom,pattern,block,spot)=>{const startPattern=pattern.start;var patternContent;return repeatLeft(dom,spot.container,spot.offset,(patternContent=startPattern,(element,offset)=>{const searchText=element.data.substring(0,offset),startEndIndex=searchText.lastIndexOf(patternContent.charAt(patternContent.length-1)),startIndex=searchText.lastIndexOf(patternContent);return-1!==startIndex?startIndex+patternContent.length:-1!==startEndIndex?startEndIndex+1:-1}),block).bind((spot=>{var _a,_b;const startPatternIndex=null!==(_b=null===(_a=block.textContent)||void 0===_a?void 0:_a.indexOf(startPattern))&&void 0!==_b?_b:-1;if(-1!==startPatternIndex&&spot.offset>=startPatternIndex+startPattern.length){const rng=dom.createRng();return rng.setStart(spot.container,spot.offset-startPattern.length),rng.setEnd(spot.container,spot.offset),Optional.some(rng)}{const offset=spot.offset-startPattern.length;return scanLeft(spot.container,offset,block).map((nextSpot=>{const rng=dom.createRng();return rng.setStart(nextSpot.container,nextSpot.offset),rng.setEnd(spot.container,spot.offset),rng})).filter((rng=>rng.toString()===startPattern)).orThunk((()=>findPatternStartFromSpot(dom,pattern,block,point(spot.container,0))))}}))},findPattern=(editor,block,details,normalizedMatches)=>{const dom=editor.dom,root=dom.getRoot(),pattern=details.pattern,endNode=details.position.container,endOffset=details.position.offset;return scanLeft(endNode,endOffset-details.pattern.end.length,block).bind((spot=>{const endPathRng=generatePathRange(dom,root,spot.container,spot.offset,endNode,endOffset,normalizedMatches);if(isReplacementPattern(pattern))return Optional.some({matches:[{pattern,startRng:endPathRng,endRng:endPathRng}],position:spot});{const resultsOpt=findPatternsRec(editor,details.remainingPatterns,spot.container,spot.offset,block,normalizedMatches),results=resultsOpt.getOr({matches:[],position:spot}),pos=results.position,start=((dom,pattern,node,offset,block,requireGap=!1)=>{if(0===pattern.start.length&&!requireGap){const rng=dom.createRng();return rng.setStart(node,offset),rng.setEnd(node,offset),Optional.some(rng)}return textBefore(node,offset,block).bind((spot=>findPatternStartFromSpot(dom,pattern,block,spot).bind((startRange=>{var _a;if(requireGap){if(startRange.endContainer===spot.container&&startRange.endOffset===spot.offset)return Optional.none();if(0===spot.offset&&(null===(_a=startRange.endContainer.textContent)||void 0===_a?void 0:_a.length)===startRange.endOffset)return Optional.none()}return Optional.some(startRange)}))))})(dom,pattern,pos.container,pos.offset,block,resultsOpt.isNone());return start.map((startRng=>{const startPathRng=((dom,root,range,normalized=!1)=>generatePathRange(dom,root,range.startContainer,range.startOffset,range.endContainer,range.endOffset,normalized))(dom,root,startRng,normalizedMatches);return{matches:results.matches.concat([{pattern,startRng:startPathRng,endRng:endPathRng}]),position:point(startRng.startContainer,startRng.startOffset)}}))}}))},findPatternsRec=(editor,patterns,node,offset,block,normalizedMatches)=>{const dom=editor.dom;return textBefore(node,offset,dom.getRoot()).bind((endSpot=>{const text=getBeforeText(dom,block,node,offset);for(let i=0;i<patterns.length;i++){const pattern=patterns[i];if(!endsWith(text,pattern.end))continue;const patternsWithoutCurrent=patterns.slice();patternsWithoutCurrent.splice(i,1);const result=findPattern(editor,block,{pattern,remainingPatterns:patternsWithoutCurrent,position:endSpot},normalizedMatches);if(result.isNone()&&offset>0)return findPatternsRec(editor,patterns,node,offset-1,block,normalizedMatches);if(result.isSome())return result}return Optional.none()}))},applyPattern=(editor,pattern,patternRange)=>{editor.selection.setRng(patternRange),"inline-format"===pattern.type?each$e(pattern.format,(format=>{editor.formatter.apply(format)})):editor.execCommand(pattern.cmd,!1,pattern.value)},findPatterns=(editor,block,node,offset,patternSet,normalizedMatches)=>{var patterns;return((matches,matchesWithSortedPatterns)=>{const hasSameMatches=forall(matches,(match=>exists(matchesWithSortedPatterns,(sortedMatch=>match.pattern.start===sortedMatch.pattern.start&&match.pattern.end===sortedMatch.pattern.end))));return matches.length===matchesWithSortedPatterns.length?hasSameMatches?matches:matchesWithSortedPatterns:matches.length>matchesWithSortedPatterns.length?matches:matchesWithSortedPatterns})(findPatternsRec(editor,patternSet.inlinePatterns,node,offset,block,normalizedMatches).fold((()=>[]),(result=>result.matches)),findPatternsRec(editor,(patterns=patternSet.inlinePatterns,sort(patterns,((a,b)=>b.end.length-a.end.length))),node,offset,block,normalizedMatches).fold((()=>[]),(result=>result.matches)))},applyMatches=(editor,matches)=>{if(0===matches.length)return;const dom=editor.dom,bookmark=editor.selection.getBookmark(),matchesWithMarkers=((dom,matches)=>{const markerPrefix=generate$1("mce_textpattern"),matchesWithEnds=foldr(matches,((acc,match)=>{const endMarker=createMarker(dom,markerPrefix+`_end${acc.length}`,match.endRng);return acc.concat([{...match,endMarker}])}),[]);return foldr(matchesWithEnds,((acc,match)=>{const idx=matchesWithEnds.length-acc.length-1,startMarker=isReplacementPattern(match.pattern)?match.endMarker:createMarker(dom,markerPrefix+`_start${idx}`,match.startRng);return acc.concat([{...match,startMarker}])}),[])})(dom,matches);each$e(matchesWithMarkers,(match=>{const block=dom.getParent(match.startMarker.start,dom.isBlock),isRoot=node=>node===block;isReplacementPattern(match.pattern)?((editor,pattern,marker,isRoot)=>{const markerRange=rangeFromMarker(editor.dom,marker);deleteRng(editor.dom,markerRange,isRoot),applyPattern(editor,pattern,markerRange)})(editor,match.pattern,match.endMarker,isRoot):((editor,pattern,startMarker,endMarker,isRoot)=>{const dom=editor.dom,markerEndRange=rangeFromMarker(dom,endMarker),markerStartRange=rangeFromMarker(dom,startMarker);deleteRng(dom,markerStartRange,isRoot),deleteRng(dom,markerEndRange,isRoot);const patternMarker={prefix:startMarker.prefix,start:startMarker.end,end:endMarker.start},patternRange=rangeFromMarker(dom,patternMarker);applyPattern(editor,pattern,patternRange)})(editor,match.pattern,match.startMarker,match.endMarker,isRoot),removeMarker(dom,match.endMarker,isRoot),removeMarker(dom,match.startMarker,isRoot)})),editor.selection.moveToBookmark(bookmark)},handleEnter=(editor,patternSet)=>{const rng=editor.selection.getRng();return getParentBlock(editor,rng).map((block=>{var _a;const offset=Math.max(0,rng.startOffset),dynamicPatternSet=resolveFromDynamicPatterns(patternSet,block,null!==(_a=block.textContent)&&void 0!==_a?_a:""),inlineMatches=findPatterns(editor,block,rng.startContainer,offset,dynamicPatternSet,!0),blockMatches=((editor,block,patternSet,normalizedMatches)=>{var _a;const dom=editor.dom,forcedRootBlock=getForcedRootBlock(editor);if(!dom.is(block,forcedRootBlock))return[];const blockText=null!==(_a=block.textContent)&&void 0!==_a?_a:"";return findPattern$1(patternSet.blockPatterns,blockText).map((pattern=>Tools.trim(blockText).length===pattern.start.length?[]:[{pattern,range:generatePathRange(dom,dom.getRoot(),block,0,block,0,normalizedMatches)}])).getOr([])})(editor,block,dynamicPatternSet,!0);return(blockMatches.length>0||inlineMatches.length>0)&&(editor.undoManager.add(),editor.undoManager.extra((()=>{editor.execCommand("mceInsertNewLine")}),(()=>{(editor=>{editor.insertContent("\ufeff",{preserve_zwsp:!0})})(editor),applyMatches(editor,inlineMatches),((editor,matches)=>{if(0===matches.length)return;const bookmark=editor.selection.getBookmark();each$e(matches,(match=>applyPattern$1(editor,match))),editor.selection.moveToBookmark(bookmark)})(editor,blockMatches);const range=editor.selection.getRng(),spot=textBefore(range.startContainer,range.startOffset,editor.dom.getRoot());editor.execCommand("mceInsertNewLine"),spot.each((s=>{const node=s.container;"\ufeff"===node.data.charAt(s.offset-1)&&(node.deleteData(s.offset-1,1),cleanEmptyNodes(editor.dom,node.parentNode,(e=>e===editor.dom.getRoot())))}))})),!0)})).getOr(!1)},checkKeyEvent=(codes,event,predicate)=>{for(let i=0;i<codes.length;i++)if(predicate(codes[i],event))return!0;return!1},setup$2=editor=>{const charCodes=[",",".",";",":","!","?"],keyCodes=[32],getPatternSet=()=>{return patterns=getTextPatterns(editor),dynamicPatternsLookup=getTextPatternsLookup(editor),{inlinePatterns:getInlinePatterns(patterns),blockPatterns:getBlockPatterns(patterns),dynamicPatternsLookup};var patterns,dynamicPatternsLookup},hasDynamicPatterns=()=>(editor=>editor.options.isSet("text_patterns_lookup"))(editor);editor.on("keydown",(e=>{if(13===e.keyCode&&!VK.modifierPressed(e)&&editor.selection.isCollapsed()){const patternSet=getPatternSet();(patternSet.inlinePatterns.length>0||patternSet.blockPatterns.length>0||hasDynamicPatterns())&&handleEnter(editor,patternSet)&&e.preventDefault()}}),!0);const handleInlineTrigger=()=>{if(editor.selection.isCollapsed()){const patternSet=getPatternSet();(patternSet.inlinePatterns.length>0||hasDynamicPatterns())&&((editor,patternSet)=>{const rng=editor.selection.getRng();getParentBlock(editor,rng).map((block=>{const offset=Math.max(0,rng.startOffset-1),beforeText=getBeforeText(editor.dom,block,rng.startContainer,offset),dynamicPatternSet=resolveFromDynamicPatterns(patternSet,block,beforeText),inlineMatches=findPatterns(editor,block,rng.startContainer,offset,dynamicPatternSet,!1);inlineMatches.length>0&&editor.undoManager.transact((()=>{applyMatches(editor,inlineMatches)}))}))})(editor,patternSet)}};editor.on("keyup",(e=>{checkKeyEvent(keyCodes,e,((code,event)=>code===event.keyCode&&!VK.modifierPressed(event)))&&handleInlineTrigger()})),editor.on("keypress",(e=>{checkKeyEvent(charCodes,e,((chr,event)=>chr.charCodeAt(0)===event.charCode))&&Delay.setEditorTimeout(editor,handleInlineTrigger)}))},Quirks=editor=>{const each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser,browser=Env.browser,isGecko=browser.isFirefox(),isWebKit=browser.isChromium()||browser.isSafari(),isiOS=Env.deviceType.isiPhone()||Env.deviceType.isiPad(),isMac=Env.os.isMacOS()||Env.os.isiOS(),setEditorCommandState=(cmd,state)=>{try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}},isDefaultPrevented=e=>e.isDefaultPrevented(),emptyEditorWhenDeleting=()=>{const serializeRng=rng=>{const body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})};editor.on("keydown",(e=>{const keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)&&editor.selection.isEditable()){const isCollapsed=editor.selection.isCollapsed(),body=editor.getBody();if(isCollapsed&&!isEmpty$2(SugarElement.fromDom(body)))return;if(!isCollapsed&&!(rng=>{const selection=serializeRng(rng),allRng=dom.createRng();return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)})(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}}))},selectAll=()=>{editor.shortcuts.add("meta+a",null,"SelectAll")},documentElementEditingFocus=()=>{editor.inline||dom.bind(editor.getDoc(),"mousedown mouseup",(e=>{let rng;if(e.target===editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"===e.type){if(isCaretContainer$2(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)}))},focusBody=()=>{Range.prototype.getClientRects||editor.on("mousedown",(e=>{if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){const body=editor.getBody();body.blur(),Delay.setEditorTimeout(editor,(()=>{body.focus()}))}}))},selectControlElements=()=>{const visualAidsAnchorClass=getVisualAidsAnchorClass(editor);editor.on("click",(e=>{const target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&dom.isEditable(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"===target.nodeName&&dom.hasClass(target,visualAidsAnchorClass)&&0===target.childNodes.length&&dom.isEditable(target.parentNode)&&(e.preventDefault(),selection.select(target))}))},disableBackspaceIntoATable=()=>{editor.on("keydown",(e=>{if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng().startOffset){const previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}return!0}))},setGeckoEditingOptions=()=>{const setOpts=()=>{setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),getObjectResizing(editor)||setEditorCommandState("enableObjectResizing",!1)};isReadOnly$1(editor)||editor.on("BeforeExecCommand mousedown",setOpts)},addBrAfterLastLinks=()=>{editor.on("SetContent ExecCommand",(e=>{"setcontent"!==e.type&&"mceInsertLink"!==e.command||each(dom.select("a:not([data-mce-block])"),(node=>{var _a;let parentNode=node.parentNode;const root=dom.getRoot();if((null==parentNode?void 0:parentNode.lastChild)===node){for(;parentNode&&!dom.isBlock(parentNode);){if((null===(_a=parentNode.parentNode)||void 0===_a?void 0:_a.lastChild)!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}}))}))},showBrokenImageIcon=()=>{editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")},restoreFocusOnKeyDown=()=>{editor.inline||editor.on("keydown",(()=>{document.activeElement===document.body&&editor.getWin().focus()}))},bodyHeight=()=>{editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",(e=>{let rng;"HTML"===e.target.nodeName&&(rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged())})))},blockCmdArrowNavigation=()=>{isMac&&editor.on("keydown",(e=>{if(VK.metaKeyPressed(e)&&!e.shiftKey&&(37===e.keyCode||39===e.keyCode)){e.preventDefault();editor.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary")}}))},tapLinksAndImages=()=>{editor.on("click",(e=>{let elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)})),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")},blockFormSubmitInsideEditor=()=>{editor.on("init",(()=>{editor.dom.bind(editor.getBody(),"submit",(e=>{e.preventDefault()}))}))},refreshContentEditable=noop,setup=()=>{editor.on("keydown",(e=>{if(isDefaultPrevented(e)||e.keyCode!==VK.BACKSPACE)return;let rng=selection.getRng();const container=rng.startContainer,offset=rng.startOffset,root=dom.getRoot();let parent=container;if(rng.collapsed&&0===offset){for(;parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.nodeName&&(editor.formatter.toggle("blockquote",void 0,parent),rng=dom.createRng(),rng.setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}})),emptyEditorWhenDeleting(),Env.windowsPhone||editor.on("keyup focusin mouseup",(e=>{VK.modifierPressed(e)||(editor=>{const body=editor.getBody(),rng=editor.selection.getRng();return rng.startContainer===rng.endContainer&&rng.startContainer===body&&0===rng.startOffset&&rng.endOffset===body.childNodes.length})(editor)||selection.normalize()}),!0),isWebKit&&(documentElementEditingFocus(),selectControlElements(),editor.on("init",(()=>{setEditorCommandState("DefaultParagraphSeparator",getForcedRootBlock(editor))})),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),parser.addNodeFilter("br",(nodes=>{let i=nodes.length;for(;i--;)"Apple-interchange-newline"===nodes[i].attr("class")&&nodes[i].remove()})),isiOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),isGecko&&(editor.on("keydown",(e=>{if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng().startOffset){const node=selection.getNode(),previousSibling=node.previousSibling;if("HR"===node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})),focusBody(),(()=>{const getAttributeApplyFunction=()=>{const template=dom.getAttribs(selection.getStart().cloneNode(!1));return()=>{const target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,(attr=>{target.setAttributeNode(attr.cloneNode(!0))})))}},isSelectionAcrossElements=()=>!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock);editor.on("keypress",(e=>{let applyAttributes;return!(!(isDefaultPrevented(e)||8!==e.keyCode&&46!==e.keyCode)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1),applyAttributes(),e.preventDefault(),1))})),dom.bind(editor.getDoc(),"cut",(e=>{if(!isDefaultPrevented(e)&&isSelectionAcrossElements()){const applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,(()=>{applyAttributes()}))}}))})(),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable(),editor.on("drop",(event=>{var _a;const data=null===(_a=event.dataTransfer)||void 0===_a?void 0:_a.getData("text/html");isString(data)&&/^<img[^>]*>$/.test(data)&&editor.dispatch("dragend",new window.DragEvent("dragend",event))})))};return isRtc(editor)?(isWebKit&&(documentElementEditingFocus(),selectControlElements(),blockFormSubmitInsideEditor(),selectAll(),isiOS&&(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages())),isGecko&&(focusBody(),setGeckoEditingOptions(),showBrokenImageIcon(),blockCmdArrowNavigation())):setup(),{refreshContentEditable,isHidden:()=>{if(!isGecko||editor.removed)return!1;const sel=editor.selection.getSel();return!sel||!sel.rangeCount||0===sel.rangeCount}}},DOM$6=DOMUtils.DOM,getRootName=editor=>editor.inline?editor.getElement().nodeName.toLowerCase():void 0,removeUndefined=obj=>filter$4(obj,(v=>!1===isUndefined(v))),mkParserSettings=editor=>{const getOption=editor.options.get,blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:getOption("allow_conditional_comments"),allow_html_data_urls:getOption("allow_html_data_urls"),allow_svg_data_urls:getOption("allow_svg_data_urls"),allow_html_in_named_anchor:getOption("allow_html_in_named_anchor"),allow_script_urls:getOption("allow_script_urls"),allow_unsafe_link_target:getOption("allow_unsafe_link_target"),convert_unsafe_embeds:getOption("convert_unsafe_embeds"),convert_fonts_to_spans:getOption("convert_fonts_to_spans"),fix_list_elements:getOption("fix_list_elements"),font_size_legacy_values:getOption("font_size_legacy_values"),forced_root_block:getOption("forced_root_block"),forced_root_block_attrs:getOption("forced_root_block_attrs"),preserve_cdata:getOption("preserve_cdata"),inline_styles:getOption("inline_styles"),root_name:getRootName(editor),sandbox_iframes:getOption("sandbox_iframes"),sanitize:getOption("xss_sanitization"),validate:!0,blob_cache:blobCache,document:editor.getDoc()})},mkSchemaSettings=editor=>{const getOption=editor.options.get;return removeUndefined({custom_elements:getOption("custom_elements"),extended_valid_elements:getOption("extended_valid_elements"),invalid_elements:getOption("invalid_elements"),invalid_styles:getOption("invalid_styles"),schema:getOption("schema"),valid_children:getOption("valid_children"),valid_classes:getOption("valid_classes"),valid_elements:getOption("valid_elements"),valid_styles:getOption("valid_styles"),verify_html:getOption("verify_html"),padd_empty_block_inline_children:getOption("format_empty_lines")})},initEditor=editor=>{editor.bindPendingEventDelegates(),editor.initialized=!0,(editor=>{editor.dispatch("Init")})(editor),editor.focus(!0),(editor=>{const root=editor.dom.getRoot();editor.inline||hasAnyRanges(editor)&&editor.selection.getStart(!0)!==root||firstPositionIn(root).each((pos=>{const node=pos.getNode(),caretPos=isTable$2(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange())}))})(editor),editor.nodeChanged({initial:!0});const initInstanceCallback=getInitInstanceCallback(editor);isFunction(initInstanceCallback)&&initInstanceCallback.call(editor,editor),(editor=>{const autoFocus=getAutoFocus(editor);autoFocus&&Delay.setEditorTimeout(editor,(()=>{let focusEditor;focusEditor=!0===autoFocus?editor:editor.editorManager.get(autoFocus),focusEditor&&!focusEditor.destroyed&&(focusEditor.focus(),focusEditor.selection.scrollIntoView())}),100)})(editor)},getStyleSheetLoader$1=editor=>editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader,loadContentCss=editor=>{const styleSheetLoader=getStyleSheetLoader$1(editor),fontCss=getFontCss(editor),css=editor.contentCSS,removeCss=()=>{styleSheetLoader.unloadAll(css),editor.inline||editor.ui.styleSheetLoader.unloadAll(fontCss)},loaded=()=>{editor.removed?removeCss():editor.on("remove",removeCss)};if(editor.contentStyles.length>0){let contentCssText="";Tools.each(editor.contentStyles,(style=>{contentCssText+=style+"\r\n"})),editor.dom.addStyle(contentCssText)}const allStylesheets=Promise.all(((editor,css,framedFonts)=>{const{pass:bundledCss,fail:normalCss}=partition$2(css,(name=>tinymce.Resource.has(toContentSkinResourceName(name)))),bundledPromises=bundledCss.map((url=>{const css=tinymce.Resource.get(toContentSkinResourceName(url));return isString(css)?Promise.resolve(getStyleSheetLoader$1(editor).loadRawCss(url,css)):Promise.resolve()})),promises=[...bundledPromises,getStyleSheetLoader$1(editor).loadAll(normalCss)];return editor.inline?promises:promises.concat([editor.ui.styleSheetLoader.loadAll(framedFonts)])})(editor,css,fontCss)).then(loaded).catch(loaded),contentStyle=getContentStyle(editor);return contentStyle&&((editor,text)=>{const body=SugarElement.fromDom(editor.getBody()),container=getStyleContainer(getRootNode(body)),style=SugarElement.fromTag("style");set$3(style,"type","text/css"),append$1(style,SugarElement.fromText(text)),append$1(container,style),editor.on("remove",(()=>{remove$5(style)}))})(editor,contentStyle),allStylesheets},initEditorWithInitialContent=editor=>{!0!==editor.removed&&((editor=>{isRtc(editor)||editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"})})(editor),initEditor(editor))},contentBodyLoaded=editor=>{const targetElm=editor.getElement();let doc=editor.getDoc();editor.inline&&(DOM$6.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=document,editor.contentWindow=window,editor.bodyElement=targetElm,editor.contentAreaContainer=targetElm);const body=editor.getBody();body.disabled=!0,editor.readonly=isReadOnly$1(editor),editor._editableRoot=hasEditableRoot$1(editor),!editor.readonly&&editor.hasEditableRoot()&&(editor.inline&&"static"===DOM$6.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable="true"),body.disabled=!1,editor.editorUpload=EditorUpload(editor),editor.schema=Schema(mkSchemaSettings(editor)),editor.dom=DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:editor.inline,schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:e=>{editor.dispatch("SetAttrib",e)},force_hex_color:shouldForceHexColor(editor)}),editor.parser=(editor=>{const parser=DomParser(mkParserSettings(editor),editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",((nodes,name)=>{const dom=editor.dom,internalName="data-mce-"+name;let i=nodes.length;for(;i--;){const node=nodes[i];let value=node.attr(name);if(value&&!node.attr(internalName)){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?(value=dom.serializeStyle(dom.parseStyle(value),node.name),value.length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}}})),parser.addNodeFilter("script",(nodes=>{let i=nodes.length;for(;i--;){const node=nodes[i],type=node.attr("type")||"no/type";0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}})),shouldPreserveCData(editor)&&parser.addNodeFilter("#cdata",(nodes=>{var _a;let i=nodes.length;for(;i--;){const node=nodes[i];node.type=8,node.name="#comment",node.value="[CDATA["+editor.dom.encode(null!==(_a=node.value)&&void 0!==_a?_a:"")+"]]"}})),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",(nodes=>{let i=nodes.length;const nonEmptyElements=editor.schema.getNonEmptyElements();for(;i--;){const node=nodes[i];node.isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&node.append(new AstNode("br",1))}})),parser})(editor),editor.serializer=DomSerializer((editor=>{const getOption=editor.options.get;return{...mkParserSettings(editor),...mkSchemaSettings(editor),...removeUndefined({remove_trailing_brs:getOption("remove_trailing_brs"),pad_empty_with_br:getOption("pad_empty_with_br"),url_converter:getOption("url_converter"),url_converter_scope:getOption("url_converter_scope"),element_format:getOption("element_format"),entities:getOption("entities"),entity_encoding:getOption("entity_encoding"),indent:getOption("indent"),indent_after:getOption("indent_after"),indent_before:getOption("indent_before")})}})(editor),editor),editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor),editor.annotator=Annotator(editor),editor.formatter=Formatter(editor),editor.undoManager=UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=SelectionOverrides(editor),setup$p(editor),setup$6(editor),setup$n(editor),isRtc(editor)||((editor=>{editor.on("mousedown",(e=>{e.detail>=3&&(e.preventDefault(),onTripleClickSelect(editor))}))})(editor),(editor=>{setup$2(editor)})(editor));const caret=setup$b(editor);setup$q(editor,caret),(editor=>{editor.on("NodeChange",curry(addRootBlocks,editor))})(editor),setup$r(editor),setup$7(editor);const setupRtcThunk=setup$t(editor);(editor=>{const doc=editor.getDoc(),body=editor.getBody();(editor=>{editor.dispatch("PreInit")})(editor),shouldBrowserSpellcheck(editor)||(doc.body.spellcheck=!1,DOM$6.setAttrib(body,"spellcheck","false")),editor.quirks=Quirks(editor),(editor=>{editor.dispatch("PostRender")})(editor);const directionality=getDirectionality(editor);void 0!==directionality&&(body.dir=directionality);const protect=getProtect(editor);protect&&editor.on("BeforeSetContent",(e=>{Tools.each(protect,(pattern=>{e.content=e.content.replace(pattern,(str=>"\x3c!--mce:protected "+escape(str)+"--\x3e"))}))})),editor.on("SetContent",(()=>{editor.addVisual(editor.getBody())})),editor.on("compositionstart compositionend",(e=>{editor.composing="compositionstart"===e.type}))})(editor),setupRtcThunk.fold((()=>{const cancelProgress=(editor=>{let canceled=!1;const progressTimeout=setTimeout((()=>{canceled||editor.setProgressState(!0)}),500);return()=>{clearTimeout(progressTimeout),canceled=!0,editor.setProgressState(!1)}})(editor);loadContentCss(editor).then((()=>{initEditorWithInitialContent(editor),cancelProgress()}))}),(setupRtc=>{editor.setProgressState(!0),loadContentCss(editor).then((()=>{setupRtc().then((_rtcMode=>{editor.setProgressState(!1),initEditorWithInitialContent(editor),bindEvents(editor)}),(err=>{editor.notificationManager.open({type:"error",text:String(err)}),initEditorWithInitialContent(editor),bindEvents(editor)}))}))}))},filter=always,DOM$5=DOMUtils.DOM,createIframe=(editor,boxInfo)=>{const iframeTitle=editor.translate("Rich Text Area"),tabindex=getOpt(SugarElement.fromDom(editor.getElement()),"tabindex").bind(toInt),ifr=((id,title,customAttrs,tabindex)=>{const iframe=SugarElement.fromTag("iframe");return tabindex.each((t=>set$3(iframe,"tabindex",t))),setAll$1(iframe,customAttrs),setAll$1(iframe,{id:id+"_ifr",frameBorder:"0",allowTransparency:"true",title}),add$2(iframe,"tox-edit-area__iframe"),iframe})(editor.id,iframeTitle,getIframeAttrs(editor),tabindex).dom;ifr.onload=()=>{ifr.onload=null,editor.dispatch("load")},editor.contentAreaContainer=boxInfo.iframeContainer,editor.iframeElement=ifr,editor.iframeHTML=(editor=>{let iframeHTML=getDocType(editor)+"<html><head>";getDocumentBaseUrl(editor)!==editor.documentBaseUrl&&(iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';const bodyId=getBodyId(editor),bodyClass=getBodyClass(editor),translatedAriaText=editor.translate(getIframeAriaText(editor));return getContentSecurityPolicy(editor)&&(iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />'),iframeHTML+=`</head><body id="${bodyId}" class="mce-content-body ${bodyClass}" data-id="${editor.id}" aria-label="${translatedAriaText}"><br></body></html>`,iframeHTML})(editor),DOM$5.add(boxInfo.iframeContainer,ifr)},setupIframeBody=editor=>{const iframe=editor.iframeElement,ready=()=>{editor.contentDocument=iframe.contentDocument,contentBodyLoaded(editor)};if(shouldUseDocumentWrite(editor)||Env.browser.isFirefox()){const doc=editor.getDoc();doc.open(),doc.write(editor.iframeHTML),doc.close(),ready()}else{const binder=(element=SugarElement.fromDom(iframe),bind$2(element,"load",filter,(()=>{binder.unbind(),ready()})));iframe.srcdoc=editor.iframeHTML}var element},DOM$4=DOMUtils.DOM,initPlugin=(editor,initializedPlugins,plugin)=>{const Plugin=PluginManager.get(plugin),pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,"");if(plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(editor.plugins[plugin])return;try{const pluginInstance=Plugin(editor,pluginUrl)||{};editor.plugins[plugin]=pluginInstance,isFunction(pluginInstance.init)&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}catch(e){((editor,name,err)=>{const message=I18n.translate(["Failed to initialize plugin: {0}",name]);fireError(editor,"PluginLoadError",{message}),initError(message,err),displayError(editor,message)})(editor,plugin,e)}}},createThemeFalseResult=(element,iframe)=>({editorContainer:element,iframeContainer:iframe,api:{}}),renderThemeFalse=editor=>{const targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):(targetElement=>{const iframeContainer=DOM$4.create("div");return DOM$4.insertAfter(iframeContainer,targetElement),createThemeFalseResult(iframeContainer,iframeContainer)})(targetElement)},renderThemeUi=editor=>{const elm=editor.getElement();return editor.orgDisplay=elm.style.display,isString(getTheme(editor))?(editor=>{const render=editor.theme.renderUI;return render?render():renderThemeFalse(editor)})(editor):isFunction(getTheme(editor))?(editor=>{const elm=editor.getElement(),info=getTheme(editor)(editor,elm);return info.editorContainer.nodeType&&(info.editorContainer.id=info.editorContainer.id||editor.id+"_parent"),info.iframeContainer&&info.iframeContainer.nodeType&&(info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer"),info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight,info})(editor):renderThemeFalse(editor)},init=function(){var _ref=_asyncToGenerator((function*(editor){editor.dispatch("ScriptsLoaded"),(editor=>{const iconPackName=Tools.trim(getIconPackName(editor)),currentIcons=editor.ui.registry.getAll().icons,loadIcons={...IconManager.get("default").icons,...IconManager.get(iconPackName).icons};each$d(loadIcons,((svgData,icon)=>{has$2(currentIcons,icon)||editor.ui.registry.addIcon(icon,svgData)}))})(editor),(editor=>{const theme=getTheme(editor);if(isString(theme)){const Theme=ThemeManager.get(theme);editor.theme=Theme(editor,ThemeManager.urls[theme])||{},isFunction(editor.theme.init)&&editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,""))}else editor.theme={}})(editor),(editor=>{const model=getModel(editor),Model=ModelManager.get(model);editor.model=Model(editor,ModelManager.urls[model])})(editor),(editor=>{const initializedPlugins=[];each$e(getPlugins(editor),(name=>{initPlugin(editor,initializedPlugins,(name=>name.replace(/^\-/,""))(name))}))})(editor);const renderInfo=yield renderThemeUi(editor);((editor,api)=>{const uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),isEnabled:Optional.from(api.isEnabled).getOr(always),setEnabled:state=>{editor.mode.isReadOnly()||Optional.from(api.setEnabled).each((f=>f(state)))}};editor.ui={...editor.ui,...uiApiFacade}})(editor,Optional.from(renderInfo.api).getOr({})),editor.editorContainer=renderInfo.editorContainer,appendContentCssFromSettings(editor),editor.inline?contentBodyLoaded(editor):((editor,boxInfo)=>{createIframe(editor,boxInfo),boxInfo.editorContainer&&(boxInfo.editorContainer.style.display=editor.orgDisplay,editor.hidden=DOM$5.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM$5.setAttrib(editor.id,"aria-hidden","true"),editor.getElement().style.visibility=editor.orgVisibility,setupIframeBody(editor)})(editor,{editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer})}));return function init(_x){return _ref.apply(this,arguments)}}(),DOM$3=DOMUtils.DOM,hasSkipLoadPrefix=name=>"-"===name.charAt(0),loadLanguage=(scriptLoader,editor)=>{const languageCode=getLanguageCode(editor),languageUrl=getLanguageUrl(editor);if(!I18n.hasCode(languageCode)&&"en"!==languageCode){const url=isNotEmpty(languageUrl)?languageUrl:`${editor.editorManager.baseURL}/langs/${languageCode}.js`;scriptLoader.add(url).catch((()=>{((editor,url,name)=>{logError(editor,"LanguageLoadError",createLoadError("language",url,name))})(editor,url,languageCode)}))}},loadTheme=(editor,suffix)=>{const theme=getTheme(editor);if(isString(theme)&&!hasSkipLoadPrefix(theme)&&!has$2(ThemeManager.urls,theme)){const themeUrl=getThemeUrl(editor),url=themeUrl?editor.documentBaseURI.toAbsolute(themeUrl):`themes/${theme}/theme${suffix}.js`;ThemeManager.load(theme,url).catch((()=>{((editor,url,name)=>{logError(editor,"ThemeLoadError",createLoadError("theme",url,name))})(editor,url,theme)}))}},loadModel=(editor,suffix)=>{const model=getModel(editor);if("plugin"!==model&&!has$2(ModelManager.urls,model)){const modelUrl=getModelUrl(editor),url=isString(modelUrl)?editor.documentBaseURI.toAbsolute(modelUrl):`models/${model}/model${suffix}.js`;ModelManager.load(model,url).catch((()=>{((editor,url,name)=>{logError(editor,"ModelLoadError",createLoadError("model",url,name))})(editor,url,model)}))}},getIconsUrlMetaFromName=(editor,name,suffix)=>Optional.from(name).filter((name=>isNotEmpty(name)&&!IconManager.has(name))).map((name=>({url:`${editor.editorManager.baseURL}/icons/${name}/icons${suffix}.js`,name:Optional.some(name)}))),loadIcons=(scriptLoader,editor,suffix)=>{const defaultIconsUrl=getIconsUrlMetaFromName(editor,"default",suffix),customIconsUrl=(editor=>Optional.from(getIconsUrl(editor)).filter(isNotEmpty).map((url=>({url,name:Optional.none()}))))(editor).orThunk((()=>getIconsUrlMetaFromName(editor,getIconPackName(editor),"")));each$e((arr=>{const r=[],push=x=>{r.push(x)};for(let i=0;i<arr.length;i++)arr[i].each(push);return r})([defaultIconsUrl,customIconsUrl]),(urlMeta=>{scriptLoader.add(urlMeta.url).catch((()=>{((editor,url,name)=>{logError(editor,"IconsLoadError",createLoadError("icons",url,name))})(editor,urlMeta.url,urlMeta.name.getOrUndefined())}))}))},loadPlugins=(editor,suffix)=>{const loadPlugin=(name,url)=>{PluginManager.load(name,url).catch((()=>{((editor,url,name)=>{logError(editor,"PluginLoadError",createLoadError("plugin",url,name))})(editor,url,name)}))};each$d(getExternalPlugins$1(editor),((url,name)=>{loadPlugin(name,url),editor.options.set("plugins",getPlugins(editor).concat(name))})),each$e(getPlugins(editor),(plugin=>{!(plugin=Tools.trim(plugin))||PluginManager.urls[plugin]||hasSkipLoadPrefix(plugin)||loadPlugin(plugin,`plugins/${plugin}/plugin${suffix}.js`)}))},loadScripts=(editor,suffix)=>{const scriptLoader=ScriptLoader.ScriptLoader,initEditor=()=>{!editor.removed&&(editor=>{const theme=getTheme(editor);return!isString(theme)||isNonNullable(ThemeManager.get(theme))})(editor)&&(editor=>{const model=getModel(editor);return isNonNullable(ModelManager.get(model))})(editor)&&init(editor)};loadTheme(editor,suffix),loadModel(editor,suffix),loadLanguage(scriptLoader,editor),loadIcons(scriptLoader,editor,suffix),loadPlugins(editor,suffix),scriptLoader.loadQueue().then(initEditor,initEditor)},render=editor=>{const id=editor.id;I18n.setCode(getLanguageCode(editor));const readyHandler=()=>{DOM$3.unbind(window,"ready",readyHandler),editor.render()};if(!EventUtils.Event.domLoaded)return void DOM$3.bind(window,"ready",readyHandler);if(!editor.getElement())return;const element=SugarElement.fromDom(editor.getElement()),snapshot=clone$4(element);editor.on("remove",(()=>{eachr(element.dom.attributes,(attr=>remove$a(element,attr.name))),setAll$1(element,snapshot)})),editor.ui.styleSheetLoader=((element,editor)=>instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)}))(element,editor),isInline$1(editor)?editor.inline=!0:(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden");const form=editor.getElement().form||DOM$3.getParent(id,"form");form&&(editor.formElement=form,hasHiddenInput(editor)&&!isTextareaOrInput(editor.getElement())&&(DOM$3.insertAfter(DOM$3.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=e=>{editor.dispatch(e.type,e)},DOM$3.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",(()=>{editor.resetContent()})),!shouldPatchSubmit(editor)||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=()=>(editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)))),editor.windowManager=WindowManager(editor),editor.notificationManager=NotificationManager(editor),(editor=>"xml"===editor.options.get("encoding"))(editor)&&editor.on("GetContent",(e=>{e.save&&(e.content=DOM$3.encode(e.content))})),shouldAddFormSubmitTrigger(editor)&&editor.on("submit",(()=>{editor.initialized&&editor.save()})),shouldAddUnloadTrigger(editor)&&(editor._beforeUnload=()=>{!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),loadScripts(editor,editor.suffix)},deviceDetection=detect$2().deviceType,isPhone=deviceDetection.isPhone(),isTablet=deviceDetection.isTablet(),normalizePlugins=plugins=>{if(isNullable(plugins))return[];{const pluginNames=isArray$1(plugins)?plugins:plugins.split(/[ ,]/),trimmedPlugins=map$3(pluginNames,trim$4);return filter$5(trimmedPlugins,isNotEmpty)}},extractSections=(keys,options)=>{const result=((obj,pred)=>{const t={},f={};return internalFilter(obj,pred,objAcc(t),objAcc(f)),{t,f}})(options,((value,key)=>contains$2(keys,key)));return sections=result.t,settings=result.f,{sections:constant(sections),options:constant(settings)};var sections,settings},hasSection=(sectionResult,name)=>has$2(sectionResult.sections(),name),getMobileOverrideOptions=(mobileOptions,isPhone)=>({...{table_grid:!1,object_resizing:!1,resize:!1,toolbar_mode:get$a(mobileOptions,"toolbar_mode").getOr("scrolling"),toolbar_sticky:!1},...isPhone?{menubar:!1}:{}}),getExternalPlugins=(overrideOptions,options)=>{var _a;const userDefinedExternalPlugins=null!==(_a=options.external_plugins)&&void 0!==_a?_a:{};return overrideOptions&&overrideOptions.external_plugins?Tools.extend({},overrideOptions.external_plugins,userDefinedExternalPlugins):userDefinedExternalPlugins},processPlugins=(isMobileDevice,sectionResult,defaultOverrideOptions,options)=>{const forcedPlugins=normalizePlugins(defaultOverrideOptions.forced_plugins),desktopPlugins=normalizePlugins(options.plugins),mobileConfig=((sectionResult,name)=>hasSection(sectionResult,name)?sectionResult.sections()[name]:{})(sectionResult,"mobile"),platformPlugins=((isMobileDevice,sectionResult,desktopPlugins,mobilePlugins)=>isMobileDevice&&hasSection(sectionResult,"mobile")?mobilePlugins:desktopPlugins)(isMobileDevice,sectionResult,desktopPlugins,mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins),combinedPlugins=((forcedPlugins,plugins)=>[...normalizePlugins(forcedPlugins),...normalizePlugins(plugins)])(forcedPlugins,platformPlugins);return Tools.extend(options,{forced_plugins:forcedPlugins,plugins:combinedPlugins})},combineOptions=(isMobileDevice,isPhone,defaultOptions,defaultOverrideOptions,options)=>{var _a;const deviceOverrideOptions=isMobileDevice?{mobile:getMobileOverrideOptions(null!==(_a=options.mobile)&&void 0!==_a?_a:{},isPhone)}:{},sectionResult=extractSections(["mobile"],deepMerge(deviceOverrideOptions,options)),extendedOptions=Tools.extend(defaultOptions,defaultOverrideOptions,sectionResult.options(),((isMobileDevice,sectionResult)=>isMobileDevice&&hasSection(sectionResult,"mobile"))(isMobileDevice,sectionResult)?((sectionResult,name,defaults={})=>{const sections=sectionResult.sections(),sectionOptions=get$a(sections,name).getOr({});return Tools.extend({},defaults,sectionOptions)})(sectionResult,"mobile"):{},{external_plugins:getExternalPlugins(defaultOverrideOptions,sectionResult.options())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideOptions,extendedOptions)},addVisual=(editor,elm)=>((editor,elm)=>getRtcInstanceWithError(editor).editor.addVisual(elm))(editor,elm),registerExecCommands$3=editor=>{const toggleAlign=align=>()=>{each$e("left,center,right,justify".split(","),(name=>{align!==name&&editor.formatter.remove("align"+name)})),"none"!==align&&((name,value)=>{editor.formatter.toggle(name,value),editor.nodeChanged()})("align"+align)};editor.editorCommands.addCommands({JustifyLeft:toggleAlign("left"),JustifyCenter:toggleAlign("center"),JustifyRight:toggleAlign("right"),JustifyFull:toggleAlign("justify"),JustifyNone:toggleAlign("none")})},registerCommands$b=editor=>{registerExecCommands$3(editor),(editor=>{const alignStates=name=>()=>{const selection=editor.selection,nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks();return exists(nodes,(node=>isNonNullable(editor.formatter.matchNode(node,name))))};editor.editorCommands.addCommands({JustifyLeft:alignStates("alignleft"),JustifyCenter:alignStates("aligncenter"),JustifyRight:alignStates("alignright"),JustifyFull:alignStates("alignjustify")},"state")})(editor)},trimOrPad=(editor,value)=>{const selection=editor.selection,dom=editor.dom;return/^ | $/.test(value)?((dom,rng,html,schema)=>{const root=SugarElement.fromDom(dom.getRoot());return html=needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng),schema)?html.replace(/^ /,"&nbsp;"):html.replace(/^&nbsp;/," "),needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng),schema)?html.replace(/(&nbsp;| )(<br( \/)>)?$/,"&nbsp;"):html.replace(/&nbsp;(<br( \/)?>)?$/," ")})(dom,selection.getRng(),value,editor.schema):value},insertAtCaret=(editor,value)=>{if(editor.selection.isEditable()){const{content,details}=(value=>{if("string"!=typeof value){const details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value);return{content:value.content,details}}return{content:value,details:{}}})(value);preProcessSetContent(editor,{...details,content:trimOrPad(editor,content),format:"html",set:!1,selection:!0}).each((args=>{const insertedContent=((editor,value,details)=>getRtcInstanceWithFallback(editor).editor.insertContent(value,details))(editor,args.content,details);postProcessSetContent(editor,insertedContent,args),editor.addVisual()}))}},legacyPropNames={"font-size":"size","font-family":"face"},isFont=isTag("font"),getSpecifiedFontProp=(propName,rootElm,elm)=>closest$1(SugarElement.fromDom(elm),(elm=>(elm=>getRaw(elm,propName).orThunk((()=>isFont(elm)?get$a(legacyPropNames,propName).bind((legacyPropName=>getOpt(elm,legacyPropName))):Optional.none())))(elm)),(elm=>eq(SugarElement.fromDom(rootElm),elm))),getFontProp=propName=>(rootElm,elm)=>Optional.from(elm).map(SugarElement.fromDom).filter(isElement$7).bind((element=>getSpecifiedFontProp(propName,rootElm,element.dom).or(((propName,elm)=>Optional.from(DOMUtils.DOM.getStyle(elm,propName,!0)))(propName,element.dom)))).getOr(""),getFontSize=getFontProp("font-size"),getFontFamily=compose((fontFamily=>fontFamily.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")),getFontProp("font-family")),findFirstCaretElement=editor=>firstPositionIn(editor.getBody()).bind((caret=>{const container=caret.container();return Optional.from(isText$a(container)?container.parentNode:container)})),bindRange=(editor,binder)=>(editor=>Optional.from(editor.selection.getRng()).bind((rng=>{const root=editor.getBody();return rng.startContainer===root&&0===rng.startOffset?Optional.none():Optional.from(editor.selection.getStart(!0))})))(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement$7).bind(binder),mapRange=(editor,mapper)=>bindRange(editor,compose1(Optional.some,mapper)),fromFontSizeNumber=(editor,value)=>{if(/^[0-9.]+$/.test(value)){const fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){const fontSizes=(editor=>Tools.explode(editor.options.get("font_size_style_values")))(editor),fontClasses=(editor=>Tools.explode(editor.options.get("font_size_classes")))(editor);return fontClasses.length>0?fontClasses[fontSizeNumber-1]||value:fontSizes[fontSizeNumber-1]||value}return value}return value},normalizeFontNames=font=>{const fonts=font.split(/\s*,\s*/);return map$3(fonts,(font=>-1===font.indexOf(" ")||startsWith(font,'"')||startsWith(font,"'")?font:`'${font}'`)).join(",")},registerExecCommands$2=editor=>{const toggleFormat=(name,value)=>{editor.formatter.toggle(name,value),editor.nodeChanged()};editor.editorCommands.addCommands({"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":command=>{toggleFormat(command)},"ForeColor,HiliteColor":(command,_ui,value)=>{toggleFormat(command,{value})},BackColor:(_command,_ui,value)=>{toggleFormat("hilitecolor",{value})},FontName:(_command,_ui,value)=>{((editor,value)=>{const font=fromFontSizeNumber(editor,value);editor.formatter.toggle("fontname",{value:normalizeFontNames(font)}),editor.nodeChanged()})(editor,value)},FontSize:(_command,_ui,value)=>{((editor,value)=>{editor.formatter.toggle("fontsize",{value:fromFontSizeNumber(editor,value)}),editor.nodeChanged()})(editor,value)},LineHeight:(_command,_ui,value)=>{((editor,lineHeight)=>{editor.formatter.toggle("lineheight",{value:String(lineHeight)}),editor.nodeChanged()})(editor,value)},Lang:(command,_ui,lang)=>{var _a;toggleFormat(command,{value:lang.code,customValue:null!==(_a=lang.customCode)&&void 0!==_a?_a:null})},RemoveFormat:command=>{editor.formatter.remove(command)},mceBlockQuote:()=>{toggleFormat("blockquote")},FormatBlock:(_command,_ui,value)=>{toggleFormat(isString(value)?value:"p")},mceToggleFormat:(_command,_ui,value)=>{toggleFormat(value)}})},registerQueryValueCommands=editor=>{const isFormatMatch=name=>editor.formatter.match(name);editor.editorCommands.addCommands({"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":command=>isFormatMatch(command),mceBlockQuote:()=>isFormatMatch("blockquote")},"state"),editor.editorCommands.addQueryValueHandler("FontName",(()=>(editor=>mapRange(editor,(elm=>getFontFamily(editor.getBody(),elm.dom))).getOr(""))(editor))),editor.editorCommands.addQueryValueHandler("FontSize",(()=>(editor=>mapRange(editor,(elm=>getFontSize(editor.getBody(),elm.dom))).getOr(""))(editor))),editor.editorCommands.addQueryValueHandler("LineHeight",(()=>(editor=>mapRange(editor,(elm=>{const root=SugarElement.fromDom(editor.getBody()),specifiedStyle=closest$1(elm,(elm=>getRaw(elm,"line-height")),curry(eq,root));return specifiedStyle.getOrThunk((()=>{const lineHeight=parseFloat(get$7(elm,"line-height")),fontSize=parseFloat(get$7(elm,"font-size"));return String(lineHeight/fontSize)}))})).getOr(""))(editor)))},registerCommands$6=editor=>{editor.editorCommands.addCommands({Indent:()=>{(editor=>{handle(editor,"indent")})(editor)},Outdent:()=>{outdent(editor)}}),editor.editorCommands.addCommands({Outdent:()=>canOutdent(editor)},"state")},insert=(editor,before)=>{const dom=editor.dom,rng=editor.selection.getRng(),node=before?editor.selection.getStart():editor.selection.getEnd(),container=before?rng.startContainer:rng.endContainer,root=getEditableRoot(dom,container);if(!root||!root.isContentEditable)return;const insertFn=before?before$3:after$4,newBlockName=getForcedRootBlock(editor);((editor,node,root,container)=>{const dom=editor.dom,selector=node=>dom.isBlock(node)&&node.parentElement===root,topParentBlock=selector(node)?node:dom.getParent(container,selector,root);return Optional.from(topParentBlock).map(SugarElement.fromDom)})(editor,node,root,container).each((parentBlock=>{const newBlock=createNewBlock(editor,container,parentBlock.dom,root,!1,newBlockName);insertFn(parentBlock,SugarElement.fromDom(newBlock)),editor.selection.setCursorLocation(newBlock,0),editor.dispatch("NewBlock",{newBlock}),fireInputEvent(editor,"insertParagraph")}))},registerCommands$3=editor=>{editor.editorCommands.addCommands({InsertNewBlockBefore:()=>{(editor=>{insert(editor,!0)})(editor)},InsertNewBlockAfter:()=>{(editor=>{insert(editor,!1)})(editor)}})},registerCommands=editor=>{registerCommands$b(editor),(editor=>{editor.editorCommands.addCommands({"Cut,Copy,Paste":command=>{const doc=editor.getDoc();let failed;try{doc.execCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){let msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");(Env.os.isMacOS()||Env.os.isiOS())&&(msg=msg.replace(/Ctrl\+/g,"⌘+")),editor.notificationManager.open({text:msg,type:"error"})}}})})(editor),(editor=>{editor.editorCommands.addCommands({mceAddUndoLevel:()=>{editor.undoManager.add()},mceEndUndoLevel:()=>{editor.undoManager.add()},Undo:()=>{editor.undoManager.undo()},Redo:()=>{editor.undoManager.redo()}})})(editor),(editor=>{editor.editorCommands.addCommands({mceSelectNodeDepth:(_command,_ui,value)=>{let counter=0;editor.dom.getParent(editor.selection.getNode(),(node=>!isElement$6(node)||counter++!==value||(editor.selection.select(node),!1)),editor.getBody())},mceSelectNode:(_command,_ui,value)=>{editor.selection.select(value)},selectAll:()=>{const editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue$3);if(editingHost){const rng=editor.dom.createRng();rng.selectNodeContents(editingHost),editor.selection.setRng(rng)}}})})(editor),(editor=>{editor.editorCommands.addCommands({mceCleanup:()=>{const bm=editor.selection.getBookmark();editor.setContent(editor.getContent()),editor.selection.moveToBookmark(bm)},insertImage:(_command,_ui,value)=>{insertAtCaret(editor,editor.dom.createHTML("img",{src:value}))},insertHorizontalRule:()=>{editor.execCommand("mceInsertContent",!1,"<hr>")},insertText:(_command,_ui,value)=>{insertAtCaret(editor,editor.dom.encode(value))},insertHTML:(_command,_ui,value)=>{insertAtCaret(editor,value)},mceInsertContent:(_command,_ui,value)=>{insertAtCaret(editor,value)},mceSetContent:(_command,_ui,value)=>{editor.setContent(value)},mceReplaceContent:(_command,_ui,value)=>{editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:"text"})))},mceNewDocument:()=>{editor.setContent(getNewDocumentContent(editor))}})})(editor),(editor=>{const applyLinkToSelection=(_command,_ui,value)=>{const linkDetails=isString(value)?{href:value}:value,anchor=editor.dom.getParent(editor.selection.getNode(),"a");isObject(linkDetails)&&isString(linkDetails.href)&&(linkDetails.href=linkDetails.href.replace(/ /g,"%20"),anchor&&linkDetails.href||editor.formatter.remove("link"),linkDetails.href&&editor.formatter.apply("link",linkDetails,anchor))};editor.editorCommands.addCommands({unlink:()=>{if(editor.selection.isEditable()){if(editor.selection.isCollapsed()){const elm=editor.dom.getParent(editor.selection.getStart(),"a");return void(elm&&editor.dom.remove(elm,!0))}editor.formatter.remove("link")}},mceInsertLink:applyLinkToSelection,createLink:applyLinkToSelection})})(editor),registerCommands$6(editor),registerCommands$3(editor),(editor=>{editor.editorCommands.addCommands({insertParagraph:()=>{insertBreak(blockbreak,editor)},mceInsertNewLine:(_command,_ui,value)=>{insert$1(editor,value)},InsertLineBreak:(_command,_ui,_value)=>{insertBreak(linebreak,editor)}})})(editor),(editor=>{(editor=>{editor.editorCommands.addCommands({"InsertUnorderedList,InsertOrderedList":command=>{editor.getDoc().execCommand(command);const listElm=editor.dom.getParent(editor.selection.getNode(),"ol,ul");if(listElm){const listParent=listElm.parentNode;if(listParent&&/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){const bm=editor.selection.getBookmark();editor.dom.split(listParent,listElm),editor.selection.moveToBookmark(bm)}}}})})(editor),(editor=>{editor.editorCommands.addCommands({"InsertUnorderedList,InsertOrderedList":command=>{const list=editor.dom.getParent(editor.selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state")})(editor)})(editor),(editor=>{registerExecCommands$2(editor),registerQueryValueCommands(editor)})(editor),(editor=>{editor.editorCommands.addCommands({mceRemoveNode:(_command,_ui,value)=>{const node=null!=value?value:editor.selection.getNode();if(node!==editor.getBody()){const bm=editor.selection.getBookmark();editor.dom.remove(node,!0),editor.selection.moveToBookmark(bm)}},mcePrint:()=>{editor.getWin().print()},mceFocus:(_command,_ui,value)=>{focus(editor,!0===value)},mceToggleVisualAid:()=>{editor.hasVisual=!editor.hasVisual,editor.addVisual()}})})(editor)},selectionSafeCommands=["toggleview"],isSelectionSafeCommand=command=>contains$2(selectionSafeCommands,command.toLowerCase());class EditorCommands{constructor(editor){this.commands={state:{},exec:{},value:{}},this.editor=editor}execCommand(command,ui=!1,value,args){const editor=this.editor,lowerCaseCommand=command.toLowerCase(),skipFocus=null==args?void 0:args.skip_focus;if(editor.removed)return!1;"mcefocus"!==lowerCaseCommand&&(/^(mceAddUndoLevel|mceEndUndoLevel)$/i.test(lowerCaseCommand)||skipFocus?(editor=>{getRng(editor).each((rng=>editor.selection.setRng(rng)))})(editor):editor.focus());if(editor.dispatch("BeforeExecCommand",{command,ui,value}).isDefaultPrevented())return!1;const func=this.commands.exec[lowerCaseCommand];return!!isFunction(func)&&(func(lowerCaseCommand,ui,value),editor.dispatch("ExecCommand",{command,ui,value}),!0)}queryCommandState(command){if(!isSelectionSafeCommand(command)&&this.editor.quirks.isHidden()||this.editor.removed)return!1;const lowerCaseCommand=command.toLowerCase(),func=this.commands.state[lowerCaseCommand];return!!isFunction(func)&&func(lowerCaseCommand)}queryCommandValue(command){if(!isSelectionSafeCommand(command)&&this.editor.quirks.isHidden()||this.editor.removed)return"";const lowerCaseCommand=command.toLowerCase(),func=this.commands.value[lowerCaseCommand];return isFunction(func)?func(lowerCaseCommand):""}addCommands(commandList,type="exec"){const commands=this.commands;each$d(commandList,((callback,command)=>{each$e(command.toLowerCase().split(","),(command=>{commands[type][command]=callback}))}))}addCommand(command,callback,scope){const lowerCaseCommand=command.toLowerCase();this.commands.exec[lowerCaseCommand]=(_command,ui,value)=>callback.call(null!=scope?scope:this.editor,ui,value)}queryCommandSupported(command){const lowerCaseCommand=command.toLowerCase();return!!this.commands.exec[lowerCaseCommand]}addQueryStateHandler(command,callback,scope){this.commands.state[command.toLowerCase()]=()=>callback.call(null!=scope?scope:this.editor)}addQueryValueHandler(command,callback,scope){this.commands.value[command.toLowerCase()]=()=>callback.call(null!=scope?scope:this.editor)}}const setEditorCommandState=(editor,cmd,state)=>{try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}},setContentEditable=(elm,state)=>{elm.dom.contentEditable=state?"true":"false"},toggleReadOnly=(editor,state)=>{const body=SugarElement.fromDom(editor.getBody());((elm,cls,state)=>{has(elm,cls)&&!state?remove$7(elm,cls):state&&add$2(elm,cls)})(body,"mce-content-readonly",state),state?(editor.selection.controlSelection.hideResizeRect(),editor._selectionOverrides.hideFakeCaret(),(editor=>{Optional.from(editor.selection.getNode()).each((elm=>{elm.removeAttribute("data-mce-selected")}))})(editor),editor.readonly=!0,setContentEditable(body,!1),each$e(descendants(body,'*[contenteditable="true"]'),(elm=>{set$3(elm,"data-mce-contenteditable","true"),setContentEditable(elm,!1)}))):(editor.readonly=!1,editor.hasEditableRoot()&&setContentEditable(body,!0),(elm=>{each$e(descendants(elm,'*[data-mce-contenteditable="true"]'),(elm=>{remove$a(elm,"data-mce-contenteditable"),setContentEditable(elm,!0)}))})(body),setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),hasEditorOrUiFocus(editor)&&editor.focus(),(editor=>{editor.selection.setRng(editor.selection.getRng())})(editor),editor.nodeChanged())},isReadOnly=editor=>editor.readonly,registerFilters=editor=>{editor.parser.addAttributeFilter("contenteditable",(nodes=>{isReadOnly(editor)&&each$e(nodes,(node=>{node.attr("data-mce-contenteditable",node.attr("contenteditable")),node.attr("contenteditable","false")}))})),editor.serializer.addAttributeFilter("data-mce-contenteditable",(nodes=>{isReadOnly(editor)&&each$e(nodes,(node=>{node.attr("contenteditable",node.attr("data-mce-contenteditable"))}))})),editor.serializer.addTempAttr("data-mce-contenteditable")},allowedEvents=["copy"],processReadonlyEvents=(editor,e)=>{if((e=>"click"===e.type)(e)&&!VK.metaKeyPressed(e)){const elm=SugarElement.fromDom(e.target);((editor,elm)=>closest$3(elm,"a",(elm=>eq(elm,SugarElement.fromDom(editor.getBody())))).bind((a=>getOpt(a,"href"))))(editor,elm).each((href=>{if(e.preventDefault(),/^#/.test(href)){const targetEl=editor.dom.select(`${href},[name="${removeLeading(href,"#")}"]`);targetEl.length&&editor.selection.scrollIntoView(targetEl[0],!0)}else window.open(href,"_blank","rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes")}))}else(e=>contains$2(allowedEvents,e.type))(e)&&editor.dispatch(e.type,e)},nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel"," ");class EventDispatcher{static isNative(name){return!!nativeEvents[name.toLowerCase()]}constructor(settings){this.bindings={},this.settings=settings||{},this.scope=this.settings.scope||this,this.toggleEvent=this.settings.toggleEvent||never}fire(name,args){return this.dispatch(name,args)}dispatch(name,args){const lcName=name.toLowerCase(),event=normalize$3(lcName,null!=args?args:{},this.scope);this.settings.beforeFire&&this.settings.beforeFire(event);const handlers=this.bindings[lcName];if(handlers)for(let i=0,l=handlers.length;i<l;i++){const callback=handlers[i];if(!callback.removed){if(callback.once&&this.off(lcName,callback.func),event.isImmediatePropagationStopped())return event;if(!1===callback.func.call(this.scope,event))return event.preventDefault(),event}}return event}on(name,callback,prepend,extra){if(!1===callback&&(callback=never),callback){const wrappedCallback={func:callback,removed:!1};extra&&Tools.extend(wrappedCallback,extra);const names=name.toLowerCase().split(" ");let i=names.length;for(;i--;){const currentName=names[i];let handlers=this.bindings[currentName];handlers||(handlers=[],this.toggleEvent(currentName,!0)),handlers=prepend?[wrappedCallback,...handlers]:[...handlers,wrappedCallback],this.bindings[currentName]=handlers}}return this}off(name,callback){if(name){const names=name.toLowerCase().split(" ");let i=names.length;for(;i--;){const currentName=names[i];let handlers=this.bindings[currentName];if(!currentName)return each$d(this.bindings,((_value,bindingName)=>{this.toggleEvent(bindingName,!1),delete this.bindings[bindingName]})),this;if(handlers){if(callback){const filteredHandlers=partition$2(handlers,(handler=>handler.func===callback));handlers=filteredHandlers.fail,this.bindings[currentName]=handlers,each$e(filteredHandlers.pass,(handler=>{handler.removed=!0}))}else handlers.length=0;handlers.length||(this.toggleEvent(name,!1),delete this.bindings[currentName])}}}else each$d(this.bindings,((_value,name)=>{this.toggleEvent(name,!1)})),this.bindings={};return this}once(name,callback,prepend){return this.on(name,callback,prepend,{once:!0})}has(name){name=name.toLowerCase();const binding=this.bindings[name];return!(!binding||0===binding.length)}}const getEventDispatcher=obj=>(obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:(name,state)=>{EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher),Observable={fire(name,args,bubble){return this.dispatch(name,args,bubble)},dispatch(name,args,bubble){const self=this;if(self.removed&&"remove"!==name&&"detach"!==name)return normalize$3(name.toLowerCase(),null!=args?args:{},self);const dispatcherArgs=getEventDispatcher(self).dispatch(name,args);if(!1!==bubble&&self.parent){let parent=self.parent();for(;parent&&!dispatcherArgs.isPropagationStopped();)parent.dispatch(name,dispatcherArgs,!1),parent=parent.parent?parent.parent():void 0}return dispatcherArgs},on(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off(name,callback){return getEventDispatcher(this).off(name,callback)},once(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners(name){return getEventDispatcher(this).has(name)}},DOM$2=DOMUtils.DOM;let customEventRootDelegates;const getEventTarget=(editor,eventName)=>{if("selectionchange"===eventName)return editor.getDoc();if(!editor.inline&&/^(?:mouse|touch|click|contextmenu|drop|dragover|dragend)/.test(eventName))return editor.getDoc().documentElement;const eventRoot=getEventRoot(editor);return eventRoot?(editor.eventRoot||(editor.eventRoot=DOM$2.select(eventRoot)[0]),editor.eventRoot):editor.getBody()},fireEvent=(editor,eventName,e)=>{(editor=>!editor.hidden&&!isReadOnly(editor))(editor)?editor.dispatch(eventName,e):isReadOnly(editor)&&processReadonlyEvents(editor,e)},bindEventDelegate=(editor,eventName)=>{if(editor.delegates||(editor.delegates={}),editor.delegates[eventName]||editor.removed)return;const eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",(()=>{editor.editorManager.activeEditor||customEventRootDelegates&&(each$d(customEventRootDelegates,((_value,name)=>{editor.dom.unbind(getEventTarget(editor,name))})),customEventRootDelegates=null)}))),customEventRootDelegates[eventName])return;const delegate=e=>{const target=e.target,editors=editor.editorManager.get();let i=editors.length;for(;i--;){const body=editors[i].getBody();(body===target||DOM$2.isChildOf(target,body))&&fireEvent(editors[i],eventName,e)}};customEventRootDelegates[eventName]=delegate,DOM$2.bind(eventRootElm,eventName,delegate)}else{const delegate=e=>{fireEvent(editor,eventName,e)};DOM$2.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}},EditorObservable={...Observable,bindPendingEventDelegates(){const self=this;Tools.each(self._pendingNativeEvents,(name=>{bindEventDelegate(self,name)}))},toggleNativeEvent(name,state){const self=this;"focus"!==name&&"blur"!==name&&(self.removed||(state?self.initialized?bindEventDelegate(self,name):self._pendingNativeEvents?self._pendingNativeEvents.push(name):self._pendingNativeEvents=[name]:self.initialized&&self.delegates&&(self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]),delete self.delegates[name])))},unbindAllNativeEvents(){const self=this,body=self.getBody(),dom=self.dom;self.delegates&&(each$d(self.delegates,((value,name)=>{self.dom.unbind(getEventTarget(self,name),name,value)})),delete self.delegates),!self.inline&&body&&dom&&(body.onload=null,dom.unbind(self.getWin()),dom.unbind(self.getDoc())),dom&&(dom.unbind(body),dom.unbind(self.getContainer()))}},stringListProcessor=value=>isString(value)?{value:value.split(/[ ,]/),valid:!0}:isArrayOf(value,isString)?{value,valid:!0}:{valid:!1,message:"The value must be a string[] or a comma/space separated string."},getErrorMessage=(message,result)=>message+(isEmpty$3(result.message)?"":`. ${result.message}`),isValidResult=result=>result.valid,processValue=(value,processor,message="")=>{const result=processor(value);return isBoolean(result)?result?{value,valid:!0}:{valid:!1,message}:result},create$5=(editor,initialOptions)=>{const registry={},values={},setValue=(name,value,processor)=>{const result=processValue(value,processor);return isValidResult(result)?(values[name]=result.value,!0):(console.warn(getErrorMessage(`Invalid value passed for the ${name} option`,result)),!1)},isRegistered=name=>has$2(registry,name);return{register:(name,spec)=>{const processor=(spec=>isString(spec.processor))(spec)?(type=>{const validator=(()=>{switch(type){case"array":return isArray$1;case"boolean":return isBoolean;case"function":return isFunction;case"number":return isNumber;case"object":return isObject;case"string":return isString;case"string[]":return stringListProcessor;case"object[]":return val=>isArrayOf(val,isObject);case"regexp":return val=>is$4(val,RegExp);default:return always}})();return value=>processValue(value,validator,`The value must be a ${type}.`)})(spec.processor):spec.processor,defaultValue=((name,defaultValue,processor)=>{if(!isUndefined(defaultValue)){const result=processValue(defaultValue,processor);if(isValidResult(result))return result.value;console.error(getErrorMessage(`Invalid default value passed for the "${name}" option`,result))}})(name,spec.default,processor);registry[name]={...spec,default:defaultValue,processor};get$a(values,name).orThunk((()=>get$a(initialOptions,name))).each((value=>setValue(name,value,processor)))},isRegistered,get:name=>get$a(values,name).orThunk((()=>get$a(registry,name).map((spec=>spec.default)))).getOrUndefined(),set:(name,value)=>{if(isRegistered(name)){const spec=registry[name];return spec.immutable?(console.error(`"${name}" is an immutable option and cannot be updated`),!1):setValue(name,value,spec.processor)}return console.warn(`"${name}" is not a registered option. Ensure the option has been registered before setting a value.`),!1},unset:name=>{const registered=isRegistered(name);return registered&&delete values[name],registered},isSet:name=>has$2(values,name)}},defaultModes=["design","readonly"],switchToMode=(editor,activeMode,availableModes,mode)=>{const oldMode=availableModes[activeMode.get()],newMode=availableModes[mode];try{newMode.activate()}catch(e){return void console.error(`problem while activating editor mode ${mode}:`,e)}oldMode.deactivate(),oldMode.editorReadOnly!==newMode.editorReadOnly&&toggleReadOnly(editor,newMode.editorReadOnly),activeMode.set(mode),((editor,mode)=>{editor.dispatch("SwitchMode",{mode})})(editor,mode)},create$4=editor=>{const activeMode=Cell("design"),availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:!1},readonly:{activate:noop,deactivate:noop,editorReadOnly:!0}});return(editor=>{editor.serializer?registerFilters(editor):editor.on("PreInit",(()=>{registerFilters(editor)}))})(editor),(editor=>{editor.on("ShowCaret",(e=>{isReadOnly(editor)&&e.preventDefault()})),editor.on("ObjectSelected",(e=>{isReadOnly(editor)&&e.preventDefault()}))})(editor),{isReadOnly:()=>isReadOnly(editor),set:mode=>((editor,availableModes,activeMode,mode)=>{if(mode!==activeMode.get()){if(!has$2(availableModes,mode))throw new Error(`Editor mode '${mode}' is invalid`);editor.initialized?switchToMode(editor,activeMode,availableModes,mode):editor.on("init",(()=>switchToMode(editor,activeMode,availableModes,mode)))}})(editor,availableModes.get(),activeMode,mode),get:()=>activeMode.get(),register:(mode,api)=>{availableModes.set(((availableModes,mode,api)=>{if(contains$2(defaultModes,mode))throw new Error(`Cannot override default mode ${mode}`);return{...availableModes,[mode]:{...api,deactivate:()=>{try{api.deactivate()}catch(e){console.error(`problem while deactivating editor mode ${mode}:`,e)}}}}})(availableModes.get(),mode,api))}}},each$2=Tools.each,explode=Tools.explode,keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access"),parseShortcut=pattern=>{const shortcut={},isMac=Env.os.isMacOS()||Env.os.isiOS();each$2(explode(pattern.toLowerCase(),"+"),(value=>{(key=>key in modifierNames)(value)?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}));const id=[shortcut.keyCode];let key;for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,isMac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(isMac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut};class Shortcuts{constructor(editor){this.shortcuts={},this.pendingPatterns=[],this.editor=editor;const self=this;editor.on("keyup keypress keydown",(e=>{!self.hasModifier(e)&&!self.isFunctionKey(e)||e.isDefaultPrevented()||(each$2(self.shortcuts,(shortcut=>{self.matchShortcut(e,shortcut)&&(self.pendingPatterns=shortcut.subpatterns.slice(0),"keydown"===e.type&&self.executeShortcutAction(shortcut))})),self.matchShortcut(e,self.pendingPatterns[0])&&(1===self.pendingPatterns.length&&"keydown"===e.type&&self.executeShortcutAction(self.pendingPatterns[0]),self.pendingPatterns.shift()))}))}add(pattern,desc,cmdFunc,scope){const self=this,func=self.normalizeCommandFunc(cmdFunc);return each$2(explode(Tools.trim(pattern)),(pattern=>{const shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut})),!0}remove(pattern){const shortcut=this.createShortcut(pattern);return!!this.shortcuts[shortcut.id]&&(delete this.shortcuts[shortcut.id],!0)}normalizeCommandFunc(cmdFunc){const self=this,cmd=cmdFunc;return"string"==typeof cmd?()=>{self.editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)?()=>{self.editor.execCommand(cmd[0],cmd[1],cmd[2])}:cmd}createShortcut(pattern,desc,cmdFunc,scope){const shortcuts=Tools.map(explode(pattern,">"),parseShortcut);return shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor}),Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)})}hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey}isFunctionKey(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123}matchShortcut(e,shortcut){return!!shortcut&&(shortcut.ctrl===e.ctrlKey&&shortcut.meta===e.metaKey&&(shortcut.alt===e.altKey&&shortcut.shift===e.shiftKey&&(!!(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode)&&(e.preventDefault(),!0))))}executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null}}const registry=()=>{const bridge=(()=>{const buttons={},menuItems={},popups={},icons={},contextMenus={},contextToolbars={},sidebars={},views={},add=(collection,type)=>(name,spec)=>{collection[name.toLowerCase()]={...spec,type}};return{addButton:add(buttons,"button"),addGroupToolbarButton:add(buttons,"grouptoolbarbutton"),addToggleButton:add(buttons,"togglebutton"),addMenuButton:add(buttons,"menubutton"),addSplitButton:add(buttons,"splitbutton"),addMenuItem:add(menuItems,"menuitem"),addNestedMenuItem:add(menuItems,"nestedmenuitem"),addToggleMenuItem:add(menuItems,"togglemenuitem"),addAutocompleter:add(popups,"autocompleter"),addContextMenu:add(contextMenus,"contextmenu"),addContextToolbar:add(contextToolbars,"contexttoolbar"),addContextForm:add(contextToolbars,"contextform"),addSidebar:add(sidebars,"sidebar"),addView:add(views,"views"),addIcon:(name,svgData)=>icons[name.toLowerCase()]=svgData,getAll:()=>({buttons,menuItems,icons,popups,contextMenus,contextToolbars,sidebars,views})}})();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,addView:bridge.addView,getAll:bridge.getAll}},DOM$1=DOMUtils.DOM,extend=Tools.extend,each$1=Tools.each;class Editor{constructor(id,options,editorManager){this.plugins={},this.contentCSS=[],this.contentStyles=[],this.loadedCSS={},this.isNotDirty=!1,this.composing=!1,this.destroyed=!1,this.hasHiddenInput=!1,this.iframeElement=null,this.initialized=!1,this.readonly=!1,this.removed=!1,this.startContent="",this._pendingNativeEvents=[],this._skinLoaded=!1,this._editableRoot=!0,this.editorManager=editorManager,this.documentBaseUrl=editorManager.documentBaseURL,extend(this,EditorObservable);const self=this;this.id=id,this.hidden=!1;const normalizedOptions=((defaultOverrideOptions,options)=>combineOptions(isPhone||isTablet,isPhone,options,defaultOverrideOptions,options))(editorManager.defaultOptions,options);this.options=create$5(0,normalizedOptions),(editor=>{const registerOption=editor.options.register;registerOption("id",{processor:"string",default:editor.id}),registerOption("selector",{processor:"string"}),registerOption("target",{processor:"object"}),registerOption("suffix",{processor:"string"}),registerOption("cache_suffix",{processor:"string"}),registerOption("base_url",{processor:"string"}),registerOption("referrer_policy",{processor:"string",default:""}),registerOption("language_load",{processor:"boolean",default:!0}),registerOption("inline",{processor:"boolean",default:!1}),registerOption("iframe_attrs",{processor:"object",default:{}}),registerOption("doctype",{processor:"string",default:"<!DOCTYPE html>"}),registerOption("document_base_url",{processor:"string",default:editor.documentBaseUrl}),registerOption("body_id",{processor:bodyOptionProcessor(editor,"tinymce"),default:"tinymce"}),registerOption("body_class",{processor:bodyOptionProcessor(editor),default:""}),registerOption("content_security_policy",{processor:"string",default:""}),registerOption("br_in_pre",{processor:"boolean",default:!0}),registerOption("forced_root_block",{processor:value=>{const valid=isString(value)&&isNotEmpty(value);return valid?{value,valid}:{valid:!1,message:"Must be a non-empty string."}},default:"p"}),registerOption("forced_root_block_attrs",{processor:"object",default:{}}),registerOption("newline_behavior",{processor:value=>{const valid=contains$2(["block","linebreak","invert","default"],value);return valid?{value,valid}:{valid:!1,message:"Must be one of: block, linebreak, invert or default."}},default:"default"}),registerOption("br_newline_selector",{processor:"string",default:".mce-toc h2,figcaption,caption"}),registerOption("no_newline_selector",{processor:"string",default:""}),registerOption("keep_styles",{processor:"boolean",default:!0}),registerOption("end_container_on_empty_block",{processor:value=>isBoolean(value)||isString(value)?{valid:!0,value}:{valid:!1,message:"Must be boolean or a string"},default:"blockquote"}),registerOption("font_size_style_values",{processor:"string",default:"xx-small,x-small,small,medium,large,x-large,xx-large"}),registerOption("font_size_legacy_values",{processor:"string",default:"xx-small,small,medium,large,x-large,xx-large,300%"}),registerOption("font_size_classes",{processor:"string",default:""}),registerOption("automatic_uploads",{processor:"boolean",default:!0}),registerOption("images_reuse_filename",{processor:"boolean",default:!1}),registerOption("images_replace_blob_uris",{processor:"boolean",default:!0}),registerOption("icons",{processor:"string",default:""}),registerOption("icons_url",{processor:"string",default:""}),registerOption("images_upload_url",{processor:"string",default:""}),registerOption("images_upload_base_path",{processor:"string",default:""}),registerOption("images_upload_credentials",{processor:"boolean",default:!1}),registerOption("images_upload_handler",{processor:"function"}),registerOption("language",{processor:"string",default:"en"}),registerOption("language_url",{processor:"string",default:""}),registerOption("entity_encoding",{processor:"string",default:"named"}),registerOption("indent",{processor:"boolean",default:!0}),registerOption("indent_before",{processor:"string",default:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,details,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist"}),registerOption("indent_after",{processor:"string",default:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,details,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist"}),registerOption("indent_use_margin",{processor:"boolean",default:!1}),registerOption("indentation",{processor:"string",default:"40px"}),registerOption("content_css",{processor:value=>{const valid=!1===value||isString(value)||isArrayOf(value,isString);return valid?isString(value)?{value:map$3(value.split(","),trim$4),valid}:isArray$1(value)?{value,valid}:!1===value?{value:[],valid}:{value,valid}:{valid:!1,message:"Must be false, a string or an array of strings."}},default:isInline$1(editor)?[]:["default"]}),registerOption("content_style",{processor:"string"}),registerOption("content_css_cors",{processor:"boolean",default:!1}),registerOption("font_css",{processor:value=>{const valid=isString(value)||isArrayOf(value,isString);return valid?{value:isArray$1(value)?value:map$3(value.split(","),trim$4),valid}:{valid:!1,message:"Must be a string or an array of strings."}},default:[]}),registerOption("inline_boundaries",{processor:"boolean",default:!0}),registerOption("inline_boundaries_selector",{processor:"string",default:"a[href],code,span.mce-annotation"}),registerOption("object_resizing",{processor:value=>{const valid=isBoolean(value)||isString(value);return valid?!1===value||deviceDetection$1.isiPhone()||deviceDetection$1.isiPad()?{value:"",valid}:{value:!0===value?"table,img,figure.image,div,video,iframe":value,valid}:{valid:!1,message:"Must be boolean or a string"}},default:!isTouch}),registerOption("resize_img_proportional",{processor:"boolean",default:!0}),registerOption("event_root",{processor:"object"}),registerOption("service_message",{processor:"string"}),registerOption("theme",{processor:value=>!1===value||isString(value)||isFunction(value),default:"silver"}),registerOption("theme_url",{processor:"string"}),registerOption("formats",{processor:"object"}),registerOption("format_empty_lines",{processor:"boolean",default:!1}),registerOption("format_noneditable_selector",{processor:"string",default:""}),registerOption("preview_styles",{processor:value=>{const valid=!1===value||isString(value);return valid?{value:!1===value?"":value,valid}:{valid:!1,message:"Must be false or a string"}},default:"font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"}),registerOption("custom_ui_selector",{processor:"string",default:""}),registerOption("hidden_input",{processor:"boolean",default:!0}),registerOption("submit_patch",{processor:"boolean",default:!0}),registerOption("encoding",{processor:"string"}),registerOption("add_form_submit_trigger",{processor:"boolean",default:!0}),registerOption("add_unload_trigger",{processor:"boolean",default:!0}),registerOption("custom_undo_redo_levels",{processor:"number",default:0}),registerOption("disable_nodechange",{processor:"boolean",default:!1}),registerOption("readonly",{processor:"boolean",default:!1}),registerOption("editable_root",{processor:"boolean",default:!0}),registerOption("plugins",{processor:"string[]",default:[]}),registerOption("external_plugins",{processor:"object"}),registerOption("forced_plugins",{processor:"string[]"}),registerOption("model",{processor:"string",default:editor.hasPlugin("rtc")?"plugin":"dom"}),registerOption("model_url",{processor:"string"}),registerOption("block_unsupported_drop",{processor:"boolean",default:!0}),registerOption("visual",{processor:"boolean",default:!0}),registerOption("visual_table_class",{processor:"string",default:"mce-item-table"}),registerOption("visual_anchor_class",{processor:"string",default:"mce-item-anchor"}),registerOption("iframe_aria_text",{processor:"string",default:"Rich Text Area. Press ALT-0 for help."}),registerOption("setup",{processor:"function"}),registerOption("init_instance_callback",{processor:"function"}),registerOption("url_converter",{processor:"function",default:editor.convertURL}),registerOption("url_converter_scope",{processor:"object",default:editor}),registerOption("urlconverter_callback",{processor:"function"}),registerOption("allow_conditional_comments",{processor:"boolean",default:!1}),registerOption("allow_html_data_urls",{processor:"boolean",default:!1}),registerOption("allow_svg_data_urls",{processor:"boolean"}),registerOption("allow_html_in_named_anchor",{processor:"boolean",default:!1}),registerOption("allow_script_urls",{processor:"boolean",default:!1}),registerOption("allow_unsafe_link_target",{processor:"boolean",default:!1}),registerOption("convert_fonts_to_spans",{processor:"boolean",default:!0,deprecated:!0}),registerOption("fix_list_elements",{processor:"boolean",default:!1}),registerOption("preserve_cdata",{processor:"boolean",default:!1}),registerOption("remove_trailing_brs",{processor:"boolean",default:!0}),registerOption("pad_empty_with_br",{processor:"boolean",default:!1}),registerOption("inline_styles",{processor:"boolean",default:!0,deprecated:!0}),registerOption("element_format",{processor:"string",default:"html"}),registerOption("entities",{processor:"string"}),registerOption("schema",{processor:"string",default:"html5"}),registerOption("convert_urls",{processor:"boolean",default:!0}),registerOption("relative_urls",{processor:"boolean",default:!0}),registerOption("remove_script_host",{processor:"boolean",default:!0}),registerOption("custom_elements",{processor:"string"}),registerOption("extended_valid_elements",{processor:"string"}),registerOption("invalid_elements",{processor:"string"}),registerOption("invalid_styles",{processor:stringOrObjectProcessor}),registerOption("valid_children",{processor:"string"}),registerOption("valid_classes",{processor:stringOrObjectProcessor}),registerOption("valid_elements",{processor:"string"}),registerOption("valid_styles",{processor:stringOrObjectProcessor}),registerOption("verify_html",{processor:"boolean",default:!0}),registerOption("auto_focus",{processor:value=>isString(value)||!0===value}),registerOption("browser_spellcheck",{processor:"boolean",default:!1}),registerOption("protect",{processor:"array"}),registerOption("images_file_types",{processor:"string",default:"jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp"}),registerOption("deprecation_warnings",{processor:"boolean",default:!0}),registerOption("a11y_advanced_options",{processor:"boolean",default:!1}),registerOption("api_key",{processor:"string"}),registerOption("paste_block_drop",{processor:"boolean",default:!1}),registerOption("paste_data_images",{processor:"boolean",default:!0}),registerOption("paste_preprocess",{processor:"function"}),registerOption("paste_postprocess",{processor:"function"}),registerOption("paste_webkit_styles",{processor:"string",default:"none"}),registerOption("paste_remove_styles_if_webkit",{processor:"boolean",default:!0}),registerOption("paste_merge_formats",{processor:"boolean",default:!0}),registerOption("smart_paste",{processor:"boolean",default:!0}),registerOption("paste_as_text",{processor:"boolean",default:!1}),registerOption("paste_tab_spaces",{processor:"number",default:4}),registerOption("text_patterns",{processor:value=>isArrayOf(value,isObject)||!1===value?{value:fromRawPatterns(!1===value?[]:value),valid:!0}:{valid:!1,message:"Must be an array of objects or false."},default:[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}]}),registerOption("text_patterns_lookup",{processor:value=>{return isFunction(value)?{value:(lookupFn=value,ctx=>{const rawPatterns=lookupFn(ctx);return fromRawPatterns(rawPatterns)}),valid:!0}:{valid:!1,message:"Must be a single function"};var lookupFn},default:_ctx=>[]}),registerOption("noneditable_class",{processor:"string",default:"mceNonEditable"}),registerOption("editable_class",{processor:"string",default:"mceEditable"}),registerOption("noneditable_regexp",{processor:value=>isArrayOf(value,isRegExp)?{value,valid:!0}:isRegExp(value)?{value:[value],valid:!0}:{valid:!1,message:"Must be a RegExp or an array of RegExp."},default:[]}),registerOption("table_tab_navigation",{processor:"boolean",default:!0}),registerOption("highlight_on_focus",{processor:"boolean",default:!1}),registerOption("xss_sanitization",{processor:"boolean",default:!0}),registerOption("details_initial_state",{processor:value=>{const valid=contains$2(["inherited","collapsed","expanded"],value);return valid?{value,valid}:{valid:!1,message:"Must be one of: inherited, collapsed, or expanded."}},default:"inherited"}),registerOption("details_serialized_state",{processor:value=>{const valid=contains$2(["inherited","collapsed","expanded"],value);return valid?{value,valid}:{valid:!1,message:"Must be one of: inherited, collapsed, or expanded."}},default:"inherited"}),registerOption("init_content_sync",{processor:"boolean",default:!1}),registerOption("newdocument_content",{processor:"string",default:""}),registerOption("force_hex_color",{processor:value=>{const options=["always","rgb_only","off"],valid=contains$2(options,value);return valid?{value,valid}:{valid:!1,message:`Must be one of: ${options.join(", ")}.`}},default:"off"}),registerOption("sandbox_iframes",{processor:"boolean",default:!1}),registerOption("convert_unsafe_embeds",{processor:"boolean",default:!1}),editor.on("ScriptsLoaded",(()=>{registerOption("directionality",{processor:"string",default:I18n.isRtl()?"rtl":void 0}),registerOption("placeholder",{processor:"string",default:DOM$a.getAttrib(editor.getElement(),"placeholder")})}))})(self);const getOption=this.options.get;getOption("deprecation_warnings")&&logWarnings(options,normalizedOptions);const suffix=getOption("suffix");suffix&&(editorManager.suffix=suffix),this.suffix=editorManager.suffix;const baseUrl=getOption("base_url");baseUrl&&editorManager._setBaseUrl(baseUrl),this.baseUri=editorManager.baseURI;const referrerPolicy=getReferrerPolicy(self);referrerPolicy&&(ScriptLoader.ScriptLoader._setReferrerPolicy(referrerPolicy),DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(referrerPolicy));const contentCssCors=hasContentCssCors(self);isNonNullable(contentCssCors)&&DOMUtils.DOM.styleSheetLoader._setContentCssCors(contentCssCors),AddOnManager.languageLoad=getOption("language_load"),AddOnManager.baseURL=editorManager.baseURL,this.setDirty(!1),this.documentBaseURI=new URI(getDocumentBaseUrl(self),{base_uri:this.baseUri}),this.baseURI=this.baseUri,this.inline=isInline$1(self),this.hasVisual=isVisualAidsEnabled(self),this.shortcuts=new Shortcuts(this),this.editorCommands=new EditorCommands(this),registerCommands(this);const cacheSuffix=getOption("cache_suffix");cacheSuffix&&(Env.cacheSuffix=cacheSuffix.replace(/^[\?\&]+/,"")),this.ui={registry:registry(),styleSheetLoader:void 0,show:noop,hide:noop,setEnabled:noop,isEnabled:always},this.mode=create$4(self),editorManager.dispatch("SetupEditor",{editor:this});const setupCallback=getSetupCallback(self);isFunction(setupCallback)&&setupCallback.call(self,self)}render(){render(this)}focus(skipFocus){this.execCommand("mceFocus",!1,skipFocus)}hasFocus(){return hasFocus(this)}translate(text){return I18n.translate(text)}getParam(name,defaultVal,type){const options=this.options;return options.isRegistered(name)||(isNonNullable(type)?options.register(name,{processor:type,default:defaultVal}):options.register(name,{processor:always,default:defaultVal})),options.isSet(name)||isUndefined(defaultVal)?options.get(name):defaultVal}hasPlugin(name,loaded){return!!contains$2(getPlugins(this),name)&&(!loaded||void 0!==PluginManager.get(name))}nodeChanged(args){this._nodeChangeDispatcher.nodeChanged(args)}addCommand(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)}addQueryStateHandler(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)}addQueryValueHandler(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)}addShortcut(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)}execCommand(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)}queryCommandState(cmd){return this.editorCommands.queryCommandState(cmd)}queryCommandValue(cmd){return this.editorCommands.queryCommandValue(cmd)}queryCommandSupported(cmd){return this.editorCommands.queryCommandSupported(cmd)}show(){const self=this;self.hidden&&(self.hidden=!1,self.inline?self.getBody().contentEditable="true":(DOM$1.show(self.getContainer()),DOM$1.hide(self.id)),self.load(),self.dispatch("show"))}hide(){const self=this;self.hidden||(self.save(),self.inline?(self.getBody().contentEditable="false",self===self.editorManager.focusedEditor&&(self.editorManager.focusedEditor=null)):(DOM$1.hide(self.getContainer()),DOM$1.setStyle(self.id,"display",self.orgDisplay)),self.hidden=!0,self.dispatch("hide"))}isHidden(){return this.hidden}setProgressState(state,time){this.dispatch("ProgressState",{state,time})}load(args={}){const self=this,elm=self.getElement();if(self.removed)return"";if(elm){const loadArgs={...args,load:!0},value=isTextareaOrInput(elm)?elm.value:elm.innerHTML,html=self.setContent(value,loadArgs);return loadArgs.no_events||self.dispatch("LoadContent",{...loadArgs,element:elm}),html}return""}save(args={}){const self=this;let elm=self.getElement();if(!elm||!self.initialized||self.removed)return"";const getArgs={...args,save:!0,element:elm};let html=self.getContent(getArgs);const saveArgs={...getArgs,content:html};if(saveArgs.no_events||self.dispatch("SaveContent",saveArgs),"raw"===saveArgs.format&&self.dispatch("RawSaveContent",saveArgs),html=saveArgs.content,isTextareaOrInput(elm))elm.value=html;else{!args.is_removing&&self.inline||(elm.innerHTML=html);const form=DOM$1.getParent(self.id,"form");form&&each$1(form.elements,(elm=>elm.name!==self.id||(elm.value=html,!1)))}return saveArgs.element=getArgs.element=elm=null,!1!==saveArgs.set_dirty&&self.setDirty(!1),html}setContent(content,args){return setContent(this,content,args)}getContent(args){return getContent(this,args)}insertContent(content,args){args&&(content=extend({content},args)),this.execCommand("mceInsertContent",!1,content)}resetContent(initialContent){void 0===initialContent?setContent(this,this.startContent,{format:"raw"}):setContent(this,initialContent),this.undoManager.reset(),this.setDirty(!1),this.nodeChanged()}isDirty(){return!this.isNotDirty}setDirty(state){const oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!==oldState&&this.dispatch("dirty")}getContainer(){const self=this;return self.container||(self.container=self.editorContainer||DOM$1.get(self.id+"_parent")),self.container}getContentAreaContainer(){return this.contentAreaContainer}getElement(){return this.targetElm||(this.targetElm=DOM$1.get(this.id)),this.targetElm}getWin(){const self=this;if(!self.contentWindow){const elm=self.iframeElement;elm&&(self.contentWindow=elm.contentWindow)}return self.contentWindow}getDoc(){const self=this;if(!self.contentDocument){const win=self.getWin();win&&(self.contentDocument=win.document)}return self.contentDocument}getBody(){var _a,_b;const doc=this.getDoc();return null!==(_b=null!==(_a=this.bodyElement)&&void 0!==_a?_a:null==doc?void 0:doc.body)&&void 0!==_b?_b:null}convertURL(url,name,elm){const self=this,getOption=self.options.get,urlConverterCallback=getUrlConverterCallback(self);if(isFunction(urlConverterCallback))return urlConverterCallback.call(self,url,elm,!0,name);if(!getOption("convert_urls")||"link"===elm||isObject(elm)&&"LINK"===elm.nodeName||0===url.indexOf("file:")||0===url.length)return url;const urlObject=new URI(url);return"http"!==urlObject.protocol&&"https"!==urlObject.protocol&&""!==urlObject.protocol?url:getOption("relative_urls")?self.documentBaseURI.toRelative(url):url=self.documentBaseURI.toAbsolute(url,getOption("remove_script_host"))}addVisual(elm){addVisual(this,elm)}setEditableRoot(state){((editor,state)=>{editor._editableRoot!==state&&(editor._editableRoot=state,editor.readonly||(editor.getBody().contentEditable=String(editor.hasEditableRoot()),editor.nodeChanged()),((editor,state)=>{editor.dispatch("EditableRootStateChange",{state})})(editor,state))})(this,state)}hasEditableRoot(){return this._editableRoot}remove(){remove$1(this)}destroy(automatic){destroy(this,automatic)}uploadImages(){return this.editorUpload.uploadImages()}_scanForImages(){return this.editorUpload.scanForImages()}}const DOM=DOMUtils.DOM,each=Tools.each;let beforeUnloadDelegate,boundGlobalEvents=!1,editors=[];const globalEventDelegate=e=>{const type=e.type;each(EditorManager.get(),(editor=>{switch(type){case"scroll":editor.dispatch("ScrollWindow",e);break;case"resize":editor.dispatch("ResizeWindow",e)}}))},toggleGlobalEvents=state=>{if(state!==boundGlobalEvents){const DOM=DOMUtils.DOM;state?(DOM.bind(window,"resize",globalEventDelegate),DOM.bind(window,"scroll",globalEventDelegate)):(DOM.unbind(window,"resize",globalEventDelegate),DOM.unbind(window,"scroll",globalEventDelegate)),boundGlobalEvents=state}},removeEditorFromList=targetEditor=>{const oldEditors=editors;return editors=filter$5(editors,(editor=>targetEditor!==editor)),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=editors.length>0?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length},isQuirksMode="CSS1Compat"!==document.compatMode,EditorManager={...Observable,baseURI:null,baseURL:null,defaultOptions:{},documentBaseURL:null,suffix:null,majorVersion:"6",minorVersion:"8.5",releaseDate:"TBD",i18n:I18n,activeEditor:null,focusedEditor:null,setup(){let baseURL="",suffix="",documentBaseURL=URI.getDocumentBaseUrl(document.location);/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/"));const preInit=window.tinymce||window.tinyMCEPreInit;if(preInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{const scripts=document.getElementsByTagName("script");for(let i=0;i<scripts.length;i++){const src=scripts[i].src||"";if(""===src)continue;const srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!==srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}if(!baseURL&&document.currentScript){const src=document.currentScript.src;-1!==src.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"))}}var editorManager;this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,(editorManager=this).on("AddEditor",curry(registerEvents$1,editorManager)),editorManager.on("RemoveEditor",curry(unregisterDocumentEvents,editorManager))},overrideDefaults(defaultOptions){const baseUrl=defaultOptions.base_url;baseUrl&&this._setBaseUrl(baseUrl);const suffix=defaultOptions.suffix;suffix&&(this.suffix=suffix),this.defaultOptions=defaultOptions;const pluginBaseUrls=defaultOptions.plugin_base_urls;void 0!==pluginBaseUrls&&each$d(pluginBaseUrls,((pluginBaseUrl,pluginName)=>{AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl}))},init(options){const self=this;let result;const invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu"," ");let provideResults=editors=>{result=editors};const initEditors=()=>{let initCount=0;const editors=[];let targets;DOM.unbind(window,"ready",initEditors),(name=>{const callback=options[name];if(callback)callback.apply(self,[])})("onpageload"),targets=((xs,comparator)=>{const r=[],isDuplicated=isFunction(comparator)?x=>exists(r,(i=>comparator(i,x))):x=>contains$2(r,x);for(let i=0,len=xs.length;i<len;i++){const x=xs[i];isDuplicated(x)||r.push(x)}return r})((options=>Env.browser.isIE()||Env.browser.isEdge()?(initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tiny.cloud/docs/tinymce/6/support/#supportedwebbrowsers"),[]):isQuirksMode?(initError("Failed to initialize the editor as the document is not in standards mode. TinyMCE requires standards mode."),[]):isString(options.selector)?DOM.select(options.selector):isNonNullable(options.target)?[options.target]:[])(options)),Tools.each(targets,(elm=>{var editor;(editor=self.get(elm.id))&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0)})),targets=Tools.grep(targets,(elm=>!self.get(elm.id))),0===targets.length?provideResults([]):each(targets,(elm=>{((options,elm)=>options.inline&&elm.tagName.toLowerCase()in invalidInlineTargets)(options,elm)?initError("Could not initialize inline editor on invalid inline target element",elm):((id,options,targetElm)=>{const editor=new Editor(id,options,self);editors.push(editor),editor.on("init",(()=>{++initCount===targets.length&&provideResults(editors)})),editor.targetElm=editor.targetElm||targetElm,editor.render()})((elm=>{let id=elm.id;return id||(id=get$a(elm,"name").filter((name=>!DOM.get(name))).getOrThunk(DOM.uniqueId),elm.setAttribute("id",id)),id})(elm),options,elm)}))};return DOM.bind(window,"ready",initEditors),new Promise((resolve=>{result?resolve(result):provideResults=editors=>{resolve(editors)}}))},get(id){return 0===arguments.length?editors.slice(0):isString(id)?find$2(editors,(editor=>editor.id===id)).getOr(null):isNumber(id)&&editors[id]?editors[id]:null},add(editor){const self=this,existingEditor=self.get(editor.id);return existingEditor===editor||(null===existingEditor&&editors.push(editor),toggleGlobalEvents(!0),self.activeEditor=editor,self.dispatch("AddEditor",{editor}),beforeUnloadDelegate||(beforeUnloadDelegate=e=>{const event=self.dispatch("BeforeUnload");if(event.returnValue)return e.preventDefault(),e.returnValue=event.returnValue,event.returnValue},window.addEventListener("beforeunload",beforeUnloadDelegate))),editor},createEditor(id,options){return this.add(new Editor(id,options,this))},remove(selector){const self=this;let editor;if(selector){if(!isString(selector))return editor=selector,isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.dispatch("RemoveEditor",{editor}),0===editors.length&&window.removeEventListener("beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors.length>0),editor);each(DOM.select(selector),(elm=>{editor=self.get(elm.id),editor&&self.remove(editor)}))}else for(let i=editors.length-1;i>=0;i--)self.remove(editors[i])},execCommand(cmd,ui,value){var _a;const self=this,editorId=isObject(value)?null!==(_a=value.id)&&void 0!==_a?_a:value.index:value;switch(cmd){case"mceAddEditor":if(!self.get(editorId)){const editorOptions=value.options;new Editor(editorId,editorOptions,self).render()}return!0;case"mceRemoveEditor":{const editor=self.get(editorId);return editor&&editor.remove(),!0}case"mceToggleEditor":{const editor=self.get(editorId);return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(self.execCommand("mceAddEditor",!1,value),!0)}}return!!self.activeEditor&&self.activeEditor.execCommand(cmd,ui,value)},triggerSave:()=>{each(editors,(editor=>{editor.save()}))},addI18n:(code,items)=>{I18n.add(code,items)},translate:text=>I18n.translate(text),setActive(editor){const activeEditor=this.activeEditor;this.activeEditor!==editor&&(activeEditor&&activeEditor.dispatch("deactivate",{relatedTarget:editor}),editor.dispatch("activate",{relatedTarget:activeEditor})),this.activeEditor=editor},_setBaseUrl(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)}};EditorManager.setup();const FakeClipboard=(()=>{const dataValue=value$2();return{FakeClipboardItem:items=>({items,types:keys(items),getType:type=>get$a(items,type).getOrUndefined()}),write:data=>{dataValue.set(data)},read:()=>dataValue.get().getOrUndefined(),clear:dataValue.clear}})(),min=Math.min,max=Math.max,round=Math.round,relativePosition=(rect,targetRect,rel)=>{let x=targetRect.x,y=targetRect.y;const w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,relChars=(rel||"").split("");return"b"===relChars[0]&&(y+=targetH),"r"===relChars[1]&&(x+=targetW),"c"===relChars[0]&&(y+=round(targetH/2)),"c"===relChars[1]&&(x+=round(targetW/2)),"b"===relChars[3]&&(y-=h),"r"===relChars[4]&&(x-=w),"c"===relChars[3]&&(y-=round(h/2)),"c"===relChars[4]&&(x-=round(w/2)),create$2(x,y,w,h)},create$2=(x,y,w,h)=>({x,y,w,h}),Rect={inflate:(rect,w,h)=>create$2(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h),relativePosition,findBestRelativePosition:(rect,targetRect,constrainRect,rels)=>{for(let i=0;i<rels.length;i++){const pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i]}return null},intersect:(rect,cropRect)=>{const x1=max(rect.x,cropRect.x),y1=max(rect.y,cropRect.y),x2=min(rect.x+rect.w,cropRect.x+cropRect.w),y2=min(rect.y+rect.h,cropRect.y+cropRect.h);return x2-x1<0||y2-y1<0?null:create$2(x1,y1,x2-x1,y2-y1)},clamp:(rect,clampRect,fixedSize)=>{let x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h;const cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max(0,clampRect.x-x1),underflowY1=max(0,clampRect.y-y1),overflowX2=max(0,x2-cx2),overflowY2=max(0,y2-cy2);return x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),x2-=overflowX2,y2-=overflowY2,create$2(x1,y1,x2-x1,y2-y1)},create:create$2,fromClientRect:clientRect=>create$2(clientRect.left,clientRect.top,clientRect.width,clientRect.height)},Resource=(()=>{const tasks={},resultFns={},resources={};return{load:(id,url)=>{const loadErrMsg=`Script at URL "${url}" failed to load`,runErrMsg=`Script at URL "${url}" did not call \`tinymce.Resource.add('${id}', data)\` within 1 second`;if(void 0!==tasks[id])return tasks[id];{const task=new Promise(((resolve,reject)=>{const waiter=((resolveCb,rejectCb,timeout=1e3)=>{let done=!1,timer=null;const complete=completer=>(...args)=>{done||(done=!0,null!==timer&&(clearTimeout(timer),timer=null),completer.apply(null,args))},resolve=complete(resolveCb),reject=complete(rejectCb);return{start:(...args)=>{done||null!==timer||(timer=setTimeout((()=>reject.apply(null,args)),timeout))},resolve,reject}})(resolve,reject);resultFns[id]=waiter.resolve,ScriptLoader.ScriptLoader.loadScript(url).then((()=>waiter.start(runErrMsg)),(()=>waiter.reject(loadErrMsg)))}));return tasks[id]=task,task}},add:(id,data)=>{void 0!==resultFns[id]&&(resultFns[id](data),delete resultFns[id]),tasks[id]=Promise.resolve(data),resources[id]=data},has:id=>id in resources,get:id=>resources[id],unload:id=>{delete tasks[id]}}})();let localStorage;try{const test="__storage_test__";localStorage=window.localStorage,localStorage.setItem(test,test),localStorage.removeItem(test)}catch(e){localStorage=(()=>{let data={},keys=[];const storage={getItem:key=>data[key]||null,setItem:(key,value)=>{keys.push(key),data[key]=String(value)},key:index=>keys[index],removeItem:key=>{keys=keys.filter((k=>k===key)),delete data[key]},clear:()=>{keys=[],data={}},length:0};return Object.defineProperty(storage,"length",{get:()=>keys.length,configurable:!1,enumerable:!1}),storage})()}const publicApi={geom:{Rect},util:{Delay,Tools,VK,URI,EventDispatcher,Observable,I18n,LocalStorage:localStorage,ImageUploader:editor=>{const uploadStatus=UploadStatus(),uploader=createUploader(editor,uploadStatus);return{upload:(blobInfos,showNotification=!0)=>uploader.upload(blobInfos,showNotification?openNotification(editor):void 0)}}},dom:{EventUtils,TreeWalker:DomTreeWalker,TextSeeker,DOMUtils,ScriptLoader,RangeUtils,Serializer:DomSerializer,StyleSheetLoader,ControlSelection,BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles,Entities,Node:AstNode,Schema,DomParser,Writer,Serializer:HtmlSerializer},Env,AddOnManager,Annotator,Formatter,UndoManager,EditorCommands,WindowManager,NotificationManager,EditorObservable,Shortcuts,Editor,FocusManager,EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager,ThemeManager,ModelManager,IconManager,Resource,FakeClipboard,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,walk:Tools.walk,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix},tinymce$1=Tools.extend(EditorManager,publicApi);(tinymce=>{window.tinymce=tinymce,window.tinyMCE=tinymce})(tinymce$1),(tinymce=>{try{module.exports=tinymce}catch(_){}})(tinymce$1)}()}}]);