(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[5973],{"./src/app/design/atoms/card/card.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{i:()=>CardComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var card_componentngResource=__webpack_require__("./src/app/design/atoms/card/card.component.scss?ngResource"),card_componentngResource_default=__webpack_require__.n(card_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");let CardComponent=class CardComponent{};CardComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"app-card",template:'<div class="card">\n  <ng-content></ng-content>\n</div>',changeDetection:core.ChangeDetectionStrategy.OnPush,imports:[],styles:[card_componentngResource_default()]})],CardComponent)},"./src/app/design/organisms/quote-field/quote-field.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{k:()=>QuoteFieldComponent});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var quote_field_componentngResource=__webpack_require__("./src/app/design/organisms/quote-field/quote-field.component.scss?ngResource"),quote_field_componentngResource_default=__webpack_require__.n(quote_field_componentngResource),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),formly_service_service=__webpack_require__("./src/app/_services/formly/formly-service.service.ts"),routing_service=__webpack_require__("./src/app/_services/routing.service.ts"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),http=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),environment=__webpack_require__("./src/environments/environment.ts");let ArticleService=class ArticleService{constructor(routingService,http){this.routingService=routingService,this.http=http,this.apiUrl=environment.c.apiUrl,this.recentlyUpdatedUrl=`${this.apiUrl}/recentupdates`,this.searchUrl=`${this.apiUrl}/search`}getRecentlyUpdatedArticle(campaign,pageNumber){return null==pageNumber&&(pageNumber=0),this.http.get(`${this.recentlyUpdatedUrl}/${campaign}/${pageNumber}`).pipe((0,map.T)((entries=>entries.map((entry=>this.parseOverviewEntity(entry))))))}getGlobalSearchArticle(searchString){return this.http.get(`${this.searchUrl}/${searchString}`).pipe((0,map.T)((searchResponse=>{const searchArticleObjects=searchResponse.articles.map((item=>this.parseOverviewEntity(item)));return searchResponse.articles=searchArticleObjects,searchResponse})))}getCampaignSearchArticle(campaign,searchString){return this.http.get(`${this.searchUrl}/${campaign}/${searchString}`).pipe((0,map.T)((searchResponse=>{const searchArticleObjects=searchResponse.articles.map((item=>this.parseOverviewEntity(item)));return searchResponse.articles=searchArticleObjects,searchResponse})))}searchArticlesKind(campaign,searchTerm,articleKind){return this.http.get(`${this.searchUrl}/${campaign}/${articleKind}/${searchTerm}`).pipe((0,map.T)((response=>response.map((item=>this.parseOverviewEntity(item))))))}readArticle(articleId,articleKind){return this.http.get(`${this.searchUrl}/single/${articleKind}/${articleId}`).pipe((0,map.T)((resp=>this.parseOverviewEntity(resp))))}parseOverviewEntity(data){return{...data,getAbsoluteRouterUrl:this.generateUrlCallback(data)}}generateUrlCallback(data){const articleType=data.article_type,params={campaign:data.campaign_details.name};let routeName="";switch(articleType){case"character":params.name=data.name,routeName="character";break;case"creature":params.name=data.name,routeName="creature";break;case"diaryentry":params.session_number=data.session_details.session_number,params.isMainSession=data.session_details.is_main_session_int,params.authorName=data.author_details.name,routeName="diaryentry";break;case"encounter":params.session_number=data.diaryentry_details.session_number,params.isMainSession=data.diaryentry_details.is_main_session,params.authorName=data.diaryentry_details.author_name,params.encounterTitle=data.title,routeName="diaryentry-encounter";break;case"item":params.name=data.name,routeName="item";break;case"location":params.name=data.name,params.parent_name=data.parent_location_details.name,routeName="location";break;case"organization":params.name=data.name,routeName="organization";break;case"quest":params.name=data.name,routeName="quest";break;case"sessionaudio":params.isMainSession=data.session_details.is_main_session_int,params.sessionNumber=data.session_details.session_number,routeName="sessionaudio";break;case"session":routeName="sessions";break;case"map":case"mapmarker":params.name=data.name,routeName="map";break;case"timestamp":routeName="default-map";break;case"spell":params.name=data.name,routeName="spell";break;case"rules":params.name=data.name,routeName="rule"}return()=>this.routingService.getRoutePath(routeName,params)}static{this.ctorParameters=()=>[{type:routing_service.O},{type:http.Qq}]}};ArticleService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],ArticleService);var button_component=__webpack_require__("./src/app/design/atoms/button/button.component.ts"),card_component=__webpack_require__("./src/app/design/atoms/card/card.component.ts"),html_text_component=__webpack_require__("./src/app/design/atoms/html-text/html-text.component.ts"),molecules=__webpack_require__("./src/app/design/molecules/index.ts"),quote_component=__webpack_require__("./src/app/design/organisms/quote/quote.component.ts");let QuoteFieldComponent=class QuoteFieldComponent{constructor(routingService,formlyService,articleService){this.routingService=routingService,this.formlyService=formlyService,this.articleService=articleService,this.quote=core.input.required(),this.character=core.input.required(),this.campaignCharacters=core.input.required(),this.serverModel=core.input.required(),this.canCreate=(0,core.input)(!1),this.canUpdate=(0,core.input)(!1),this.canDelete=(0,core.input)(!1),this.encounters=core.input.required(),this.sessions=core.input.required(),this.quoteControlsBlacklist=(0,core.input)([]),this.quoteDelete=(0,core.output)(),this.quoteCreate=(0,core.output)(),this.quoteUpdate=(0,core.output)(),this.connectionDelete=(0,core.output)(),this.connectionCreate=(0,core.output)(),this.refreshQuote=(0,core.output)(),this.sessions$=(0,rxjs_interop.br)(this.sessions).pipe((0,take.s)(1)),this.encounters$=(0,rxjs_interop.br)(this.encounters).pipe((0,take.s)(1)),this.state=(0,core.signal)("DISPLAY"),this.badgeEntries=(0,core.computed)((()=>this.parseConnection(this.quote()?.connections??[]))),this.campaignName=(0,core.computed)((()=>this.character().campaign_details?.name)),this.isLoadingQuote=(0,core.signal)(!1),this.quoteOverviewUrl=(0,core.computed)((()=>this.routingService.getRoutePath("quote-overview",{name:this.character().name,campaign:this.campaignName}))),this.userModel=(0,core.signal)({}),this.formlyFields=(0,core.computed)((()=>[this.formlyService.buildInputConfig({key:"description",required:!0,inputKind:"STRING"}),this.formlyService.buildOverviewSelectConfig({key:"session",required:!0,campaign:this.campaignName(),options$:this.sessions$,labelProp:"name_full",valueProp:"pk"}),this.formlyService.buildTypeaheadConfig({key:"encounter",required:!1,getOptions:searchTerm=>this.articleService.searchArticlesKind(this.campaignName(),searchTerm,"encounter").pipe((0,catchError.W)((()=>(0,of.of)([])))),optionLabelProp:"name",optionValueProp:"pk",initialOption$:this.quote()?.encounter?this.articleService.readArticle(this.quote()?.encounter,"encounter"):(0,of.of)(null),formatSearchTerm:searchTerm=>searchTerm}),this.formlyService.buildEditorConfig({key:"quote",required:!0})])),(0,rxjs_interop.br)(this.quote).pipe((0,rxjs_interop.pQ)()).subscribe((()=>this.isLoadingQuote.set(!1)))}onSubmit(event){switch(this.state()){case"UPDATE":case"UPDATE_OUTDATED":this.quoteUpdate.emit(event);break;case"CREATE":this.quoteCreate.emit(event);break;default:throw new Error(`QuoteField - Submitted form while in state '${this.state()}', which is not possible.`)}this.changeState("DISPLAY",{})}onDelete(){this.quoteDelete.emit(this.quote()),this.changeState("DISPLAY",{})}onCancel(){this.changeState("DISPLAY",{})}onConnectionDelete(connection){this.canDelete()&&this.connectionDelete.emit(connection)}onConnectionCreate(character){if(!this.canCreate()||!this.quote)return;const newConnection={quote:this.quote()?.pk,character:character.pk};this.connectionCreate.emit(newConnection)}getNextRandomQuote(){this.isLoadingQuote.set(!0),this.refreshQuote.emit()}changeState(newState,newModel){this.state.set(newState),this.userModel.set({...newModel})}parseConnection(connections){return connections.map((con=>{const characterName=con.character_details?.name;return{text:characterName,badgeValue:con,link:this.routingService.getRoutePath("character",{name:characterName,campaign:this.campaignName})}}))}static{this.ctorParameters=()=>[{type:routing_service.O},{type:formly_service_service.$},{type:ArticleService}]}static{this.propDecorators={quote:[{type:core.Input,args:[{isSignal:!0,alias:"quote",required:!0,transform:void 0}]}],character:[{type:core.Input,args:[{isSignal:!0,alias:"character",required:!0,transform:void 0}]}],campaignCharacters:[{type:core.Input,args:[{isSignal:!0,alias:"campaignCharacters",required:!0,transform:void 0}]}],serverModel:[{type:core.Input,args:[{isSignal:!0,alias:"serverModel",required:!0,transform:void 0}]}],canCreate:[{type:core.Input,args:[{isSignal:!0,alias:"canCreate",required:!1,transform:void 0}]}],canUpdate:[{type:core.Input,args:[{isSignal:!0,alias:"canUpdate",required:!1,transform:void 0}]}],canDelete:[{type:core.Input,args:[{isSignal:!0,alias:"canDelete",required:!1,transform:void 0}]}],encounters:[{type:core.Input,args:[{isSignal:!0,alias:"encounters",required:!0,transform:void 0}]}],sessions:[{type:core.Input,args:[{isSignal:!0,alias:"sessions",required:!0,transform:void 0}]}],quoteControlsBlacklist:[{type:core.Input,args:[{isSignal:!0,alias:"quoteControlsBlacklist",required:!1,transform:void 0}]}],quoteDelete:[{type:core.Output,args:["quoteDelete"]}],quoteCreate:[{type:core.Output,args:["quoteCreate"]}],quoteUpdate:[{type:core.Output,args:["quoteUpdate"]}],connectionDelete:[{type:core.Output,args:["connectionDelete"]}],connectionCreate:[{type:core.Output,args:["connectionCreate"]}],refreshQuote:[{type:core.Output,args:["refreshQuote"]}]}}};QuoteFieldComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"app-quote-field",template:'@switch (state()) {\n  @case ("DISPLAY") {\n    <ng-container [ngTemplateOutlet]="display" />\n  }\n  @case ("UPDATE") {\n    <ng-container [ngTemplateOutlet]="update" />\n  }\n  @case ("CREATE") {\n    <ng-container [ngTemplateOutlet]="create" />\n  }\n  @case ("DELETE") {\n    <ng-container [ngTemplateOutlet]="delete" />\n  }\n}\n\n<ng-template #display>\n  <app-quote\n    [quote]="quote()"\n    [character]="character()"\n    [campaignCharacters]="campaignCharacters()"\n    [canCreate]="canCreate()"\n    [canUpdate]="canUpdate()"\n    [canDelete]="canDelete()"\n    [quoteControlsBlacklist]="quoteControlsBlacklist()"\n    (quoteCreate)="changeState(\'CREATE\', undefined)"\n    (quoteDelete)="changeState(\'DELETE\', quote())"\n    (quoteUpdate)="changeState(\'UPDATE\', quote())"\n    (connectionCreate)="connectionCreate.emit($event)"\n    (connectionDelete)="connectionDelete.emit($event)"\n    (refreshQuote)="refreshQuote.emit()"\n  ></app-quote>\n</ng-template>\n\n\x3c!-- Quote Edit Form --\x3e\n<ng-template #update>\n  <app-card class="form-card" (window:keydown.Escape)="onCancel()">\n    \x3c!-- Heading --\x3e\n    <h3 class="form-card__heading">Updating Quote {{ quote()?.pk }}</h3>\n\n    @if (canUpdate() && state() === "UPDATE") {\n      <app-form\n        class="form-card__form"\n        [model]="userModel()"\n        [fields]="formlyFields()"\n        [cancelButtonType]="\'DARK\'"\n        (formlySubmit)="onSubmit($event)"\n        (formlyCancel)="onCancel()"\n      ></app-form>\n    }\n\n    @if (state() === "UPDATE_OUTDATED") {\n      <app-compare-form\n        [fields]="formlyFields()"\n        [modelFromUser]="$any(userModel())"\n        [modelFromServer]="serverModel()"\n        [displayVertically]="true"\n        (formlySubmit)="onSubmit($event)"\n        (cancel)="changeState(\'DISPLAY\', undefined)"\n      ></app-compare-form>\n    }\n  </app-card>\n</ng-template>\n\n\x3c!-- Quote Create Form --\x3e\n<ng-template #create>\n  <app-card class="form-card" (window:keydown.Escape)="onCancel()">\n    \x3c!-- Heading --\x3e\n    <h5 class="form-card__heading">\n      Create Quote for <b>{{ character().name }}</b>\n    </h5>\n\n    \x3c!-- Form --\x3e\n    <app-form\n      class="form-card__form"\n      [model]="userModel()"\n      [fields]="formlyFields()"\n      [cancelButtonType]="\'DARK\'"\n      (formlySubmit)="onSubmit($event)"\n      (formlyCancel)="onCancel()"\n    ></app-form>\n  </app-card>\n</ng-template>\n\n\x3c!-- Quote Delete "Form" --\x3e\n<ng-template #delete>\n  <app-card class="form-card" (window:keydown.Escape)="onCancel()">\n    <h5 class="form-card__heading">Delete this quote?</h5>\n\n    <blockquote class="form-card__quote quote">\n      <app-html-text\n        class="quote__content"\n        [text]="quote()?.quote ?? \'\'"\n      ></app-html-text>\n\n      <div class="quote__description">\n        @if (quote()?.description) {\n          <app-html-text [text]="\'- \' + quote()?.description"></app-html-text>\n        }\n\n        @if (!quote()?.description) {\n          - {{ character().name }}\n        }\n      </div>\n    </blockquote>\n\n    <div class="form-card__confirmation confirmation">\n      <button\n        btn\n        class="confirmation__button"\n        [kind]="\'DARK\'"\n        [icon]="\'times\'"\n        [text]="\'No\'"\n        (clicked)="onCancel()"\n      ></button>\n      <button\n        btn\n        class="confirmation__button"\n        [kind]="\'DANGER\'"\n        [icon]="\'trash\'"\n        [text]="\'Yes\'"\n        (clicked)="onDelete()"\n      ></button>\n    </div>\n  </app-card>\n</ng-template>\n',imports:[common.NgTemplateOutlet,quote_component.w,card_component.i,molecules.s2,molecules.zx,html_text_component.m,button_component.Q],changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[quote_field_componentngResource_default()]})],QuoteFieldComponent)},"./src/app/design/atoms/card/card.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,".accordion {\n  --bs-accordion-active-bg: var(--bs-gray-900) !important;\n}\n\nbutton.btn.btn-link:hover {\n  text-decoration: none !important;\n}\n\nbutton.btn.btn-link:focus {\n  text-decoration: none !important;\n  box-shadow: none !important;\n}\n\n.card button.btn.btn-link {\n  width: 100%;\n  text-align: left;\n}\n\n.form-control {\n  height: 2.75rem;\n  font-size: 1.2rem;\n}\n\ninput.form-control {\n  background-color: transparent !important;\n  color: white !important;\n  border: solid white 1px !important;\n}\n\ninput.form-control:focus {\n  box-shadow: 3px blue;\n  color: white;\n}\n\nselect.form-select {\n  color: white !important;\n  background-color: #4c4c4c !important;\n}\n\nselect:focus {\n  background-color: #4c4c4c;\n  box-shadow: 3px blue;\n  color: white;\n}\n\noption {\n  background-color: #1b1f22;\n  color: white;\n  font-size: 18px;\n}\n\n.custom-control.custom-checkbox {\n  transform: scale(1.2);\n  transform-origin: 0;\n}\n\n.visually-hidden {\n  display: none;\n}\n\n.vh-50 {\n  height: 50vh;\n}\n\n.tooltip-inner {\n  --bs-tooltip-bg: var(--bs-info-bg-subtle);\n  --bs-tooltip-color: var(--bs-emphasis-color);\n}\n\n:host {\n  --card-bg-color: #393e41 !important;\n  --card-flex-direction: column;\n  --card-padding: var(--spacer-4);\n  border-radius: var(--bs-border-radius);\n}\n\n.card {\n  background-color: var(--card-bg-color);\n  padding: var(--card-padding);\n  flex-direction: var(--card-flex-direction);\n  width: 100%;\n  height: 100%;\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./src/app/design/organisms/quote-field/quote-field.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,".form-card {\n  padding: var(--spacer-4);\n  margin: var(--spacer-2);\n}\n.form-card__heading {\n  text-align: center;\n}\n.form-card__form {\n  margin-top: var(--spacer-3);\n  display: block;\n}\n.form-card__quote {\n  margin-top: var(--spacer-3);\n  margin-bottom: var(--spacer-3);\n}\n\n.confirmation__button {\n  margin-left: var(--spacer-2);\n  margin-right: var(--spacer-2);\n}\n\n.quote__description {\n  margin: var(--spacer-3) var(--spacer-0) var(--spacer-3) var(--spacer-3);\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);