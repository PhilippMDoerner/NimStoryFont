(self.webpackChunknimstoryfont_gui=self.webpackChunknimstoryfont_gui||[]).push([[7963],{"./src/app/design/animations/slideDown.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{V4:()=>slideOutFromBottom,sb:()=>slideUpFromBottom,st:()=>slideRight});var _angular_animations__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/animations/fesm2022/animations.mjs");const inactiveStyle=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.iF)({opacity:.2,transform:"translateY(50%)"}),activeStyle=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.iF)({opacity:1,transform:"translateY(0%)"}),slideUpFromBottom=((0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.hZ)("slideFromBottom",[(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":enter",[inactiveStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("500ms ease-out",activeStyle)]),(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":leave",[activeStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("500ms ease-in",inactiveStyle)])]),(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.hZ)("slideUpFromBottom",[(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":enter",[inactiveStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("500ms ease-out",activeStyle)])])),slideOutFromBottom=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.hZ)("slideOutFromBottom",[(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":leave",[activeStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("500ms ease-in",inactiveStyle)])]),inactiveSlideRightStyle=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.iF)({transform:"translateX(100%)"}),activeSlideRightStyle=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.iF)({transform:"translateX(0%)"}),slideRight=(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.hZ)("slideRight",[(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":enter",[inactiveSlideRightStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("250ms ease-in-out",activeSlideRightStyle)]),(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.kY)(":leave",[activeSlideRightStyle,(0,_angular_animations__WEBPACK_IMPORTED_MODULE_0__.i0)("250ms ease-in-out",inactiveSlideRightStyle)])])},"./src/app/design/organisms/focus-list/focus-list.component.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>FocusListComponent,m:()=>FocusListContextTypecastDirective});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var focus_list_componentngResource=__webpack_require__("./src/app/design/organisms/focus-list/focus-list.component.scss?ngResource"),focus_list_componentngResource_default=__webpack_require__.n(focus_list_componentngResource),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),merge=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/merge.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js"),scan=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/scan.js"),share=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/share.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),hotkey_service=__webpack_require__("./src/app/_services/hotkey.service.ts"),DOM=__webpack_require__("./src/utils/DOM.ts"),rxjs_operators=__webpack_require__("./src/utils/rxjs-operators.ts");let FocusListComponent=class FocusListComponent{constructor(){this.entries=core.input.required(),this.disableHotkeyNavigation=(0,core.input)(!1),this.itemTemplate=core.contentChild.required("itemTemplate"),this.separatorTemplate=(0,core.contentChild)("separator"),this.hotkeyService=(0,core.inject)(hotkey_service.Q),this.itemContainers=(0,core.viewChildren)("itemContainer"),this.focusItemEvent$=new Subject.B,this.arrowEvents$=(0,merge.h)(this.hotkeyService.watch("ArrowDown").pipe((0,map.T)((()=>({type:"down"})))),this.hotkeyService.watch("ArrowUp").pipe((0,map.T)((()=>({type:"up"}))))),this.focusIndex$=this.deriveFocusItemIndex(),this.scrollAndFocusOnArrowNavigation(this.focusIndex$,(0,rxjs_interop.br)(this.itemContainers),(0,rxjs_interop.br)(this.disableHotkeyNavigation))}deriveFocusItemIndex(){const lastItemIndex=(0,core.computed)((()=>this.entries().length)),focusEvents$=this.focusItemEvent$.pipe((0,map.T)((index=>({type:"selection",nextIndex:index})))),focusIndex$=(0,merge.h)(this.arrowEvents$,focusEvents$).pipe((0,withLatestFrom.E)((0,rxjs_interop.br)(lastItemIndex)),(0,scan.S)(((priorFocusIndex,[event,lastItemIndex])=>{let isNextIndexOutOfBounds=!1;switch(event.type){case"down":return null==priorFocusIndex?0:(isNextIndexOutOfBounds=priorFocusIndex+1>lastItemIndex,isNextIndexOutOfBounds?lastItemIndex:priorFocusIndex+1);case"up":return null==priorFocusIndex?lastItemIndex:(isNextIndexOutOfBounds=priorFocusIndex-1<0,isNextIndexOutOfBounds?0:priorFocusIndex-1);case"selection":return event.nextIndex}}),void 0),(0,share.u)());return focusIndex$}scrollAndFocusOnArrowNavigation(focusIndex$,itemContainers$,disableHotkeyNavigation$){const itemWithFocus=(0,combineLatest.z)({focusIndex:focusIndex$,itemContainers:itemContainers$}).pipe((0,filter.p)((({focusIndex})=>null!=focusIndex)),(0,map.T)((({focusIndex,itemContainers})=>itemContainers[focusIndex]?.nativeElement)));this.arrowEvents$.pipe((0,withLatestFrom.E)(disableHotkeyNavigation$),(0,filter.p)((([,disableHotkeyNavigation])=>!disableHotkeyNavigation)),(0,withLatestFrom.E)(itemWithFocus),(0,map.T)((([,itemWithFocus])=>itemWithFocus)),(0,rxjs_operators.u5)(),(0,distinctUntilChanged.F)(),(0,rxjs_interop.pQ)()).subscribe((itemWithFocus=>{itemWithFocus.scrollIntoView({behavior:"smooth",block:"start"});((0,DOM.L)(itemWithFocus)??itemWithFocus).focus()}))}static{this.ctorParameters=()=>[]}static{this.propDecorators={entries:[{type:core.Input,args:[{isSignal:!0,alias:"entries",required:!0,transform:void 0}]}],disableHotkeyNavigation:[{type:core.Input,args:[{isSignal:!0,alias:"disableHotkeyNavigation",required:!1,transform:void 0}]}],itemTemplate:[{type:core.ContentChild,args:["itemTemplate",{isSignal:!0}]}],separatorTemplate:[{type:core.ContentChild,args:["separator",{isSignal:!0}]}],itemContainers:[{type:core.ViewChildren,args:["itemContainer",{isSignal:!0}]}]}}};FocusListComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"app-focus-list",imports:[common.NgTemplateOutlet,common.AsyncPipe],template:'@let separator = separatorTemplate();\n<ul>\n  @for (entry of entries(); track entry.id) {\n    @let entryData =\n      {\n        data: entry.data,\n        index: $index,\n        first: $first,\n        last: $last,\n        isInFocus: $index === (focusIndex$ | async),\n      };\n\n    <li\n      class="item-container"\n      #itemContainer\n      (focusin)="this.focusItemEvent$.next($index)"\n      (focus)="this.focusItemEvent$.next($index)"\n    >\n      <ng-container\n        *ngTemplateOutlet="itemTemplate(); context: { $implicit: entryData }"\n      />\n    </li>\n\n    @if (separator && !$last) {\n      <ng-container\n        *ngTemplateOutlet="separator; context: { $implicit: entryData }"\n      />\n    }\n  }\n</ul>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[focus_list_componentngResource_default()]})],FocusListComponent);let FocusListContextTypecastDirective=class FocusListContextTypecastDirective{constructor(){this.inferContextTypeFrom=core.input.required()}static ngTemplateContextGuard(directive,ctx){return!0}static{this.propDecorators={inferContextTypeFrom:[{type:core.Input,args:[{isSignal:!0,alias:"inferContextTypeFrom",required:!0,transform:void 0}]}]}}};FocusListContextTypecastDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[inferContextTypeFrom]"})],FocusListContextTypecastDirective)},"./src/utils/math.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function getPseudoRandomId(max=Number.MAX_SAFE_INTEGER){return Math.floor(Math.random()*max)}__webpack_require__.d(__webpack_exports__,{d:()=>getPseudoRandomId})},"./src/app/design/organisms/rules/rules.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,NoPermissions:()=>NoPermissions,NoRules:()=>NoRules,__namedExportsOrder:()=>__namedExportsOrder,default:()=>rules_stories});var fesm2022_forms=__webpack_require__("./node_modules/@angular/forms/fesm2022/forms.mjs"),animations=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/animations.mjs"),testing=__webpack_require__("./node_modules/@angular/router/fesm2022/testing.mjs"),dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),angular_dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),formly_constants=__webpack_require__("./src/app/_modules/formly_constants.ts"),tslib_es6=(__webpack_require__("./node_modules/tinymce/tinymce.js"),__webpack_require__("./node_modules/tslib/tslib.es6.mjs"));var rules_componentngResource=__webpack_require__("./src/app/design/organisms/rules/rules.component.scss?ngResource"),rules_componentngResource_default=__webpack_require__.n(rules_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),router=__webpack_require__("./node_modules/@angular/router/fesm2022/router.mjs"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),hotkey_directive=__webpack_require__("./src/app/_directives/hotkey.directive.ts"),slideDown=__webpack_require__("./src/app/design/animations/slideDown.ts"),button_component=__webpack_require__("./src/app/design/atoms/button/button.component.ts"),spinner_component=__webpack_require__("./src/app/design/atoms/spinner/spinner.component.ts"),molecules=__webpack_require__("./src/app/design/molecules/index.ts"),math=__webpack_require__("./src/utils/math.ts"),rxjs_operators=__webpack_require__("./src/utils/rxjs-operators.ts"),focus_list_component=__webpack_require__("./src/app/design/organisms/focus-list/focus-list.component.ts"),rule_component=__webpack_require__("./src/app/design/organisms/rule/rule.component.ts");let RulesComponent=class RulesComponent{constructor(){this.DEFAULT_TITLE="New Rule",this.campaignId=core.input.required(),this.rules=core.input.required(),this.canUpdate=core.input.required(),this.canDelete=core.input.required(),this.canCreate=core.input.required(),this.serverModel=core.input.required(),this.ruleDelete=(0,core.output)(),this.ruleUpdate=(0,core.output)(),this.ruleCreate=(0,core.output)(),this.ruleElements=(0,core.viewChildren)("rule"),this.isCreatingRule=(0,core.signal)(!1),this.createRuleData=(0,core.computed)((()=>({name:this.DEFAULT_TITLE,campaign:this.campaignId()}))),this.ruleCards=(0,core.computed)((()=>this.rules().map((rule=>({id:rule.pk??(0,math.d)(),data:{rule,isOpen:!1}})))));const ruleNameParam=(0,core.inject)(router.nX).snapshot.params.name;ruleNameParam&&this.scrollToRule(ruleNameParam)}onRuleDelete(ruleToDelete){this.ruleDelete.emit(ruleToDelete)}onRuleCreate(rule){this.ruleCreate.emit({...rule,campaign:this.campaignId()}),this.isCreatingRule.set(!1)}cancelRuleCreation(){this.isCreatingRule.set(!1)}addRule(){this.isCreatingRule.set(!0)}scrollToRule(ruleName){(0,rxjs_interop.br)(this.ruleElements).pipe((0,rxjs_interop.pQ)(),(0,map.T)((elements=>elements.find((el=>el.nativeElement.id===ruleName)))),(0,rxjs_operators.u5)(),(0,take.s)(1)).subscribe((ruleElement=>{ruleElement.nativeElement.scrollIntoView({behavior:"instant"})}))}static{this.ctorParameters=()=>[]}static{this.propDecorators={campaignId:[{type:core.Input,args:[{isSignal:!0,alias:"campaignId",required:!0,transform:void 0}]}],rules:[{type:core.Input,args:[{isSignal:!0,alias:"rules",required:!0,transform:void 0}]}],canUpdate:[{type:core.Input,args:[{isSignal:!0,alias:"canUpdate",required:!0,transform:void 0}]}],canDelete:[{type:core.Input,args:[{isSignal:!0,alias:"canDelete",required:!0,transform:void 0}]}],canCreate:[{type:core.Input,args:[{isSignal:!0,alias:"canCreate",required:!0,transform:void 0}]}],serverModel:[{type:core.Input,args:[{isSignal:!0,alias:"serverModel",required:!0,transform:void 0}]}],ruleDelete:[{type:core.Output,args:["ruleDelete"]}],ruleUpdate:[{type:core.Output,args:["ruleUpdate"]}],ruleCreate:[{type:core.Output,args:["ruleCreate"]}],ruleElements:[{type:core.ViewChildren,args:["rule",{isSignal:!0}]}]}}};RulesComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"app-rules",template:'<div class="container list">\n  @if (canCreate()) {\n    <div class="list__button">\n      <button\n        btn\n        [kind]="\'PRIMARY\'"\n        [text]="\'Add Rule\'"\n        [icon]="\'plus\'"\n        (clicked)="addRule()"\n        [hotkey]="\'c\'"\n        (hotkeyPressed)="addRule()"\n      ></button>\n    </div>\n  }\n\n  <div class="row">\n    @if (isCreatingRule()) {\n      <div class="list__rule-card rule-card" [@slideUpFromBottom]>\n        <app-collapsible-panel [isOpen]="true" [ariaLevel]="2">\n          <span heading>\n            {{ createRuleData().name }}\n          </span>\n\n          <app-rule\n            body\n            class="rule-card__rule"\n            [rule]="createRuleData()"\n            [serverModel]="undefined"\n            [canUpdate]="false"\n            [canDelete]="false"\n            [canCreate]="canCreate()"\n            [cancelButtonType]="\'DARK\'"\n            (ruleCreate)="onRuleCreate($event)"\n            (ruleCreateCancel)="cancelRuleCreation()"\n          ></app-rule>\n        </app-collapsible-panel>\n      </div>\n    }\n    <app-focus-list [entries]="ruleCards()" #focusListComponent>\n      <ng-template\n        #itemTemplate\n        let-focusEntry\n        [inferContextTypeFrom]="focusListComponent"\n      >\n        <div\n          class="list__rule-card rule-card"\n          [@slideOutFromBottom]\n          [id]="focusEntry.data.rule.name"\n          #rule\n        >\n          <app-collapsible-panel\n            [isOpen]="focusEntry.data.isOpen"\n            [ariaLevel]="2"\n          >\n            <span heading>\n              {{ focusEntry.data.rule.name }}\n            </span>\n\n            <app-rule\n              body\n              class="rule-card__rule"\n              [rule]="focusEntry.data.rule"\n              [serverModel]="serverModel()"\n              [canUpdate]="canUpdate()"\n              [canDelete]="canDelete()"\n              [canCreate]="canCreate()"\n              [cancelButtonType]="\'DARK\'"\n              [disabledHotkeys]="!focusEntry.isInFocus"\n              (ruleDelete)="onRuleDelete($event)"\n              (ruleUpdate)="ruleUpdate.emit($event)"\n              (ruleCreateCancel)="cancelRuleCreation()"\n            ></app-rule>\n          </app-collapsible-panel>\n        </div>\n      </ng-template>\n    </app-focus-list>\n  </div>\n</div>\n\n\x3c!-- Loading Spinner --\x3e\n<ng-template #loading><app-spinner></app-spinner></ng-template>\n',animations:[slideDown.V4,slideDown.sb],imports:[button_component.Q,molecules.e9,rule_component.M,spinner_component.t,hotkey_directive.G,focus_list_component.e,focus_list_component.m],changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[rules_componentngResource_default()]})],RulesComponent);const dummyRule={getAbsoluteRouterUrl:()=>"/dnd/rules/1",pk:1,name:"The 'Critical Hit' Rule",creation_datetime:"2022-03-15T10:30:00Z",update_datetime:"2022-03-18T16:45:00Z",description:"\n  <p>In our campaign, we've decided to implement a 'critical hit' rule that can add some extra excitement to combat encounters. Whenever a player rolls a natural 20 on an attack roll, they will score a critical hit. This means that they will automatically hit their target, regardless of the target's AC, and will deal maximum damage for that attack. This rule applies to both players and enemies, so everyone has a chance to land a critical hit! </p>\n\n  <p>However, there is a risk involved in attempting a critical hit. If a player rolls a natural 1 on their attack roll while attempting a critical hit, they will suffer a critical failure. This means that their attack will miss and they will take some form of penalty, such as losing their balance and falling prone, or damaging their weapon in the process. This adds an element of unpredictability to combat, and encourages players to weigh the potential rewards and risks of attempting a critical hit.\" </p>\n\n  <p> This rule adds an exciting element of chance to combat encounters in the campaign, while also providing some risk and uncertainty for players who attempt to score a critical hit. By implementing this rule, players will have to think strategically about when to attempt a critical hit and when to play it safe, adding an additional layer of strategy and excitement to combat encounters. </p>\n  ",campaign:2,campaign_details:{id:2,name:"The Quest for the Lost City"}},rules_stories={title:"DesignSystem/Organisms/RulesComponent",component:RulesComponent,decorators:[(0,angular_dist.moduleMetadata)({imports:[fesm2022_forms.YN,fesm2022_forms.X1,animations.BrowserAnimationsModule,formly_constants.d_,testing.c]})],args:{rules:Array(10).fill(dummyRule),canCreate:!0,canUpdate:!0,canDelete:!0,serverModel:void 0}},Template=args=>({props:{...args,ruleDelete:(0,dist.XI)("ruleDelete"),ruleUpdate:(0,dist.XI)("ruleUpdate"),ruleCreate:(0,dist.XI)("ruleCreate")}}),Default=Template.bind({});Default.args={};const NoPermissions=Template.bind({});NoPermissions.args={canUpdate:!1,canCreate:!1,canDelete:!1};const NoRules=Template.bind({});NoRules.args={rules:[]};const __namedExportsOrder=["Default","NoPermissions","NoRules"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"args => ({\n  props: {\n    ...args,\n    ruleDelete: action('ruleDelete'),\n    ruleUpdate: action('ruleUpdate'),\n    ruleCreate: action('ruleCreate')\n  }\n})",...Default.parameters?.docs?.source}}},NoPermissions.parameters={...NoPermissions.parameters,docs:{...NoPermissions.parameters?.docs,source:{originalSource:"args => ({\n  props: {\n    ...args,\n    ruleDelete: action('ruleDelete'),\n    ruleUpdate: action('ruleUpdate'),\n    ruleCreate: action('ruleCreate')\n  }\n})",...NoPermissions.parameters?.docs?.source}}},NoRules.parameters={...NoRules.parameters,docs:{...NoRules.parameters?.docs,source:{originalSource:"args => ({\n  props: {\n    ...args,\n    ruleDelete: action('ruleDelete'),\n    ruleUpdate: action('ruleUpdate'),\n    ruleCreate: action('ruleCreate')\n  }\n})",...NoRules.parameters?.docs?.source}}}},"./src/app/design/organisms/focus-list/focus-list.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,"li {\n  list-style: none;\n}\n\nul {\n  padding-left: 0;\n}\n\n.item-container {\n  scroll-margin-top: var(--spacer-5);\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./src/app/design/organisms/rules/rules.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,".list__button {\n  width: fit-content;\n  margin-bottom: var(--spacer-3);\n}\n\n.rule-card {\n  margin-bottom: var(--spacer-3);\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);